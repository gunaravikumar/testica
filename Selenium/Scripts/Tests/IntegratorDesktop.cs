using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using OpenQA.Selenium;
using OpenQA.Selenium.Remote;
using OpenQA.Selenium.Support.UI;
using Selenium.Scripts.Pages;
using Selenium.Scripts.Pages.eHR;
using Selenium.Scripts.Pages.MergeServiceTool;
using Selenium.Scripts.Reusable.Generic;
using Selenium.Scripts.Pages.iConnect;
using TestStack.White.UIItems;
using TestStack.White.UIItems.TabItems;
using TestStack.White.UIItems.Finders;
using System.Threading;
using System.Data;
using System.Xml;
using OpenQA.Selenium.Interactions;
using Selenium.Scripts.Pages.MPAC;
using ComboBox = TestStack.White.UIItems.ListBoxItems.ComboBox;
using Window = TestStack.White.UIItems.WindowItems.Window;
using Dicom;
using Dicom.Network;
using System.Text.RegularExpressions;
using System.Diagnostics;

namespace Selenium.Scripts.Tests
{
    class IntegratorDesktop
    {
        public Login login { get; set; }
        public string filepath { get; set; }
        public EHR ehr { get; set; }
        public ExamImporter ei { get; set; }
        public WpfObjects wpfobject { get; set; }
        public ServiceTool servicetool { get; set; }

        public BasePage basepage { get; set; }
        public MpacLogin mpaclogin { get; set; }

        private string AuthenticationErrorMsg = "Error Occurred in operation: Client authentication failed.";
        private string MultiplePatientErrorMsg = "* Studies listed below may not belong to the same patient";
        private string ExpandText = "Show Search Criteria";
        private string HideText = "Hide Search Criteria";

        /// <summary>
        /// Constructor - Test Suite
        /// </summary>
        public IntegratorDesktop(String classname)
        {
            login = new Login();
            BasePage.InitializeControlIdMap();
            login.DriverGoTo(login.url);
            filepath = Config.TestSuitePath + Path.DirectorySeparatorChar + classname + ".xls";
            wpfobject = new WpfObjects();
            servicetool = new ServiceTool();
            ehr = new EHR();
            ei = new ExamImporter();
            basepage = new BasePage();
            mpaclogin = new MpacLogin();
        }

        /// <summary>
        /// Test case number 27935 - Direct Study Display
        /// </summary>
        public TestCaseResult Test_27935(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String EA131 = login.GetHostName(Config.EA1);

                //Initial Set-up
                servicetool.LaunchServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab("Integrator");
                wpfobject.WaitTillLoad();
                //servicetool.ClickModifyFromTab();
                //wpfobject.WaitTillLoad();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "URL Determined");
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("intg_chkAllowShowSelector");
                wpfobject.SelectCheckBox("intg_chkAllowShowSelectorSearch");
                servicetool.ApplyEnableFeatures();
                servicetool.RestartIISandWindowsServices();

                servicetool.CloseServiceTool();

                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                //Validate whether EHR application is launched or not
                if (WpfObjects._mainWindow.Visible)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(user: adminUserName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID", datasources: EA131);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;


                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                if (studyviewer.PatientDetailsInViewer()["PatientID"].ToLower().Equals(PatientID.ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Click the Printable View link.
                studyviewer.ClickElement("Print View");
                PageLoadWait.WaitForFrameLoad(20);
                var PrintWindow = BasePage.Driver.WindowHandles.Last();
                var StudyWindow = BasePage.Driver.CurrentWindowHandle;
                BasePage.Driver.SwitchTo().Window(PrintWindow);
                BasePage.wait.Until(ExpectedConditions.ElementIsVisible(By.CssSelector("#viewerImg_1_1")));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool step_5 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.PrintView());
                if (step_5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4
                result.steps[++ExecutedSteps].status = "Not Automated";
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27936 - Series Scope is Image
        /// </summary>
        public TestCaseResult Test_27936(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String EA131 = login.GetHostName(Config.EA1);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;


                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(user: adminUserName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID", datasources: EA131);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);

                studyviewer.ClickElement("Print View");
                PageLoadWait.WaitForFrameLoad(20);
                var PrintWindow = BasePage.Driver.WindowHandles.Last();
                var StudyWindow = BasePage.Driver.CurrentWindowHandle;
                BasePage.Driver.SwitchTo().Window(PrintWindow);
                BasePage.wait.Until(ExpectedConditions.ElementIsVisible(By.CssSelector("#viewerImg_1_1")));

                //Step 2
                BasePage.Driver.SwitchTo().Window(PrintWindow).Close();
                BasePage.Driver.SwitchTo().Window(StudyWindow);
                PageLoadWait.WaitForFrameLoad(10);

                var element = login.GetElement("id", login.GetControlId("SeriesViewer1-2X2"));
                element.Click();

                login.ClickElement("Series Viewer 2x3");
                login.ClickElement("Image Scope");
                studyviewer.PerformPan(element);
                studyviewer.PerformWindowLevel(element);
                //Get detail of Viewport
                String ZoomseriesUID_1 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")), "src", '&', "seriesUID");

                //Perform Zoom
                studyviewer.ClickElement("Zoom");
                studyviewer.DragMovement(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")));

                //Get detail of Viewport
                String ZoomseriesUID_2 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")), "src", '&', "seriesUID");

                //Validate Images 
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool ZoomImage = login.CompareImage(result.steps[ExecutedSteps], login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")));

                //Perform Zoom
                if (ZoomImage)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3            
                login.Click("id", login.GetControlId("SeriesViewer1-2X2"));

                login.ClickElement("Series Scope");
                login.ClickElement("Reset");
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.SeriesViewer1_1x1));
                bool step3 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4
                login.Click("id", login.GetControlId("SeriesViewer1-2X2"));
                new StudyViewer().SeriesViewer_1X1().Click();

                studyviewer.PerformPan(element);
                login.ClickElement("Rotate Clockwise");
                login.ClickElement("Invert");
                login.ClickElement("Flip Vertical");

                //Get detail of Viewport
                //ZoomseriesUID_1 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")), "src", '&', "seriesUID");
                ZoomseriesUID_1 = login.GetInnerAttribute(new StudyViewer().SeriesViewer_1X1(), "src", '&', "seriesUID");

                //Perform Zoom
                studyviewer.ClickElement("Zoom");
                studyviewer.DragMovement(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")));

                //Get detail of Viewport
                //ZoomseriesUID_2 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")), "src", '&', "seriesUID");
                ZoomseriesUID_2 = login.GetInnerAttribute(new StudyViewer().SeriesViewer_1X1(), "src", '&', "seriesUID");

                //Validate Images 
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                ZoomImage = login.CompareImage(result.steps[ExecutedSteps], login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")));

                //Perform Zoom
                if (ZoomImage && ZoomseriesUID_1.Equals(ZoomseriesUID_2))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                login.Click("id", Locators.ID.SeriesViewer1_2X2);
                login.ClickElement("Image Scope");
                login.ClickElement("Reset");
                viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.SeriesViewer1_2X2));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step5 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6
                login.Click("id", Locators.ID.SeriesViewer1_2X2);
                login.ClickElement("Series Scope");
                login.ClickElement("Reset");
                viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.SeriesViewer1_2X2));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step6 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 8
                result.steps[++ExecutedSteps].status = "Not Automated";
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27938 - Indirect Study Display
        /// </summary>
        public TestCaseResult Test_27938(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastname = LastNameList.Split(':');
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String MiddleName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MiddleName");
                String AccessionList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] Accession = AccessionList.Split(':');
                String PatientDOB = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String Gender = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
                String RefPhysician = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "RefPhysician");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName, "First_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.expandPatient(Lastname[0]);
                if (ehr.VerifyElement(Lastname[0], Accession[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                ehr.selectPatient(Lastname[0]);
                login.ClickUrlViewStudyBtn();
                if (studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession[0].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 4
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(MiddleName, "Middle_Name");
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientList())
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                ehr.expandPatient(Lastname[1]);
                if (ehr.VerifyElement(Lastname[1], Accession[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6
                ehr.selectPatient(Lastname[1]);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[1].ToLower()) &&
                    studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession[1].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 7
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Lastname[0], "Last_Name");
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Last Name", Lastname[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 8
                ehr.selectPatient(Lastname[0]);
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[0].ToLower()) &&
                    studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession[0].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 9
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_9);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Patient ID", PatientID, 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10
                ehr.selectPatient(Lastname[2], 1);
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[2].ToLower()) &&
                    studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession[3].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 11
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Lastname[3], "Patient_Name");
                ehr.SetSearchKeys_Study(PatientDOB, "Patient_DOB");
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_11);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Last Name", Lastname[3]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12
                ehr.selectPatient(Lastname[3]);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[3].ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 13
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Lastname[3], "Patient_Name");
                ehr.SetSearchKeys_Study(Gender, "Gender");
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_13);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Last Name", Lastname[3]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 14
                ehr.selectPatient(Lastname[3]);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[3].ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 15
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Gender, "Gender");
                ehr.SetSearchKeys_Study(RefPhysician, "Ref_Physician");
                String url_15 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_15);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientList(1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 16
                ehr.selectPatient(Lastname[3], 1);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[3].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 17
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(RefPhysician, "Ref_Physician");
                String url_17 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_17);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientList(1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18
                ehr.selectPatient(Lastname[3], 1);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[3].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27939 - Patient Centric
        /// </summary>
        public TestCaseResult Test_27939(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastname = LastNameList.Split(':');
                String columnsList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "columnsList");
                String[] colNames = columnsList.Split(':');
                String subcolumnsList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "subcolumnlist");
                String[] subcolNames = subcolumnsList.Split(':');
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Patient", viewName: viewerName);
                ehr.SetSearchKeys_Study(Lastname[0], "Last_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Validate the columns are in expected order
                IList<String> col = ehr.GetColumnNames();
                bool headervalues = col.SequenceEqual(colNames);
                if (headervalues == true)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.expandPatient(Lastname[1]);
                ehr.expandPatient(Lastname[2]);
                //Validate the columns are in expected order
                IList<String> col2 = ehr.GetColumnNames(1);
                bool headervalues1 = col2.SequenceEqual(subcolNames);
                if (headervalues1 == true)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                ExecutedSteps++;

                //Step 4
                //login.Click("id", "patient.lastname");
                //IList<String> LastnameColumnvalues = ehr.GetColumnValues("Last Name");
                //bool step4_1 = LastnameColumnvalues.SequenceEqual(LastnameColumnvalues.OrderBy<String, String>(q => q).ToArray());
                //login.Click("id", "patient.lastname");
                //LastnameColumnvalues = ehr.GetColumnValues("Last Name");
                //bool step4_2 = LastnameColumnvalues.SequenceEqual((LastnameColumnvalues.OrderBy(q => q).ThenByDescending(z => z)));

                //login.Click("id", "patient.id");
                //IList<String> PatIDColumnvalues = ehr.GetColumnValues("Patient ID");
                //bool step4_3 = PatIDColumnvalues.SequenceEqual(PatIDColumnvalues.OrderBy<String, String>(q => q).ToArray());
                //login.Click("id", "patient.id");
                //PatIDColumnvalues = ehr.GetColumnValues("Patient ID");
                //bool step4_4 = PatIDColumnvalues.SequenceEqual((PatIDColumnvalues.OrderBy(q => q).ThenByDescending(z => z)));

                //login.Click("id", "patient.dob");
                //IList<String> PatDOBColumnvalues = ehr.GetColumnValues("Patient DOB");
                //bool step4_5 = PatDOBColumnvalues.SequenceEqual(PatDOBColumnvalues.OrderBy<String, String>(q => q).ToArray());
                //login.Click("id", "patient.dob");
                //PatDOBColumnvalues = ehr.GetColumnValues("Patient DOB");
                //bool step4_6 = PatDOBColumnvalues.SequenceEqual((PatDOBColumnvalues.OrderBy(q => q).ThenByDescending(z => z)));

                //if (step4_1 && step4_2 && step4_3 && step4_4 && step4_5 && step4_6)
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 5
                ehr.selectPatient(PatientID);
                login.ClickUrlViewStudyBtn();
                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[2].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 6
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Patient", viewName: viewerName);
                ehr.SetSearchKeys_Study(Lastname[0], "Last_Name");
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_6);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                ehr.selectPatient(Lastname[1]);
                ehr.selectPatient(Lastname[3]);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);

                if (studyviewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg) &&
                    studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(Lastname[3].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 8
                login.Click("id", login.GetControlId("SeriesViewer1-1X1"));
                login.ClickElement("Series Viewer 1x3");
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.viewer));
                bool step8 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9
                studyviewer.ClickElement("Print View");
                PageLoadWait.WaitForFrameLoad(20);
                var PrintWindow = BasePage.Driver.WindowHandles.Last();
                var StudyWindow = BasePage.Driver.CurrentWindowHandle;
                BasePage.Driver.SwitchTo().Window(PrintWindow);
                BasePage.wait.Until(ExpectedConditions.ElementIsVisible(By.CssSelector("#viewerImg_1_1")));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step_9 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.PrintView());
                if (step_9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10
                BasePage.Driver.SwitchTo().Window(PrintWindow).Close();
                BasePage.Driver.SwitchTo().Window(StudyWindow);
                PageLoadWait.WaitForFrameLoad(10);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.viewer));
                bool step10 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11
                login.NavigateToIntegratorFrame();
                var element = login.GetElement("id", Locators.ID.SeriesViewer1_1x1);
                element.Click();
                studyviewer.PerformPan(element);
                int h = studyviewer.SeriesViewer_1X1().Size.Height;
                int w = studyviewer.SeriesViewer_1X1().Size.Width;
                studyviewer.DrawLineMeasurement(studyviewer.SeriesViewer_1X1(), w / 3, h / 3);
                login.ClickElement("Reset");
                studyviewer.ToolBarSetAllInOneTool();
                login.DoubleClick(element);
                //Get detail of Viewport
                //String ZoomseriesUID_1 = studyviewer.GetInnerAttribute(login.GetElement("id", Locators.ID.SeriesViewer1_1x1), "src", '&', "seriesUID");
                String ZoomseriesUID_1 = login.GetInnerAttribute(new StudyViewer().SeriesViewer_1X1(), "src", '&', "seriesUID");

                //Perform Zoom
                studyviewer.ClickElement("Zoom");
                studyviewer.DragMovement(login.GetElement("id", Locators.ID.SeriesViewer1_1x1));

                //Get detail of Viewport
                //String ZoomseriesUID_2 = studyviewer.GetInnerAttribute(login.GetElement("id", Locators.ID.SeriesViewer1_1x1), "src", '&', "seriesUID");
                String ZoomseriesUID_2 = login.GetInnerAttribute(new StudyViewer().SeriesViewer_1X1(), "src", '&', "seriesUID");

                //Validate Images 
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool ZoomImage = login.CompareImage(result.steps[ExecutedSteps], login.GetElement("id", Locators.ID.SeriesViewer1_1x1));

                //Perform Zoom
                if (ZoomImage)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27940 - Study Centric
        /// </summary>
        public TestCaseResult Test_27940(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            //IntegratorStudies intgtrStudies = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String columnsList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "columnsList");
                String[] colNames = columnsList.Split(':');
                String FirstNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNameList.Split(':');
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNameList.Split(':');
                String MiddleName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MiddleName");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String PatientDOBList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String[] PatientDOB = PatientDOBList.Split(':');
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                //Validate the columns are in expected order
                IList<String> col = ehr.GetColumnNames(expandFlag: 1);
                bool headervalues = col.SequenceEqual(colNames);
                if (ehr.VerifyPatientList(1) && headervalues)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ExecutedSteps++;

                //Step 3
                //login.Click("id", "PatientLastName");
                //IList<String> LastnameColumnvalues = ehr.GetColumnValues("Last Name", 1);
                //bool step3_1 = LastnameColumnvalues.SequenceEqual(LastnameColumnvalues.OrderBy<String, String>(q => q).ToArray());
                //login.Click("id", "PatientLastName");
                //LastnameColumnvalues = ehr.GetColumnValues("Last Name", 1);
                //bool step3_2 = LastnameColumnvalues.SequenceEqual((LastnameColumnvalues.OrderBy(q => q).ThenByDescending(z => z)));

                //login.Click("id", "PatientID");
                //IList<String> PatIDColumnvalues = ehr.GetColumnValues("Patient ID", 1);
                //bool step3_3 = PatIDColumnvalues.SequenceEqual(PatIDColumnvalues.OrderBy<String, String>(q => q).ToArray());
                //login.Click("id", "PatientID");
                //PatIDColumnvalues = ehr.GetColumnValues("Patient ID", 1);
                //bool step3_4 = PatIDColumnvalues.SequenceEqual((PatIDColumnvalues.OrderBy(q => q).ThenByDescending(z => z)));

                //login.Click("id", "StudyID");
                //IList<String> StIDColumnvalues = ehr.GetColumnValues("Study ID", 1);
                //bool step3_5 = StIDColumnvalues.SequenceEqual(StIDColumnvalues.OrderBy<String, String>(q => q).ToArray());
                //login.Click("id", "StudyID");
                //StIDColumnvalues = ehr.GetColumnValues("Study ID", 1);
                //bool step3_6 = StIDColumnvalues.SequenceEqual((StIDColumnvalues.OrderBy(q => q).ThenByDescending(z => z)));

                //if (step3_1 && step3_2 && step3_3 && step3_4 && step3_5 && step3_6)
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 4
                ehr.selectPatient(LastName[0], 1);
                login.ClickUrlViewStudyBtn();
                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName[0].ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName[0].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 5
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(PatientDOB[0], "Patient_DOB");
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_5);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[1], 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 6
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(PatientDOB[1], "Patient_DOB");
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_6);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Patient ID", PatientID, 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 7
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(PatientDOB[0], "Patient_DOB");
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[1], 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 8
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                String url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_8);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[1], 1) && ehr.VerifyPatientDetails("Last Name", LastName[1], 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 9
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                ehr.SetSearchKeys_Study(MiddleName, "Middle_Name");
                ehr.SetSearchKeys_Study(LastName[2], "Last_Name");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_9);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[2], 1) && ehr.VerifyPatientDetails("Last Name", LastName[2], 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 10
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study", viewName: viewerName);
                ehr.SetSearchKeys_Study(LastName[3], "Patient_Name");
                String url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_10);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[2], 1) && ehr.VerifyPatientDetails("Last Name", LastName[2], 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27941 - Unspecified Study Display
        /// </summary>
        public TestCaseResult Test_27941(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                //String LogoutLink = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "URL");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName, "First_Name");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientList())
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.selectPatient(LastName);
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 3
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(Accession);
                String url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_3);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 4
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (studyviewer.PatientDetailsInViewer()["PatientID"].ToLower().Equals(PatientID.ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                var element = login.GetElement("id", login.GetControlId("SeriesViewer1-1X1"));
                element.Click();

                studyviewer.PerformPan(element);
                studyviewer.PerformWindowLevel(element);
                //Get detail of Viewport
                String ZoomseriesUID_1 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-1X1")), "src", '&', "seriesUID");

                //Perform Zoom
                studyviewer.ClickElement("Zoom");
                studyviewer.DragMovement(login.GetElement("id", login.GetControlId("SeriesViewer1-1X1")));

                //Get detail of Viewport
                String ZoomseriesUID_2 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-1X1")), "src", '&', "seriesUID");

                //Validate Images 
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool ZoomImage = login.CompareImage(result.steps[ExecutedSteps], login.GetElement("id", login.GetControlId("SeriesViewer1-1X1")));

                //Perform Zoom
                if (ZoomImage && ZoomseriesUID_1.Equals(ZoomseriesUID_2))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6
                result.steps[++ExecutedSteps].status = "Not Automated";
                ////Navigate to url generated in test eHR
                //BasePage.MultiDriver.Add(BasePage.Driver);      // Save current State of Driver to 1st Element of Webdriver Array
                ////Open Another Browser instance
                //BasePage.MultiDriver.Add(login.InvokeBrowser("chrome"));
                //login.SetDriver(BasePage.MultiDriver[1]);

                //login.NavigateToIntegratorURL(LogoutLink);
                //login.SwitchToDefault();
                //if (login.GetElement("xpath", "/html/body/img") != null)
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                ////Close browser
                //BasePage.Driver.Quit();
                //BasePage.Driver = null;

                //Step 7
                result.steps[++ExecutedSteps].status = "Not Automated";
                //login.SetDriver(BasePage.MultiDriver[0]);
                //element = login.GetElement("id", login.GetControlId("SeriesViewer1-1X1"));
                //element.Click();
                //studyviewer.PerformPan(element);

                //result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                //var viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.SeriesViewer1_1x1));
                //var step7 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                //if (step7)
                //{
                //    result.steps[ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27942 - Study Data Source
        /// </summary>
        public TestCaseResult Test_27942(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String DatasourceList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources");
                String[] Datasource = DatasourceList.Split(':');
                String PatientFullName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Datasource[0], "Datasource");
                ehr.SetSearchKeys_Study("*^*", "Last_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                String Step1_1 = ehr.StudyListErrorMsg();
                String Step1_2 = ehr.StudyListGrid()[1].FindElement(By.TagName("td")).Text;
                if (Step1_1 == "* Error occurred while retrieving study list. Your search result may be incomplete." && Step1_2 == "No studies that match the search criteria could be found.")
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 2
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Datasource[1], "Datasource");
                ehr.SetSearchKeys_Study(PatientFullName, "Patient_Name");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientList())
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27955 - GSPS True
        /// </summary>
        public TestCaseResult Test_27955(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            var servicetool = new ServiceTool();
            int executedSteps = -1;
            String configfilepath = Config.WebConfigPath;
            String key = "Application.EnableSavingGSPS";
            String value = String.Empty;
            StudyViewer studyviewer = null;

            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                String accessionlist = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                string[] accession = accessionlist.Split(':');
                value = "true";
                //Reset the Datasource selection
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var studies = login.Navigate<Studies>();
                studies.SearchStudy(LastName: "*", Datasource: "All");
                PageLoadWait.WaitForLoadingMessage(60);
                login.Logout();

                //Pre-condition - Enable Saving GSPS
                login.SetWebConfigValue(configfilepath, key, value);
                login.RestartIISUsingexe();

                //Service tool updates                
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyButton();
                wpfobject.SelectCheckBox("intg_chkAllowShowSelector");
                wpfobject.SelectCheckBox("intg_chkAllowShowSelectorSearch");
                servicetool.ApplyEnableFeatures();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //step 1: Load a study.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(user: Config.adminUserName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(accession[0]);
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ehr.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                if (studyviewer.GetReviewToolsFromviewer().Contains("SaveSeries"))
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //step 2: Apply various tools and select Save *^>^* Save Series.
                //Apply W/L
                studyviewer.ClickElement("Window Level");
                IWebElement viewport1 = studyviewer.SeriesViewer_1X1();
                int h = viewport1.Size.Height;
                int w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, 3 * w / 4, 3 * h / 4);
                //Apply Zoom
                studyviewer.ClickElement("Zoom");
                viewport1 = studyviewer.SeriesViewer_1X1();
                h = viewport1.Size.Height;
                w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, 3 * w / 4, 3 * h / 4);
                result.steps[executedSteps].SetPath(testid + "_2_2_Zoom_Applied", executedSteps + 1);
                //Apply Pan
                studyviewer.ClickElement("Pan");
                viewport1 = studyviewer.SeriesViewer_1X1();
                h = viewport1.Size.Height;
                w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, w / 2, h / 4);
                result.steps[executedSteps].SetPath(testid + "_2_3_Pan_Applied", executedSteps + 1);
                studyviewer.ClickElement("Save Series");
                PageLoadWait.WaitForLoadingIconToAppear_Savestudy();
                PageLoadWait.WaitForLoadingIconToDisAppear_Savestudy();
                BasePage.wait.Until(ExpectedConditions.ElementToBeClickable(studyviewer.ThumbnailCaptions()[0]));
                result.steps[++executedSteps].SetPath(testid, executedSteps);
                var viewport2 = BasePage.Driver.FindElement(By.Id(Locators.ID.viewer));
                bool step2 = login.CompareImage(result.steps[executedSteps], viewport2);
                if (step2)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //step 3: Load a different study then reload the one with the saved GSPS.
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(user: Config.adminUserName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(accession[1]);
                String url_3_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login = new Login();
                ehr.NavigateToIntegratorURL(url_3_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(user: Config.adminUserName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(accession[0]);
                String url_3_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login = new Login();
                ehr.NavigateToIntegratorURL(url_3_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                result.steps[++executedSteps].SetPath(testid, executedSteps);
                var viewport3 = BasePage.Driver.FindElement(By.Id(Locators.ID.viewer));
                bool step3 = login.CompareImage(result.steps[executedSteps], viewport3);
                if (step3)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27946 - multiple studies from different patients
        /// </summary>
        public TestCaseResult Test_27946(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PatientID = PatientIDList.Split(':');
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNameList.Split(':');
                String AccessionIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String StudyDescriptionList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyDescription");
                String[] StudyDescription = StudyDescriptionList.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String StudyIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyID");
                String[] StudyID = StudyIDList.Split(':');
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String EA131 = login.GetHostName(Config.EA1);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID", datasources: EA131);
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                PageLoadWait.WaitForFrameLoad(10);
                if (studyviewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg) &&
                    studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName[0].ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["PatientID"].ToLower().Equals(PatientID[0].ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                studyviewer.NavigateToHistoryPanel();
                PageLoadWait.WaitForPageLoad(20);

                studyviewer.ChooseColumns(new String[] { "Study ID" });

                login.SelectStudy("Study ID", StudyID[0]);
                bool step2_1 = BasePage.Driver.FindElement(By.Id("m_patientHistory_patientIDTextBox")).Displayed;
                login.SelectStudy("Study ID", StudyID[1]);
                bool step2_2 = BasePage.Driver.FindElement(By.Id("m_patientHistory_patientDOBTextBox")).Displayed;
                login.SelectStudy("Study ID", StudyID[2]);
                bool step2_3 = BasePage.Driver.FindElement(By.Id("m_patientHistory_currentStudyPatientIDTextBox")).Displayed;

                if (step2_1 && step2_2 && step2_3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                studyviewer.DoubleClick(studyviewer.Study(2));
                PageLoadWait.WaitForAllViewportsToLoad(30, 2);
                studyviewer.NavigateToHistoryPanel();
                studyviewer.DoubleClick(studyviewer.Study(3));
                PageLoadWait.WaitForAllViewportsToLoad(30, 3);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool status3 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.StudyPanelContainer());

                if (status3 && studyviewer.studyPanel(1).Displayed && studyviewer.studyPanel(2).Displayed && studyviewer.studyPanel(3).Displayed)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 4
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(AccessionIDList, datasources: EA131);
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(60);

                if (studyviewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg) &&
                    studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName[1].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                studyviewer.NavigateToHistoryPanel();
                login.SelectStudy("Study Description", StudyDescription[0]);
                bool step5_1 = BasePage.Driver.FindElement(By.Id("m_patientHistory_patientIDTextBox")).Displayed;
                login.SelectStudy("Patient ID", PatientID[1]);
                bool step5_2 = BasePage.Driver.FindElement(By.Id("m_patientHistory_currentStudyPatientIDTextBox")).Displayed;
                login.SelectStudy("Study Description", StudyDescription[1]);
                bool step5_3 = BasePage.Driver.FindElement(By.Id("m_patientHistory_patientIDTextBox")).Displayed;

                if (step5_1 && step5_2 && step5_3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6
                studyviewer.DoubleClick(studyviewer.Study(2));
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 2);
                studyviewer.NavigateToHistoryPanel();
                studyviewer.DoubleClick(studyviewer.Study(3));
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 3);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);

                bool status6 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.StudyPanelContainer());

                if (status6 && studyviewer.studyPanel(1).Displayed && studyviewer.studyPanel(2).Displayed && studyviewer.studyPanel(3).Displayed)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;


                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27947 - multiple studies from DICOM data source
        /// </summary>
        public TestCaseResult Test_27947(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String StudyUIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDList.Split(':');
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 2
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID[1], "Study_UID");
                String url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_3);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);


                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27948 - Same Patient, Multiple Study Tests
        /// </summary>
        public TestCaseResult Test_27948(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            IntegratorStudies intgtrStudies = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PatientID = PatientIDList.Split(':');
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNameList.Split(':');
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String ModalityList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Modality");
                String[] Modality = ModalityList.Split(':');
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                String EA77 = login.GetHostName(Config.EA77);
                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName, "Last_Name", datasources: EA77);
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[0]) && ehr.VerifyPatientDetails("Last Name", LastName))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.selectStudiesWithMatchingRecord(LastName, PatientID[0]);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName[0].ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                studyviewer.NavigateToHistoryPanel();

                //studyviewer.DoubleClick(studyviewer.Study(2));
                studyviewer.ChooseColumns(new String[] { "Accession" });
                String[] AccessionListed = BasePage.GetColumnValues("Accession");
                studyviewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionListed[1] });
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 2);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool status3 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.StudyPanelContainer());

                if (status3 && studyviewer.studyPanel(1).Displayed && studyviewer.studyPanel(2).Displayed)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 4
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName, "Last_Name", datasources: EA77);
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName[0]) && ehr.VerifyPatientDetails("Last Name", LastName))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                result.steps[++ExecutedSteps].status = "Not Automated";// In Hold. Data not available";

                //Step 6
                result.steps[++ExecutedSteps].status = "Not Automated";// In Hold. Data not available";

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 7
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName, "Last_Name", datasources: EA77);
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                if (ehr.VerifyPatientDetails("First Name", FirstName[0]) && ehr.VerifyPatientDetails("Last Name", LastName))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8
                intgtrStudies.Intgr_GetorSelectRow("Patient ID", PatientID[0]);
                intgtrStudies.Intgr_GetorSelectRow("Patient ID", PatientID[1]);
                studyviewer = StudyViewer.LaunchStudy();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                if (studyviewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg) &&
                    studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName[0].ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9
                studyviewer.NavigateToHistoryPanel();
                studyviewer.ChooseColumns(new String[] { "Accession" });
                AccessionListed = BasePage.GetColumnValues("Accession");
                studyviewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionListed[1] });
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 2);
                studyviewer.NavigateToHistoryPanel();
                studyviewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionListed[0] });
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 3);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool status9 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.StudyPanelContainer());

                if (status9 && studyviewer.studyPanel(1).Displayed && studyviewer.studyPanel(2).Displayed && studyviewer.studyPanel(3).Displayed)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10
                login.Click("id", login.GetControlId("SeriesViewer1-1X1"));
                login.ClickElement("Series Viewer 1x2");
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool status10 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.StudyPanelContainer());

                if (status10 && studyviewer.studyPanel(1).Displayed && studyviewer.studyPanel(2).Displayed && studyviewer.studyPanel(3).Displayed)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11
                studyviewer.ClickElement("Print View");
                PageLoadWait.WaitForFrameLoad(20);
                var PrintWindow = BasePage.Driver.WindowHandles.Last();
                var StudyWindow = BasePage.Driver.CurrentWindowHandle;
                BasePage.Driver.SwitchTo().Window(PrintWindow);
                BasePage.wait.Until(ExpectedConditions.ElementIsVisible(By.CssSelector("#viewerImg_1_1")));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step_11 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.PrintView());
                if (step_11)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12
                BasePage.Driver.SwitchTo().Window(PrintWindow).Close();
                BasePage.Driver.SwitchTo().Window(StudyWindow);
                PageLoadWait.WaitForFrameLoad(10);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.viewer));
                bool step12 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13
                var element = login.GetElement("id", Locators.ID.SeriesViewer1_1x1);
                element.Click();
                studyviewer.PerformPan(element);
                int h = studyviewer.SeriesViewer_1X1().Size.Height;
                int w = studyviewer.SeriesViewer_1X1().Size.Width;
                studyviewer.DrawLineMeasurement(studyviewer.SeriesViewer_1X1(), w / 3, h / 3);
                login.ClickElement("Reset");
                studyviewer.ToolBarSetAllInOneTool();
                login.DoubleClick(element);
                //Get detail of Viewport
                String ZoomseriesUID_1 = studyviewer.GetInnerAttribute(login.GetElement("id", Locators.ID.SeriesViewer1_1x1), "src", '&', "seriesUID");

                //Perform Zoom
                studyviewer.ClickElement("Zoom");
                studyviewer.DragMovement(login.GetElement("id", Locators.ID.SeriesViewer1_1x1));

                //Get detail of Viewport
                String ZoomseriesUID_2 = studyviewer.GetInnerAttribute(login.GetElement("id", Locators.ID.SeriesViewer1_1x1), "src", '&', "seriesUID");

                //Validate Images 
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool ZoomImage = login.CompareImage(result.steps[ExecutedSteps], login.GetElement("id", Locators.ID.SeriesViewer1_1x1));

                //Perform Zoom
                if (ZoomImage && ZoomseriesUID_1.Equals(ZoomseriesUID_2))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 14
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Patient("FirstName", FirstName[1]);
                //ehr.SetSearchKeys_Study(Accession);
                String url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_14);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                intgtrStudies.Intgr_GetorSelectRow("Patient ID", PatientID[3]);
                intgtrStudies.Intgr_GetorSelectRow("Patient ID", PatientID[4]);
                intgtrStudies.Intgr_GetorSelectRow("Patient ID", PatientID[5]);
                studyviewer = StudyViewer.LaunchStudy();
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                if (studyviewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg) &&
                                       studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().StartsWith(FirstName[1].ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 15
                studyviewer.NavigateToHistoryPanel();
                String[] PIDList = BasePage.GetColumnValues("Patient ID").Distinct().ToArray();
                studyviewer.OpenPriors(new String[] { "Patient ID" }, new String[] { PIDList[1].ToString() });
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 2);
                studyviewer.NavigateToHistoryPanel();
                studyviewer.OpenPriors(new String[] { "Patient ID" }, new String[] { PIDList[2].ToString() });
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40, 3);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool status15 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.StudyPanelContainer());

                if (status15 && studyviewer.studyPanel(1).Displayed && studyviewer.studyPanel(2).Displayed && studyviewer.studyPanel(3).Displayed)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27956 - 3.6.0 Search Panel
        /// </summary>
        public TestCaseResult Test_27956(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            IntegratorStudies intgtrStudies = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNameList.Split(':');
                String FirstNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNameList.Split(':');
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                servicetool.CloseServiceTool();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL is " + url_1);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]) && ehr.VerifyPatientDetails("Last Name", LastName[0]) && !(login.GetElement("id", "SearchPanelDiv").GetAttribute("style").Contains("display: none;")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                intgtrStudies.ExpandBtn().Click();
                if (intgtrStudies.expandTextlbl().Text.Equals(ExpandText) && login.GetElement("id", "SearchPanelDiv").GetAttribute("style").Contains("display: none;"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                intgtrStudies.ExpandBtn().Click();
                if (intgtrStudies.expandTextlbl().Text.Equals(HideText) && !(login.GetElement("id", "SearchPanelDiv").GetAttribute("style").Contains("display: none;")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4
                login.ClearText("id", "ctl00_m_studySearchControl_m_searchInputPatientLastName");
                login.SetText("id", "ctl00_m_studySearchControl_m_searchInputPatientLastName", LastName[1]);
                login.ClearText("id", "ctl00_m_studySearchControl_m_searchInputPatientFirstName");
                login.SetText("id", "ctl00_m_studySearchControl_m_searchInputPatientFirstName", FirstName[1]);
                intgtrStudies.searchBtn().Click();

                if (ehr.VerifyPatientDetails("First Name", FirstName[1]) && ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                ehr.selectPatient(LastName[1]);
                studyviewer = StudyViewer.LaunchStudy();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                PageLoadWait.WaitForAllViewportsToLoad(40);
                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName[1].ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName[1].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 6
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "False", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_6);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                bool status6 = false;
                try
                {
                    BasePage.Driver.FindElement(By.Id("SearchPanelDiv")).Click();

                }
                catch (NoSuchElementException) { status6 = true; }


                if (status6 && ehr.VerifyPatientDetails("First Name", FirstName[0]) && ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 7
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]) && ehr.VerifyPatientDetails("Last Name", LastName[0]) && !(login.GetElement("id", "SearchPanelDiv").GetAttribute("style").Contains("display: none;")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27959 - Disable Show close and ensure Show selector is enabled.
        /// </summary>
        public TestCaseResult Test_27959(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                servicetool.CloseServiceTool();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Last Name", LastName, 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27966 - 5.0 Series Thumbnail View5.1.0 Display Series Thumbnail Image
        /// </summary>
        public TestCaseResult Test_27966(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String StudyUIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDList.Split(':');
                String SeriesUIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SeriesUID");
                String[] SeriesUID = SeriesUIDList.Split(':');
                String Height = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Height");
                String Width = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Width");
                servicetool.CloseServiceTool();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ITabPage currenttab = ehr.GetCurrentTabItem();
                if (wpfobject.GetAnyUIItem<ITabPage, TextBox>(currenttab, "m_addressTextBox").Text.Equals("http://localhost/WebAccess"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                String url_2 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                var viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step2 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 3
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[1]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[1]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                String url_3 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_3);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step3 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 4
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[1]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                String url_4 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step4 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 5
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[3]);
                String url_5 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_5);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step5 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 6
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[7]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[10]);
                String url_6 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_6);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);

                PageLoadWait.WaitForPageLoad(10);
                //PageLoadWait.WaitForAllViewportsToLoad(60);

                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step6 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 7
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[5]);
                String url_7 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step7 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step7)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 8
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[6]);
                String url_8 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_8);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step8 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 9
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[3]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[3]);
                String url_9 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_9);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step9 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 10
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[6]);
                String url_10 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_10);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step10 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 11
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[6]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[9]);
                String url_11 = ehr.clickCmdLine("ThumbnailView");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_11);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step11 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step11)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.FocusWindow();
                currenttab = ehr.GetCurrentTabItem();
                //wpfobject.GetAnyUIItem<ITabPage, Button>(currenttab, "Logout", 1).Click();
                //wpfobject.GetMainWindow("Test WebAccess EHR");
                //String url_12 = ehr.clickCmdLine("ThumbnailView");
                String url_12 = ehr.ClickLogout("ThumbnailView");
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.NavigateToIntegratorURL(url_12);

                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step12 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();


                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27967 - 5.2.0 Thumbnail Image Width and Height
        /// </summary>
        public TestCaseResult Test_27967(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String SeriesUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SeriesUID");
                String HeightList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Height");
                String[] Height = HeightList.Split(':');
                String Width = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Width");
                servicetool.CloseServiceTool();
                servicetool.LaunchServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID);
                ehr.SetSearchKeys_ThumbnailView("Height", Height[0]);
                String url_1 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_1);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                var viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step1 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 2
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID);
                ehr.SetSearchKeys_ThumbnailView("Height", Height[1]);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                String url_2 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step2 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27972 - 7.0 Authentication7.1.0 ByPass
        /// </summary>
        public TestCaseResult Test_27972(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                servicetool.CloseServiceTool();
                servicetool.LaunchServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.GUID().Click();

                if ((wpfobject.GetTextbox("m_securityIdTextBox").Text != null) && (wpfobject.GetTextbox("m_securityIdTextBox").Text != "Administrator-Administrator"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.SetSelectorOptions(showSelector: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(FirstName, "First_Name");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("First Name", FirstName))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                ehr.selectPatient(LastName);
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    studyviewer.PatientDetailsInViewer()["PatientID"].ToLower().Equals(PatientID.ToLower()) &&
                     studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 4
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.GUID().Click();
                ehr.SetSelectorOptions(showSelector: "False", viewName: viewerName);
                ehr.SetSearchKeys_Study(Accession);
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                  studyviewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                  studyviewer.PatientDetailsInViewer()["PatientID"].ToLower().Equals(PatientID.ToLower()) &&
                   studyviewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                  studyviewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27975 - 12.0 Browser Multisession Modesmultiple session/multiple browser tab handling
        /// </summary>
        public TestCaseResult Test_27975(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            IWebDriver localDriver = null;
            login = new Login();
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                //Fetch required Test data            
                String Username = Config.adminUserName;
                String Password = Config.adminPassword;

                String PatientIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PatientID = PatientIDList.Split(':');
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                //String[] Lastname = LastNameList.Split(':');
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String SessionID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SessionID");
                //String AccessionList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                //String[] Accession = AccessionList.Split(':');
                //String PatientDOB = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                //String Gender = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
                //String RefPhysician = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "RefPhysician");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                //Restart IIS services to close existing sessions
                servicetool.RestartIISUsingexe();
                Thread.Sleep(5000);
                servicetool.CloseServiceTool();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.GUID().Click();

                if ((wpfobject.GetTextbox("m_securityIdTextBox").Text != null) && (wpfobject.GetTextbox("m_securityIdTextBox").Text != "Administrator-Administrator"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                String url_2 = ehr.clickCmdLine("ImageLoad");

                if (url_2.StartsWith("http://localhost/WebAccess/Default.ashx"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 3
                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (ehr.VerifyPatientDetails("Patient ID", PatientID[0], 1) && ehr.VerifyPatientDetails("First Name", FirstName, 1) && ehr.VerifyPatientDetails("Last Name", LastName, 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4
                ehr.selectPatient(LastName, 1);
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                var element = login.GetElement("id", login.GetControlId("SeriesViewer1-2X2"));
                element.Click();

                studyviewer.PerformPan(element);
                login.ClickElement("Rotate Clockwise");
                login.ClickElement("Invert");
                studyviewer.PerformWindowLevel(element);

                //Get detail of Viewport
                String ZoomseriesUID_1 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")), "src", '&', "seriesUID");

                //Perform Zoom
                studyviewer.ClickElement("Zoom");
                studyviewer.DragMovement(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")));

                //Get detail of Viewport
                String ZoomseriesUID_2 = studyviewer.GetInnerAttribute(login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")), "src", '&', "seriesUID");

                //Validate Images 
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool ZoomImage = login.CompareImage(result.steps[ExecutedSteps], login.GetElement("id", login.GetControlId("SeriesViewer1-2X2")));

                //Perform Zoom
                if (ZoomImage)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                var ParentWindowID = BasePage.Driver.CurrentWindowHandle;

                //Step 5
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ehr.GUID().Click();
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.openTab();
                if (BasePage.Driver.WindowHandles.Count > 1)
                {
                    string ChildWindowID = BasePage.Driver.WindowHandles[0].Equals(ParentWindowID, StringComparison.InvariantCultureIgnoreCase) ? BasePage.Driver.WindowHandles[1] : BasePage.Driver.WindowHandles[0];
                    BasePage.Driver.SwitchTo().Window(ChildWindowID);
                    PageLoadWait.WaitForPageLoad(20);
                }
                else
                {
                    login.openTab();
                    string ChildWindowID = BasePage.Driver.WindowHandles[0].Equals(ParentWindowID, StringComparison.InvariantCultureIgnoreCase) ? BasePage.Driver.WindowHandles[1] : BasePage.Driver.WindowHandles[0];
                    BasePage.Driver.SwitchTo().Window(ChildWindowID);
                    PageLoadWait.WaitForPageLoad(20);
                }
                login.DriverGoTo(url_5);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);

                if (studyviewer.AuthenticationErrorMsg().Text.ToLower().Contains("there is another session open"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6
                if (BasePage.Driver.WindowHandles.Count > 1)
                {
                    string ChildWindowID = BasePage.Driver.WindowHandles[0].Equals(ParentWindowID, StringComparison.InvariantCultureIgnoreCase) ? BasePage.Driver.WindowHandles[1] : BasePage.Driver.WindowHandles[0];
                    BasePage.Driver.SwitchTo().Window(ChildWindowID).Close();
                    PageLoadWait.WaitForFrameLoad(10);
                }

                BasePage.Driver.SwitchTo().Window(ParentWindowID);
                login.ClickElement("Reset");
                studyviewer.ToolBarSetAllInOneTool();
                login.ClickElement("Rotate Clockwise");
                studyviewer.ClickElement("Window Level");
                var viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.SeriesViewer1_2X2));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step6 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;

                //Step 8
                ehr.LaunchEHR();
                ehr.SetCommonParameters(SessionID: SessionID);
                ehr.SetSelectorOptions(showSelector: "False", viewName: viewerName);
                ehr.SetSearchKeys_Study(PatientID[1], "Patient_ID");
                String url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_8);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                if (studyviewer.PatientDetailsInViewer()["PatientID"].ToLower().Equals(PatientID[1].ToLower()) &&
                    studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9
                ParentWindowID = BasePage.Driver.CurrentWindowHandle;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(SessionID: SessionID);
                ehr.SetSelectorOptions(showSelector: "False", viewName: viewerName);
                ehr.SetSearchKeys_Study(PatientID[1], "Patient_ID");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.openTab();
                if (BasePage.Driver.WindowHandles.Count > 1)
                {
                    string ChildWindowID = BasePage.Driver.WindowHandles[0].Equals(ParentWindowID, StringComparison.InvariantCultureIgnoreCase) ? BasePage.Driver.WindowHandles[1] : BasePage.Driver.WindowHandles[0];
                    BasePage.Driver.SwitchTo().Window(ChildWindowID);
                    PageLoadWait.WaitForPageLoad(20);
                }
                else
                {
                    login.openTab();
                    string ChildWindowID = BasePage.Driver.WindowHandles[0].Equals(ParentWindowID, StringComparison.InvariantCultureIgnoreCase) ? BasePage.Driver.WindowHandles[1] : BasePage.Driver.WindowHandles[0];
                    BasePage.Driver.SwitchTo().Window(ChildWindowID);
                    PageLoadWait.WaitForPageLoad(20);
                }

                login.DriverGoTo(url_9);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);

                if (studyviewer.AuthenticationErrorMsg().Text.ToLower().Contains("there is another session open"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10
                if (BasePage.Driver.WindowHandles.Count > 1)
                {
                    string ChildWindowID = BasePage.Driver.WindowHandles[0].Equals(ParentWindowID, StringComparison.InvariantCultureIgnoreCase) ? BasePage.Driver.WindowHandles[1] : BasePage.Driver.WindowHandles[0];
                    BasePage.Driver.SwitchTo().Window(ChildWindowID).Close();
                    PageLoadWait.WaitForFrameLoad(10);
                }

                BasePage.Driver.SwitchTo().Window(ParentWindowID);
                login.ClickElement("Reset");
                studyviewer.ToolBarSetAllInOneTool();
                login.ClickElement("Rotate Clockwise");
                studyviewer.ClickElement("Window Level");
                viewport = BasePage.Driver.FindElement(By.Id(Locators.ID.SeriesViewer1_2X2));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step10 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Copy WebDriver to local variable
                localDriver = BasePage.Driver;

                //Step 11
                if (Config.BrowserType.ToLower().Equals("chrome"))
                    login.InvokeBrowser("ie");
                else
                    login.InvokeBrowser("chrome");

                //Login as Admin User
                login.DriverGoTo(login.url);
                login.LoginIConnect(Username, Password);
                ExecutedSteps++;

                //Step 12
                Maintenance maintenance = null;
                maintenance = (Maintenance)login.Navigate("Maintenance");
                //BasePage.Driver.SwitchTo().DefaultContent();
                //BasePage.Driver.SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                IWebElement ele = BasePage.Driver.FindElement(By.Id(Locators.ID.LicenseTable));
                List<IWebElement> Licenselist = ele.FindElements(By.CssSelector("#m_licenseUsageListControl_m_dataListGrid > tbody > tr")).ToList();
                if (Licenselist.Count() == 3 && Licenselist.Exists(lic => (lic.Text.ToLower().Contains("administrator")) || (lic.Text.ToLower().Contains("integrator"))))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12
                //result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 13
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 14
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 15
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 16
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 17
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 18
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 19
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 20
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 21
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 22
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 23
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 24
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 25
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Step 26
                result.steps[++ExecutedSteps].status = "Not Automated";

                //Logout
                login.Logout();
                localDriver.Quit();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Logout
                login.Logout();
                if (localDriver != null && BasePage.Driver != localDriver) { localDriver.Quit(); }

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test case number 27977 - Priors Box = True in TESTEHR
        /// </summary>
        public TestCaseResult Test_27977(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            StudyViewer studyviewer = null;
            Studies studies = null;
            login = new Login();
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String StudyIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyID");
                String[] StudyID = StudyIDList.Split(':');
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                servicetool.CloseServiceTool();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();

                //Step 1
                ehr.LaunchEHR();
                ehr.SetSelectorOptions(SearchPriors: "True");

                if (wpfobject.GetComboBox("m_searchPriorsComboBox").SelectedItemText.Equals("True"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                studyviewer.NavigateToHistoryPanel();
                studyviewer.ChooseColumns(new String[] { "Study ID" });

                //Validate prior studies are displayed in Patient history tab
                bool flag = true;
                foreach (String Studyid in StudyID)
                {
                    Dictionary<string, string> priors = studyviewer.GetMatchingRow("Study ID", Studyid);
                    if (!(priors == null))
                    { flag = true; }
                    else
                    {
                        flag = false;
                        break;
                    }
                }
                if (flag)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                //Close browser
                ExecutedSteps++;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                GC.Collect();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Integrator User Sharing
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27985(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer viewer = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmgmt = null;
            RoleManagement rolemgmt = null;
            UserManagement usermgmt = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String datasource1 = login.GetHostName(Config.DestinationPACS).ToUpper();
                String datasource2 = login.GetHostName(Config.SanityPACS).ToUpper();
                int randomnumber = new Random().Next(1, 1000);

                //Domain-1 Users and Role
                Dictionary<object, string> domainattr1;
                String Role1 = "Physician1" + randomnumber;
                String User1 = "ph1" + randomnumber;

                //Non existing Users 
                String User_7 = "aa_" + randomnumber;
                String User_8 = "bb_" + randomnumber;
                String User_9 = "frank_" + randomnumber;
                String User_12 = "Tony_" + randomnumber;
                String User_15 = "User_" + randomnumber;
                String User_16 = "cc_" + randomnumber;
                String User_17 = "dd_" + randomnumber;
                String User_18 = "ee_" + randomnumber;
                String User_22 = "NonUser1_" + randomnumber;
                String User_23 = "bbb_" + randomnumber;
                String User_24 = "NonUser2_" + randomnumber;

                //Step 1 :- Pre-Condition
                //Login as Administrator
                login.LoginIConnect(adminUserName, adminPassword);

                //Create domain-1 with Physicain,archivist  and Staff users
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainattr1 = domainmgmt.CreateDomainAttr();
                domainmgmt.CreateDomain(domainattr1, new string[] { datasource1, datasource2 });
                String Domain1 = domainattr1[DomainManagement.DomainAttr.DomainName];

                //Edit domain - Set CR modality layout as 1x1
                domainmgmt.SearchDomain(Domain1);
                domainmgmt.SelectDomain(Domain1);
                domainmgmt.ClickEditDomain();
                domainmgmt.ModifyStudySearchFields();
                domainmgmt.ModalityDropDown().SelectByText("CR");
                domainmgmt.LayoutDropDown().SelectByText("1x1");
                domainmgmt.ClickSaveDomain();

                //Create Roles
                rolemgmt = (RoleManagement)login.Navigate("RoleManagement");
                rolemgmt.CreateRole(Domain1, Role1, "Physician");

                //Create Users
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.CreateUser(User1, Domain1, Role1, 1, Config.emailid, 1, User1);

                //Logout iCA           
                login.Logout();
                ExecutedSteps++;

                //Step 2 (PreCondition) :-  Disable User sharing, shadow user and modify CR modality layout.
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.NavigateToTab("Viewer");
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                servicetool.MoadalitySetting(layout: "2x3");
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 3 (PreCondition):- Enable Bypass mode in integrator web.config file  
                login.EnableBypass();
                ExecutedSteps++;

                //Launch service tool and navigate to integrator tab
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();

                //Step 4 :- Validate both shadow user and User sharing are disabled
                if (servicetool.UserSharingCombobox().SelectedItemText.Equals("Always disabled")
                    && servicetool.ShadowUserCombobox().SelectedItemText.Equals(String.Empty))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close tool
                servicetool.CloseServiceTool();

                //Login as Administrator
                login.LoginIConnect(adminUserName, adminPassword);

                //Navigate to domain management tab
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");

                //Edit domain - Set CR modality layout as 1x1
                domainmgmt.SearchDomain(Domain1);
                domainmgmt.SelectDomain(Domain1);
                domainmgmt.ClickEditDomain();

                //Step 5 :- Check default role dropdown is displayed or not                
                PageLoadWait.WaitForPageLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame");
                if (!domainmgmt.DefaultRoleDropDown().Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Click Close button
                domainmgmt.EditDomainCloseBtn().Click();

                //Open Study in Viewer with TestEHR as known iCA user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_6);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 6 :- Validate iCA viewer for iCA known user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as non existing iCA user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User_7);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 7 :- Validate iCA viewer for non existing iCA user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as non existing iCA user & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User_8);
                ehr.SetSearchKeys_Study(Accession);
                String url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_8);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 8 :- Validate iCA viewer with blank role non existing iCA user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Enable shadow user
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled");
                servicetool.CloseServiceTool();

                //Open Study in Viewer with shadow user enabled in TestEHR as non existing iCA user 
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User_9);
                ehr.SetSearchKeys_Study(Accession);
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_9);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 9 :- Validate iCA viewer with shadow user enabled as non existing iCA user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with shadow user enabled in TestEHR as known iCA user & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_10);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 10 :- Validate iCA viewer with shadow user enabled as known iCA user & blank role
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Enable UserSharing and disable Shadow user
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();

                //Open Study in Viewer with user sharing enabled and disabled shadow user in TestEHR as known iCA user & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_11);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 11 :- Validate iCA viewer with shadow user enabled as known iCA user & blank role
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with user sharing enabled and disabled shadow user in TestEHR as unknown user & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User_12);
                ehr.SetSearchKeys_Study(Accession);
                String url_12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_12);
                try
                {
                    viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                    //Step 12 :- Validate iCA viewer with shadow user enabled as unknown user & blank role
                    if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                        viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                        viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                        viewer.IntegratorViewPorts().Count == 6)
                    {
                        result.steps[++ExecutedSteps].status = "Pass";
                        Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                    }
                    else
                    {
                        result.steps[++ExecutedSteps].status = "Fail";
                        Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                        result.steps[ExecutedSteps].SetLogs();
                    }
                }
                catch (Exception)
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Disable UserSharing and disable Shadow user
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();

                //Open Study in Viewer with user sharing enabled and disabled shadow user in TestEHR as unknown user & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: User1, role: User1, user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_13);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 13 :- Validate iCA viewer with shadow user enabled as known iCA user & also that user as role
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 14 :- Enable UserSharing and Enable Shadow user
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Open Study in Viewer with user sharing & shadow user enabled in TestEHR as unknown user & role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "RandomRole_" + randomnumber, user: User_15);
                ehr.SetSearchKeys_Study(Accession);
                String url_15 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_15);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 15 :- Validate authentication error message
                if (viewer.AuthenticationErrorMsg().Text.Contains("Client authentication failed"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with enabled user sharing and shadow user in TestEHR as unknown user 
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User_16);
                ehr.SetSearchKeys_Study(Accession);
                String url_16 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_16);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 16 :- Validate iCA viewer
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with enabled user sharing and shadow user in TestEHR as unknown user & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User_17);
                ehr.SetSearchKeys_Study(Accession);
                String url_17 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_17);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 17 :- Validate iCA viewer
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with enabled user sharing and shadow user in TestEHR as unknown user, unknown domain & known role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "RandomDomain_" + randomnumber, role: Role1, user: User_18);
                ehr.SetSearchKeys_Study(Accession);
                String url_18 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_18);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 18 :- Validate iCA viewer
                if (viewer.AuthenticationErrorMsg().Text.Contains("Client authentication failed"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with enabled user sharing and shadow user in TestEHR as iCA known user, blank domain & blank role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_19 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_19);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 19 :- Validate iCA viewer
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Step 20 :- Make URL enabled in UserSharing and Enable Shadow user
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "URL determined", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Open Study in Viewer with URL determined user sharing and enabled shadow user in servicetool with usersharing enabled 
                //in TestEHR as iCA known user, domain and role
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "True", domain: Domain1, role: Role1, user: User1);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_21 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_21);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 21 :- Validate iCA viewer
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with URL determined user sharing and enabled shadow user in servicetool with usersharing disabled in 
                //testEHR as iCA non registered user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "False", domain: Domain1, role: Role1, user: User_22);
                ehr.SetSearchKeys_Study(Accession);
                String url_22 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_22);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                Boolean isStudyPresent_22 = viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6;

                //Validate shadow user creation
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser("*", Domain1);
                Boolean isuserpresent_22 = usermgmt.IsUserPresent(User_22);

                //Step 22 :- Validate iCA viewer
                if (isStudyPresent_22 && !isuserpresent_22)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with URL determined user sharing and enabled shadow user in servicetool with usersharing disabled in 
                //testEHR as iCA non existing user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "False", domain: Domain1, role: User_23, user: User_23);
                ehr.SetSearchKeys_Study(Accession);
                String url_23 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_23);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                Boolean isStudyPresent_23 = viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6;

                //Validate shadow user creation
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser("*", Domain1);
                Boolean isuserpresent_23 = usermgmt.IsUserPresent(User_23);

                //Step 23 :- Validate iCA viewer
                if (isStudyPresent_23 && !isuserpresent_23)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with URL determined user sharing and enabled shadow user in servicetool with usersharing disabled in 
                //testEHR as iCA non registered user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "False", domain: Role1, role: Role1, user: User_24);
                ehr.SetSearchKeys_Study(Accession);
                String url_24 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_24);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                Boolean isStudyPresent_24 = viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6;

                //Validate shadow user creation
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser("*", Domain1);
                Boolean isuserpresent_24 = usermgmt.IsUserPresent(User_24);

                //Step 24 :- Validate iCA viewer
                if (isStudyPresent_24 && !isuserpresent_24)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with URL determined user sharing and enabled shadow user in servicetool with usersharing enabled in 
                //testEHR as existing iCA user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "True", domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_25 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_25);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 25 :- Validate iCA viewer
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with URL determined user sharing and enabled shadow user in servicetool with usersharing disabled in 
                //testEHR as existing iCA user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "False", domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_26 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_26);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                Boolean isStudyPresent_26 = viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 6;

                //Validate shadow user creation
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser(User1, Domain1);
                int UsersCount_26 = usermgmt.ListedUsers().Count();

                //Step 26 :- Validate iCA viewer
                if (isStudyPresent_26 && UsersCount_26 == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Ldap - Integration  Sharing
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27986(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer viewer = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmgmt = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LDAPadminUserName = Config.LdapAdminUserName;
                String LDAPadminPassword = Config.LdapAdminPassword;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Domain = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DomainName");
                String datasource = login.GetHostName(Config.SanityPACS).ToUpper();
                int randomnumber = new Random().Next(1, 1000);

                //PreCondition :- 
                //Enable 'Ldap Directory Service' and 'Local Database'
                //servicetool.EnableLDAPConfigfile();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(2);
                //servicetool.EnableLdap();

                //Enable User Sharing and Shadow user
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();

                //Login as LDAP Administrator
                login.LoginIConnect(LDAPadminUserName, LDAPadminPassword);

                //Navigate to domain management tab
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                Dictionary<object, string> domainattr1;
                domainattr1 = domainmgmt.CreateDomainAttr();
                domainmgmt.CreateDomain(domainattr1, new string[] { datasource });
                String Domain1 = domainattr1[DomainManagement.DomainAttr.DomainName];

                //Step 1 :- Set CR modality layout as 2x2
                domainmgmt.SearchDomain(Domain);
                domainmgmt.SelectDomain(Domain);
                domainmgmt.ClickEditDomain();
                domainmgmt.ModifyStudySearchFields();
                domainmgmt.ModalityDropDown().SelectByText("CR");
                domainmgmt.LayoutDropDown().SelectByText("2x2");
                domainmgmt.ClickSaveDomain();
                ExecutedSteps++;

                //Step 2 :- Logout iCA
                login.Logout();
                ExecutedSteps++;

                //Open Study in Viewer with TestEHR as LDAp Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "", role: "", user: LDAPadminUserName);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_3);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 3 :- Validate iCA viewer for LDAP admin user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as LDAp Admin user with non default domain
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: LDAPadminUserName);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_4);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 4 :- Validate iCA viewer for LDAP admin user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Select User preferences tool in review toolbar
                viewer.SelectToolInToolBar("UserPreference");

                //Step 5 :- Change Image format in User preferences
                BasePage.wait.Until(ExpectedConditions.ElementExists(By.CssSelector("iframe#m_UserprefFrame")));
                BasePage.Driver.SwitchTo().Frame("m_UserprefFrame");
                viewer.ImageFormatInUserPref("PNG").Click();
                viewer.CloseUserPreferences();
                ExecutedSteps++;

                //Step 6 :- Login as LDAP Administrator
                login.LoginIConnect(LDAPadminUserName, LDAPadminPassword);
                ExecutedSteps++;

                //Open User preferences
                viewer.OpenUserPreferences();

                //Step 7 :- Validate the image format selected in integrator window user preferences
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                if (viewer.ImageFormatInUserPref("PNG").Selected)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 :- Logout
                login.Logout();
                ExecutedSteps++;

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as LDAp Admin user with domain and role fields blank
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "", role: "", user: LDAPadminUserName);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_9);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 9 :- Validate iCA viewer for LDAP admin user
                if (viewer.PatientDetailsInViewer()["LastName"].ToLower().Equals(LastName.ToLower()) &&
                    viewer.PatientDetailsInViewer()["FirstName"].ToLower().Equals(FirstName.ToLower()) &&
                    viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()) &&
                    viewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Authentication - iCALdap authenticator
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_77836(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer viewer = null;
            IntegratorStudies intgtrStudies = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmgmt = null;
            RoleManagement rolemgmt = null;
            UserManagement usermgmt = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String LDAPadminUserName = Config.LdapAdminUserName;
                String LDAPadminPassword = Config.LdapAdminPassword;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String datasource = login.GetHostName(Config.SanityPACS).ToUpper();
                int randomnumber = new Random().Next(1, 1000);

                //Users
                String User_NonLdap = "NonLdapUser_" + randomnumber;
                String User_Local = adminUserName;
                String User_LDAP = LDAPadminUserName;

                //Security ID's
                String securityID_LDAP = LDAPadminUserName + "-" + LDAPadminPassword;
                String securityID_Unknown = User_NonLdap + "-" + User_NonLdap;
                String securityID_Local = adminUserName + "-" + adminPassword;

                //Domain-1 Users and Role
                Dictionary<object, string> domainattr1;
                String D1Physician = "Physician1" + randomnumber;
                String D1ph = "ph1" + randomnumber;

                //Step 1 :- Precondition - Enable 'Ldap Directory Service' and 'Local Database'
                //servicetool.EnableLDAPConfigfile();
                servicetool.LaunchServiceTool();
                //servicetool.EnableLdap();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(2);
                ExecutedSteps++;

                //Step 2 :- Enable 'Allow Show Selector' and 'Allow Show Selector Search'
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.WaitWhileBusy();
                servicetool.RestartService();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 3 :- Create new domain, role and user as Admin user
                //Login as Administrator
                login.LoginIConnect(adminUserName, adminPassword);

                //Create domain-1 with Physicain,archivist and Staff users
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainattr1 = domainmgmt.CreateDomainAttr();
                domainmgmt.CreateDomain(domainattr1, new string[] { datasource });
                String Domain1 = domainattr1[DomainManagement.DomainAttr.DomainName];

                //Create Role
                rolemgmt = (RoleManagement)login.Navigate("RoleManagement");
                rolemgmt.CreateRole(Domain1, D1Physician, "Physician");

                //Create User
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.CreateUser(D1ph, Domain1, D1Physician, 1, Config.emailid, 1, D1ph);

                //Logout iCA           
                login.Logout();
                ExecutedSteps++;

                //Step 4 :- Comment Bypass node and Uncommment iCA LDAP node
                login.CommentXMLnode("id", "Bypass");
                login.UncommentXMLnode("id", "iCALdap");
                ExecutedSteps++;

                //Open Study in Viewer with TestEHR as LDAp Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCALdap", user: LDAPadminUserName, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_5 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_5);
                ehr.CloseEHR();
                Dictionary<String, String> URLdetails_5 = new StudyViewer().IntegratorURLdetails(url_5);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Step 5 :- Test with Valid credentials in Ldap DB
                if (URLdetails_5["UserID"].Equals(LDAPadminUserName) && URLdetails_5["SecurityID"].Equals(securityID_LDAP)
                    && intgtrStudies.Intgtr_Rows().Count() != 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load a study in 2D view
                intgtrStudies.Intgr_GetorSelectRow("Last Name", LastName);
                viewer = StudyViewer.LaunchStudy();

                //Take Screenshot
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                Boolean ViewerStatus = intgtrStudies.CompareImage(result.steps[ExecutedSteps], viewer.ViewerContainer());

                //Step 6 :- Validate study loaded in viewer
                if (ViewerStatus)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Launch a study with show selector cleared using test EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCALdap", user: LDAPadminUserName, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "");
                ehr.SetSearchKeys_Patient("LastName", "");
                ehr.SetSearchKeys_Study(Accession);
                String url_7 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ehr.CloseEHR();

                //Screenshot Comparison
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                Boolean Is2Dview = login.CompareImage(result.steps[ExecutedSteps], viewer.ViewerContainer());

                //Step 7 :- Validate study loaded in viewer
                if (Is2Dview && viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as LDAp Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCALdap", user: User_NonLdap, SecurityID: securityID_Unknown);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_8 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_8);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ehr.CloseEHR();

                //Step 8 :- Validate error message for query with non existing LDAP user
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as local database Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCALdap", user: User_Local, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_9 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_9);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ehr.CloseEHR();

                //Step 9 :- Validate error message for query with existing local database user
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as local database Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "Bypass", user: User_LDAP, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_10 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_10);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ehr.CloseEHR();

                //Step 10 :- Validate error message for query with existing ldap user
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as local database Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCADatabase", user: User_LDAP, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_11 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_11);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ehr.CloseEHR();

                //Step 11 :- Validate error message for query with existing ldap user
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                //Comment iCALdap and Uncomment Bypass
                login.CommentXMLnode("id", "iCALdap");
                login.UncommentXMLnode("id", "Bypass");
            }
        }

        /// <summary>
        /// Authentication - iCAMixed authenticator
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_77837(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer viewer = null;
            IntegratorStudies intgtrStudies = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmgmt = null;
            RoleManagement rolemgmt = null;
            UserManagement usermgmt = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String LDAPadminUserName = Config.LdapAdminUserName;
                String LDAPadminPassword = Config.LdapAdminPassword;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String datasource = login.GetHostName(Config.SanityPACS).ToUpper();
                int randomnumber = new Random().Next(1, 1000);

                //Users
                String User_LDAP = LDAPadminUserName;
                String User_NonLdap = "NonLdap_" + randomnumber;
                String User_Local = adminUserName;
                String User_UnKnown = "UnknownUser_" + randomnumber;

                //Security ID's
                String securityID_LDAP = LDAPadminUserName + "-" + LDAPadminPassword;
                String securityID_NonLdap = User_NonLdap + "-" + User_NonLdap;
                String securityID_Local = User_Local + "-" + adminPassword;
                String securityID_Unknown = User_UnKnown + "-" + User_UnKnown;

                //Domain-1 Users and Role
                Dictionary<object, string> domainattr1;
                String D1Physician = "Physician1" + randomnumber;
                String D1ph = "ph1" + randomnumber;

                //Step 1 :- Precondition - Enable 'Ldap Directory Service' and 'Local Database'
                //servicetool.EnableLDAPConfigfile();
                servicetool.LaunchServiceTool();
                //servicetool.EnableLdap();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(2);
                ExecutedSteps++;

                //Step 2 :- Enable 'Allow Show Selector' and 'Allow Show Selector Search'
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;

                //Click apply button if enabled   
                ITabPage currenttab = WpfObjects._mainWindow.Get<Tab>(SearchCriteria.All).SelectedTab;
                Button applybutton = wpfobject.GetAnyUIItem<ITabPage, Button>(currenttab, "Apply", 1);
                int counter = 0;
                currenttab.Click();
                System.Windows.Forms.SendKeys.SendWait("{Enter}");
                while ((applybutton.Enabled == false) && (counter++ < 2)) { Thread.Sleep(5000); }
                if (wpfobject.GetAnyUIItem<ITabPage, Button>(currenttab, "Apply", 1).Enabled)
                {
                    servicetool.ClickApplyButtonFromTab();
                    wpfobject.WaitForPopUp();
                    wpfobject.GetMainWindowByIndex(1);
                    wpfobject.GetButton("Yes", 1).Click();
                    wpfobject.GetMainWindowByIndex(0);
                    servicetool.RestartService();
                    servicetool.WaitWhileBusy();
                }
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 3 :- Create new domain, role and user as Admin user
                //Login as Administrator
                login.LoginIConnect(adminUserName, adminPassword);

                //Create domain-1 with Physicain,archivist  and Staff users
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainattr1 = domainmgmt.CreateDomainAttr();
                domainmgmt.CreateDomain(domainattr1, new string[] { datasource });
                String Domain1 = domainattr1[DomainManagement.DomainAttr.DomainName];

                //Create Role
                rolemgmt = (RoleManagement)login.Navigate("RoleManagement");
                rolemgmt.CreateRole(Domain1, D1Physician, "Physician");

                //Create User
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.CreateUser(D1ph, Domain1, D1Physician, 1, Config.emailid, 1, D1ph);

                //Logout iCA           
                login.Logout();
                ExecutedSteps++;

                //Step 4 :- Comment Bypass node and Uncommment iCA LDAP node
                login.CommentXMLnode("id", "Bypass");
                login.UncommentXMLnode("id", "iCAMixed");
                ExecutedSteps++;

                //Open Study in Viewer with TestEHR as LDAp Admin user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCAMixed", user: LDAPadminUserName, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_5 = ehr.clickCmdLine("ImageLoad");

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_5);
                Dictionary<String, String> URLdetails_5 = new StudyViewer().IntegratorURLdetails(url_5);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");

                //Step 5 :- 
                if (URLdetails_5["UserID"].Equals(LDAPadminUserName) && URLdetails_5["SecurityID"].Equals(securityID_LDAP))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load a study in 2D view
                intgtrStudies.Intgr_GetorSelectRow("Last Name", LastName);
                viewer = StudyViewer.LaunchStudy();

                //Take Screenshot
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                Boolean ViewerStatus = intgtrStudies.CompareImage(result.steps[ExecutedSteps], viewer.ViewerContainer());

                //Step 6 :- Validate study loaded in viewer
                if (ViewerStatus)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Launch a study with show selector cleared using test EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCAMixed", user: LDAPadminUserName, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "");
                ehr.SetSearchKeys_Patient("LastName", "");
                ehr.SetSearchKeys_Study(Accession);
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_7);
                login.NavigateToIntegratorFrame();

                //Screenshot Comparison
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                Boolean Is2Dview = login.CompareImage(result.steps[ExecutedSteps], viewer.ViewerContainer());

                //Step 7 :- Validate study loaded in viewer
                if (Is2Dview && viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as local database user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCAMixed", user: User_Local, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_8);
                Dictionary<String, String> URLdetails_8 = viewer.IntegratorURLdetails(url_8);
                login.NavigateToIntegratorFrame("studies");

                //Step 8 :- Validate error message for query with existing local database user
                if (URLdetails_8["UserID"].Equals(User_Local) && URLdetails_8["SecurityID"].Equals(securityID_Local))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load a study in 2D view
                intgtrStudies.Intgr_GetorSelectRow("Last Name", LastName);
                intgtrStudies.LaunchStudy();

                //Take Screenshot
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                Boolean ViewerStatus_9 = intgtrStudies.CompareImage(result.steps[ExecutedSteps], viewer.ViewerContainer());

                //Step 9 :- Validate study loaded in viewer
                if (ViewerStatus_9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Launch a study with show selector cleared using test EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCAMixed", user: User_Local, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "");
                ehr.SetSearchKeys_Patient("LastName", "");
                ehr.SetSearchKeys_Study(Accession);
                String url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_10);
                login.NavigateToIntegratorFrame();

                //Screenshot Comparison
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                Boolean Is2Dview_10 = login.CompareImage(result.steps[ExecutedSteps], viewer.ViewerContainer());

                //Step 10 :- Validate study loaded in viewer
                if (Is2Dview_10 && viewer.StudyDetailsInViewer()["Accession"].ToLower().Equals(Accession.ToLower()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as local Admin(Non-LDAP) user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCAMixed", user: User_NonLdap, SecurityID: securityID_NonLdap);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_11);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();

                //Step 11 :- Validate Test with Invalid Credentials in Ldap DB
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with TestEHR as unknown local user
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCAMixed", user: User_UnKnown, SecurityID: securityID_Unknown);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_12);
                login.NavigateToIntegratorFrame();

                //Step 12 :- Validate Test with Invalid Credentials in Local DB
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with valid credential with Auth Provider=Bypass
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "Bypass", user: User_LDAP, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_13);
                login.NavigateToIntegratorFrame();

                //Step 13 :- Validate Test with valid LDAP credential with Auth Provider=Bypass
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with valid Local credential with Auth Provider=Bypass
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "Bypass", user: User_Local, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_14);
                login.NavigateToIntegratorFrame();

                //Step 14 :- Validate Test with valid Local credential with Auth Provider=Bypass
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with valid LDAP credential with Auth Provider=iCALdap
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCALdap", user: User_LDAP, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_15 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_15);
                login.NavigateToIntegratorFrame();

                //Step 15 :- Validate Test with valid LDAP credential with Auth Provider=iCALdap
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with valid local credential with Auth Provider=iCALdap
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCALdap", user: User_Local, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_16 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_16);
                login.NavigateToIntegratorFrame();

                //Step 16 :- Validate Test with valid local credential with Auth Provider=iCALdap
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with valid LDAP credential with Auth Provider=iCADatabase
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCADatabase", user: User_LDAP, SecurityID: securityID_LDAP);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_17 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_17);
                login.NavigateToIntegratorFrame();

                //Step 17 :- Validate Test with valid LDAP credential with Auth Provider=iCADatabase
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Open Study in Viewer with valid local credential with Auth Provider=iCADatabase
                ehr.LaunchEHR();
                ehr.SetCommonParameters(AuthProvider: "iCADatabase", user: User_Local, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "", showSelector: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_18 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_18);
                login.NavigateToIntegratorFrame();

                //Step 18 :- Validate Test with valid local credential with Auth Provider=iCADatabase
                if (viewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                //Comment iCAMixed and Uncomment Bypass
                login.CommentXMLnode("id", "iCAMixed");
                login.UncommentXMLnode("id", "Bypass");

                //Reset LDAP settings
                //servicetool.EnableLDAPConfigfile();
                //servicetool.LaunchServiceTool();
                //servicetool.EnableLdap();
                //servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                //servicetool.SetMode(0);
                //servicetool.RestartService();
                //servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// Viewing priors with Query Related Study Parameters Applied
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27981(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer viewer = null;
            Studies studies = null;
            Outbounds outbounds = null;
            Taskbar taskbar = null;
            IntegratorStudies intgtrStudies = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmgmt = null;
            RoleManagement rolemanagement = null;
            UserManagement usermanagement = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String StudyPath = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath");
                String AccessionIDList1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList"); //AccessionIDList
                String[] AccessionList_1 = AccessionIDList1.Split(':');
                String AccessionIDList2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList2");
                String[] AccessionList_2 = AccessionIDList2.Split(':');
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                LastName = LastName.ToUpper();
                String datasource1 = login.GetHostName(Config.PACS2).ToUpper();
                String datasource2 = login.GetHostName(Config.SanityPACS).ToUpper();
                int randomnumber = new Random().Next(1, 1000);

                //Dynamic Domain/Role/User details
                String domainname = "Domain1_" + randomnumber;
                String Role_1 = "Role1_" + randomnumber;
                String Role_2 = "Role2_" + randomnumber;
                String User_1 = "User1_" + randomnumber;
                String User_2 = "User2_" + randomnumber;
                String Dest_1 = "Dest1_" + randomnumber;
                String eiWindowName = "ExamImporter_" + randomnumber;

                //Node Paths
                String AllowShowSelector = @"Configuration/IntegratedMode/AllowShowSelector";
                String AllowShowSelectorSearch = @"Configuration/IntegratedMode/AllowShowSelectorSearch";

                //AccessionList_1[0] --> Study Shared by U1
                //AccessionList_1[1] --> Study in DataSource 1(U1)
                //AccessionList_2[0] --> Study in DataSource 2(U2)
                //AccessionList_2[1] --> Study Uploaded by U2 (in Holding pen)
                String[] Accessions_User2 = { AccessionList_1[0], AccessionList_2[0], AccessionList_2[1] };

                //Step 1 :- Enable Allow Show Selector and Allow Show Selector Search in WebaccessConfiguration.xml file
                login.ChangeNodeValue(ehr.WebaccessConfigurationXMLPath, AllowShowSelector, "true");
                login.ChangeNodeValue(ehr.WebaccessConfigurationXMLPath, AllowShowSelectorSearch, "true");
                ExecutedSteps++;

                //Step 2 :- Test - EHR initial setup and enable bypass mode
                login.UncommentXMLnode("id", "Bypass");
                ExecutedSteps++;

                //PreConditions
                //Login as Administrator
                login.LoginIConnect(adminUserName, adminPassword);

                //Navigate to Domain Management
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");

                //Create domain
                domainmgmt.CreateDomain(domainname, domainname + "Role",
                    new String[] { "datatransfer", "grant", "emailstudy", "datadownload", "pdfreport", "allowdownload", "allowtransfer", "allowemail", "PDFreport", "receiveexam", "archive", "imagesharing" },
                    new string[] { datasource1, datasource2 });

                //Step 3 :- Validate domain creation
                if (domainmgmt.SearchDomain(domainname))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to Domain Management
                rolemanagement = (RoleManagement)login.Navigate("RoleManagement");

                //Create Role1
                rolemanagement.CreateRole(domainname, Role_1, "both");
                rolemanagement.SearchRole(Role_1, domainname);
                rolemanagement.SelectRole(Role_1);
                rolemanagement.ClickEditRole();
                rolemanagement.AddDatasourceToRole(datasource1);
                if (!rolemanagement.GrantAccessRadioBtn_Anyone().Selected)
                {
                    rolemanagement.GrantAccessRadioBtn_Anyone().Click();
                }
                rolemanagement.ClickSaveEditRole();
                bool IsRole1Created = rolemanagement.RoleExists(Role_1);

                //Create Role 2
                rolemanagement = (RoleManagement)login.Navigate("RoleManagement");
                rolemanagement.CreateRole(domainname, Role_2, "both");
                rolemanagement.SearchRole(Role_2, domainname);
                rolemanagement.SelectRole(Role_2);
                rolemanagement.ClickEditRole();
                rolemanagement.AddDatasourceToRole(datasource2);
                if (!rolemanagement.GrantAccessRadioBtn_Anyone().Selected)
                {
                    rolemanagement.GrantAccessRadioBtn_Anyone().Click();
                }
                rolemanagement.ClickSaveEditRole();
                bool IsRole2Created = rolemanagement.RoleExists(Role_2);

                //Create User 1 under role 1
                usermanagement = (UserManagement)login.Navigate("UserManagement");
                usermanagement.CreateUser(User_1, domainname, Role_1);
                bool IsUser1Created = usermanagement.SearchUser(User_1, domainname);

                //Create User 2 under role 2
                usermanagement.CreateUser(User_2, domainname, Role_2);
                bool IsUser2Created = usermanagement.SearchUser(User_2, domainname);

                //Navigate to Image Sharing-->Destination tab
                Image_Sharing imagesharing = (Image_Sharing)login.Navigate("Image Sharing");
                Image_Sharing.Destination dest = (Image_Sharing.Destination)imagesharing.NavigateToSubTab("Destination");

                //Create a destination with User 2 as receiver and archivist
                dest.AddDestination(domainname, Dest_1, datasource1, User_2, User_2);
                Boolean IsDestFound = dest.SearchDestination(domainname, Dest_1);

                //Step 4 :- Validate Roles, Users and Destination creation
                if (IsRole1Created && IsRole2Created && IsUser1Created && IsUser2Created && IsDestFound)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 :- Test Data Preparation
                taskbar = new Taskbar();
                taskbar.Hide();
                ServiceTool servicetool = new ServiceTool();
                servicetool.LaunchServiceTool();
                servicetool.GenerateInstallerAllDomain(domainname, eiWindowName);
                servicetool.RestartService();
                servicetool.CloseServiceTool();
                BasePage.Kill_EXEProcess("UploaderTool");
                taskbar.Show();

                //EI installation
                String EIPath = ei.EI_Installation(domainname, eiWindowName, Config.Inst1, User_1, User_1);
                //Uploading study to holding pen      
                ei.eiWinName = eiWindowName;
                ei.EIDicomUpload(User_2, User_2, Dest_1, StudyPath, 1, EIPath);
                ExecutedSteps++;

                //Share Study to User_2 as User1
                login.LoginIConnect(User_1, User_1);
                studies = (Studies)login.Navigate("Studies");
                studies.SearchStudy("Accession", AccessionList_1[0]);
                Dictionary<string, string> StudyDetails_Shared = studies.GetMatchingRow("Accession", AccessionList_1[0]);
                studies.SelectStudy1("Accession", AccessionList_1[0]);
                studies.ShareStudy(false, new string[] { User_2 });
                outbounds = (Outbounds)login.Navigate("Outbounds");
                outbounds.SearchStudy("Accession", AccessionList_1[0]);
                Dictionary<string, string> Sharedstudy = outbounds.GetMatchingRow("Accession", AccessionList_1[0]);

                //Step 6 :- Validate study listed with Shared status in User 1's outbounds
                if (Sharedstudy != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout
                login.Logout();

                //Step 7 :- Launch Service tool, enable image sharing and Select "Show Selector" in Integrator tab
                servicetool = new ServiceTool();
                servicetool.LaunchServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "enable");
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                servicetool.OnMultipleStudy().Select("Show Selector");
                wpfobject.WaitTillLoad();
                servicetool.WaitWhileBusy();
                servicetool.RestartService();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 8 :- Set Study Search Query parameter to patient last name as Administrator
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientlastname", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientid", 1);//Uncheck
                domainmgmt.SetCheckBoxInEditDomain("patientfullname", 1);
                domainmgmt.SetCheckBoxInEditDomain("patientdob", 1);
                domainmgmt.SetCheckBoxInEditDomain("patientipid", 1);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_5);
                Dictionary<String, String> URLdetails_5 = new StudyViewer().IntegratorURLdetails(url_5);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_9 = Array.Exists(LastnameColumnvalues, s => s.Equals(LastName));

                //Step 9 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_9)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_10 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_10 = Accessions_User2.Intersect(ColumnValues_10).Count() == Accessions_User2.Length;

                //Step 10 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_10 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_11 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 11 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_11["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_11["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_11["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 12 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 :- Set Study Search Query parameter to patient full name as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientlastname", 1);
                domainmgmt.SetCheckBoxInEditDomain("patientfullname", 0);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient full name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_14);
                Dictionary<String, String> URLdetails_14 = new StudyViewer().IntegratorURLdetails(url_14);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_14 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_14 = Array.Exists(LastnameColumnvalues_14, s => s.Equals(LastName));

                //Step 14 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_14)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_15 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_15 = Accessions_User2.Intersect(ColumnValues_15).Count() == Accessions_User2.Length;

                //Step 15 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_15 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_16 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 16 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_16["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_16["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_16["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 17 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18 :- Set Study Search Query parameter to patient ID as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientfullname", 1);
                domainmgmt.SetCheckBoxInEditDomain("patientid", 0);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_19 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_19);
                Dictionary<String, String> URLdetails_19 = new StudyViewer().IntegratorURLdetails(url_19);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_19 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_19 = Array.Exists(LastnameColumnvalues_19, s => s.Equals(LastName));

                //Step 19 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_19)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_20 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_20 = Accessions_User2.Intersect(ColumnValues_20).Count() == Accessions_User2.Length;

                //Step 20 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_20 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_21 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 21 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_21["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_21["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_21["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 22 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 23 :- Set Study Search Query parameter to patient ID as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientid", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientlastname", 0);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_24 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_24);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_24 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_24 = Array.Exists(LastnameColumnvalues_24, s => s.Equals(LastName));

                //Step 24 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_24)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_25 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_25 = Accessions_User2.Intersect(ColumnValues_25).Count() == Accessions_User2.Length;

                //Step 25 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_25 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_26 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 26 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_26["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_26["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_26["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 27 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 28 :- Set Study Search Query parameter to patient ID and Patient full name as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientid", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientfullname", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientlastname", 1);//Uncheck
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_29 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_29);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_29 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_29 = Array.Exists(LastnameColumnvalues_29, s => s.Equals(LastName));

                //Step 28 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_29)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_30 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_30 = Accessions_User2.Intersect(ColumnValues_30).Count() == Accessions_User2.Length;

                //Step 30 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_30 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_31 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 31 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_31["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_31["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_31["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 32 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 33 :- Set Study Search Query parameter to patient ID and Patient DOB as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientid", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientdob", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientfullname", 1);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_34 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_34);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_34 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_34 = Array.Exists(LastnameColumnvalues_34, s => s.Equals(LastName));

                //Step 34 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_34)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_35 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_35 = Accessions_User2.Intersect(ColumnValues_35).Count() == Accessions_User2.Length;

                //Step 35 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_35 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_36 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 36 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_36["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_36["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_36["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 37 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 38 :- Set Study Search Query parameter to patient ID and Patient DOB as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientid", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientipid", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientdob", 1);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_39 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_39);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_39 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_39 = Array.Exists(LastnameColumnvalues_39, s => s.Equals(LastName));

                //Step 39 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_39)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_40 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_40 = Accessions_User2.Intersect(ColumnValues_40).Count() == Accessions_User2.Length;

                //Step 40 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_40 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_41 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 41 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_41["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_41["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_41["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 42 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 43 :- Set Study Search Query parameter to patient ID and Patient DOB as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(domainname);
                domainmgmt.SelectDomain(domainname);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("patientid", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientdob", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientlastname", 0);
                domainmgmt.SetCheckBoxInEditDomain("patientipid", 1);
                domainmgmt.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Query with Patient last name in Test - EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: "http://" + Config.IConnectIP + "/webaccess", AuthProvider: "Bypass", user: User_2, SecurityID: User_2 + "-" + User_2,
                    domain: domainname, role: Role_2, usersharing: "True");
                ehr.SetSelectorOptions(selectoroption: "Study", showSelector: "True", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("LastName", LastName);
                String url_44 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Navigate to url generated in test eHR
                login = new Login();
                login.NavigateToIntegratorURL(url_44);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Get Listed Studies Last names
                String[] LastnameColumnvalues_44 = intgtrStudies.Intgr_ColumnValues("Last Name");
                Boolean LastNameMatch_44 = Array.Exists(LastnameColumnvalues_44, s => s.Equals(LastName));

                //Step 44 :- Validate queried studies with patient last name is listed
                if (LastNameMatch_44)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Load Study
                intgtrStudies.Intgr_GetorSelectRow("Accession", AccessionList_2[0]);
                viewer = StudyViewer.LaunchStudy();

                //Navigate to History Panel
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Accession", "# Images" });

                String[] ColumnValues_45 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                Boolean AccessionMatch_45 = Accessions_User2.Intersect(ColumnValues_45).Count() == Accessions_User2.Length;

                //Step 45 :- Validate priors of same patient are displayed in history panel
                if (AccessionMatch_40 && viewer.CheckForeignExamAlert("Accession", AccessionList_2[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Open shared study in second study viewer
                Dictionary<string, string> SharedStudy_46 = viewer.GetMatchingRow("Accession", AccessionList_1[0]);
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_1[0] });

                //Step 46 :- Validate shared study in second study viewer
                if (viewer.studyPanel(2).Displayed && StudyDetails_Shared["Modality"].Equals(SharedStudy_46["Modality"])
                    && StudyDetails_Shared["# Images"].Equals(SharedStudy_46["# Images"]) &&
                    StudyDetails_Shared["Study Date"].Equals(SharedStudy_46["Study Date"]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Navigate to History Panel and open uploaded study in third study viewer
                viewer.NavigateToHistoryPanel();
                viewer.OpenPriors(new String[] { "Accession" }, new String[] { AccessionList_2[1] });

                //Step 47 :- Validate uploaded study in third study viewer
                if (viewer.studyPanel(3).Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
        }

        /// <summary> 
        /// 6.0 System Configuration Settings
        /// </summary>
        public TestCaseResult Test_27968(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmanagement = null;
            StudyViewer viewer = new StudyViewer();
            int ExecutedSteps = -1;
            string url = string.Empty;
            string[] ModalitySettings = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "Modality")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Preconditions
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.NavigateToTab("Viewer");
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                foreach (string ms in ModalitySettings)
                {
                    servicetool.MoadalitySetting(ms.Split('-')[0], ms.Split('-')[1]);
                }
                servicetool.CloseServiceTool();
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                login.LoginIConnect(username, password);
                if (login.IsTabSelected("DomainManagement"))
                {
                    domainmanagement = new DomainManagement();
                }
                else
                {
                    domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                }
                Dictionary<Object, String> createDomain = domainmanagement.CreateDomainAttr();
                domainmanagement.CreateDomain(createDomain);
                string DomainName = createDomain[DomainManagement.DomainAttr.DomainName];
                string RoleName = createDomain[DomainManagement.DomainAttr.RoleName];
                string user = createDomain[DomainManagement.DomainAttr.UserID];
                login.Logout();

                //Step 1: Using the test EHR application load a US study.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 2: Load a MR study.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 3: Load a CT study
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[2]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 4: Load a CR study
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[3]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 5: Load a RF study
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[4]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 6: Change the layout to 1x2.
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                viewer.SelectToolInToolBar("SeriesViewer1x2");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 7: Load another RF study.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[4]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 8:Load a CR study with 3 series (i.e. Hanner, Martin).
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[5]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 9: Load a CR study with 4 series (i.e. Ransholt, Ingrid).
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[6]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (viewer.SeriesViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
            }
        }

        /// <summary>
        /// 27937 - Test With User ID
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27937(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            IntegratorStudies studies = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                // String StudyPath = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath");

                int randomnumber = new Random().Next(1, 1000);

                String datasource1 = login.GetHostName(Config.PACS2).ToUpper();
                String datasource2 = login.GetHostName(Config.SanityPACS).ToUpper();

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');

                String AccessionIDList1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String[] AccessionList_1 = AccessionIDList1.Split(':');

                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNames.Split(':');

                String FirstNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNames.Split(':');

                String MiddleNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MiddleName");
                String[] MiddleName = MiddleNames.Split(':');

                String Patient_DOBs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String[] Patient_DOB = Patient_DOBs.Split(':');

                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");

                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String URL = "http://localhost/webaccess";

                String ThumbnailSeriesUID;
                String ViewerSeriesUID;

                // Pre Condition 
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                DomainManagement domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                PageLoadWait.WaitForPageLoad(10);
                Dictionary<Object, String> createDomain = domainmanagement.CreateDomainAttr();
                string RoleName = createDomain[DomainManagement.DomainAttr.RoleName];
                string DomainName = createDomain[DomainManagement.DomainAttr.DomainName];
                string userid = createDomain[DomainManagement.DomainAttr.UserID];
                domainmanagement.CreateDomain(createDomain);
                domainmanagement.SearchDomain(DomainName);
                domainmanagement.SelectDomain(DomainName);
                domainmanagement.ClickEditDomain();
                domainmanagement.ClickChooseColumns();
                domainmanagement.SelectColumns(new string[] { "Study UID", "Accession" });
                domainmanagement.OKButton_ChooseColumns().Click();
                domainmanagement.ClickSaveEditDomain();
                login.Logout();
                //Initial Set-up
                basepage.UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");
                servicetool.LaunchServiceTool();
                servicetool.wpfobject.WaitTillLoad();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "");
                servicetool.ClickModifyButton();
                TextBox logoPath3 = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 5);
                logoPath3.BulkText = "MM/dd/yyyy;yyyy/MM/dd";
                servicetool.CickApplyButton();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Initial Set-up
                //Step 1
                // Return to the Image Load tab, enter the Study Instance UID that matches no studies in any data source domains. 
                // Ensure that Show Report is enabled, Show selector is not enabled, and click Load
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: "", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                bool ErrorMessage = studyviewer.AuthenticationErrorMsg().Text.ToLower().Contains("the study cannot be located");
                if (ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                // Step 2
                // Return to the Image Load tab of the TestEHR application. 
                // Clear the Study UID field, enter the Accession Number that matches one study that is in one of the 
                // data source domains and click Load.
                // Study UID: 1.2.840.113619.2.15.1008000062036161045.852625986.2.9 & Accession ID : 234234
                // patient name Barium, Gary Datasource: PA-A7-WS8

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                // ehr.SetSearchKeys_Study("1.2.840.113619.2.15.1008000062036161045.852625986.2.9", "Study_UID", datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(StudyUID[1], "Study_UID", datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                WebDriverWait wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(20);
                if (studyviewer.ViewStudy(IntegratedDesktop: true))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 3
                // Select a layout other than 1x1.
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.SeriesViewer2x2);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 4
                // Return to the Image Load tab of the TestEHR application. Clear the Search keys fields, enter Study UIDs 
                // or Accession Numbers that matches multiple studies for one patient that is in one data source Domain and click Load. 
                // Note "\" should be given when multiple values are given in Accession or Study UID field (Eg Acc#1\Acc#2)
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                // ehr.SetSearchKeys_Study("1121603V\\1121602V", datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(AccessionList_1[0]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                //if (ThumbnailSeriesUID.Equals(ViewerSeriesUID))
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}
                studyviewer.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(40);
                PageLoadWait.WaitForFrameLoad(40);
                String[] accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (string.Equals(ThumbnailSeriesUID, ViewerSeriesUID) && accessionIds.Contains(AccessionId[4]) && accessionIds.Contains(AccessionId[5]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.InfoLog("Thumbanail = " + ThumbnailSeriesUID);
                    Logger.Instance.InfoLog("ViewerSeriesUID = " + ViewerSeriesUID);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5
                // Return to the Image Load tab of the TestEHR application. Clear the Search keys fields, 
                // enter Study UIDs or Accession Numbers that matches multiple studies for multiple patients that are 
                // from the same Assigning Authority and click Load. 
                // Note "\" should be given when multiple values are given in Accession or Study UID field (Eg Acc#1\Acc#2)
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                // ehr.SetSearchKeys_Study("2783801\\2783802", datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(AccessionList_1[1], datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                login.NavigateToIntegratorFrame();
                if (BasePage.Driver.FindElement(By.Id("Label1")).Text.Contains("Studies listed below may not belong to the same patient"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 6
                // Return to the Image Load tab of the TestEHR application. Clear the study UID field, enter an accession number that does not match any studies and click Load. 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                login.NavigateToIntegratorFrame();
                ErrorMessage = studyviewer.AuthenticationErrorMsg().Text.Contains("No studies that match the search criteria could be found");
                if (ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 7
                // set show selector False in TestEHR
                // Return to the Image Load tab of the TestEHR application. 
                // Clear the study UID field, enter an accession number that matches multiple studies and click Load.
                // Note "\" should be given when multiple values are given in Accession or Study UID field (Eg Acc#1\Acc#2)
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(AccessionId[1], datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();
                ErrorMessage = studyviewer.AuthenticationErrorMsg().Text.Contains("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study.");
                if (ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 8
                // Return to the Image Load tab, enter Patient query parameters that matches 1 patient with 
                // 1 study in a data source domain. 
                // Ensure to enter the Study UID or Accession number. 
                // Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                // STudy UID : 1.2.840.113619.2.55.1.1762680271.2247.1113502009.590
                // and Patient id = 556677 and Accession = 1742901 study id 1232

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID[2], "Study_UID");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(20);
                if (studyviewer.ViewStudy(IntegratedDesktop: true) && studyviewer.PatientInfo().Contains("556677"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 9
                // Return to the Image Load tab, enter Patient Name that matches 1 patient with multiple studies in 
                // one data source domain. 
                // Ensure to enter the Study UID.  Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID[3], "Study_UID");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "LastName");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();
                ErrorMessage = studyviewer.AuthenticationErrorMsg().Text.Contains("Error Occurred in operation: Other search criteria must not be specified when Study Instance UID is provided.");
                if (ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 10
                // Return to the Image Load tab, enter Patient query parameters that matches 1 
                // patient with multiple studies from multiple Assigning Authorities.
                // Ensure to enter the Study UID or Accession number. 
                // Ensure that Show Report is True, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID[4], "Study_UID");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                studyviewer.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(40);
                PageLoadWait.WaitForFrameLoad(40);
                login.NavigateToIntegratorFrame();
                accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (string.Equals(ThumbnailSeriesUID, ViewerSeriesUID) && accessionIds.Contains(AccessionId[2]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 11
                // Return to the Image Load tab, enter DOB in format yyyy.MM.dd that matches at least 1 patient in a data source domain. 
                // Ensure that Show Report is True, Show selector is not enabled, and click Load. Note: Refer pre-condition for Date Format

                // Expected result : All of the matching studies are loaded into the viewer. 
                // The first Series is visible in the left viewport, to view the other studies open the patient history drawer.

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                //ehr.SetSearchKeys_Study(AccessionList_1[2]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));

                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                studyviewer.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(40);
                PageLoadWait.WaitForFrameLoad(40);
                login.NavigateToIntegratorFrame();
                accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (string.Equals(ThumbnailSeriesUID, ViewerSeriesUID) && accessionIds.Contains(AccessionId[3]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 12
                // 	Return to the Image Load tab, enter DOB in format yyyyMMdd that matches at least 1 patient in a data source domain. Ensure to enter the Study UID or Accession number. 
                // Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Patient_DOB[1], "Patient_DOB");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));

                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                studyviewer.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(40);
                PageLoadWait.WaitForFrameLoad(40);
                login.NavigateToIntegratorFrame();
                accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (string.Equals(ThumbnailSeriesUID, ViewerSeriesUID) && accessionIds.Contains(AccessionId[3]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 13
                // Return to the Image Load tab, enter DOB in format specified in precondition 6 (InputDateTimeFormats value) that matches at least 1 patient in a data source domain. Ensure to enter the Study UID or Accession number. 
                // Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                // Note: When Study UID is specified no other values should be specified

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(Patient_DOB[2], "Patient_DOB");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));

                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                // ThumbnailSeriesUID.Equals(ViewerSeriesUID)
                studyviewer.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(40);
                PageLoadWait.WaitForFrameLoad(40);
                login.NavigateToIntegratorFrame();
                accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (string.Equals(ThumbnailSeriesUID, ViewerSeriesUID) && accessionIds.Contains(AccessionId[3]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 14
                // Return to the Image Load tab, enter Patient First Name, Middle Name and Last Name that matches at least 
                // One study in existing data source domains. Ensure to enter the Study UID or Accession number. 
                // Ensure that Show Report is enabled, Show selector is not enabled, and click Load.	

                // Expected Result
                // 1. if entering patient last/ middle / first name and Study UID, then a message 'Other search criteria 
                // must not be specified when Study Instance UID is provided'.
                // 2. if entering patient last/ middle / first name and Accession Number, then a message 
                // 'more than one study was found that match the search criteria. 
                // Each request to view a study must result in a unique study'.

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                //ehr.SetSearchKeys_Study(StudyUID[5], "Study_UID", datasources: DatasourceVMSSA131);
                //ehr.SetSearchKeys_Study(AccessionList_1[2]);
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "LastName");
                ehr.SetSearchKeys_Study(MiddleName[0], "Middle_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();
                ErrorMessage = studyviewer.AuthenticationErrorMsg().Text.Contains("Error Occurred in operation: Other search criteria must not be specified when Study Instance UID is provided.");

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(AccessionId[1]);
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();
                bool ErrorMessage1 = studyviewer.AuthenticationErrorMsg().Text.Contains("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study.");
                if (ErrorMessage || ErrorMessage1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 15
                // Return to the Image Load tab of the TestEHR application. Clear the Search keys fields, enter two Study UIDs 
                // separated by"\"and enter two Datasources that match the studies.
                // Study UIDs and datasources are paired one to one so that UID1\UID2 is paired to DS1\DS2 click Load.

                // Expected result
                // The matching studies are loaded such that study UID1 is returned from DS1 and Study UID2 irs returned from DS2. 
                // The first study is loaded in the viewer and the second study is listed in the History panel.

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: userid, domain: DomainName, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", viewName: viewerName);
                ehr.SetSearchKeys_Study(StudyUID[6] + "\\" + StudyUID[7], "Study_UID");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(10);
                PageLoadWait.WaitForThumbnailsToLoad(10);
                studyviewer.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(40);
                PageLoadWait.WaitForFrameLoad(40);
                login.NavigateToIntegratorFrame();
                string[] studyUIDvalues = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Study UID", BasePage.GetColumnNames());
                if (studyUIDvalues.Contains(StudyUID[6]) && studyUIDvalues.Contains(StudyUID[7]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// Test 27949 - 3.2.0 Compression mode preference Lossy
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27949(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            UserPreferences userpreferences;
            TestCaseResult result = new TestCaseResult(stepcount);
            IntegratorStudies integratorstudies = new IntegratorStudies();
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String datasource1 = login.GetHostName(Config.PACS2).ToUpper();
                String datasource2 = login.GetHostName(Config.SanityPACS).ToUpper();

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String URL = "http://localhost/webaccess";


                //Initial Set-up

                //Step 1
                login.LoginIConnect(adminUserName, adminPassword);

                userpreferences = new UserPreferences();
                userpreferences.OpenUserPreferences();
                PageLoadWait.WaitForPageLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.JPEGRadioBtn().Click();
                BasePage.Driver.SwitchTo().DefaultContent();
                BasePage.Driver.SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                BasePage.wait.Until(ExpectedConditions.ElementIsVisible(By.CssSelector("#SavePreferenceUpdateButton")));
                userpreferences.SavePreferenceBtn().Click();
                PageLoadWait.WaitForFrameLoad(20);
                basepage.SwitchToDefault();
                basepage.SwitchTo("index", "0");
                basepage.SwitchTo("id", "m_preferenceFrame");
                userpreferences.CloseBtn().Click();

                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();

                // Step 1
                // Load any study from a data source.	
                // Expected Result: Text "Lossy Compressed" is displayed beside the reviewing tools.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName);
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();

                if (integratorstudies.CompressionLabel().Text.Contains("Lossy"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// 27952 Disable Show Report.
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27952(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            IntegratorStudies studies = null;
            DomainManagement domainmanagement = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                // accession number : DSQ00000135 and patient id 99DSQ00000001 for report 
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String URL = "http://localhost/webaccess";

                // Pre Condition 
                login.LoginIConnect(adminUserName, adminPassword);
                PageLoadWait.WaitForPageLoad(10);
                domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                PageLoadWait.WaitForPageLoad(10);
                domainmanagement.SearchDomain("SuperAdminGroup");
                domainmanagement.SelectDomain("SuperAdminGroup");
                domainmanagement.EditDomainButton().Click();
                PageLoadWait.WaitForPageLoad(10);
                domainmanagement.SetCheckBoxInEditDomain("reportview", 1);
                domainmanagement.SetCheckBoxInEditDomain("attachment", 0);
                domainmanagement.SetCheckBoxInEditDomain("attachmentupload", 0);
                domainmanagement.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;


                // Step 1
                // Using the Test EHR program Load a study with report , in the viewer.	
                // Expected result : - There is NO report icon in the upper right hand corner in the viewer.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName);
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();

                try
                {
                    if (!(studyviewer.TitlebarReportIcon().Displayed))
                    {
                        result.steps[++ExecutedSteps].status = "Pass";
                        Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                    }
                    else
                    {
                        result.steps[++ExecutedSteps].status = "Fail";
                        Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                        result.steps[ExecutedSteps].SetLogs();
                    }

                }
                catch (Exception e)
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);

                }

                // Step 2
                // Click on the Patient History icon to display the report button	
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                WebDriverWait wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(10);
                PageLoadWait.WaitForThumbnailsToLoad(10);
                studies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                studies.NavigateToHistoryPanel();
                if (BasePage.GetSearchResults().Count != 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                // Step 3
                // Click each menu on left side.
                bool IsReportButtonPresent = studyviewer.IsElementVisible(studyviewer.By_ReportContainer());
                if (!IsReportButtonPresent)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// 27957 3.7.0 Close Button=true
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27957(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            Studies studies = new Studies();
            DomainManagement domainmanagement = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String URL = "http://localhost/webaccess";

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');

                //Initial Set-up
                if (BasePage.Driver != null)
                {
                    BasePage.Driver.Quit();
                }
                //Step 1
                // Search for a patient.	
                // Expected Result : The selector page is displayed listing the patients matching the entered criteria.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, showclose: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login.InvokeBrowser("ie");
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                // login.NavigateToIntegratorFrame();
                studies.NavigateToHistoryPanel();
                IList<IWebElement> elements = BasePage.Driver.FindElements(By.CssSelector("div.ui-dialog-buttonset>button"));
                if (elements.Count < 1)
                {
                    PageLoadWait.WaitForFrameLoad(20);
                    IWebElement element = BasePage.Driver.FindElement(By.CssSelector("td[title^='Launch Column']>div"));
                    ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("arguments[0].click();", element);
                    String selector = "div[class='available']>ul>li[title='Accession']>a";
                    String script = "document.querySelector(" + "\"" + selector + "\"" + ")" + ".click()";
                    ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript(script);
                }
                // IWebElement element2 = BasePage.Driver.FindElement(By.XPath("//span[@class^='ui-button-text' and contains(text(), 'Ok')]"));
                elements = BasePage.Driver.FindElements(By.CssSelector("div.ui-dialog-buttonset>button"));
                elements.Where<IWebElement>(element => element.Text.ToLower().Equals("ok")).ToList<IWebElement>();
                ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("arguments[0].click()", elements[0]);
                String[] accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (accessionIds.Contains(AccessionId[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 2 
                // Select one of the patients and click View.	
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 3
                // Click the close button in the tool bar
                studies.NavigateToHistoryPanel();
                ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("document.querySelector(\"#DivCloseImg\").click()");
                var sessionId = ((RemoteWebDriver)BasePage.Driver).Capabilities.GetCapability("webdriver.remote.sessionid");
                if (sessionId == null)
                {
                    Logger.Instance.InfoLog("All Browser windows are closed ");
                }
                else
                {
                    Logger.Instance.InfoLog("Browser windows not closed ");
                }
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;

                // Step 4 
                // Search for another patient.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, showclose: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.InvokeBrowser("ie");
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studies.NavigateToHistoryPanel();
                elements = BasePage.Driver.FindElements(By.CssSelector("div.ui-dialog-buttonset>button"));
                if (elements.Count < 1)
                {
                    PageLoadWait.WaitForFrameLoad(20);
                    IWebElement element = BasePage.Driver.FindElement(By.CssSelector("td[title^='Launch Column']>div"));
                    ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("arguments[0].click();", element);
                    String selector = "div[class='available']>ul>li[title='Accession']>a";
                    String script = "document.querySelector(" + "\"" + selector + "\"" + ")" + ".click()";
                    ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript(script);
                }
                elements = BasePage.Driver.FindElements(By.CssSelector("div.ui-dialog-buttonset>button"));
                elements.Where<IWebElement>(element => element.Text.ToLower().Equals("ok")).ToList<IWebElement>();
                ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("arguments[0].click()", elements[0]);
                accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (accessionIds.Contains(AccessionId[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5
                // Click the close button on the left hand side under the History Tab.
                IWebElement element1 = BasePage.Driver.FindElement(By.CssSelector("#DivCloseImg"));
                IJavaScriptExecutor ijavascriptexecutor = (IJavaScriptExecutor)BasePage.Driver;
                ijavascriptexecutor.ExecuteScript("arguments[0].click();", element1);
                sessionId = ((RemoteWebDriver)BasePage.Driver).Capabilities.GetCapability("webdriver.remote.sessionid");
                if (sessionId == null)
                {
                    Logger.Instance.InfoLog("All Browser windows are closed ");
                }
                else
                {
                    Logger.Instance.InfoLog("Browser windows not closed ");
                }
                BasePage.Driver.Quit();
                ExecutedSteps++;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// Post Method
        /// </summary>
        public TestCaseResult Test_27943(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = new StudyViewer();
            int ExecutedSteps = -1;
            int resultcount = 0;
            string url = string.Empty;
            IntegratorStudies integratorstudies = null;
            string[] TestDataPath = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath")).Split(';');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Preconditions
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartService();

                servicetool.CloseServiceTool();

                //Step 1: Navigate to the Image Load tab of the TestEHR application. Clear the Search keys fields, enter Study UIDs or Accession Numbers that matches multiple studies for one patient that is in one data source Domain "Use Post Method"checkbox checked. Select both options Use Post Method and click Load. "Use Post Method"checkbox checked. Select both options Use Post Method.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator", usepostmethod: "check");
                ehr.SetSearchKeys_Study("MICKEY_FOOT");
                url = ehr.clickCmdLine("ImageLoad");
                if (!string.IsNullOrWhiteSpace(url))
                {
                    resultcount++;
                    url = string.Empty;
                    Logger.Instance.InfoLog("EHR generates post url in cmd line");
                }
                login.NavigateToIntegratorURL(TestDataPath[0]);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.ViewStudy(IntegratedDesktop: true))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Study Displayed");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 2: Return to the Image Load tab and set show selector to true, show selector search to true then enter the UIDs for 5 studies, separated by '\', for a patient with priors. Ensure that the Use Post Method checkbox is not checked. Click on load.
                ehr.SetCommonParameters(usepostmethod: "uncheck");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(@"1.2.826.0.1.3680043.2.133.1.3.1.11.10.28208\1.3.6.1.4.1.33437.11.2.15589881.12982816737.18420.2\2.16.840.1.113662.1.3.16.0.16\1.2.124.113532.132.183.36.32.20000503.221344.3221033\1.3.46.670589.8.9621400214007.25911", "Study_UID");
                ehr.SetSearchKeys_Study("");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                url = ehr.clickCmdLine("ImageLoad");
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                if (integratorstudies.Intgtr_Rows().Count == 5)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 3: Select a study and click on view.
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                DataTable intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                string[] columnvalue = basepage.GetColumnValues(intgrtable, "Study ID");
                int index = Array.IndexOf(columnvalue, columnvalue.Where(x => x.Contains("5782262")).FirstOrDefault());
                //((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("arguments[0].scrollIntoView(true);", integratorstudies.Intgtr_CheckBoxes()[index]);
                basepage.ClickElement(integratorstudies.Intgtr_CheckBoxes()[index]);
                basepage.ClickElement(integratorstudies.Intgr_ViewBtn());
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.ViewStudy(IntegratedDesktop: true))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 4: Return to the Image Load tab and check the"Use Post Method"checkbox.Click on load.
                resultcount = 0;
                ehr.SetCommonParameters(usepostmethod: "check");
                url = ehr.clickCmdLine("ImageLoad");
                if (!string.IsNullOrWhiteSpace(url))
                {
                    resultcount++;
                    url = string.Empty;
                    Logger.Instance.InfoLog("EHR generates post url in cmd line");
                }
                login.NavigateToIntegratorURL(TestDataPath[1]);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                if (integratorstudies.Intgtr_Rows().Count == 5)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Integrator studies displays 5 studies");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 5: Select a study and click on view.

                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Study ID");
                index = Array.IndexOf(columnvalue, columnvalue.Where(x => x.Contains("5782262")).FirstOrDefault());
                //((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("arguments[0].scrollIntoView(true);", integratorstudies.Intgtr_CheckBoxes()[index]);
                basepage.ClickElement(integratorstudies.Intgtr_CheckBoxes()[index]);
                basepage.ClickElement(integratorstudies.Intgr_ViewBtn());
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.ViewStudy(IntegratedDesktop: true))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 6: Return to the Image Load tab and set show selector to false, show selector search to false then enter the UIDs for 5 studies, separated by '\', for a patient with priors. Ensure that the Use Post Method checkbox is not checked. Click on Load.
                resultcount = 0;
                ehr.SetCommonParameters(usepostmethod: "uncheck");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(@"1.2.826.0.1.3680043.2.110.292143302687.104\1.2.826.0.1.3680043.2.110.292143314640.105\1.2.826.0.1.3680043.2.110.292143334343.107\1.2.826.0.1.3680043.2.110.292143344593.108\1.2.826.0.1.3680043.2.110.292143427734.109", "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.ViewStudy(IntegratedDesktop: true))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Loaded successfully");
                }
                basepage.ClickElement(viewer.PatientHistoryTab());
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                if (integratorstudies.HisIntgtr_Rows().Count == 5)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Prior series shows 5 studies");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 7: Return to the Image Load tab and check the"Use Post Method"checkbox. Click on load.
                resultcount = 0;
                ehr.SetCommonParameters(usepostmethod: "check");
                url = ehr.clickCmdLine("ImageLoad");
                if (!string.IsNullOrWhiteSpace(url))
                {
                    resultcount++;
                    url = string.Empty;
                    Logger.Instance.InfoLog("EHR generates post url in cmd line");
                }
                login.NavigateToIntegratorURL(TestDataPath[2]);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.ViewStudy(IntegratedDesktop: true))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Loaded successfully");
                }
                basepage.ClickElement(viewer.PatientHistoryTab());
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                if (integratorstudies.HisIntgtr_Rows().Count == 5)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Prior series shows 5 studies");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
            }
        }

        /// <summary> 
        /// Using Encrypted URL - HALO
        /// </summary>
        public TestCaseResult Test_90027(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = new StudyViewer();
            int ExecutedSteps = -1;
            string url = string.Empty;
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Step 1: Navigate to iCA Service tool -> Click the Encryption tab and select Encryption Service sub-tab
                servicetool.LaunchServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToEncryption();
                servicetool.SetEncryptionEncryptionService();
                GroupBox group = wpfobject.GetAnyUIItem<ITabPage, GroupBox>(servicetool.GetCurrentTabItem(), "Encryption Service List", 1);
                ListView datagrid = wpfobject.GetAnyUIItem<GroupBox, ListView>(group, "ListView");
                if (datagrid.Rows.Count == 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                    throw new Exception("Encryption is added");
                }
                //Step 2: Click Add to open the Service Entry Form dialog
                servicetool.EnterServiceEntry(Key: "HALO.RC4", Class: "OpenContent.Core.Security.Services.HaloCryptographyWrapper");
                ExecutedSteps++;
                //Step 3: In the Service Parameters group box, click Add to open the Service Parameter Entry form dialog, and do the following:
                servicetool.EnterServiceParameters("password", "string", "amicas");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                group = WpfObjects._mainWindow.Get<GroupBox>(SearchCriteria.ByText("Service Parameters"));
                datagrid = wpfobject.GetAnyUIItem<GroupBox, ListView>(group, "ListView");
                int rowcount = datagrid.Rows.Count;
                wpfobject.GetButton("OK", 1).Click();
                if (rowcount == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 4: Restart IIS and Windows services
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                if (servicetool.Grid().Rows.Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 5: Click the External Application tab and Click Add. 
                wpfobject.SelectTabFromTabItems("External Application");
                wpfobject.ClickButton("Add", 1);
                ExecutedSteps++;
                //Step 6: In the Settings group box, do the following
                servicetool.EnterExternalApplicationSettingsParameters("HALO", "Halo Application", "amicaspacs HALOPACS", "80", false, "servlet/com.amicas.servlet.integration.EmbeddedGateway", "Browser", "unixTicks,milliseconds,0", false);
                ExecutedSteps++;
                //Step 7:  In the Encryption group box, do the following
                servicetool.EnterExternalApplicationEncryptionParameters("auth", "Cryptographic.HALO.RC4");
                ExecutedSteps++;
                //Step 8: In the URL Parameter List group box, click Add.
                //Step 9: Enter the following entries
                servicetool.EnterExternalApplicationUrlParameterEntryForm("TS", "Dynamic", "Application.TimeStamp", true);
                servicetool.EnterExternalApplicationUrlParameterEntryForm("ID", "Dynamic", "Patient.PatientID", true);
                servicetool.EnterExternalApplicationUrlParameterEntryForm("SID", "Dynamic", "Study.UID", true);
                ExecutedSteps++;
                group = WpfObjects._mainWindow.Get<GroupBox>(SearchCriteria.ByText("Url Parameter List"));
                datagrid = wpfobject.GetAnyUIItem<GroupBox, ListView>(group, "ListView");
                if (datagrid.Rows.Count == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 10: In the External Application URL Configuration dialog box, click Add and restart the services
                servicetool.AddExternalApplicationAndResetIIS();
                datagrid = wpfobject.GetAnyUIItem<ITabPage, ListView>(servicetool.GetCurrentTabItem(), "ListView");
                if (datagrid.Rows.Count == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                basepage.RemoveNode(Config.ExternalApplicationConfiguration, "/add[@id='HALO']");
                basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.HALO.RC4']");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary> 
        /// Lossless
        /// </summary>
        public TestCaseResult Test_27950(String testid, String teststeps, int stepcount)
        {
            StudyViewer studyviewer = new StudyViewer();
            DomainManagement domainmanagement = null;
            UserPreferences userpreferences = null;
            IntegratorStudies integratorstudies = new IntegratorStudies();
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Preconditions
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                login.LoginIConnect(adminUserName, adminPassword);
                domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                Dictionary<Object, String> createDomain = domainmanagement.CreateDomainAttr();
                domainmanagement.CreateDomain(createDomain);
                string domainname = createDomain[DomainManagement.DomainAttr.DomainName];
                string rolename = createDomain[DomainManagement.DomainAttr.RoleName];
                string userid = createDomain[DomainManagement.DomainAttr.UserID];
                string password = createDomain[DomainManagement.DomainAttr.Password];
                login.Logout();
                login.LoginIConnect(userid, password);
                userpreferences = new UserPreferences();
                userpreferences.OpenUserPreferences();
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.PNGRadioBtn().Click();
                userpreferences.CloseUserPreferences();
                PageLoadWait.WaitForPageLoad(20);
                login.Logout();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                //Step 1: Load any study from a data source.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: domainname, role: rolename, user: userid);
                ehr.SetSearchKeys_Study("1.2.840.113619.2.1.1040.2152540934.744484954", "Study_UID", datasources: new Login().GetHostName(Config.EA1));
                string url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                ehr.CloseEHR();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (string.IsNullOrWhiteSpace(integratorstudies.CompressionLabel().Text))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.InfoLog("Compression Label displays with Label" + integratorstudies.CompressionLabel().Text);
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
            }
        }

        /// <summary> 
        /// Set 'Show close' to unspecified
        /// </summary>
        public TestCaseResult Test_27958(String testid, String teststeps, int stepcount)
        {
            StudyViewer studyviewer = new StudyViewer();
            TestCaseResult result = new TestCaseResult(stepcount);
            IntegratorStudies integratorstudies = new IntegratorStudies();
            int ExecutedSteps = -1;
            string PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Preconditions
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartService();
                servicetool.CloseServiceTool();
                //Step 1: Using the Test EHR Search for a patient
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                string url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                DataTable intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                string[] Patient_ID = basepage.GetColumnValues(intgrtable, "Patient ID");
                if (intgrtable.Rows.Count > 0 && Patient_ID.All(pid => pid.ToLowerInvariant().Contains(PatientID)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 2: Select one of the patients and click View.
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                basepage.ClickElement(integratorstudies.Intgtr_CheckBoxes()[0]);
                basepage.ClickElement(integratorstudies.Intgr_ViewBtn());
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (!basepage.IsElementVisible(integratorstudies.CloseStudy1()) && !basepage.IsElementVisible(integratorstudies.CloseStudy2()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// TestEHR with supported Modality
        /// </summary>
        public TestCaseResult Test_27970(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmanagement = null;
            StudyViewer viewer = null;
            int ExecutedSteps = -1;
            string url = string.Empty;
            string[] ModalitySettings = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "Modality")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            int resultcount = 0;
            try
            {
                //Preconditions
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.NavigateToTab("Viewer");
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                foreach (string ms in ModalitySettings)
                {
                    servicetool.MoadalitySetting(ms.Split('-')[0], ms.Split('-')[1]);
                }
                servicetool.CloseServiceTool();
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                login.LoginIConnect(username, password);
                if (login.IsTabSelected("DomainManagement"))
                {
                    domainmanagement = new DomainManagement();
                }
                else
                {
                    domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                }
                Dictionary<Object, String> createDomain = domainmanagement.CreateDomainAttr();
                domainmanagement.CreateDomain(createDomain);
                string DomainName = createDomain[DomainManagement.DomainAttr.DomainName];
                string RoleName = createDomain[DomainManagement.DomainAttr.RoleName];
                string user = createDomain[DomainManagement.DomainAttr.UserID];
                login.Logout();
                //Step 1: Using the test TestEHR application load a study of each modality.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (viewer.SeriesViewPorts().Count == 1)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Layout displayed as 1x1 for " + AccessionNumber[0]);
                }
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (viewer.SeriesViewPorts().Count == 2)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Layout displayed as 1x2 for " + AccessionNumber[1]);
                }
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[2]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (viewer.SeriesViewPorts().Count == 3)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Layout displayed as 1x3 for " + AccessionNumber[2]);
                }
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[3]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (viewer.SeriesViewPorts().Count == 4)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Layout displayed as 2x2 for " + AccessionNumber[3]);
                }
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user);
                ehr.SetSearchKeys_Study(AccessionNumber[4]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (viewer.SeriesViewPorts().Count == 6)
                {
                    resultcount++;
                    Logger.Instance.InfoLog("Layout displayed as 2x3 for " + AccessionNumber[4]);
                }
                if (resultcount == 5)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
            }
        }

        /// <summary> 
        /// Default studies query parameters
        /// </summary>
        public TestCaseResult Test_91330(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmanagement = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string url = string.Empty;
            string PatientName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName"));
            string PatientID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID"));
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Preconditions
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartService();
                servicetool.CloseServiceTool();
                //Step 1: Log in ICA as Administrator 
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                login.LoginIConnect(username, password);
                if (login.IsTabSelected("DomainManagement"))
                {
                    domainmanagement = new DomainManagement();
                }
                else
                {
                    domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                }
                ExecutedSteps++;
                //Step 2: Create a new Domain
                Dictionary<Object, String> createDomain = domainmanagement.CreateDomainAttr();
                domainmanagement.CreateDomain(createDomain);
                string DomainName = createDomain[DomainManagement.DomainAttr.DomainName];
                string RoleName = createDomain[DomainManagement.DomainAttr.RoleName];
                string user = createDomain[DomainManagement.DomainAttr.UserID];
                string pwd = createDomain[DomainManagement.DomainAttr.Password];
                string securityID = user + "-" + pwd;
                if (domainmanagement.IsDomainExist(DomainName))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 3: Ensure that the “Query Related Study Parameters” is Patient ID and Patient Full name by default for the newly created domain.
                domainmanagement.SearchDomain(DomainName);
                domainmanagement.SelectDomain(DomainName);
                domainmanagement.ClickEditDomain();
                domainmanagement.SetCheckBoxInEditDomain("patientid", 0);
                domainmanagement.SetCheckBoxInEditDomain("patientfullname", 0);
                domainmanagement.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;
                //Step 4: Launch TestEHR
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: DomainName, role: RoleName, user: user, SecurityID: securityID, usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Patient("fullname", PatientName);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                PageLoadWait.WaitForFrameLoad(10);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                DataTable intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                string[] Patient_ID = basepage.GetColumnValues(intgrtable, "Patient ID");
                string[] Last_Name = basepage.GetColumnValues(intgrtable, "Last Name");
                if (intgrtable.Rows.Count > 0 && Patient_ID.All(pid => pid.ToLowerInvariant().Contains(PatientID.ToLowerInvariant())) && Last_Name.All(ln => ln.ToLowerInvariant().Contains(PatientName.ToLowerInvariant())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
            }
        }

        /// <summary> 
        /// List Studies in XML Format
        /// </summary>
        public TestCaseResult Test_91844(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            string url = "http://localhost/webaccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ListStudies&";
            string PatientName = string.Concat("PatientName=", Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")));
            string PatientID = string.Concat("PatientID=", Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")));
            string AccessionID = string.Concat("AccessionNumber=", Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")));
            XmlDocument xmlDocument = null;
            XmlNodeList NodeList = null;
            IList<string> AttributeValue;
            int resultcount = 0;
            try
            {
                //Step 1: Setup Test EHR application with Bypass configuration
                ExecutedSteps++;
                //Step 2: Launch the following URL for listing the studies in XML Format
                xmlDocument = new XmlDocument();
                AttributeValue = new List<string>();
                login.NavigateToIntegratorURL(string.Concat(url, PatientName));
                PageLoadWait.WaitForPageLoad(30);
                string pagesource = BasePage.Driver.PageSource;
                xmlDocument.LoadXml(pagesource);
                NodeList = xmlDocument.SelectNodes("//study");
                foreach (XmlNode Node in NodeList)
                {
                    AttributeValue.Add(Node.Attributes["patientName"].Value);
                }
                if (AttributeValue.All(pn => pn.StartsWith("a", StringComparison.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 2: Using same URL, test with different possibilities
                AttributeValue.Clear();
                login.NavigateToIntegratorURL(string.Concat(url, PatientID));
                PageLoadWait.WaitForPageLoad(30);
                pagesource = BasePage.Driver.PageSource;
                xmlDocument.LoadXml(pagesource);
                NodeList = xmlDocument.SelectNodes("//study");
                foreach (XmlNode Node in NodeList)
                {
                    AttributeValue.Add(Node.Attributes["patientId"].Value);
                }
                if (AttributeValue.All(pid => pid.Contains(pid.ToLowerInvariant())))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("XML Loaded with given PatientID");
                }
                AttributeValue.Clear();
                login.NavigateToIntegratorURL(string.Concat(url, AccessionID));
                PageLoadWait.WaitForPageLoad(30);
                pagesource = BasePage.Driver.PageSource;
                xmlDocument.LoadXml(pagesource);
                NodeList = xmlDocument.SelectNodes("//study");
                foreach (XmlNode Node in NodeList)
                {
                    AttributeValue.Add(Node.Attributes["accessionNumber"].Value);
                }
                if (AttributeValue.All(pid => pid.Contains(pid.ToLowerInvariant())))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("XML Loaded with given AccessionNumber");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }

        }

        /// <summary>
        /// Test 27961 - Select the option of"Store attachment in a single data source"from Study Attachment tab under Storage. Apply
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        /// <summary>
        public TestCaseResult Test_27961(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            IntegratorStudies integratorstudies = new IntegratorStudies();
            DomainManagement domainmanagement = null;
            ServiceTool tool = new ServiceTool();
            Studies studies = new Studies();
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            By attachmentlink = null;
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                string adminUserName = Config.adminUserName;
                string adminPassword = Config.adminPassword;
                string DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                string DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                string DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                string DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                string DatasourceDestinationPacs = new Login().GetHostName(Config.DestinationPACS);
                string DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                string URL = "http://localhost/webaccess";

                string accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                attachmentlink = By.CssSelector("table[id$='_attachmentList'] tr:nth-of-type(2)>td:nth-of-type(4)>a");
                String Modalitys = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Modality");
                String[] Modality = Modalitys.Split(':');
                String UploadFilePath = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath"));
                string Datasource = Config.DestinationPACS;
                string AETitle = Config.DestinationPACSAETitle;
                string reportdownloadpath = string.Concat(Config.downloadpath, Path.DirectorySeparatorChar, "Test_27961.txt");
                //Precondition
                if (File.Exists(reportdownloadpath))
                {
                    File.Delete(reportdownloadpath);
                }
                //Initial Set-up
                tool.InvokeServiceTool();
                tool.SetEnableFeaturesGeneral();
                wpfobject.WaitTillLoad();
                tool.ModifyEnableFeatures();
                wpfobject.WaitTillLoad();
                tool.EnablePatient();
                tool.EnableUpload();

                tool.EnableStudyAttachements();
                wpfobject.WaitTillLoad();
                tool.ModifyEnableFeatures();
                wpfobject.WaitTillLoad();

                wpfobject.ClickRadioButton("Store attachments in a single data source", 1);
                TextBox DatasourceID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 2);
                DatasourceID.BulkText = basepage.GetHostName(Datasource);
                wpfobject.WaitTillLoad();

                TextBox DatasourceAETitle = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                DatasourceAETitle.BulkText = AETitle;
                wpfobject.WaitTillLoad();

                TextBox DatasourceHost = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                DatasourceHost.BulkText = Datasource;
                wpfobject.WaitTillLoad();

                TestStack.White.InputDevices.AttachedKeyboard keyboard = WpfObjects._mainWindow.Keyboard;
                keyboard.PressSpecialKey(TestStack.White.WindowsAPI.KeyboardInput.SpecialKeys.TAB);
                keyboard.Enter("104");

                // Enter the port
                tool.ApplyEnableFeatures();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton("2");
                    wpfobject.WaitTillLoad();
                }
                catch (Exception) { }

                tool.RestartService();
                wpfobject.WaitTillLoad();
                tool.CloseServiceTool();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                //Login as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);

                //Navigate to DomainManagement Tab
                domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                PageLoadWait.WaitForPageLoad(10);
                //Step-1:Enable Attachment at DomainLevel(SuperAdminGroup)
                domainmanagement.SearchDomain("SuperAdminGroup");
                domainmanagement.SelectDomain("SuperAdminGroup");
                domainmanagement.ClickEditDomain();
                PageLoadWait.WaitForFrameLoad(40);
                PageLoadWait.WaitForPageLoad(10);
                domainmanagement.SetCheckBoxInEditDomain("attachment", 0);
                domainmanagement.SetCheckBoxInEditDomain("attachmentupload", 0);
                domainmanagement.ConnectAllDataSources();
                PageLoadWait.WaitForPageLoad(10);
                domainmanagement.ClickSaveDomain();
                login.Logout();

                //Step 1
                // 	Open the test EHR application and load a study from the datasource that is different from the one specified in the Precondition 
                // for saving attachments.	
                // Expected Result : The study is loaded to the viewer, the attachment feature appears from the left panel
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, showclose: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(accession);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                integratorstudies.NavigateToHistoryPanel();
                studies.ChooseColumns(new String[] { "Study UID", "Accession", "# Images" });
                String[] accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                String[] Images = BasePage.GetColumnValues(BasePage.GetSearchResults(), "# Images", BasePage.GetColumnNames());
                int ImagesCount = Int32.Parse(Images[0]);
                if (accessionIds.Contains(accession))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[++ExecutedSteps].SetLogs();
                }

                // Step 2 
                // Attach a file and save	
                studyviewer.NavigateTabInHistoryPanel("Attachment");
                PageLoadWait.WaitForFrameLoad(20);
                string filename = UploadFilePath + "Test_27961.txt";
                string text2write = "Hello World!";
                //TextWriter tw = File.CreateText(filename);
                //tw.WriteLine(text2write);
                //tw.Close();
                if (File.Exists(filename))
                {
                    File.Delete(filename);
                }
                StreamWriter writer = new StreamWriter(filename);
                writer.Write(text2write);
                writer.Close();
                if (studyviewer.UploadAttachment(filename, 20))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[++ExecutedSteps].SetLogs();
                }

                // Step 3
                // Open the saved attachment	
                // not automated
                /*result.steps[++ExecutedSteps].status = "Not Automated";
                Logger.Instance.InfoLog("-->Test Step Not Automated to External Source");*/
                var attachmentname = BasePage.Driver.FindElement(attachmentlink).GetAttribute("innerHTML");
                BasePage.Driver.FindElement(attachmentlink).Click();
                var downloadpath = Config.downloadpath + Path.DirectorySeparatorChar;
                PageLoadWait.WaitForFileDownload(downloadpath, attachmentname, "txt", 2);
                ExecutedSteps++;

                // Step 4
                // Go back to the list of study
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, showclose: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(accession, datasources: DatasourceDestinationPacs);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                integratorstudies.NavigateToHistoryPanel();
                studies.ChooseColumns(new String[] { "Study UID", "Accession", "# Images" });
                String[] CurrentImages = BasePage.GetColumnValues(BasePage.GetSearchResults(), "# Images", BasePage.GetColumnNames());
                int CurrentImagesCount = Int32.Parse(CurrentImages[0]);
                if (CurrentImagesCount == ImagesCount + 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // STep 5
                // Check the raw data saved from the original data source where the study came from	

                //Thread.Sleep(300000);
                mpaclogin.DriverGoTo(login.GetMPacUrl(Config.DestinationPACS));
                MPHomePage mpachome = mpaclogin.Loginpacs(Config.pacsadmin, Config.pacspassword);
                Monitors monitors = (Monitors)mpachome.NavigateTopMenu("Monitors");
                monitors.NavigateToImporters();
                IList<String> msgs = monitors.GetStudyStatus();

                bool IsStatusExist = msgs.Any(msg => msg.Replace(" ", "").Contains("Modality:OT,Accession:" + accession) && msg.Contains("Status:OK"));
                bool IsNewStudymsgExist = msgs.Any(msg => msg.Contains("New study arrived") && msg.Contains("Accession:" + accession));
                bool IsModalityExist = msgs.Any(msg => msg.Replace(" ", "").Contains("Modality:OT,Accession:" + accession));
                if (IsStatusExist && IsNewStudymsgExist && IsModalityExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                mpaclogin.LogoutPacs();

                // Step 6
                // Check the raw data saved from the original data source where the study came from
                login.LoginIConnect(adminUserName, adminPassword);
                PageLoadWait.WaitForPageLoad(10);
                studies = (Studies)login.Navigate("Studies");
                studies.SearchStudy(AccessionNo: accession);
                studies.SelectStudy1("Accession", accession);
                studyviewer = StudyViewer.LaunchStudy();
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                PageLoadWait.WaitForAllViewportsToLoad(10);
                studyviewer.NavigateToHistoryPanel();
                PageLoadWait.WaitForPageLoad(20);
                if (BasePage.Driver.FindElements(attachmentlink).Count == 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// Test 27969 - Auto-fill all viewers in the series layout with the first available series.
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27969(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool tool = new ServiceTool();
            Studies studies = new Studies();
            UserPreferences userpreferences = new UserPreferences();
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String url = string.Empty;
                String AccessionId = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                string DicomPath = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath");
                string Datasource = Config.DestinationPACS;
                string AETitle = Config.DestinationPACSAETitle;

                //PreConditions
                //Add Dicom to the DataSource
                var client = new DicomClient();
                for (int i = 1; i < 5; i++)
                {
                    client.AddRequest(new DicomCStoreRequest(string.Concat(DicomPath, "27969-", i)));
                    client.Send(Datasource, 104, false, "SCU", AETitle);
                }
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = false;
                servicetool.AllowShowSelector().Checked = false;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab("Viewer");
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                servicetool.MoadalitySetting(layout: "auto");
                servicetool.CloseServiceTool();
                //Step 1
                // Load a CR study with 4 series.	
                // Expected result: The study loads with a layout of 2x2.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionId);
                ehr.SetSearchKeys_Study(login.GetHostName(Datasource), "Datasource");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (studyviewer.IntegratorViewPorts().Count == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 2
                // Verify the first available series is loaded into the top left viewer.	

                string ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                string ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                if (ThumbnailSeriesUID.Equals(ViewerSeriesUID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 3
                // Verify the rest of the series.
                // Expected result : The rest of the series should be loaded followed by the thumbnails.
                String ThumbnailSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[1], "src", '&', "seriesUID");
                String ViewerSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X2(), "src", '&', "seriesUID");
                bool result_1X2 = ThumbnailSeriesUID_2.Equals(ViewerSeriesUID_2);

                String ThumbnailSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[2], "src", '&', "seriesUID");
                String ViewerSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X1(), "src", '&', "seriesUID");
                bool result_2X1 = ThumbnailSeriesUID_3.Equals(ViewerSeriesUID_3);

                String ThumbnailSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[3], "src", '&', "seriesUID");
                String ViewerSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X2(), "src", '&', "seriesUID");
                bool result_2X2 = ThumbnailSeriesUID_4.Equals(ViewerSeriesUID_4);

                if (result_1X2 && result_2X1 && result_2X2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 4
                // 	Select any series and draw some annotations.
                // Save the series.
                IWebElement source = studyviewer.ViewportScrollHandle(1, 2);
                IWebElement destination = studyviewer.ViewportScrollBar(1, 2);

                int w = destination.Size.Width;
                int h = destination.Size.Height;

                Actions action2 = new Actions(BasePage.Driver);
                //Apply W/L
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.WindowLevel);
                IWebElement viewport1 = studyviewer.SeriesViewer_1X1();
                h = viewport1.Size.Height;
                w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, 3 * w / 4, 3 * h / 4);

                result.steps[++ExecutedSteps].SetPath(testid + "_2_1_WL_Applied", ExecutedSteps + 1);
                bool status2_1 = studies.CompareImage(result.steps[ExecutedSteps], studyviewer.SeriesViewer_1X1());

                //Apply Zoom
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.Zoom);
                viewport1 = studyviewer.SeriesViewer_1X1();
                h = viewport1.Size.Height;
                w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, 3 * w / 4, 3 * h / 4);
                int ThumbnailCountBeforeSave_FirstStudy = studyviewer.Thumbnails().Count;
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.SaveSeries);

                PageLoadWait.WaitForLoadingIconToAppear_Savestudy();
                PageLoadWait.WaitForLoadingIconToDisAppear_Savestudy();
                if (status2_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                // Step 5
                // Reload the same study.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (studyviewer.Thumbnails().Count == (ThumbnailCountBeforeSave_FirstStudy + 1) &&
                    studyviewer.ThumbnailCaptions()[0].Text.Contains("PR"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step  6
                // Verify the first available PR series is loaded into the top left viewer.	

                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                String ThumbnailModality = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesModality");

                if (ThumbnailSeriesUID.Equals(ViewerSeriesUID) && ThumbnailModality.Equals("PR"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 7
                // Verify the rest of the series.
                // Expected result: The rest of the series should be loaded followed by the thumbnails.
                ThumbnailSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[1], "src", '&', "seriesUID");
                ViewerSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X2(), "src", '&', "seriesUID");
                result_1X2 = ThumbnailSeriesUID_2.Equals(ViewerSeriesUID_2);

                bool result_1X3;
                ThumbnailSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[2], "src", '&', "seriesUID");
                ViewerSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X3(), "src", '&', "seriesUID");
                result_1X3 = ThumbnailSeriesUID_3.Equals(ViewerSeriesUID_3);

                ThumbnailSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[3], "src", '&', "seriesUID");
                ViewerSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X1(), "src", '&', "seriesUID");
                result_2X1 = ThumbnailSeriesUID_4.Equals(ViewerSeriesUID_4);

                string ThumbnailSeriesUID_5;
                string ViewerSeriesUID_5;

                ThumbnailSeriesUID_5 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[4], "src", '&', "seriesUID");
                ViewerSeriesUID_5 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X2(), "src", '&', "seriesUID");
                result_2X2 = ThumbnailSeriesUID_5.Equals(ViewerSeriesUID_5);

                if (result_1X2 && result_1X3 && result_2X1 && result_2X2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// Test 27973 - 7.2.0 Local
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27973(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool servicetool = new ServiceTool();
            IntegratorStudies studies = new IntegratorStudies();
            Maintenance maintenance = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies study = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);
                String URL = "http://localhost/webaccess";

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');
                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNames.Split(':');

                servicetool.CloseServiceTool();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();
                //login.InvokeBrowser(Config.BrowserType);

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                study = login.Navigate<Studies>();
                study.SelectAllDateAndData();
                study.ClickSearchBtn();
                login.Logout();


                //  Pre - conditions: 
                // Change the integrator authentication. Open IntegratorAuthenticationSTS\Web.config:  C:\WebAccess\IntegratorAuthenticationSTS
                //Set the integrator authentication to local (In IntegratorAuthenticationSTS\Web.config:
                //1.Change from: "Sample.HostIntegration.Authentication.IntegratorAuthenticator, Sample.HostIntegration" to "Sample.HostIntegration.Authentication.WADBAuthenticator, Sample.HostIntegration"
                //2.Change from: storedProcedure name = "AuthenticateIntegrator" ipParam = "@ip" securityIdParam = "@securityId" to storedProcedure name = "AuthenticateUser" idParam = "@userID" passwordParam = "@password"
                //3.Change from: connectionString value = "Data Source=SOLARA\SQLEXPRESS;Initial Catalog=SAMPLEDB;User Id=sa;Password=XXXXXX" to connectionString value = "Data Source=<TestServerName>\WEBACCESS;Initial Catalog=IRWSDB;User Id=sa;Password=Cedara123".
                //4.Set the credentialsPattern to #  
                //  Note: credentialsPattern does not exist by default.i.e. < credentialsPattern pattern = "#" /> needs to be added after the storedProcedure element but still within the add element.
                // basepage.ChangeAttributeValue(@"C:\WebAccess\WebAccess\Config\DSA\DSAServerManagerConfiguration.xml", "/server[@id='ica.ldap.merge.ad']/options/hosts/host", "name", HostName);

                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]", "class", "Sample.HostIntegration.Authentication.WADBAuthenticator");
                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]", "assembly", "Sample.HostIntegration");
                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]/storedProcedure", "name", "AuthenticateUser");
                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]/storedProcedure", "ipParam", "@userID");
                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]/storedProcedure", "securityIdParam", "@password");
                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]/connectionString", "value", "Data Source=<TestServerName>\\WEBACCESS;Initial Catalog=IRWSDB;User Id=sa;Password=Cedara123");
                basepage.ChangeAttributeValue(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]/connectionString", "value", "Data Source=<TestServerName>\\WEBACCESS;Initial Catalog=IRWSDB;User Id=sa;Password=Cedara123");
                basepage.InsertNode(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]", "<credentialsPattern pattern=\"#\" />", false);

                servicetool.CloseServiceTool();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartService();
                servicetool.CloseServiceTool();


                // Step 1
                // Open the TestEHR application. Enter the username and password of a WebAccess user into the Security ID field. Format: *^<^ *username *^>^ *#*^<^*password*^>^*
                // Example, in Security ID field type: Administrator#Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: "sa#Cedara123", domain: "SuperAdminGroup", usersharing: "True");
                ExecutedSteps++;

                // Step 2
                // Enable Show selector, enter some search criteria and click Load.	
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                login.NavigateToIntegratorFrame();
                ExecutedSteps++;

                // Step 3
                // Select and load one of the patients.
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                WebDriverWait wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                PageLoadWait.WaitForAllViewportsToLoad(10);
                PageLoadWait.WaitForThumbnailsToLoad(10);
                string ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                string ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool step_2 = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                studies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                studies.NavigateToHistoryPanel();
                studies.ChooseColumns(new String[] { "Study UID", "Accession" });
                String[] accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (step_2 && accessionIds.Contains(AccessionId[0]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 4
                // 	Return to the Image Load tab of the TestEHR application. Enter an invalid username and password in the Security ID field, enter some search criteria and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "invalid", domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5
                ExecutedSteps++;

                // Step 6
                // Open the TestEHR application. Enter the username and password of a WebAccess user into the Security ID field.
                // Format: *^<^ *username *^>^ *-*^<^ *password *^>^ * Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "sa-Cedara123", domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 7
                // Open the TestEHR application. Enter the username of a WebAccess user and an incorrect password into the Security ID field.
                // Format: Username - Password. Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "sa-Cedara1asda23", domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 8
                // Open the TestEHR application. Enter the username and password of a iConnect Access user into the Security ID field.
                // Format: 12345 *^<^ *username *^>^ *@#$*^<^*password*^>^* Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "Administrator@#$Administrator", domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 9
                // Open the TestEHR application. Enter the username of a WebAccess user and an incorrect password into the Security ID field.
                // Format: 12345 *^<^ *username *^>^ *@#$*^<^*password*^>^* Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "12345sa@#$Cedara123", domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 10
                // Go to another machine and log in to iConnect Access application, open the audit log.	
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                login = new Login();

                login.LoginIConnect(adminUserName, adminPassword);
                maintenance = (Maintenance)login.Navigate("Maintenance");
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent");

                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Return Result
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
        }

        /// <summary> 
        /// multiple studies from the same patient
        /// </summary>
        public TestCaseResult Test_27945(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            IntegratorStudies integratorstudies = null;
            var servicetool = new ServiceTool();
            int executedSteps = -1;
            String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
            var arraccession = accession.Split(':');
            String studyuid = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
            string patientname = string.Concat((String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName"), ", ", (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName"));
            var arrstudyuid = studyuid.Split(':');

            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                /*#### Preconditions #####*/
                //Reset the Datasource selection
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var studies = login.Navigate<Studies>();
                studies.SearchStudy(LastName: "*", Datasource: "All");
                PageLoadWait.WaitForLoadingMessage(60);
                login.Logout();
                //Set Service Tool Show Selector and selector search to True and Multiple Study to Show Error.
                basepage.ChangeAttributeValue(Config.WebConfigPath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                //Step-1 - Enable Show Selector
                var ehr = new EHR();
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                ehr.SetShowSelector(false);
                executedSteps++;

                //Step-2 - Load  astudy with 1 StudyUID
                ehr.SetSearchKeys_Study(arrstudyuid[0], "Study_UID");
                var url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                var viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                var viewport = viewer.SeriesViewer_1X1(1);
                var step2 = result.steps[++executedSteps];
                step2.SetPath(testid, executedSteps);
                var step2_1 = ehr.CompareImage(step2, viewport);
                if (step2_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step3 - Keyin 2 StudyUId in Studyuid field seperated by backslash
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                ehr.SetShowSelector(false);
                ehr.SetSearchKeys_Study(arrstudyuid[0] + "\\" + arrstudyuid[1], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                viewport = viewer.SeriesViewer_1X1(1);
                var step3 = result.steps[++executedSteps];
                step3.SetPath(testid, executedSteps);
                var step3_1 = ehr.CompareImage(step3, viewport);
                if (step3_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step-4 - Compare Pateint and Study Info with dataSource
                if (viewer.PatientInfo().StartsWith(patientname, StringComparison.OrdinalIgnoreCase) && viewer.StudyInfo().StartsWith(arraccession[1], StringComparison.OrdinalIgnoreCase))
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }
                //Step-5 - Apply viewer tools
                viewer.ApplyZoom(viewer.SeriesViewer_1X1(1));
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                var step5 = result.steps[++executedSteps];
                step5.SetPath(testid, executedSteps);
                viewport = viewer.SeriesViewer_1X1();
                var step5_1 = ehr.CompareImage(step5, viewport);
                if (step5_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step6 - open the another study
                viewer.NavigateToHistoryPanel();
                viewer.ChooseColumns(new String[] { "Study UID" });
                viewer.OpenPriors(new String[] { "Study UID" }, new String[] { arrstudyuid[1] });
                BasePage.Driver.FindElement(By.CssSelector("div#m_studyPanels_m_studyPanel_2_panelInfoDiv > div")).Click();
                viewport = viewer.SeriesViewer_1X1(studyPanelIndex: 2);
                var step6 = result.steps[++executedSteps];
                step6.SetPath(testid, executedSteps);
                var step6_1 = viewer.CompareImage(step6, viewport);
                if (step6_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step7 - Open a  series from thumbnail
                var thumbnails = viewer.Thumbnails(studypanelindex: 2);
                viewer.DoubleClick(thumbnails[1]);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                viewport = viewer.SeriesViewer_1X1(studyPanelIndex: 2);
                var step7 = result.steps[++executedSteps];
                step7.SetPath(testid, executedSteps);
                var step7_1 = viewer.CompareImage(step7, viewport);
                if (step7_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Steps-8: Load multiple studies from another patient.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                ehr.SetShowSelector(false);
                ehr.SetSearchKeys_Study(arrstudyuid[0] + "\\" + arrstudyuid[2] + "\\" + arrstudyuid[3], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                viewport = viewer.SeriesViewer_1X1(1);
                var step8 = result.steps[++executedSteps];
                step8.SetPath(testid, executedSteps);
                var step8_1 = ehr.CompareImage(step8, viewport);
                if (step8_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step 9: Compare the patient, study and image info with the data source.
                if (viewer.PatientInfo().StartsWith(patientname, StringComparison.OrdinalIgnoreCase) && viewer.StudyInfo().StartsWith(arraccession[1], StringComparison.OrdinalIgnoreCase))
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step-10 - Load studies with accession number
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                ehr.SetShowSelector(true);
                ehr.SetSearchKeys_Study("", "Study_UID");
                var combinedaccession = arraccession[0] + "\\" + arraccession[1];
                ehr.SetSearchKeys_Study(combinedaccession, "");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                var step10_1 = integratorstudies.Intgtr_CheckBoxes().Count == arraccession.Length;

                basepage.ClickElement(integratorstudies.Intgtr_CheckBoxes()[0]);
                basepage.ClickElement(integratorstudies.Intgr_ViewBtn());
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                var viewport1 = viewer.SeriesViewer_1X1();
                var step10 = result.steps[++executedSteps];
                step10.SetPath(testid, executedSteps, 1);
                var step10_2 = viewer.CompareImage(step10, viewport1);
                bool info1 = (viewer.PatientInfo().StartsWith(patientname, StringComparison.OrdinalIgnoreCase) && viewer.StudyInfo().StartsWith(arraccession[0], StringComparison.OrdinalIgnoreCase));
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                basepage.ClickElement(integratorstudies.Intgtr_CheckBoxes()[1]);
                basepage.ClickElement(integratorstudies.Intgr_ViewBtn());
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                var viewport2 = viewer.SeriesViewer_1X1();
                step10.SetPath(testid, executedSteps, 2);
                var step10_3 = viewer.CompareImage(step10, viewport2);
                bool info2 = (viewer.PatientInfo().StartsWith(patientname, StringComparison.OrdinalIgnoreCase) && viewer.StudyInfo().StartsWith(arraccession[1], StringComparison.OrdinalIgnoreCase));
                if (step10_1 && step10_2 && step10_3)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step-11 - Compare Patient, Study and Image with Data source
                if (info1 && info2)
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                ehr.CloseEHR();
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Logout
                login.Logout();
                ehr.CloseEHR();
                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// Enable Show Report
        /// </summary>
        public TestCaseResult Test_27951(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = new TestCaseResult(stepcount);
            result.SetTestStepDescription(teststeps);
            var servicetool = new ServiceTool();
            int executedSteps = -1;
            String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

            try
            {
                /*#### Preconditions #####*/
                //Reset the Datasource selection
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var studies = login.Navigate<Studies>();
                studies.SearchStudy(LastName: "*", Datasource: "All");
                PageLoadWait.WaitForLoadingMessage(60);

                //Enable Report in SuperAdminGroup
                var domain = login.Navigate<DomainManagement>();
                domain.SearchDomain("SuperAdminGroup");
                domain.SelectDomain("SuperAdminGroup");
                domain.ClickEditDomain();
                domain.SetCheckbox(BasePage.Driver.FindElement(By.CssSelector("input[id$='_ReportViewingEnabledCB']")));
                domain.ClickSaveEditDomain();
                login.Logout();

                //Service tool updates                
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartService();
                servicetool.CloseServiceTool();

                //Step-1 - Load a Study and check report icon
                var ehr = new EHR();
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                WpfObjects._mainWindow.Get(TestStack.White.UIItems.Finders.SearchCriteria.ByAutomationId("m_accessionNumberTextBox")).SetValue(accession);
                var url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                var viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                viewer.SelectToolInToolBar(IEnum.ViewerTools.SeriesViewer1x2);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                if (BasePage.Driver.FindElement(By.CssSelector("div[id*='_1_reportIcon']>img")) != null)
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step-2 - Open report
                var reporticon2 = BasePage.Driver.FindElement(By.CssSelector("div[id*='_1_reportIcon']>img"));
                reporticon2.Click();
                Thread.Sleep(2000);
                executedSteps++;
                result.steps[executedSteps].SetPath(testid, executedSteps);
                var step2 = viewer.CompareImage(result.steps[executedSteps], viewer.studyPanel());
                if (step2)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //step-3 - Close report
                var reporticon3 = BasePage.Driver.FindElement(By.CssSelector("div[id*='_1_reportIcon']>img"));
                reporticon3.Click();
                Thread.Sleep(2000);
                executedSteps++;
                result.steps[executedSteps].SetPath(testid, executedSteps);
                var step3 = viewer.CompareImage(result.steps[executedSteps], viewer.studyPanel());
                if (step3)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// 3.5.0 Configuring GSPS False
        /// </summary>
        public TestCaseResult Test_27954(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            var servicetool = new ServiceTool();
            int executedSteps = -1;
            String accession = String.Empty;
            String configfilepath = String.Empty;
            String key = "Application.EnableSavingGSPS";
            String value = String.Empty;

            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                configfilepath = @"C:\WebAccess\WebAccess\Web.config";
                value = "false";

                //Reset the Datasource selection
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var studies = login.Navigate<Studies>();
                studies.SearchStudy(LastName: "*", Datasource: "All");
                PageLoadWait.WaitForLoadingMessage(60);
                login.Logout();

                //Pre-condition - Disable GSPS
                login.SetWebConfigValue(configfilepath, key, value);

                //Service tool updates                
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartService();
                servicetool.CloseServiceTool();

                //Load a Study a and validate save option
                var ehr = new EHR();
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                WpfObjects._mainWindow.Get(TestStack.White.UIItems.Finders.SearchCriteria.ByAutomationId("m_accessionNumberTextBox")).SetValue(accession);
                var url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                var viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                if (!viewer.GetReviewToolsFromviewer().Contains("SaveSeries") && viewer.GetReviewToolsFromviewer().Count > 0)
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }


                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }

            finally
            {
                login.SetWebConfigValue(configfilepath, key, "true");
                servicetool.RestartIISUsingexe();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// 3.8.0 Saving Attachmentt
        /// </summary>
        public TestCaseResult Test_27960(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            int executedSteps = -1;
            ServiceTool servicetool = null;
            String accession = String.Empty;
            String datasource = String.Empty;
            EHR ehr = null;
            String reportpath = String.Empty;
            String studypath = String.Empty;
            By attachmentlink = null;
            String aetitle = String.Empty;

            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                //Initialize variables
                servicetool = new ServiceTool();
                datasource = Config.DestinationPACS;
                studypath = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath");
                ehr = new EHR();
                reportpath = Directory.GetCurrentDirectory() + Path.DirectorySeparatorChar + "Report.txt";
                attachmentlink = By.CssSelector("table[id$='_attachmentList'] tr:nth-of-type(2)>td:nth-of-type(4)>a");
                aetitle = Config.DestinationPACSAETitle;

                //Precondition
                servicetool = new ServiceTool();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Enable Features");
                servicetool.NavigateSubTab("Study Attachment");
                servicetool.EnableStudyAttachements(IntegratorAllowed: 1);
                servicetool.RestartService();
                servicetool.CloseServiceTool();

                //Create a text file at runtime
                TextWriter outputstream = new StreamWriter(reportpath, true);
                outputstream.WriteLine("Sample Report");
                outputstream.Close();

                //Create a Dicom File and send to pacs
                var dicomstudy = login.CreateNewDicomStudy(filename: studypath);
                accession = BasePage.ReadDicomFile<String>(dicomstudy, Dicom.DicomTag.AccessionNumber);
                var client = new DicomClient();
                client.AddRequest(new DicomCStoreRequest(dicomstudy));
                client.Send(datasource, 104, false, "SCU", aetitle);


                //Step-1 - Launch EHR
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                WpfObjects._mainWindow.Get(TestStack.White.UIItems.Finders.SearchCriteria.ByAutomationId("m_accessionNumberTextBox")).SetValue(accession);
                var url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                var viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                ehr.NavigateToIntegratorFrame();
                executedSteps++;

                //Step-2 - Attach a Document          
                viewer.NavigateToHistoryPanel();
                viewer.UploadAttachment(reportpath);
                executedSteps++;

                //Step-3 - Open the attachement
                var attachmentname = BasePage.Driver.FindElement(attachmentlink).GetAttribute("innerHTML");
                BasePage.Driver.FindElement(attachmentlink).Click();
                var downloadpath = Config.downloadpath + Path.DirectorySeparatorChar;
                PageLoadWait.WaitForFileDownload(downloadpath, attachmentname, "txt", 2);
                executedSteps++;

                //Step-4 - Check Modality in iConnect
                BasePage.Driver.Navigate().GoToUrl(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var studies = login.Navigate<Studies>();
                studies.SearchStudy("Accession", accession);
                studies.ChooseColumns(new string[] { "Modality" });
                var study = studies.GetMatchingRow("Accession", accession);
                if (study["Modality"].Contains("OT"))
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step5 - Validate in data source
                mpaclogin.DriverGoTo(login.GetMPacUrl(datasource));
                MPHomePage mpachome = mpaclogin.Loginpacs(Config.pacsadmin, Config.pacspassword);
                Monitors monitors = (Monitors)mpachome.NavigateTopMenu("Monitors");
                monitors.NavigateToImporters();
                IList<String> msgs = monitors.GetStudyStatus();
                bool IsStatusExist = msgs.Any(msg => msg.Replace(" ", "").Contains("Modality:OT,Accession:" + accession) && msg.Contains("Status:OK"));
                bool IsNewStudymsgExist = msgs.Any(msg => msg.Contains("New study arrived") && msg.Contains("Accession:" + accession));
                bool IsModalityExist = msgs.Any(msg => msg.Replace(" ", "").Contains("Modality:OT,Accession:" + accession));
                if (IsStatusExist && IsNewStudymsgExist && IsModalityExist)
                {
                    result.steps[++executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[++executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }
                mpaclogin.LogoutPacs();


                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                ehr.CloseEHR();
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                ehr.CloseEHR();
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// Loading CR study
        /// </summary>
        public TestCaseResult Test_27963(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            int executedSteps = -1;


            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);




                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
        }

        /// <summary> 
        /// 4.2.0 Loading study that have saved measurement
        /// </summary>
        public TestCaseResult Test_27965(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            int executedSteps = -1;


            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);




                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
        }

        /// <summary> 
        /// Modality Presets --Aliases
        /// </summary>
        public TestCaseResult Test_27971(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            DomainManagement domainmanagement = null;
            UserPreferences userpreferences = new UserPreferences();
            string[] ModalitySettings = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "Modality")).Split(':');
            string[] AccessionID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string url = string.Empty;
            int ExecutedSteps = -1;
            IList<string> APresets = null;
            string[] EPresets = null;
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Preconditions
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                login.LoginIConnect(username, password);
                if (login.IsTabSelected("DomainManagement"))
                {
                    domainmanagement = new DomainManagement();
                }
                else
                {
                    domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                }
                Dictionary<Object, String> createDomain = domainmanagement.CreateDomainAttr();
                domainmanagement.CreateDomain(createDomain);
                string domainadminuid = createDomain[DomainManagement.DomainAttr.UserID];
                string domainadminpwd = createDomain[DomainManagement.DomainAttr.Password];
                string domainname = createDomain[DomainManagement.DomainAttr.DomainName];
                string rolename = createDomain[DomainManagement.DomainAttr.RoleName];
                login.Logout();
                login.LoginIConnect(domainadminuid, domainadminpwd);
                userpreferences.OpenUserPreferences();
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                foreach (string modalitysetting in ModalitySettings)
                {
                    userpreferences.ModalityDropDown().SelectByText(modalitysetting.Split('=')[0]);
                    userpreferences.LayoutDropDown().SelectByText("1x1");
                    string[] presets = modalitysetting.Split('=')[1].Split(';');
                    foreach (string preset in presets)
                    {
                        string[] presetvalue = preset.Split(',');
                        basepage.SendKeys(userpreferences.PresetNameTextBox(), presetvalue[0]);
                        basepage.SendKeys(userpreferences.WidthTextBox(), presetvalue[1]);
                        basepage.SendKeys(userpreferences.LevelTextBox(), presetvalue[2]);
                        basepage.ClickElement(userpreferences.AddModifyBtn());
                    }
                }
                userpreferences.CloseUserPreferences();
                PageLoadWait.WaitForPageLoad(20);
                login.Logout();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                //Step 1: Load a CR Study and select the Preset W/L drop down.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: domainname, role: rolename, user: domainadminuid, usersharing: "True");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                APresets = viewer.Presets().Select(pst => Regex.Replace(pst.GetAttribute("title"), "[:|/]", ",")).ToList();
                EPresets = ModalitySettings[0].Split('=')[1].Split(';');
                if (APresets.Count == 3 && APresets.All(acrpreset => EPresets.Contains(acrpreset, StringComparer.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 2: Apply each viewing protocol, and verify image updates correctly.
                APresets.Clear();
                for (int i = 0; i < viewer.Presets().Count; i++)
                {
                    basepage.ClickElement(viewer.Presets()[i]);
                    PageLoadWait.WaitForPageLoad(40);
                    PageLoadWait.WaitForFrameLoad(40);
                    PageLoadWait.WaitForAllViewportsToLoad(40);
                    PageLoadWait.WaitForThumbnailsToLoad(40);
                    APresets.Add(string.Concat("CR", i + 1, ",", viewer.GetInnerAttribute(viewer.SeriesViewer_1X1(), "src", '&', "width"), ",", viewer.GetInnerAttribute(viewer.SeriesViewer_1X1(), "src", '&', "level")));
                    Logger.Instance.InfoLog("Displayed Preset is"+ APresets[i]);
                }
                if (APresets.Count == 3 && APresets.All(acrpreset => EPresets.Contains(acrpreset, StringComparer.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 3: Load a MG Study and select the Preset W/L drop down.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: domainname, role: rolename, user: domainadminuid, usersharing: "True");
                ehr.SetSearchKeys_Study(AccessionID[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                APresets = viewer.Presets().Select(pst => Regex.Replace(pst.GetAttribute("title"), "[:|/]", ",")).ToList();
                EPresets = ModalitySettings[1].Split('=')[1].Split(';');
                if (APresets.Count == 3 && APresets.All(acrpreset => EPresets.Contains(acrpreset, StringComparer.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 4: Apply each viewing protocol, and verify image updates correctly
                APresets.Clear();
                for (int i = 0; i < viewer.Presets().Count; i++)
                {
                    basepage.ClickElement(viewer.Presets()[i]);
                    PageLoadWait.WaitForPageLoad(20);
                    PageLoadWait.WaitForFrameLoad(20);
                    PageLoadWait.WaitForAllViewportsToLoad(20);
                    APresets.Add(string.Concat("MG", i + 1, ",", viewer.GetInnerAttribute(viewer.SeriesViewer_1X1(), "src", '&', "width"), ",", viewer.GetInnerAttribute(viewer.SeriesViewer_1X1(), "src", '&', "level")));
                }
                if (APresets.Count == 3 && APresets.All(acrpreset => EPresets.Contains(acrpreset, StringComparer.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 5: Load a CT Study and select the Preset W/L drop down.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: domainname, role: rolename, user: domainadminuid, usersharing: "True");
                ehr.SetSearchKeys_Study(AccessionID[2]);
                url = ehr.clickCmdLine("ImageLoad");
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                APresets = viewer.Presets().Select(pst => Regex.Replace(pst.GetAttribute("title"), "[:|/]", ",")).ToList();
                EPresets = ModalitySettings[2].Split('=')[1].Split(';');
                if (APresets.Count == 2 && APresets.All(acrpreset => EPresets.Contains(acrpreset, StringComparer.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 6: Apply each viewing protocol, and verify image updates correctly.
                APresets.Clear();
                for (int i = 0; i < viewer.Presets().Count; i++)
                {
                    basepage.ClickElement(viewer.Presets()[i]);
                    PageLoadWait.WaitForPageLoad(20);
                    PageLoadWait.WaitForFrameLoad(20);
                    PageLoadWait.WaitForAllViewportsToLoad(20);
                    APresets.Add(string.Concat("CT", i + 1, ",", viewer.GetInnerAttribute(viewer.SeriesViewer_1X1(), "src", '&', "width"), ",", viewer.GetInnerAttribute(viewer.SeriesViewer_1X1(), "src", '&', "level")));
                }
                if (APresets.Count == 2 && APresets.All(acrpreset => EPresets.Contains(acrpreset, StringComparer.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 7: Launch a study and click on "User Preferences" and modify few settings under Default Settings Per Modality: Remove all presets for CR modality.
                login.DriverGoTo(login.url);
                login.LoginIConnect(domainadminuid, domainadminpwd);
                userpreferences.OpenUserPreferences();
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.ModalityDropDown().SelectByText("CR");
                for (int i = 0; i < 3; i++)
                {
                    basepage.ClickElement(userpreferences.RemoveBtn());
                }
                userpreferences.CloseUserPreferences();
                PageLoadWait.WaitForPageLoad(20);
                login.Logout();
                ExecutedSteps++;
                //Step 8: Load a CR Study and move the mouse cursor over the preset W/L drop down icon.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: domainname, role: rolename, user: domainadminuid, usersharing: "True");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                if (string.Equals("preset", viewer.Preset().GetAttribute("title")) && viewer.Presets().Count == 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 9: Apply Auto W/L
                viewer.SeriesViewer_1X1().Click();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(30);
                viewer.Preset().Click();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                if (basepage.CompareImage(result.steps[ExecutedSteps], viewer.SeriesViewer_1X1()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// 13.0 Search Prior
        /// </summary>
        public TestCaseResult Test_27976(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            int ExecutedSteps = -1;
            ServiceTool servicetool = new ServiceTool();
            StudyViewer studyviewer = null;
            IntegratorStudies studies = null;
            EHR ehr = new EHR();

            String adminUserName = Config.adminUserName;
            String adminPassword = Config.adminPassword;
            String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
            String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
            String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
            String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
            String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
            String DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);
            String URL = "http://localhost/webaccess";

            String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
            String[] AccessionId = AccessionIds.Split(':');
            String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
            String[] LastName = LastNames.Split(':');

            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                // Step 1:
                // Run Merge iConnect Access Service Tool	
                // Expected result: Merge iConnect Access Service Tool is brought up successfully.
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                ExecutedSteps++;

                // Step 2:
                // Select Integrator Tab Select Modify button and uncheck the following boxes: Patient ID and Patient Name
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                servicetool.WaitWhileBusy();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                wpfobject.UnSelectCheckBox("Patient ID", 1);
                wpfobject.UnSelectCheckBox("Patient Full Name", 1);
                servicetool.WaitWhileBusy();
                if (!wpfobject.IsCheckBoxSelected("Patient ID", 1) && !wpfobject.IsCheckBoxSelected("Patient Full Name", 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 3:
                // Select Apply button.	
                servicetool.ClickApplyButtonFromTab();
                servicetool.WaitWhileBusy();
                String msg = "";
                String ErrorMsg = "At least Patient ID or Patient Name should be selected as Related Study Parameters.";
                Window dialog = WpfObjects._mainWindow.MessageBox("ERROR");
                msg = wpfobject.GetAnyUIItem<Window, Label>(dialog, "65535").Text;
                wpfobject.GetAnyUIItem<Window, Button>(dialog, "2").Click();
                wpfobject.WaitTillLoad();
                if (msg.Contains(ErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 4:
                // Re-select Patient ID and Patient Name.	
                wpfobject.SelectCheckBox("Patient ID", 1);
                wpfobject.SelectCheckBox("Patient Full Name", 1);
                if (wpfobject.IsCheckBoxSelected("Patient ID", 1) && wpfobject.IsCheckBoxSelected("Patient Full Name", 1))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5:
                // Select Apply button and IIS reset.	
                servicetool.ClickApplyButtonFromTab();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                // Step 6
                // Run TestEHR.exe
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                if (wpfobject.VerifyWindowExist("Test WebAccess EHR"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 7
                // Select/Type the followings:
                // 1.In Study UID box, type: (study UID number)
                // 2.Select True from the drop box Search Priors(top left corner).
                // 3.Select True from the drop box Auto End Session
                // 4.Select Load button.
                ehr.SetCommonParameters(address: URL, user: "Administrator", domain: "SuperAdminGroup", usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", SearchPriors: "True");
                ehr.SetSearchKeys_Study("1.2.840.113619.2.1.1.2702803387.515.959155152.885", "Study_UID");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad (20);
                basepage.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer.ChooseColumns(new String[] { "Study ID" });
                string[] studyIDs = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Study ID", BasePage.GetColumnNames());
                if (studyIDs.Contains("33648") && studyIDs.Contains("33632") && studyIDs.Contains("33621"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 8 
                // Close the browser	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;

                // Step 9
                // From the TestEHR, select False from the drop box Search Priors.	
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "Administrator", domain: "SuperAdminGroup", usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(SearchPriors: "False");
                if (wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "m_searchPriorsComboBox").SelectedItemText.Contains("False"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 10
                // Select Load button.	
                ehr.SetSearchKeys_Study("1.2.840.113619.2.1.1.2702803387.515.959155152.885", "Study_UID", datasources: "EA-46");
                url_2 = ehr.clickCmdLine("ImageLoad");
                login = new Login();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(20);
                basepage.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer.ChooseColumns(new String[] { "Study ID" });
                studyIDs = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Study ID", BasePage.GetColumnNames());
                if (studyIDs.Contains("33648"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 11
                // Close the browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;

                // Step 12
                // From the TestEHR, enter abdomen in the Full Name field and click on Load
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "Administrator", domain: "SuperAdminGroup", usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(SearchPriors: "False", showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("abdomen", "Patient_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");

                login = new Login();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (ehr.VerifyPatientDetails("Last Name", "Abdomen"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                // Step 13
                // Select one of the patients and click View. Then click History to view the Priors	
                ehr.selectPatient("ABDOMEN");
                login.ClickUrlViewStudyBtn();
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(20);
                PageLoadWait.WaitForThumbnailsToLoad(20);
                basepage.ClickElement(studyviewer.PatientHistoryTab());
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer.ChooseColumns(new String[] { "Study ID" });
                studyIDs = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Study ID", BasePage.GetColumnNames());
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                bool patientname = BasePage.Driver.FindElement(By.CssSelector("#m_patientHistory_patientNameTextBox")).GetAttribute("value").ToLower().Contains("abdomen");
                if (studyIDs.Contains("24813") && patientname)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 14
                // Close Viewer	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;


                // Step 15
                // In the service tool Integrator Tab
                // pre - condition in service tool set user sharing to URL determined and in testEHR 
                // set ENable user sharing to False
                // Select the Patient Full Name and unselect the others
                // Reset IIS

                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Url Determined", shadowuser: "Always Disabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                wpfobject.UnSelectCheckBox("Patient ID", 1);
                wpfobject.SelectCheckBox("Patient Full Name", 1); //
                if (!wpfobject.IsCheckBoxSelected("Patient ID", 1) && wpfobject.IsCheckBoxSelected("Patient Full Name", 1))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                servicetool.CickApplyButton();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();

                // Step 16
                // In the TestEHR Application click on load, the name abdomen is still in the Full name field
                // Expected result: the window displays all of the patients with the last name containing"abdomen"
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "Administrator", domain: "SuperAdminGroup", usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(SearchPriors: "False");
                ehr.SetSearchKeys_Study("abdomen", "Patient_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");


                login = new Login();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (ehr.VerifyPatientDetails("Last Name", "Abdomen"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 17
                // Select one of the patients and click View. Then click History to view the Priors	
                ehr.selectPatient("Abdomen");
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["LastName"].ToLower().Equals("Abdomen".ToLower()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 18
                // Close Viewer	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;


                // Step 19
                // in the service tool Integrator Tab 
                // Select the Patient ID and unselect the others Reset IIS
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Url Determined", shadowuser: "Always Disabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                wpfobject.SelectCheckBox("Patient ID", 1);
                wpfobject.UnSelectCheckBox("Patient Full Name", 1);
                if (wpfobject.IsCheckBoxSelected("Patient ID", 1) && !wpfobject.IsCheckBoxSelected("Patient Full Name", 1))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                servicetool.CickApplyButton();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();


                // Step 20
                // In the TestEHR Application click on load, the name abdomen is still in the Full name field
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "Administrator", domain: "SuperAdminGroup", usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(SearchPriors: "False");
                ehr.SetSearchKeys_Study("abdomen", "Patient_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");

                login = new Login();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (ehr.VerifyPatientDetails("Last Name", "Abdomen"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                // Step 21
                // Select one of the patients and click View. Then click History to view the Priors	
                ehr.selectPatient("1205937");
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["PatientID"].Contains("1205937"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 22
                // Close Viewer	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;


                // Step 23
                // In the service tool Integrator Tab
                // Select the Patient Last Name and unselect the others
                // Reset IIS
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Url Determined", shadowuser: "Always Disabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                wpfobject.SelectCheckBox("Patient Last Name", 1);
                wpfobject.UnSelectCheckBox("Patient Full Name", 1);
                wpfobject.UnSelectCheckBox("Patient ID", 1);
                if (!wpfobject.IsCheckBoxSelected("Patient ID", 1) && !wpfobject.IsCheckBoxSelected("Patient Full Name", 1) && wpfobject.IsCheckBoxSelected("Patient Last Name", 1))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                servicetool.CickApplyButton();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();

                // Step 24 
                // In the TestEHR Application click on load, the name abdomen is still in the Full name field
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "Administrator", domain: "SuperAdminGroup", usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(SearchPriors: "False");
                ehr.SetSearchKeys_Study("abdomen", "Patient_Name");
                url_2 = ehr.clickCmdLine("ImageLoad");
                login = new Login();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (ehr.VerifyPatientDetails("Last Name", "Abdomen"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 25
                // Select one of the patients and click View. Then click History to view the Priors	
                ehr.selectPatient("1205937");
                login.ClickUrlViewStudyBtn();

                if (studyviewer.PatientDetailsInViewer()["PatientID"].Contains("1205937"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 26
                // In the service tool Integrator Tab 
                // Select the Patient Last Name and unselect the others
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Url Determined", shadowuser: "Always Disabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                wpfobject.SelectCheckBox("Patient Last Name", 1);
                if (!wpfobject.IsCheckBoxSelected("Patient ID", 1) && !wpfobject.IsCheckBoxSelected("Patient Full Name", 1) && wpfobject.IsCheckBoxSelected("Patient Last Name", 1))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                servicetool.CickApplyButton();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();

                // Step 27
                // In the service tool Integrator Tab Select the Patient Full Name
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Url Determined", shadowuser: "Always Disabled");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                wpfobject.SelectCheckBox("Patient Full Name", 1);
                if (!wpfobject.IsCheckBoxSelected("Patient ID", 1) && wpfobject.IsCheckBoxSelected("Patient Full Name", 1) && !wpfobject.IsCheckBoxSelected("Patient Last Name", 1))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                servicetool.CickApplyButton();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();


                // Step 28
                // Close the browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;


                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                try
                {
                    servicetool.InvokeServiceTool();
                    servicetool.WaitWhileBusy();
                    servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                    servicetool.WaitWhileBusy();
                    servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                    servicetool.WaitWhileBusy();
                    servicetool.ClickModifyButton();
                    wpfobject.UnSelectCheckBox("Patient Last Name", 1);
                    wpfobject.SelectCheckBox("Patient Full Name", 1);
                    wpfobject.SelectCheckBox("Patient ID", 1);
                    servicetool.CickApplyButton();
                    servicetool.WaitWhileBusy();
                    servicetool.RestartIISandWindowsServices();
                    servicetool.WaitWhileBusy();
                    servicetool.CloseServiceTool();
                }
                catch (Exception) { }
            }
        }

        /// <summary> 
        /// 14.0 Using Encrypted URL
        /// </summary>
        public TestCaseResult Test_27978(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            StudyViewer studyviewer = new StudyViewer();
            int ExecutedSteps = -1;
            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                String PatientNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientName");
                String[] PatientName = PatientNames.Split(':');

                String PatientIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PatientID = PatientIDs.Split(':');

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String SeriesUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SeriesUID");
                String[] SeriesUID = SeriesUIDs.Split(':');

                String Height = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Height");
                String Width = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Width");

                String DocumentIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DocumentID");
                String[] DocumentID = DocumentIDs.Split(':');
                String RepositoryIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "RepositoryID");
                String[] RepositoryID = RepositoryIDs.Split(':');
                String MimeTypes = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MimeType");
                String[] MimeType = MimeTypes.Split('/');






                // Pre-condition:
                /*
                Close browser. 
                In Service tool, configure PMJ assigning authority: topkick as TOH, Forenza as NYH ,etc. 
                Enabled MPI from Enable Features tab. 
                Restart IIS.
                ONE
                Open the ICA service tool and select the Encryption Tab. Click on Add and enter an encryption service with the following data.
                Key = TripleDES
                Assembly = OpenContent.Generic.Core.dll
                Class = OpenContent.Core.Security.Services.TripleDES
                Click on Add and the bottom and enter the following Service Parameters. update each field. 
                Name                 Class          Value 
                --------------------------------------------------------------------------
                key               string         Leave Blank
                iv                string         Leave Blank
                characterSet      string         Windows-1252
                operationMode     string         CBC  
                paddingMode      string         Zeros
                Click on OK  and OK and reset IISserver.
 
                TWO
                Create a encryption key using the Key converter tab located on the right hand side of the encryption screen.  .
                Enter a Plain Text Key "mergehealthcare"
                Select the KeySize =  192bit (Key for TripleDes, DES) and click on convert.
                Copy the data in the Base64 field and enter it in the Key service parameter value field that was left blank.
 
                THREE
                Creatre a second entry change the key name and create a new 64 base key. 
                Key = TripleDES-A
                Assembly = OpenContent.Generic.Core.dll
                Class = OpenContent.Core.Security.Services.TripleDES
                Click on Add and the bottom and enter the following Service Parameters. update each field. 
                Name                 Class          Value 
                --------------------------------------------------------------------------
                key                    string         Leave Blank
                iv                       string         Leave Blank
                characterSet       string         Windows-1252
                operationMode    string         CBC  
                paddingMode      string         Zeros
                Repeat the above step TWO process and change the name to "cedaracare" OR to any other name and use the new 64base key for the second Key entry.
                Click on OK  and OK and reset IISserver.
 
                Click on the Integrator URL tab located on the right hand side of the encryption screen.
                Enable the URL Encryption, enter  
                Enter an ID = ID-123
                Argument Name = args
                Select one of the created encription services and click on Add 
                Repeat the steps entering ID-456 and selecting the next encription service. 
                Select one of the Encryptions for the Default Provider
                User sharing: Always enabled
                Shadow user: Always enabled
                AllowShowSelector = true
                AllowShowSelectorSearch=true
                Set integrator URL timeout to 2mins
                Click on Apply and Restart IIS
                */

                string Encryption_TripleDes_Key = "TripleDES";
                string Encryption_TripleDesA_Key = "TripleDES-A";

                string Encryption_Passpharse_TripleDes_Key = "mergehealthcare";
                string Encryption_Passphares_TripleDes_A_key = "cedaracare";
                string URL = "http://localhost/webaccess";
                string adminUserName = Config.adminUserName;
                string adminpassword = Config.adminPassword;
                string url_2;
                Stopwatch stopwatch = new Stopwatch();
                TimeSpan timeout = new TimeSpan(0, 3, 0);
                //WebDriverWait wait1;
                //bool StudyPanelExists;

                servicetool.InvokeServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.EnableFeatures_Tab);
                wpfobject.WaitTillLoad();
                servicetool.wpfobject.ClickButton("Modify", 1);
                wpfobject.WaitTillLoad();
                servicetool.EnablePatient();
                servicetool.EnableMergeEMPI();
                wpfobject.WaitTillLoad();

                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Key Generator");
                String[] TripleDESGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_Passpharse_TripleDes_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] TripleDESAGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_Passphares_TripleDes_A_key, keysize: "192 bit (Key for TripleDES, AES)");

                // Create Encrption Service for "Triple DES"
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDes_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", TripleDESGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDesA_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", TripleDESAGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                wpfobject.WaitTillLoad();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();

                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();
                TextBox ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = "ID-123";
                wpfobject.WaitTillLoad();
                TextBox ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "args";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDes_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = "ID-456";
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "args";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDesA_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter("ID-123");
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }


                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                servicetool.InvokeServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                SetTimeout.Enter("2");
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.WaitForPopUp();
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception) { }
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                // Step 1:
                // Open the TestEHR program and change the Address to HTTP:/localhost/webaccess
                // click on the default browser box, select auto end session = true, enter an A in the patients Full Name field.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSearchKeys_Study(PatientName[0], "Patient_Name");
                ExecutedSteps++;

                // Step 2
                // Click on the Use Encryption box and click on Cmd Line button.	
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                if (url_2.Contains("encryptionProvider=ID-123"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                // Step 3
                // Click on Load to launch ICA.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                string[] columnvalues = ehr.GetColumnValues("Last Name");
                bool ValueSearch = columnvalues.All(lastname => lastname.StartsWith("A", StringComparison.OrdinalIgnoreCase));
                if (ValueSearch)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 4:
                // close the ICA and in the TestEHR and select the None box, click on Cmd Line	

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSearchKeys_Study(PatientName[0], "Patient_Name");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                wpfobject.SelectCheckBox("useNoEncryption");
                url_2 = ehr.clickCmdLine("ImageLoad");
                if (!url_2.Contains("encryptionProvider=ID-123"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();


                // Step 5
                // Click on Load to launch ICA.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                string ExpectedError = "Error Occurred in operation: Requested study doesn't match security claims provided.";
                if (studyviewer.AuthenticationErrorMsg().Text.Contains(ExpectedError))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 6:
                // Close ICA and in the TestEHR select the Default box and click on CmdLine
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSearchKeys_Study(PatientName[0], "Patient_Name");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                wpfobject.SelectCheckBox("useDefaultEncryptionChk");
                url_2 = ehr.clickCmdLine("ImageLoad");
                if (!url_2.Contains("encryptionProvider"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                ehr.CloseEHR();

                // Step 7
                // Click on Load to launch ICA.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                columnvalues = ehr.GetColumnValues("Last Name");
                ValueSearch = columnvalues.All(lastname => lastname.StartsWith("A", StringComparison.OrdinalIgnoreCase));
                if (ValueSearch)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 8
                // 	Copy the URL and wait for 2 min copy URL into new browser window.

                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                int actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();

                string expectederrormsg = "Error Occurred in operation: The Url has been over due.";
                if (studyviewer.AuthenticationErrorMsg().Text.Contains(expectederrormsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 9
                // go to TestEHR"PMJ Load"tab.Address = http:/localhost/WebAccess
                // Security ID = Administrator - Administrator
                // Select Auto End Session as"True"
                // Patient ID = 4455 ^^^ TOH(test data: John, Doe)
                // Check Use Encryption(TimeStamp)
                // Click"cmd line"button.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("PMJ Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True", SecurityID: "administrator-administrator", autoendsession: "True");
                ehr.SetSearchKeysPMJ_Study("Patient_ID", PatientID[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("PmjLoad");
                bool PatientidNotExists = !url_2.Contains("Patient_id");
                if (PatientidNotExists)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                // Step 10
                // Click on Load to launch ICA.

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(40);
                if (BasePage.Driver.FindElement(By.CssSelector("#PatientMasterJacket_PatientDemographic_m_patientName")).Text.Contains("John,Doe"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 11
                // Copy the URL and wait for 2 min copy URL into new browser window.
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();


                expectederrormsg = "Error Occurred in operation: The Url has been over due.";
                if (studyviewer.AuthenticationErrorMsg().Text.Contains(expectederrormsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12
                // Close all browsers. Go to TestEHR"Thumbnail View"tab. 
                // Address = http://localhost/WebAccess
                // Security ID = Administrator - Administrator
                // StudyUID = 2.16.840.1.113662.4.4162725393.939735033.1759523607584223909
                // Series UID = 2.16.840.1.113662.4.4162725393.939736864.621350209442302413
                // (this is test study"Abdomen, MR; make sure this study existed in datasource)
                //Thumbnail Height = 512; Thumbnail width = 512
                // Check Use Encryption(TimeStamp)  Click 'Cmd line' button.

                ehr.LaunchEHR();
                //ehr.Logout();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Thumbnail view");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True", SecurityID: "administrator-administrator", autoendsession: "True");
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ThumbnailView");
                bool StudyUidNotExists = !url_2.Contains("Study_UID");
                bool SeriesUidNotExists = !url_2.Contains("Series_UID");
                if (StudyUidNotExists && SeriesUidNotExists)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                // Step 13
                // Click on View to launch the thumbnail.	

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                // studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(40);

                string[] width = BasePage.Driver.FindElements(By.TagName("img")).Select(img => img.GetAttribute("width")).ToArray();
                string[] height = BasePage.Driver.FindElements(By.TagName("img")).Select(img => img.GetAttribute("height")).ToArray();

                if (width[0].Equals(Width) && height[0].Equals(Height))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 14
                // Copy the URL and wait for 2 min copy URL into new browser window.	
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                // studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], BasePage.Driver.FindElement(By.CssSelector("body>img")));
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 15
                // Close all browsers. Go to TestEHR"Document View"tab. 
                // Address = http://localhost/WebAccess
                // Security ID = Administrator - Administrator
                // Document ID = Document200
                // keep the Repository UID as default.
                // MIME type selects"image/jpeg"
                // Check Use Encryption(TimeStamp)
                // Click"cmd line"button.

                ehr.LaunchEHR();
                //ehr.Logout();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Document View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True", SecurityID: "administrator-administrator", autoendsession: "True");
                ehr.SetSearchKeysDocument_Study("Document_id", DocumentID[0]);
                ehr.SetSearchKeysDocument_Study("Repository_uid", RepositoryID[0]);
                ComboBox MimeTypetextbox = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "m_MIMETypeCB", 0);
                MimeTypetextbox.Enter(MimeType[0] + "/" + MimeType[1]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("Documentview");
                bool DocumentidNotExists = !url_2.Contains("Document_id");
                if (DocumentidNotExists)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                // Step 16
                // Click on View to launch the thumbnail.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(40);
                string ThumbnailDocumentUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "mimetype");
                if (ThumbnailDocumentUID.ToLowerInvariant().Contains(MimeType[0]) && ThumbnailDocumentUID.ToLowerInvariant().Contains(MimeType[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 17
                // Copy the URL and wait for 2 min copy URL into new browser window.	
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                expectederrormsg = "Error Occurred in operation: The Url has been over due.";
                string Actualerrormsg = studyviewer.AuthenticationErrorMsg().Text;
                if (Actualerrormsg.Contains(expectederrormsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
                try
                {
                    servicetool.InvokeServiceTool();
                    wpfobject.WaitTillLoad();
                    servicetool.NavigateToTab("Integrator");
                    servicetool.WaitWhileBusy();
                    servicetool.ClickModifyButton();
                    TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                    SetTimeout.Enter("0");
                    servicetool.ClickApplyButtonFromTab();
                    wpfobject.WaitTillLoad();
                    try
                    {
                        wpfobject.WaitForPopUp();
                        wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    }
                    catch (Exception) { }
                    servicetool.RestartIISandWindowsServices();
                    wpfobject.WaitTillLoad();
                    servicetool.CloseServiceTool();
                }
                catch (Exception) { }
            }
        }

        /// <summary> 
        /// Configuring the Application to Use an Encryption Service
        /// </summary>
        public TestCaseResult Test_90028(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            int executedSteps = -1;
            ServiceTool servicetool = new ServiceTool();
            string Encryption_TripleDES_Key = "TripleDES_" + +new Random().Next(1000);
            string Encryption_AMICAS_Key = "AMICAS_HALO.RC4" + +new Random().Next(1000);
            string Encryption_AES_Key = "AES_" + +new Random().Next(1000);
            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                string Encryption_Provider_id = "ID_TripleDES_" + +new Random().Next(1000); ;
                string Encryption_Provide_Amicas_id = "ID_AMICAS_" + +new Random().Next(1000);
                string Encryption_Provide_AES_id = "ID_AES_" + +new Random().Next(1000);
                string AmicasPassword = "amicas";

                // Precondition:
                // 
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Key Generator");
                servicetool.WaitWhileBusy();

                String[] testkey1 = servicetool.GenerateEncryptionKeys(Encryption_TripleDES_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] testkey2 = servicetool.GenerateEncryptionKeys(Encryption_AMICAS_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] testkey3 = servicetool.GenerateEncryptionKeys(Encryption_AES_Key, keysize: "192 bit (Key for TripleDES, AES)");
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                //Disable Default HTML5 Viewer
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDES_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", testkey1[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_AES_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", testkey2[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_AMICAS_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.HaloCryptographyWrapper");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("password", "string", AmicasPassword);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();
                servicetool.WaitWhileBusy();

                // Step 1:
                // Click the Encryption tab, then click the Integrator URL sub - tab.
                // Expected result: Click the Encryption tab, then click the Integrator URL sub - tab is selected
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                executedSteps++;

                // Step 2:
                // Click Modify and select the URL Encryption Enabled check box.	
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();
                executedSteps++;

                // Step 3:
                // In the ID field, type a unique identifier for the encryption provider and in the Argument Name field, ensure you replace the default value 
                // with the encryption argument used in your URL
                // Note; If this value does not match the encryption argument used in the URL, the iConnect Access application does not decrypt the URL

                TextBox ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_id;
                wpfobject.WaitTillLoad();
                TextBox ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "encrypt";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDES_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provide_Amicas_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "encrypt";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_AMICAS_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provide_AES_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "encrypt";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_AES_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                executedSteps++;

                // Step 4
                // n the Encryption Service drop-down list, select the encryption service you created (for
                // example, the Triple DES, AES, or AMICAS Cryptographic service) and click on Add
                executedSteps++;


                // Step 5
                // Select any encryption service from Default Encryption Provider dropdown list
                // Note: If the encryptionProvider parameter is not specified in the URL but URL encrytion is enabled, it will consider the default encryption service
                ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }
                executedSteps++;

                // Step 6
                // Click on apply and restart the services	
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                executedSteps++;

                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_TripleDES_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_TripleDES_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AMICAS_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AMICAS_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AES_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AES_Key + "']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// Autoend session
        /// </summary>
        public TestCaseResult Test_91339(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string AccessionNumber = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Step 1: From WebAccessConfiguration.xml set AutoEndSession value to "False" in IntegratorMode session
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AutoEndSession", "False");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 2: Launch TestEHR application
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ExecutedSteps++;
                //Step 3: Set AutoEndSession = True in TestEHR tool
                ehr.SetCommonParameters();
                ExecutedSteps++;
                //Step 4: Enter Accession number which is available in datasource and Click on CMD Line.
                ehr.SetSearchKeys_Study(AccessionNumber);
                url = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;
                //Step 5: Select Load
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 6: Close the browser or tab in which study is loaded
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ExecutedSteps++;
                //Step 7: Hit the Load button again with same settings
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 8: Select AutoEndSession value to blank and hit cmd button from TestEHR tool 
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ehr.SetCommonParameters(autoendsession: "");
                ExecutedSteps++;
                //Step 9: Enter Accession number which is available in datasource and Click on CMD Line
                //Step 10: Copy the complete URL
                ehr.SetSearchKeys_Study(AccessionNumber);
                url = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;
                ExecutedSteps++;
                //Step 11: Open the browser and paste the URL in browser address bar
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 12: Close the browser or tab in which study is loaded
                login.NavigateToIntegratorURL(url);
                ExecutedSteps++;
                //Step 13: Open the browser again and re-paste the changed url again in address bar
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("there is another session open"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 14: Select AutoEndSession value to False and hit cmd button from TestEHR tool
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ehr.SetCommonParameters(autoendsession: "False");
                ExecutedSteps++;
                //Step 15: Enter Accession number which is available in datasource and Click on CMD Line
                ehr.SetSearchKeys_Study(AccessionNumber);
                url = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;
                //Step 16: Select Load.
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 17: Close the browser or tab in which study is loaded
                //Step 18: Hit the Load button again with same settings
                login.NavigateToIntegratorURL(url);
                ExecutedSteps++;
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("there is another session open"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 19: From WebAccessConfiguration.xml set AutoEndSession value to "True" in IntegratorMode session
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AutoEndSession", "True");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 20: Launch TestEHR application.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ExecutedSteps++;
                //Step 21: Set AutoEndSession = True in TestEHR tool
                ehr.SetCommonParameters();
                ExecutedSteps++;
                //Step 22: Enter Accession number which is available in datasource and Click on CMD Line.
                ehr.SetSearchKeys_Study(AccessionNumber);
                url = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;
                //Step 23: Select Load
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 24: Close the browser or tab in which study is loaded
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ExecutedSteps++;
                //Step 25: Hit the Load button again with same settings
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 26: Select AutoEndSession value to blank and hit cmd button from TestEHR tool 
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ehr.SetCommonParameters(autoendsession: "");
                ExecutedSteps++;
                //Step 27: Enter Accession number which is available in datasource and Click on CMD Line
                ehr.SetSearchKeys_Study(AccessionNumber);
                url = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;
                //Step 28: Select Load
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 29: Close the browser or tab in which study is loaded
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ExecutedSteps++;
                //Step 30: Hit the Load button again with same settings
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 31: Set AutoEndSession = False in TestEHR tool
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ehr.SetCommonParameters(autoendsession: "False");
                ExecutedSteps++;
                //Step 32: Enter Accession number which is available in datasource and Click on CMD Line
                ehr.SetSearchKeys_Study(AccessionNumber);
                url = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;
                //Step 33: Select Load
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 34: Close the browser or tab in which study is loaded
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                ExecutedSteps++;
                //Step 35: Hit the Load button again with same settings
                login.NavigateToIntegratorURL(url);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber.ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Logout
                login.Logout();
                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AutoEndSession", "True");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        /// Test 27979 - 15.0 Hide URL In Browser
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_27979(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool servicetool = new ServiceTool();
            IntegratorStudies studies = new IntegratorStudies();
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);

                String PatientNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientName");
                String[] PatientName = PatientNames.Split(':');

                //  Pre - conditions:  
                //Set the integrator authentication to bypass(In IntegratorAuthenticationSTS\Web.config:
                //Set the UsernameToken type to: "Sample.HostIntegration.Authentication.ByPassAuthenticator, Sample.HostIntegration").
                //Refer to Host Integration Guide for further details.
                basepage.CopyFiles(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", @"C:\Users\Administrator\Desktop\27979\Web.config");

                // Disable the Encripted URL in the Service tool Tab Located in Encription-- *^>^ *Integrator URL
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.IntegratorUrlTab().Click();
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                servicetool.WaitWhileBusy();
                if (servicetool.URLEnc_CB().Checked == true)
                {
                    servicetool.URLEnc_CB().Click();
                }
                servicetool.WaitWhileBusy();
                servicetool.ClickApplyButtonFromTab();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.CloseServiceTool();
                string step1_url = "http://localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&ShowClose=True&operation=ImagePresentation&ShowReport=True&SelectorCentricity=Patient&studyUID=2.16.840.1.113662.4.4162725393.939735033.1759523607584223909";

                /* Step 1
                    Load the following URL into a browser Address bar and launch it.( if using a different server change geely to the server name you are using or the IP )
                  http:/icaserver/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&ShowClose=True&operation=ImagePresentation&ShowReport=True&SelectorCentricity=Patient&studyUID=1.2.826.0.1.3680043.2.1208.15048546555201311014426645 */

                login.DriverGoTo(step1_url);
                login.NavigateToIntegratorURL(step1_url);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));

                WebDriverWait wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                string pagurl = BasePage.Driver.Url;
                if (studyviewer.ViewStudy(IntegratedDesktop: true) && string.Equals(step1_url, pagurl))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 2
                // Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;

                // Step 3
                // 	Open the service tool and in the Integrator Tab click Modify and select the Hide True URL from Browser Address bar. IISRESET
                servicetool.LaunchServiceTool();
                servicetool.wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.SelectCheckBox(ServiceTool.Integrator.Name.HideTrueURLfromBrowserAddressBar, 1);
                wpfobject.WaitTillLoad();
                servicetool.ApplyEnableFeatures();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }
                servicetool.RestartService();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                // Step 4
                // Cut and paste the same URL into a new browser window and launch the browser. ( if using a different server change geely to the server name you are using or the IP )
                // http:/icaserver/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&ShowClose=True&operation=ImagePresentation&ShowReport=True&SelectorCentricity=Patient&studyUID=1.2.826.0.1.3680043.2.1208.15048546555201311014426645
                // Expected result: The browsers opens a user is logged in and the study opens in the viewer. 
                // Note the URL at the top the browser in the Address Bar has changed and does not display any of the original information. Typical:
                // http:/geely/WebAccess/IntegratorRedirectHandler.ashx?Id=667fbe91-a7cb-4f3d-932a-61f16714a746 
                login = new Login();

                login.NavigateToIntegratorURL(step1_url);
                PageLoadWait.WaitForPageLoad(40);
                string runtimeUrl = BasePage.Driver.Url;
                if (!step1_url.Equals(BasePage.Driver.Url))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5:
                // Cut and paste the resultant URL from the Address bar in the ICA window into a new Browser window and try to launch the browser. 
                // http:/icaserver/WebAccess/IntegratorRedirectHandler.ashx?Id=667fbe91-a7cb-4f3d-932a-61f16714a746
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(runtimeUrl);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                string ExpectedError = "Error Occurred in operation";
                if (studyviewer.AuthenticationErrorMsg().Text.Contains(ExpectedError))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 6
                // If Encripted URL has not been setup use the Instructions in Hosted14.0 to set it up and enable in it in the service tool.	
                string Encryption_TripleDes_Key = "TripleDES";
                string Encryption_TripleDesA_Key = "TripleDES-A";

                string Encryption_Passpharse_TripleDes_Key = "mergehealthcare";
                string Encryption_Passphares_TripleDes_A_key = "cedaracare";


                servicetool.InvokeServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.EnableFeatures_Tab);
                wpfobject.WaitTillLoad();
                servicetool.wpfobject.ClickButton("Modify", 1);
                wpfobject.WaitTillLoad();
                servicetool.EnablePatient();
                servicetool.EnableMergeEMPI();
                wpfobject.WaitTillLoad();

                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Key Generator");
                String[] TripleDESGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_Passpharse_TripleDes_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] TripleDESAGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_Passphares_TripleDes_A_key, keysize: "192 bit (Key for TripleDES, AES)");

                // Create Encrption Service for "Triple DES"
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDes_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", TripleDESGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDesA_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", TripleDESAGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                wpfobject.WaitTillLoad();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();

                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();
                TextBox ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = "ID-123";
                wpfobject.WaitTillLoad();
                TextBox ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "args";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDes_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = "ID-456";
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = "args";
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDesA_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter("ID-123");
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }


                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = true;
                servicetool.AllowShowSelector().Checked = true;
                TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                SetTimeout.Enter("2");
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                // Step 7
                // Open the TestEHR program and change the 
                // Address to HTTP:\//localhost/webaccess, select auto end session = true, enter an A in the patients Full Name field.
                // Expected result: data entered
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: "http://localhost/webaccess", user: "Administrator", domain: "SuperAdminGroup", autoendsession: "True");
                ehr.SetSearchKeys_Study(PatientName[0], "Patient_Name");
                ExecutedSteps++;

                // Step 8
                // Click on the Use Encryption box and click on Cmd Line button.	
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                if (!url_2.Equals(runtimeUrl))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 9
                // Click on Load to launch ICA.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                string[] columnvalues = ehr.GetColumnValues("Last Name");
                bool ValueSearch = columnvalues.All(lastname => lastname.StartsWith(PatientName[0]));
                if (ValueSearch)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeNodeValue(Config.FileLocationPath, "/IntegratedMode/HideUrl", "False");
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        /// 77887 - Using Encrypted URL - AES URL Encryption
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_77887(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool servicetool = new ServiceTool();
            IntegratorStudies studies = new IntegratorStudies();
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            string Encryption_Service_List_AE256_Key = "AES256";
            string Encryption_Service_List_AES192_Key = "AES192";
            string Encryption_Service_List_AES128_Key = "AES128";
            string Encryption_Service_List_AES128_Key2 = "AES128_2";
            string Encryption_Service_List_AESCustom_Key = "AES_Custom";
            try
            {
                string adminUserName = Config.adminUserName;
                string adminPassword = Config.adminPassword;
                string DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                string DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                string DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                string DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                string DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                string DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);

                string Encryption_Key1 = "Testkey1_" + new Random().Next(1000);
                string Encryption_Key2 = "Testkey2_" + new Random().Next(1000);
                string Encryption_Key3 = "Testkey3_" + new Random().Next(1000);
                string Encryption_Key4 = "Testkey4_" + new Random().Next(1000);
                string Encryption_Key5 = "Testkey5_" + new Random().Next(1000);
                string Encryption_Key6 = "Testkey6_" + new Random().Next(1000);
                string Encryption_Key7 = "Testkey7_" + new Random().Next(1000);
                string Encryption_Key8 = "Testkey8_" + new Random().Next(1000);

                string URL = "http://localhost/webaccess";

                string Encryption_Provider_256_id = "ID_" + new Random().Next(1000);
                string Encryption_Provider_192_id = "ID_192_" + new Random().Next(1000);
                string Encryption_Provider_128_2_id = "ID_128_2_" + new Random().Next(1000);
                string Encryption_Provider_128_id = "ID_128_" + new Random().Next(1000);
                string Encryption_Provider_Custom_id = "ID_Custom_" + new Random().Next(1000);
                string Encryption_Provider_Arg = "arg";

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');

                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNames.Split(':');

                String FirstNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNames.Split(':');

                String Patient_DOBs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String[] Patient_DOB = Patient_DOBs.Split(':');

                String Genders = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
                String[] Gender = Genders.Split(':');

                //  Pre - conditions:  
                // Step 1:
                // From Service Tool create an encryption service using AES:
                // 1.Click the Encryption tab Encryption Service sub-tab
                // 2.Click Add
                // 3.In the Key field, type a name for this encryption service, e.g.AES256
                // 4.In the Assembly field, type OpenContent.Generic.Core.dll
                // 5.In the Class field, type OpenContent.Core.Security.Services.AES
                // 6.To create the service parameters, click Add.
                basepage.UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: "AES256", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                ExecutedSteps++;

                // Step 2
                // Continue from above step
                //    1.Update the fields as described below:
                // Name: key, Class: string, Value: leave it blank for now, Click Apply
                // Name: iv, Class: string, Value: blank, Click Apply.
                // Name: characterSet, Class: string, Value: Windows - 1252, Click Apply
                // Name: operationMode, Class: string, Value: CBC, Click Apply
                // Name: paddingMode, Class: string, Value: Zeros, Click Apply
                // 2.When your updates are complete, click OK in Service Parameter Entry form.
                // 3.Click Apply then Ok.
                // 4.Click Restart IIS and Windows Services to apply the changes you have made.
                servicetool.EnterServiceParameters("key", "string", "");
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                ExecutedSteps++;

                // Step 3
                // Pre-condition3:
                // 1.Click the Key Generator sub-tab.
                // 2.In the Plain Text Key field, type a text string.This string is used to generate the Base64 encryption key.
                // 3.Select key size '256 bit (Key for AES)'
                // 4.Click Generate Key.
                // 5.Copy the data in the Base64 field and enter it in the 'Key' service parameter 'Value' field that was left blank in Pre - condition2
                servicetool.NavigateSubTab("Key Generator");
                String[] testkey1 = servicetool.GenerateEncryptionKeys(Encryption_Key1, keysize: "256 bit (Key for AES");
                servicetool.EditServiceParameters("Key", "AES256", "Name", "key", Value: testkey1[0]);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                // Step 4
                // 	In the Key Generator sub-tab enter a different passphrase for key, e.g. testkey2
                // Select a key size '256 bit (key for AES)' dropdown list Click Generate key
                // Verify keys are generated with different values
                String[] testkey2 = servicetool.GenerateEncryptionKeys(Encryption_Key2, keysize: "256 bit (Key for AES");
                if (!testkey1[0].Equals(testkey2[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 5
                //	In the Key Generator sub-tab select a key size '192 bit (Key for TripleDES, AES)' from the list
                // Click Generate key. Verify keys are generated with different values
                String[] testkey3 = servicetool.GenerateEncryptionKeys(Encryption_Key3, keysize: "192 bit (Key for TripleDES, AES)");
                if (!testkey1[0].Equals(testkey3[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step6
                // In Select Key size list select 'Choose custom size it bit'
                //Enter some valid key size(multiple of 8); Note that ICA current only support keysize values 128, 192 and 256 bit for AES.
                //Verify that keys are generated successfully.
                String[] testkey4 = servicetool.GenerateEncryptionKeys(Encryption_Key4, keysize: "Choose custom size in bit", keytext: "192");
                ExecutedSteps++;

                // Step 7
                // Repeat above step for the rest key sizes available in the list
                // Verify keys are generated with different values
                String[] testkey5 = servicetool.GenerateEncryptionKeys(Encryption_Key5, keysize: "128 bit (key for TripleDES, AES | IV for AES)");
                String[] testkey6 = servicetool.GenerateEncryptionKeys(Encryption_Key6, keysize: "64 bit (IV for TripleDES)");
                String[] testkey7 = servicetool.GenerateEncryptionKeys(Encryption_Key7, keysize: "192 bit (Key for TripleDES, SHA1) - Legacy");
                String[] testkey8 = servicetool.GenerateEncryptionKeys(Encryption_Key8, keysize: "128 bit (key for TripleDES, AES | IV for AES)");
                ExecutedSteps++;

                // Step 8
                // Pre - condition4:
                // Configuring the Application to Use an Encryption Service
                // 1.Click the Encryption tab, then click the Integrator URL sub-tab.
                // 2.Click Modify
                // 3.In the ID field, type a unique identifier for the encryption provider
                // 4.Enter Argument Name = arg
                // 5.In the Encryption Service drop - down list, select the encryption service you created
                servicetool.NavigateToTab("Encryption");
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                //wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                TextBox ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_256_id;
                wpfobject.WaitTillLoad();
                TextBox ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = Encryption_Provider_Arg;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AE256_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.ClickButton("Apply", 1);
                wpfobject.WaitForPopUp();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    wpfobject.WaitForPopUp();
                }
                catch (Exception e)
                { }
                ExecutedSteps++;

                // Step 9
                // 	Pre-condition:
                // On the iCA sever modify web.config file under C:\WebAccess\WebAccess\IntegratorAuthenticationSTS\ by uncommenting section:
                // *^<^ *!--authProvider id = "Bypass"class="Sample.HostIntegration.Authentication.BypassAuthenticator"assembly="Sample.HostIntegration"*^>^*
                // *^<^*/authProvider--*^>^* IISRESET At least one datasources must be available for testing.

                basepage.UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");
                servicetool.RestartService();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                // Step 10
                // URL Encryption is disabled in Service Tool]
                // 1.Ensure option ' URL Encryption Enabled' is not selected in Service Tool\Encryption tab\Integration Url sub - tab.
                // 2.From test server, start TestEHR tool (TestEHR.exe)Image Load tab, set Show Selector to False
                // 3.Enter Patient Last Name, First Name, DOB and Gender of a patient study existing in the configured data source.
                // 4.uncheck Use Encryption(Time Stamp)
                // 5.Cmd line, Load
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                WebDriverWait wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 11
                // 	Exam the generated Url
                // expected result :  When encryption is not enabled, query parameters are visible in the generated URL query string,
                // e.g., entered patient name, DOB, gender and logins etc. are visible in the URL query string. For example: 
                // http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&
                // SecurityID =Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&patientID=11111
                // &patientFirstName=MRI&patientLastName=ANKLE&patientGender=M&patientDOB=20-Nov-1958 12

                bool IsPatientLastNameExist = url_2.Any(msg => url_2.Contains("patientLastName"));
                bool IsPatientFirstNameExist = url_2.Any(msg => url_2.Contains("patientFirstName"));
                bool IsPatientDOBExist = url_2.Any(msg => url_2.Contains("patientDOB"));
                bool IsPatientGenderExist = url_2.Any(msg => url_2.Contains("patientGender"));
                // if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist)
                if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist && IsPatientGenderExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 12
                // Close the browser, From TestEHR tool Image Load tab, clear patient search keys. 
                // Enter Accession number of a study that matches one study in configured data source. Click Cmd line and click Load
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // STep 13
                // IsAccessionNumberExist
                // When encryption is not enabled, query parameters are visible in the generated URL query string, 
                // e.g., entered accession number and logins etc. are visible in the URL query string.
                // For example: http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&accessionNumber=123df45
                bool IsAccessionNumberExist = url_2.Any(msg => url_2.Contains("accessionNumber=" + AccessionId[0]));
                if (IsAccessionNumberExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 14
                // Repeat above step by entering a StudyUID that matches one study in configured data source.Click Cmd line and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 15
                // Exam the generated Url	
                // When encryption is not enabled, query parameters are visible in the generated URL query string, 
                // e.g., entered StudyUID and logins etc. are visible in the URL query string. 
                // For example: http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=iCADatabase&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&studyUID=1.2.124.113532.1.1.3.0.8.92.20020423164900.390.137

                bool IsStudyUIDExist = url_2.Any(msg => url_2.Contains("studyUID=" + StudyUID[0]));
                if (IsStudyUIDExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 16
                // 	Close the browser. From TestEHR tool Image Load tab, check on 'Use Encryption(TimeStamp) box, click Cmd line and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                ehr.clickCmdLine("ImageLoad");
                wpfobject.WaitForPopUp();
                String data = servicetool.WarningDialogWindow();
                if (data.Equals("An encryption provider must be selected if encryption is enabled"))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 17
                // [URL Encryption is enabled with Keysize=256 bit (Key for AES)]
                // 1.Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize '256 bit (key for AES)'
                // 2.Ensure option 'URL Encryption Enabled' is SELECTED in Service Tool\Encryption tab\Integration Url sub - tab.
                // 2.From test server, start TestEHR tool (TestEHR.exe)Image Load tab, set Show Selector to False
                // 3.Enter Patient Last Name, First Name, DOB and Gender of a patient study existing in the configured data source.
                // 4.Select the Encryption Provider generated from keysize '256 bit (Key for AES)'
                // 5.Select Use Encryption(Time Stamp) option 6.Cmd line, Load
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();
                ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_256_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    wpfobject.WaitTillLoad();

                }
                catch (Exception e)
                {

                }
                servicetool.RestartService();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18
                // Exam the generated Url	
                // When encryption is enabled, query parameters are NOT visible in the generated URL query string, e.g., entered patient name, DOB, gender and logins etc. 
                // are NOT visible in the URL query string.For example:
                // http:/localhost/WebAccess/Default.ashx?encryptionProvider=AES1&arg1=E9FHC9b0yKMuFhpNK3lvROwMXjSStFUZfMrxzJwB9DYEElWg%2fmqqWLPVOVzN96gmXlHp19RzE5FBaXoUm3GnPcaSvoChZ2eH%2fj8DHLorXxNInjLEbE%2fbXOF4uQW5gcDvMwQnH1Fhun0xIIsnnEcDzYN%2frJFrgCOizj39q4LOLPYhp43lU%2bXWJ56WwXTCwbxCHq8%2bfxTOfJ3BABWz7lx%2femtFaPePcog2ubJ%2bBlpABwqh8phK3Bx1T6lJLV20b9oT7Eau5xB8cSBj3O1v%2fgDyCV7xABx%2bk1vOfnUuFqPsErx6VuuGnEm55U3mfqRvtwobhiBaeLdvefriQmXOg16vYa4bUcXpfTYZBCrhhhB3zhfSTV2iq%2fnhiPRQ5akj6BNutqr7SyHwSLbI0SnUF8sTanFOzrB6j5ete1uViJDO%2br4%3d
                IsPatientLastNameExist = url_2.Any(msg => url_2.Contains("patientLastName"));
                IsPatientFirstNameExist = url_2.Any(msg => url_2.Contains("patientFirstName"));
                IsPatientDOBExist = url_2.Any(msg => url_2.Contains("patientDOB"));
                IsPatientGenderExist = url_2.Any(msg => url_2.Contains("patientGender"));
                // if (!IsPatientLastNameExist && !IsPatientFirstNameExist && !IsPatientDOBExist)
                if (!IsPatientLastNameExist && !IsPatientFirstNameExist && !IsPatientDOBExist && !IsPatientGenderExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 19
                // Close the browser. From TestEHR tool Image Load tab, uncheck 'Use Encryption(TimeStamp) box, click Cmd line and click Load.
                // The matching study can't be loaded into 2D view. Error Occurred in operation message displays indicating URL is not properly encrypted.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.UnSelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                // ehr.CloseEHR();
                // login.DriverGoTo(url_2);
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                if (BasePage.Driver.FindElement(By.CssSelector("span#m_title")).Text.Contains("URL is not properly encrypted"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 20
                // Exam the generated Url
                // The query string is not encrypted, e.g., query parameters are visible in the URL query string, From example:
                // http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&patientID=11111&patientFirstName=MRI&patientLastName=ANKLE&patientGender=M&patientDOB=20-Nov-1958
                IsPatientLastNameExist = url_2.Any(msg => url_2.Contains("patientLastName"));
                IsPatientFirstNameExist = url_2.Any(msg => url_2.Contains("patientFirstName"));
                IsPatientDOBExist = url_2.Any(msg => url_2.Contains("patientDOB"));
                IsPatientGenderExist = url_2.Any(msg => url_2.Contains("patientGender"));
                // if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist)
                if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist && IsPatientGenderExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 21
                // Close the browser, From TestEHR tool Image Load tab, clear search keys. Enter Accession number of a study that matches one study in 
                // configured data source. Select Use Encryption (Time Stamp) option. Click Cmd line and click Load.	 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 22
                // Exam the generated Url	
                // When encryption is enabled, query parameters are NOT visible in the generated URL query string, e.g., entered accession number and logins etc. are NOT visible in the URL query string. For example: 
                // http:/localhost/WebAccess/Default.ashx?encryptionProvider=AES1&arg1=E9FHC9b0yKMuFhpNK3lvROwMXjSStFUZfMrxzJwB9DYEElWg%2fmqqWLPVOVzN96gmXlHp19RzE5FBaXoUm3GnPcaSvoChZ2eH%2fj8DHLorXxNInjLEbE%2fbXOF4uQW5gcDvMwQnH1Fhun0xIIsnnEcDzYN%2frJFrgCOizj39q4LOLPYhp43lU%2bXWJ56WwXTCwbxCHq8%2bfxTOfJ3BABWz7lx%2femtFaPePcog2ubJ%2bBlpABwpnzgVC3sHdwM1SML22yD0AAIQQqkwaTPzLo05TFWA%2bz9Hh2jMBuw5qwkUsQLx8keHooGr1T%2fA0DRVslyOGItAU
                IsAccessionNumberExist = url_2.Any(msg => url_2.Contains("accessionNumber=" + AccessionId[0]));
                if (!IsAccessionNumberExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 23
                // Close the browser. From TestEHR tool Image Load tab, uncheck 'Use Encryption(TimeStamp) box, click Cmd line and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
                wpfobject.UnSelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                // login.DriverGoTo(url_2);
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                if (BasePage.Driver.FindElement(By.CssSelector("span#m_title")).Text.Contains("URL is not properly encrypted"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 24
                // Exam the generated Url	
                IsAccessionNumberExist = url_2.Any(msg => url_2.Contains("accessionNumber=25061603"));
                if (IsAccessionNumberExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 25
                // Close the browser, From TestEHR tool Image Load tab, clear search keys. Enter 
                // StudyUID of a study that matches one study in configured data source. Select Use Encryption (Time Stamp) option. Click Cmd line and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 26
                // Exam the generated Url
                // When encryption is enabled, query parameters are NOT visible in the generated URL query string, e.g., enteredStudyUID and logins etc. 
                // are NOT visible in the URL query string.For example:
                // http:/localhost/WebAccess/Default.ashx?encryptionProvider=AES1&arg1=E9FHC9b0yKMuFhpNK3lvROwMXjSStFUZfMrxzJwB9DYEElWg%2fmqqWLPVOVzN96gmXlHp19RzE5FBaXoUm3GnPcaSvoChZ2eH%2fj8DHLorXxNInjLEbE%2fbXOF4uQW5gcDvMwQnH1Fhun0xIIsnnEcDzYN%2frJFrgCOizj39q4LOLPYhp43lU%2bXWJ56WwXTCwbxCHq8%2bfxTOfJ3BABWz7lx%2femtFaPePcog2ubJ%2bBlpABwqHT3jioBInr6djTuboSXF%2f%2fbo35JuHxz9EuJWxcdpCxX43kn2vv%2bTrIFBdnNnxAezJMjTlCODCp0H4O4aXd5XjMpgH9zPEua8qv5knSQXB2k%2bua2gtMNX9D8QsSyehzAw%3d
                IsStudyUIDExist = url_2.Any(msg => url_2.Contains("studyUID=" + StudyUID[0]));
                if (!IsStudyUIDExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 27 
                // Close the browser. From TestEHR tool Image Load tab, uncheck 'Use Encryption(TimeStamp) box, click Cmd line and click Load.	
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                wpfobject.UnSelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                // login.DriverGoTo(url_2);
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                if (BasePage.Driver.FindElement(By.CssSelector("span#m_title")).Text.Contains("URL is not properly encrypted"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 28
                // Exam the generated Url	
                // The query string is not encrypted, e.g., query parameters are visible in the URL query string, From example:
                // http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&studyUID=1.2.124.113532.1.1.3.0.8.92.20020423164900.390.137
                IsStudyUIDExist = url_2.Any(msg => url_2.Contains("studyUID=" + StudyUID[0]));
                if (IsStudyUIDExist)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 29
                // [URL Encryption is enabled with keysize = 192 bit (Key for TripleDES, AES)]
                // 1.Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize '192bit (key for TripleDES, AES)'
                // 2.Start TestEHR tool
                // 3.Enable Use Encryption (Time Stamp) option
                // 4.Click Cmd line and click Load
                // 5.Exam the generated Url

                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: "AES192", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", testkey3[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab("Encryption");
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_192_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = Encryption_Provider_Arg;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AES192_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();

                DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_192_id);

                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 30
                // [URL Encryption is enabled with keysize = 128 bit (key for TripleDES, AES | IV for AES)]
                // 1.Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize '128 bit (key for TripleDES, AES | IV for AES)'
                // 2.Start TestEHR tool
                // 3.Enable Use Encryption (Time Stamp) option
                // 4.Click Cmd line and click Load
                // 5.Exam the generated Url
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: "AES128", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", testkey5[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab("Encryption");
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_128_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = Encryption_Provider_Arg;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AES128_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();

                DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_128_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                // 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }




                // Step 31
                // [URL Encryption is enabled with keysize = 128 bit (key for TripleDES, AES | IV for AES)]
                // 1. Ensure the AES Encryption Service 'key' and 'iv' values are using Base64 Encoded Key generated by keysize '128 bit (key for TripleDES, AES | IV for AES)'
                // 2. Repeat above steps using this Encryption Provider

                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: "AES128_2", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", testkey8[0]);
                servicetool.EnterServiceParameters("iv", "string", testkey8[0]);
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab("Encryption");
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_128_2_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = Encryption_Provider_Arg;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AES128_Key2);
                wpfobject.ClickButton("Add", 1);
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();

                DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_128_2_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                wpfobject.WaitTillLoad();

                // 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 32
                // [URL Encryption is enabled with keysize = Choose custom size in bit]
                // Note that ICA current only support keysize values 128, 192 and 256bit for AES.
                // 1. Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize 'Choose custom size in bit'
                // 2. Start TestEHR tool
                // 3. Enable Use Encryption (Time Stamp) option
                // 4. Click Cmd line and click Load
                // 5. Exam the generated Url

                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: "AES_Custom", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", testkey4[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();

                servicetool.NavigateToTab("Encryption");
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_Custom_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = Encryption_Provider_Arg;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AESCustom_Key);
                wpfobject.ClickButton("Add", 1);

                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();

                DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_Custom_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try
                {
                    wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                }
                catch (Exception e)
                { }
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                // 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                // login.DriverGoTo(url_2); //
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Final Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AE256_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AE256_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES192_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES192_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key2 + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key2 + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AESCustom_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AESCustom_Key + "']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test1_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 1: iCA server under testing is configured and is able to load images from the connected data sources
                ExecutedSteps++;
                //Step 2: Required test date in data source
                ExecutedSteps++;
                //Step 3: Configure EHR
                ExecutedSteps++;
                //Step 4: Set as following values in configuration files:
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "False");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 5: In the TestEHR tool set True, True
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 6: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 7: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 8: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 9: Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 10: Now add the patient First Name with multiple priors, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 11: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 12: Change patient last name and first name, where this is the only study in the data source, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 13: In the TestEHR tool, change the following settings only: Show Selector = false Show Selector Search = false Enter Accession number to search a patient with multiple priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 14: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 15: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 16: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 17: Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 18: Now add the patient First Name with multiple priors, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 19: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(FirstName[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 20: Change patient last name and first name, where the patient only has no priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(LastName[1].ToLowerInvariant()) && viewer.PatientInfo().ToLowerInvariant().Contains(FirstName[2].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test2_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 21: In the TestEHR tool, change the following settings only Show Selector = blank Show Selector Search = blank Enter Accession number to search a patient with multiple priors
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 22: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 23: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 24: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 25: Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 26: Now add patient First Name where the patient has multiple priors , and launch URL
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 27: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 28: Change patient last name and first name, where the patient only has no priors
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test3_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            int resultcount = 0;
            DataTable intgrtable = null;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 29: Set as following values in configuration files: Show Error  true false
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 30: TestEHR tool set True, True
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                string[] columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, AccessionNumber[0], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 31: Replace a Accession number which is unique among these priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, AccessionNumber[1], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 32: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 33: Enter a Study UID from a patient with multiple priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, StudyUID[1], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 34: Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 35: Now add the patient First Name with multiple priors, and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 36: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 37: Change patient last name and first name, where this is the only study in the data source, and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 38: TestEHR tool set False False
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 39: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 40: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 41: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 42: Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 43: Now add the patient First Name with multiple priors, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 44: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(FirstName[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 45: Change patient last name and first name, where the patient only has no priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(LastName[1].ToLowerInvariant()) && viewer.PatientInfo().ToLowerInvariant().Contains(FirstName[2].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test4_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            int resultcount = 0;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                //Step 46: TestEHR tool set blank
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 47: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 48: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 49: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 50: Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 51: Now add patient First Name where the patient has multiple priors , and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 52: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 53: Change patient last name and first name, where the patient only has no priors
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (!basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is hidden");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test5_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            int resultcount = 0;
            DataTable intgrtable = null;
            string[] columnvalue = null;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 54: Set as following values in configuration files: Show Error  true true
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 55: TestEHR tool set True, True
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, AccessionNumber[0], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 56: Replace a Accession number which is unique among these priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, AccessionNumber[1], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 57: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 58: Enter a Study UID from a patient with multiple priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, StudyUID[1], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 59: Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 60: Now add the patient First Name with multiple priors, and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 61: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 62: Change patient last name and first name, where this is the only study in the data source, and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 63: TestEHR tool set False, False
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 64: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 65: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 66: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 67: Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 68: Now add the patient First Name with multiple priors, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 69: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(LastName[2].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 70: Change patient last name and first name, where the patient only has no priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(LastName[1].ToLowerInvariant()) && viewer.PatientInfo().ToLowerInvariant().Contains(FirstName[2].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test6_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            int resultcount = 0;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                servicetool.RestartIISUsingexe();
                //Step 71: TestEHR tool set Blank, Blank
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 72: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 73: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 74: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 75: Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 76: Now add patient First Name where the patient has multiple priors , and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study("Brad", FirstName[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 77: Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 78:Change patient last name and first name, where the patient only has no priors
                resultcount = 0;
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[2]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test7_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            int resultcount = 0;
            DataTable intgrtable = null;
            string[] columnvalue = null;
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 79: Set as following values in configuration files: Show Selector true true
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Selector");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 80: TestEHR tool set Blank, True
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, AccessionNumber[0], StringComparison.OrdinalIgnoreCase)))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 81: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 82: Enter a few Accession numbers from different patients, where they have priors. Launch URL
                resultcount = 0;
                string accession = string.Concat(AccessionNumber[1], "\\", AccessionNumber[0]);
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(accession);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => accession.ToLowerInvariant().Contains(cv.ToLowerInvariant())))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Accession number");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 83: Select 1 study from each patient found in the Study Selector, View
                basepage.ClickElement(integratorstudies.Intgtr_CheckBoxes()[0]);
                basepage.ClickElement(integratorstudies.Intgr_ViewBtn());
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 84: Open History tab
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                integratorstudies.NavigateToHistoryPanel();
                integratorstudies.ChooseColumns(new String[] { "Study UID", "Accession" });
                string[] accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (accessionIds.All(acid => accession.ToLowerInvariant().Contains(acid.ToLowerInvariant())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 85: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 86: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary>
        public TestCaseResult Test8_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(';');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 87: Set as following values in configuration files: Load Oldest  true true
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Load Oldest");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 88: TestEHR tool set blank, false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[0].Split('=')[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[0].Split('=')[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 89: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 90: Enter a few Accession numbers from different patient, where they have priors. Launch URL
                string accession = string.Concat(AccessionNumber[1], "\\", AccessionNumber[0].Split('=')[0]);
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(accession);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 91: Open History tab.
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                integratorstudies.NavigateToHistoryPanel();
                integratorstudies.ChooseColumns(new String[] { "Study UID", "Accession" });
                string[] accessionIds = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (accessionIds.All(acid => accession.ToLowerInvariant().Contains(acid.ToLowerInvariant())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 92: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 93: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        /// Rebranding on Integration
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_91853(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            TestCaseResult result = null;
            int executedSteps = -1;
            String imagepath = @"C:\WebAccess\WebAccess\Images";
            IList<String> images = new List<String>() { "WebAccessLoginLogo.PNG", "MergeLoginLogo.PNG", "Logout.PNG" };
            EHR ehr = new EHR();
            String accession = String.Empty;

            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                //Step-1 - EHR Setup
                executedSteps++;

                //Step-2 - Replace Files - Logout.png, MergeLoginLogo and WebAccessLoginLogo
                //Take backup                
                foreach (String image in images)
                {
                    var sourcefile = imagepath + Path.DirectorySeparatorChar + image;
                    var destfilename = Config.downloadpath + Path.DirectorySeparatorChar + image;
                    File.Copy(sourcefile, destfilename, true);
                }

                //Replace Image files
                foreach (String image in images)
                {
                    var source = "TestData" + Path.DirectorySeparatorChar + this.GetType().Name.ToString()
                    + Path.DirectorySeparatorChar + testid + Path.DirectorySeparatorChar + image;

                    File.Copy(source, imagepath + Path.DirectorySeparatorChar + image, true);
                }
                executedSteps++;

                //Step-3 - Login and perform validation of Logo(Instituition Name)
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.DriverGoTo(login.url);
                PageLoadWait.WaitForFrameLoad(10);
                executedSteps++;
                var step = result.steps[executedSteps];
                step.SetPath(testid, executedSteps, 1);
                var mergelogo = BasePage.Driver.FindElement(By.CssSelector("div[id$='_MergeLogoDiv']"));
                var webaccesslogo = BasePage.Driver.FindElement(By.CssSelector("div[id$= '_WebAccessLogoDiv']"));
                var step3_1 = login.CompareImage(step, mergelogo);
                step.SetPath(testid, executedSteps, 2);
                var step3_2 = login.CompareImage(step, webaccesslogo);
                if (step3_1 && step3_2)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step-4 - Launch Study and validate                
                ehr.LaunchEHR();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", user: "Administrator");
                WpfObjects._mainWindow.Get(TestStack.White.UIItems.Finders.SearchCriteria.ByAutomationId("m_accessionNumberTextBox")).SetValue(accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA77), "Datasource");
                var url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                var viewer = ehr.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                PageLoadWait.WaitForAllViewportsToLoad(20);
                ehr.NavigateToIntegratorFrame();
                executedSteps++;
                var step4 = result.steps[executedSteps];
                step4.SetPath(testid, executedSteps);
                //var Ele_viewer = BasePage.Driver.FindElement(By.CssSelector("#Viewport_One_1_0 > canvas:nth-child(8)"));
                var Ele_viewer = viewer.SeriesViewer_1X1();
                var step4_1 = login.CompareImage(step4, Ele_viewer);
                if (step4_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Step-5-Logout and Validate
                String logouturl = ehr.ClickLogout();
                BasePage.Driver.Navigate().GoToUrl(logouturl);
                ehr.CloseEHR();
                PageLoadWait.WaitForPageLoad(20);
                executedSteps++;
                var step5 = result.steps[executedSteps];
                step5.SetPath(testid, executedSteps);
                var splashscreen = BasePage.Driver.FindElement(By.CssSelector("body>img"));
                var step5_1 = login.CompareImage(step5, splashscreen);
                if (step5_1)
                {
                    result.steps[executedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[executedSteps].description);
                }
                else
                {
                    result.steps[executedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[executedSteps].description);
                    result.steps[executedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, executedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }

            finally
            {
                //Replace Image files
                foreach (String image in images)
                {
                    var srcfile = Config.downloadpath + Path.DirectorySeparatorChar + image;
                    var destfile = imagepath + Path.DirectorySeparatorChar + image;
                    File.Copy(srcfile, destfile, true);
                }
            }
        }

        /// <summary> 
        /// ShowSelector and ShowSelectorSearch in WebaccessConfiguration file
        /// </summary> 
        public TestCaseResult Test9_27980(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(';');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split(':');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //Step 94: Set as following values in configuration files: Load Newest  true true
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Load Newest");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 95: TestEHR tool set blank, blank
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[0].Split('=')[0]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[0].Split('=')[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 96: Replace a Accession number which is unique among these priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(AccessionNumber[1]);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains(AccessionNumber[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 97: Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 98: Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(StudyUID[0].Split('-')[0], "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains(StudyUID[0].Split('-')[1].ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 99: Enter a few Study UIDs from different patient, where they have priors.
                string Study_UID = string.Concat(StudyUID[1], "\\", StudyUID[2]);
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(Study_UID, "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.AuthenticationMultiplePatientErrorMsg().Text.Equals(MultiplePatientErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 100: Open History tab.
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("studies");
                integratorstudies.NavigateToHistoryPanel();
                integratorstudies.ChooseColumns(new String[] { "Study UID", "Accession" });
                string[] studyuid = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Study UID", BasePage.GetColumnNames());
                if (studyuid.All(suid => Study_UID.ToLowerInvariant().Contains(suid.ToLowerInvariant())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        ///  90029 Generating URL using two encryption services 
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_90029(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool servicetool = new ServiceTool();
            IntegratorStudies studies = new IntegratorStudies();
            TestCaseResult result = null;
            int ExecutedSteps = -1;
            string Encryption_AES_Key = "AES_" + new Random().Next(1000);
            string Encryption_TripleDes_Key = "TripleDES_" + new Random().Next(1000);
            string Encryption_HALO_Key = "HALO_" + new Random().Next(1000);
            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                string Encryption_Provider_AES_id = "ID_AES_" + new Random().Next(1000);
                string Encryption_Provider_TripleDES_id = "ID_TripleDES_" + new Random().Next(1000);
                string Encryption_Provider_HALO_id = "ID_HALO_" + new Random().Next(1000);

                string ArgmentName = "encrpyt";

                TextBox ID;
                TextBox ArugumentName;
                ComboBox EhrEncryptionProvider;


                string adminUserName = Config.adminUserName;
                string adminPassword = Config.adminPassword;
                string DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                string DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                string DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                string DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                string DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                string DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);
                string URL = "http://localhost/webaccess";

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');

                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNames.Split(':');

                String FirstNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNames.Split(':');

                String Patient_DOBs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String[] Patient_DOB = Patient_DOBs.Split(':');

                String Genders = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
                String[] Gender = Genders.Split(':');

                // Precondition:
                // Create three keys 
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Key Generator");

                String[] AESGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_AES_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] TripleDESGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_TripleDes_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] HALOGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_HALO_Key, keysize: "192 bit (Key for TripleDES, AES)");

                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDes_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", TripleDESGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_AES_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", AESGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_HALO_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.HaloCryptographyWrapper");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("password", "string", "amicas");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();


                // Create a Provide list for 
                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_AES_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = ArgmentName;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_AES_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_TripleDES_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = ArgmentName;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDes_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_HALO_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = ArgmentName;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_HALO_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_TripleDES_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try { wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1); } catch (Exception e) { }

                //wpfobject.SelectTabFromTabItems("External Application");
                //wpfobject.ClickButton("Add", 1);
                //servicetool.EnterExternalApplicationSettingsParameters("HALO", "Halo Application", "amicaspacs HALOPACS", "80", false, "servlet/com.amicas.servlet.integration.EmbeddedGateway", "Browser", "unixTicks,milliseconds,0", false);
                //servicetool.EnterExternalApplicationEncryptionParameters("auth", "Cryptographic.HALO.RC4");
                //servicetool.EnterExternalApplicationUrlParameterEntryForm("TS", "Dynamic", "Application.TimeStamp", true);
                //servicetool.EnterExternalApplicationUrlParameterEntryForm("ID", "Dynamic", "Patient.PatientID", true);
                //servicetool.EnterExternalApplicationUrlParameterEntryForm("SID", "Dynamic", "Study.UID", true);

                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                // Step 1:
                // Launch TestEHR application->Image Load tab-> Enter all the required information->Select "Use Encryption" checkbox.
                // Select Triple DES encryption from the list
                // Note: Triple DES encryption is made as default in Integrator tab from iCA Service tool

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_TripleDES_id);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                // Step 2:
                // Generate an URL and launch it in browser	

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                WebDriverWait wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 3:
                // Select HALO encryption service from the list and generate URL -> Launch it in browser	

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_HALO_id);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 4
                // Select Default encryption checkbox from TestEHR -> Generate and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                wpfobject.SelectCheckBox("Default");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5
                // Make HALO encryption service as default from Integrator tab under iCA Service tool -> Restart services
                servicetool.InvokeServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();
                DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_HALO_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try { wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1); } catch (Exception e) { }
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                // Step 6
                // Select HALO encryption from encryption provider list in TestEHR -> Generate and launch URL	

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_HALO_id);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 7
                // Select Triple DES encryption from the list -> Generate and launch URL	
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_TripleDES_id);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                // Step 8:
                // Select Default encryption checkbox from TestEHR -> Generate and launch URL	
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                wpfobject.SelectCheckBox("Default");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                BasePage.wait.Until(ExpectedConditions.FrameToBeAvailableAndSwitchToIt(By.CssSelector("#IntegratorHomeFrame")));
                wait1 = new WebDriverWait(BasePage.Driver, new TimeSpan(0, 0, 150));
                wait1.Until(ExpectedConditions.ElementExists(By.CssSelector("#studyPanelDiv_1")));
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], studyviewer.studyPanel());
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);

                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_TripleDes_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_TripleDes_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_HALO_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_HALO_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AES_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AES_Key + "']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        ///  91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test1_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                //Step 1: In WebaccessConfiguration.xml set false false
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "False");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                ExecutedSteps++;
                //Step 2: In Webaccess set "Show Error"
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 3: In TestEHR set ShowSelector = true
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True");
                ExecutedSteps++;
                //Step 4: Set patientLastName=<patient's last name>, and launch URL.
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 5: Now add patientFirstName=<patient's First name>, and launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 6: Set patientLastName=<patient's Last name>, and launch URL. Note: Patient should have single study in the domain
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 7: Now add patienFirstName=<patient's First name>, and launch URL. 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: system override settings don't allow showing the selector. please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 8: In TestEHR set ShowSelector = false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False");
                ExecutedSteps++;
                //Step 9: Set patientLastName=<patient's last name>, and launch URL. 
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study("", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 10: Now add patientFirstName=<patient's First name>, and launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 11: Set patientLastName=<patient's Last name>, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study("", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains("andrews, pat (129335)"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 12: Now add patienFirstName=<patient's First name>, and launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.PatientInfo().ToLowerInvariant().Contains("andrews, pat (129335)"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 13: Leave all patient/study fields empty
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        ///  91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test2_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            int resultcount = 0;
            string url = string.Empty;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                //PreCondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                //Step 14: In WebaccessConfiguration.xml set True, False
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "False");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 15: In TestEHR set ShowSelectorSearch= False
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ExecutedSteps++;
                //Step 16: Set patientLastName=<patient's last name>, and launch URL
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 17: Now add patientFirstName=<patient's First name>, and launch URL. 
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", LastName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[0]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 18: Set patientLastName=<patient's Last name>, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study("", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 19: Now add patienFirstName=<patient's First name>, and launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", LastName[1]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", FirstName[1]))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 20: Leave all patient/study fields empty
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 21: In TestEHR set ShowSelector = false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSelectorOptions(showSelector: "False");
                ExecutedSteps++;
                //Step 22: Set patientLastName=<patient's last name>, and launch URL.
                ehr.SetSearchKeys_Study(LastName[2], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 23: Now add patientFirstName=<patient's First name>, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[2], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[2], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 24: Set patientLastName=<patient's Last name>, and launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study("", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.PatientInfo().ToLowerInvariant().Contains("ANDREWS, PAT (129335)".ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 25: Now add patienFirstName=<patient's First name>, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.PatientInfo().ToLowerInvariant().Contains("ANDREWS, PAT (129335)".ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 26: Leave all patient/study fields empty
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// 91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test3_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            IntegratorStudies integratorstudies = null;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            /*string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');*/
            int resultcount;
            int ExecutedSteps = -1;
            result.SetTestStepDescription(teststeps);

            try
            {
                //Step 27: In WebaccessConfiguration.xml set True, True
                // Expected result : Pre-Condition is completed

                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;

                //Step 28: Set patientLastName=<patient's last name>, and launch URL. Note: Patient should have multiple studies in the domain
                // Expected result : Multiple studies that matching the searched last name should listed. Plus patient search area should shown.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("Raufel", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                resultcount = 0;
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }

                if (ehr.VerifyPatientDetails("Last Name", "Raufel"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 29: Now add patientFirstName=<patient's First name>, and launch URL.
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("Raufel", "Last_Name");
                ehr.SetSearchKeys_Study("Newton", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", "Raufel"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", "Newton"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 30: Set patientLastName=<patient's Last name>, and launch URL. Note: Patient should have single study in the domain
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("Andrews", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", "Andrews"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 31: Now add patienFirstName=<patient's First name>, and launch URL. 
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("Andrews", "Last_Name");
                ehr.SetSearchKeys_Study("Pat", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (basepage.IsElementVisible(integratorstudies.SearchPanel()))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Search area is Shown");
                }
                if (ehr.VerifyPatientDetails("Last Name", "Andrews"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", "Pat"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 32: Leave all patient/study fields empty
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "True", showSelector: "True", showReport: "True");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 33: In TestEHR set ShowSelectorSearch= false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("datasource", "All");
                ExecutedSteps++;
                //Step 34: Set patientLastName=<patient's last name>, and launch URL.
                ehr.SetSearchKeys_Study("Raufel", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", "Raufel"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 35: Now add patientFirstName=<patient's First name>, and launch URL. 
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("datasource", "All");
                ehr.SetSearchKeys_Study("Raufel", "Last_Name");
                ehr.SetSearchKeys_Study("Newton", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", "Raufel"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", "Newton"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 36: Set patientLastName=<patient's Last name>, and launch URL. Note: Patient should have single study in the domain
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("datasource", "All");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("Andrews", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", "Andrews"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 37: Now add patienFirstName=<patient's First name>, and launch URL. 
                resultcount = 0;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("datasource", "All");
                ehr.SetSearchKeys_Study("Andrews", "Last_Name");
                ehr.SetSearchKeys_Study("Pat", "First_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                if (ehr.VerifyPatientDetails("Last Name", "Andrews"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the Last Name");
                }
                if (ehr.VerifyPatientDetails("First Name", "Pat"))
                {
                    resultcount++;
                    Logger.Instance.InfoLog("The Study Selector exactly matching the First Name");
                }
                if (resultcount == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 38: Leave all patient/study fields empty
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSelectorOptions(selectorsearch: "False", showSelector: "True", showReport: "True");
                ehr.SetSearchKeys_Study("datasource", "All");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// 91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test4_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            /*string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');*/
            int ExecutedSteps = -1;
            result.SetTestStepDescription(teststeps);

            try
            {
                //Step 39: Set as following values in configuration files: Show Error  true true
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ExecutedSteps++;
                //Step 40: Enter Accession number and launch URL
                ehr.SetSearchKeys_Study("A120986");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: more than one patient and/or study was found that match the search criteria. each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 41: Add Study UID of study with Accession number and launch URL
                ehr.SetSearchKeys_Study("1.2.276.0.7230010.3.1.4.25399938.3924.13793896.01", "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.StudyInfo().ToLowerInvariant().Contains("A120986, 26-Oct-1998 7:13:02 AM".ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                /*if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: other search criteria must not be specified when study instance uid is provided."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }*/

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// 91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test5_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            IntegratorStudies integratorstudies = null;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            /*string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');*/

            int ExecutedSteps = -1;
            result.SetTestStepDescription(teststeps);

            try
            {
                //Step 42: Set as following values in configuration files: Show Selector true true
                ehr.CloseEHR();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Selector");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 43: Enter Accession number and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("A120986");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                integratorstudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                DataTable intgrtable = basepage.CollectRecordsInTable(integratorstudies.ListTable(), integratorstudies.Intgr_Header(), integratorstudies.Intgr_Row(), integratorstudies.Intgr_Column());
                string[] columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.All(cv => string.Equals(cv, "A120986", StringComparison.OrdinalIgnoreCase)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// 91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test6_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');

            int ExecutedSteps = -1;
            result.SetTestStepDescription(teststeps);

            try
            {
                //Step 44: Set as following values in configuration files: Load Newest
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Load Newest");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 45: Enter Accession number and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("A120986");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                if (viewer.StudyInfo().ToLowerInvariant().Contains("A120986, 21-Sep-2011 11:37:11 AM".ToLowerInvariant()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 46: Leave all patient/study fields empty
                ehr.SetSearchKeys_Study("");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                servicetool.RestartIISUsingexe();
                
            }
        }

        /// <summary>
        /// 91382 Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test7_91382(String testid, String teststeps, int stepcount)
        {
            TestCaseResult result = new TestCaseResult(stepcount);
            StudyViewer viewer = null;
            string webconfigpath = Config.WebConfigPath;
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string url = string.Empty;
            string[] LastName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "LastName")).Split(':');
            string[] FirstName = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName")).Split(':');
            string[] AccessionNumber = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID")).Split(':');
            string[] StudyUID = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID")).Split('-');

            int ExecutedSteps = -1;
            result.SetTestStepDescription(teststeps);

            try
            {
                //Step 47: Set as following values in configuration files: Load Oldest
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Load Oldest");
                servicetool.RestartIISUsingexe();
                ExecutedSteps++;
                //Step 48: Enter Accession number and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study("A120986");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                // if (viewer.StudyInfo().ToLowerInvariant().Contains("A120986, 21-Sep-2011 11:37:11 AM".ToLowerInvariant()))
                if (viewer.StudyInfo().ToLowerInvariant().Contains("A120986, 26-Oct-1998 7:13:02 AM".ToLowerInvariant()))
                // 
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 49: Leave all patient/study fields empty
                ehr.SetSearchKeys_Study("");
                url = ehr.clickCmdLine("ImageLoad");
                login.DriverGoTo(url);
                login.NavigateToIntegratorURL(url);
                PageLoadWait.WaitForPageLoad(20);
                PageLoadWait.WaitForFrameLoad(20);
                viewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (viewer.AuthenticationErrorMsg().Text.ToLower().Contains("error occurred in operation: study search fields are all empty. open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                basepage.ChangeAttributeValue(webconfigpath, "/appSettings/add[@key='Integrator.OnMultipleStudy']", "value", "Show Error");
                servicetool.RestartIISUsingexe();
                
            }
        }

    }
}
