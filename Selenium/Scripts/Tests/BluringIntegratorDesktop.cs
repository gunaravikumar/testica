using System;
using System.Collections.Generic;
using System.Linq;
using System.IO;
using OpenQA.Selenium;
using OpenQA.Selenium.Support.UI;
using Selenium.Scripts.Pages;
using Selenium.Scripts.Pages.eHR;
using Selenium.Scripts.Pages.MergeServiceTool;
using Selenium.Scripts.Reusable.Generic;
using Selenium.Scripts.Pages.iConnect;
using TestStack.White.UIItems;
using TestStack.White.UIItems.TabItems;
using TestStack.White.UIItems.Finders;
using System.Threading;
using System.Data;
using System.Xml;
using OpenQA.Selenium.Interactions;
using Selenium.Scripts.Pages.MPAC;
using ComboBox = TestStack.White.UIItems.ListBoxItems.ComboBox;
using Window = TestStack.White.UIItems.WindowItems.Window;
using Dicom.Network;
using System.Text.RegularExpressions;
using System.Diagnostics;
using System.Data.SqlClient;
using TestStack.White.InputDevices;
using System.Globalization;
using Selenium.Scripts.Pages.HoldingPen;
using OpenQA.Selenium.Remote;

namespace Selenium.Scripts.Tests
{
    class BluringIntegratorDesktop : BasePage
    {
        public Login login { get; set; }
        public string filepath { get; set; }
        public EHR ehr { get; set; }
        public ExamImporter ei { get; set; }
        public WpfObjects wpfobject { get; set; }
        public ServiceTool servicetool { get; set; }
        public UserPreferences userpref { get; set; }
        public HPHomePage hphomepage { get; set; }
        public HPLogin hplogin { get; set; }

        Studies studies { get; set; }
        public BasePage basepage { get; set; }
        public MpacLogin mpaclogin { get; set; }
        public BluRingViewer bluringviewer { get; set; }
        public StudyViewer studyviewer { get; set; }

        DomainManagement domainmanagement;
        UserManagement usermanagement;
        RoleManagement rolemanagement;
        Inbounds inbounds = null;
        Outbounds outbounds = null;
        Patients patients;

        private string AuthenticationErrorMsg = "Error Occurred in operation: Client authentication failed.";
        private string MultiplePatientErrorMsg = "* Studies listed below may not belong to the same patient";
        private string ExpandText = "Show Search Criteria";
        private string HideText = "Hide Search Criteria";
        private string ExistingLayoutValue = null;

        private string SystemOverrideErrorMsg = "Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator.";
        private string SearchFieldsEmptyErrorMsg = "Error Occurred in operation: Study search fields are all empty. Open query is not permitted.";
        private string MorePatientsErrorMsg = "Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study.";
        private string OtherSearchCriteriaErrorMsg = "Error Occurred in operation: Other search criteria must not be specified when Study Instance UID is provided.";

        /// <summary>
        /// Constructor - Test Suite
        /// </summary>
        public BluringIntegratorDesktop(String classname)
        {
            login = new Login();
            BasePage.InitializeControlIdMap();
            login.DriverGoTo(login.url);
            filepath = Config.TestSuitePath + Path.DirectorySeparatorChar + classname + ".xls";
            wpfobject = new WpfObjects();
            servicetool = new ServiceTool();
            ehr = new EHR();
            ei = new ExamImporter();
            basepage = new BasePage();
            mpaclogin = new MpacLogin();
            userpref = new UserPreferences();
            bluringviewer = new BluRingViewer();
            studies = new Studies();
            hphomepage = new HPHomePage();
            hplogin = new HPLogin();
        }

        /// <summary>
        /// Integrator mode on desktop with user sharing
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162353(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables 
            TestCaseResult result;
            UserPreferences userpreferences = new UserPreferences();
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            servicetool = new ServiceTool();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                //Fetch required Test data        
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String datasource = login.GetHostName(Config.SanityPACS);

                //Precondition if needed:
                //  1. See attached instructions for configuring TestEHR in iCA server.
                //  2. Set User Sharing as Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1: 	Login to Webaccess as Administrator and set BluRing as default viewer, 
                //          and set the default Settings per modality (e.g.CR ) layout to 2x3 in the user preferences window
                //ExistingLayoutValue = GetAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CT']", "layout");
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpreferences.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.BluringViewerRadioBtn().Click();
                userpreferences.ModalityDropDown().SelectByText("CR");

                ExistingLayoutValue = userpreferences.LayoutDropDown().SelectedOption.Text;
                userpreferences.LayoutDropDown().SelectByText("2x3");
                userpreferences.CloseUserPreferences();
                login.Logout();
                ExecutedSteps++;

                //Step 2:Open the TestEHR application and enter
                //       Address = http://<BR IP>/WebAccess/
                //       Username and Password of a WebAccess user into the Security ID field.
                //       Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //       Example, in Security ID field type:
                //       Administrator - Administrator
                ehr.LaunchEHR();
                ehr.SetCommonParameters();
                ExecutedSteps++;

                //Step 3 - Enter the noted Patient ID and Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 4 - Click on Load and copy/Paste the generated URL in a browser on a client system then search.    
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog("Exception in Test Method--" + e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                this.CloseBrowser();

                //Return Result
                return result;
            }
            finally
            {
                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpreferences.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.ModalityDropDown().SelectByText("CR");
                userpreferences.LayoutDropDown().SelectByText(ExistingLayoutValue);
                userpreferences.CloseUserPreferences();
                login.Logout();

                ////Close browser
                //Driver.Manage().Cookies.DeleteAllCookies();
                //this.CloseBrowser();
            }

        }

        /// <summary>
        /// Preferences Settings in Stand alone mode
        /// </summary>
        public TestCaseResult Test_162354(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions
                //1. See attached instructions for configuring TestEHR in iCA server.
                //2. Set default viewer as " BluRing " and layout for CR modality as 2x2 in the user preference of Administrator user
                //3. Set User Sharing as Always Disabled                
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.ModalityDropDown().SelectByText("CR");

                ExistingLayoutValue = userpref.LayoutDropDown().SelectedOption.Text;
                userpref.LayoutDropDown().SelectByText("2x2");
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - Launch iCA service tool and select default viewer as BluRing under the viewer -> miscellaneous tab and 
                //         set layout for CR modality as (1x3) under the viewer -> Protocols tab
                //         Restart IIS and windows services
                ExistingLayoutValue = GetAttributeValue(Config.FileLocationPath, "/Configuration/ImageViewer/ViewingProtocols/Protocol[@modality='CT']", "layout");

                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab(ServiceTool.Viewer.Name.Protocols_tab);
                servicetool.WaitWhileBusy();
                servicetool.MoadalitySetting("CR", "1x3");
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 2 - Open the TestEHR application and enter Address = http://<BR IP>/WebAccess/
                //         Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ * Example, in Security ID field type:Administrator - Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ExecutedSteps++;

                //Step 3 - Enter the noted Patient ID and Accession number and click on the Cmd line
                ehr.SetSearchKeys_Study(Accession, datasources: login.GetHostName(Config.EA1));
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                wpfobject.GetMainWindow("Test WebAccess EHR");
                String url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 4 - Copy/Paste the generated URL in a browser on a client system, search and verify that system level changes are applied  
                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);
                if (Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 3)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                this.CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ChangeAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CR']", "layout", ExistingLayoutValue);
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.ModalityDropDown().SelectByText("CR");
                userpref.LayoutDropDown().SelectByText(ExistingLayoutValue);
                userpref.CloseUserPreferences();
                login.Logout();
            }
        }

        /// <summary>
        /// System Configuration Settings: Layout settings for different modality
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162355(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables 
            TestCaseResult result;
            Studies studies = null;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
            String URL = "http://localhost/webaccess";

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            String[] ModalitySettings = Convert.ToString(ReadExcel.GetTestData(filepath, "TestData", testid, "Modality")).Split(':');
            string[] Modality = null;
            string[] ExistingLayout = Enumerable.Repeat(string.Empty, ModalitySettings.Length).ToArray();

            try
            {
                //Fetch required Test data               
                String AccessionList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String PatientIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");

                String[] Accession = AccessionList.Split(':');
                String[] PatientID = PatientIDList.Split(':');
                String datasource = login.GetHostName(Config.SanityPACS);

                //Pre-conditions: 
                //  1. See attached instructions for configuring TestEHR in iCA server.
                //  2. Set User Sharing as Always Disabled
                //  3. Set default viewer as "BluRing" in miscellaneous under viewer tab
                //  4. Set the layout for the following modality under viewer - > Protocols
                //In the IBM iConnect Access Service tool,  
                //Configure the EA and Merge PACS Data source Select 'Integrator' Tab,then set User Sharing = Always Disabled 
                //In the service tool ->Viewer ->Miscellaneous-> select BlueRing viewer and apply 
                //Click on "Restart IIS and Windows Services" 
                //Configure the following default series layouts in 
                //Merge iConnect Service Tool -->Viewer-> Protocols tab.
                //CR:auto
                //CT:2x2
                //MG:1x2
                //MR:2x2
                //NM:2x2
                //OT:1x2
                //US:auto
                //XA:auto
                //RF:2x2
                //Select 'Integrator' Tab,then set User Sharing = Always Disabled
                //Click on "Restart IIS and Windows Services" 
                Modality = ModalitySettings.Select(ms => ms.Split('-')[0]).ToArray();
                for (int i = 0; i < Modality.Length; i++)
                {
                    ExistingLayout[i] = GetAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='" + Modality[i] + "']", "layout");
                }
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");

                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab(ServiceTool.Viewer.Name.Protocols_tab);
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                var modality = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), ServiceTool.Viewer.ID.ModalityCmbBox);
                var layoutcombo = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), ServiceTool.Viewer.ID.LayoutCmbBox);
                foreach (string ms in ModalitySettings)
                {
                    modality.SetValue(ms.Split('-')[0]);
                    servicetool.WaitWhileBusy();
                    layoutcombo.SetValue(ms.Split('-')[1]);
                    servicetool.GetCurrentTabItem().Click();
                }
                if (wpfobject.GetAnyUIItem<ITabPage, Button>(servicetool.GetCurrentTabItem(), ServiceTool.ApplyBtn_Name, 1).Enabled)
                {
                    servicetool.ClickApplyButtonFromTab();
                    servicetool.RestartService();
                    servicetool.WaitWhileBusy();
                }
                servicetool.CloseServiceTool();

                //Step 1 - Login to WebAccess as Administrator
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                ExecutedSteps++;

                //Step 2 - Navigate to Studies,Search US,MR,CT,CR and RF modality and select study and note down the Accession numbers.
                studies = (Studies)login.Navigate("Studies");
                int cnt = 0;
                foreach (string acc in Accession)
                {
                    studies.SearchStudy(AccessionNo: acc);
                    if (BasePage.GetSearchResults().Count > 0)
                        cnt++;
                }
                if (cnt == AccessionList.Split(':').Length)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                login.Logout();

                //Step 3 - Open the TestEHR application and enter
                //         Address = http://<BR IP>/WebAccess/
                //         Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //         Example, in Security ID field type: Administrator - Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ExecutedSteps++;

                //Step 4 - Enter the noted US study Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.SetSearchKeys_Study(Accession[0]);
                ehr.SetSearchKeys_Study(datasource, "Datasource");
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 5 - Copy/Paste the generated URL in a browser on a client system then search.   
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step5, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Verify the study should be loaded into the system default viewer.
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Enter the noted MR study Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[1]);
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 8 - Copy/Paste the generated URL in a browser on a client system then search.   
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_7);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Enter the noted CT study Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[2]);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 10 - Copy/Paste the generated URL in a browser on a client system then search.  
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_9);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Enter the noted CR study Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[3]);
                ehr.SetSearchKeys_Study("", "Patient_ID");
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 12 - Copy/Paste the generated URL in a browser on a client system then search. 
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_11);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Enter the noted RF study Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[4]);
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 14 - Copy/Paste the generated URL in a browser on a client system then search.   
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_13);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 4)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 15 - Change the layout to 1x2 in "Merge iConnect Service Tool" and RESET IIS
                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                servicetool.MoadalitySetting("RF", "1x2");
                servicetool.CloseServiceTool();
                Thread.Sleep(10000);
                ExecutedSteps++;

                //Step 16 - Using the test EHR application load a RF Study
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[4]);
                String url_16 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_16);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 17 - Navigate to iCA application,search CR modality which has 3 series and select study and note down the Accession number.  
                login.CreateNewSesion();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = (Studies)login.Navigate("Studies");
                studies.SearchStudy(AccessionNo: Accession[5], Datasource: GetHostName(Config.EA1));
                if (GetSearchResults().Count > 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                login.Logout();

                //Step 18 - In TestEHR application,Enter the noted CR study which has 3 series Accession number in step19 that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[5]);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_18 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 19 - Copy/Paste the generated URL in a browser on a client system then search.    
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_18);
                ExecutedSteps++;

                //Step 20 - Verify the study should be loaded into the iCA viewer
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() > 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 21 - Navigate to iCA application,search CR modality which has 4 series and select study and note down the Accession number.  
                login.CreateNewSesion();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = (Studies)login.Navigate("Studies");
                studies.SearchStudy(AccessionNo: Accession[6], Datasource: datasource);
                if (BasePage.GetSearchResults().Count > 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                login.Logout();

                //Step 22 - In TestEHR application,Enter the noted CR study which has 4 series Accession number in step23 that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(Accession[6]);
                ehr.SetSearchKeys_Study(datasource, "Datasource");
                String url_22 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 23 - Verify the study should be loaded into the iCA viewer
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_22);
                if (bluringviewer != null && Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog("Exception in Test Method--" + e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                var modality = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), ServiceTool.Viewer.ID.ModalityCmbBox);
                var layoutcombo = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), ServiceTool.Viewer.ID.LayoutCmbBox);
                if (!(ExistingLayout.Any(EL => string.Equals(EL, string.Empty))))
                {
                    for (int i = 0; i < Modality.Length; i++)
                    {
                        modality.SetValue(Modality[i]);
                        servicetool.WaitWhileBusy();
                        layoutcombo.SetValue(ExistingLayout[i]);
                        servicetool.GetCurrentTabItem().Click();
                    }
                }
                if (wpfobject.GetAnyUIItem<ITabPage, Button>(servicetool.GetCurrentTabItem(), ServiceTool.ApplyBtn_Name, 1).Enabled)
                {
                    servicetool.ClickApplyButtonFromTab();
                    servicetool.RestartService();
                    servicetool.WaitWhileBusy();
                }
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        ///  ShowSelector=True|ShowSelectorSearch=False and showSelector/ShowSelectorSearch=Empty
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162356(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String PID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String[] Lastnames = LastName.Split(':');
                String[] Firstnames = FirstName.Split(':');
                String[] Acclist = Accession.Split(':');
                String[] PIDlist = PID.Split(':');

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition         
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set default viewer as " BluRing " in the miscellaneous under Viewer tab
                //3. Set User Sharing as Always Disabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - 	iCA 7.0 server under testing is configured and is able to load images from the connected data sources
                ExecutedSteps++;

                //Step 2 - Required test data in data sources-
                //1) A Patient with at least 3 studies
                //2) A patient with at least 3 studies in which there is a study that has a unique Accession number
                //2)  At least there are 3 patient with same last name but different first names, these patients only has 1 study.
                //3) A patient's name is unique from all accessed data sources               
                ExecutedSteps++;

                //Step 3 -Test Data: In TestEHR Tool,Test Data:
                //Show Error
                //False
                //False
                //---------------------------------
                //Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^ *add key = "Integrator.OnMultipleStudy"value = "Show Error"/*^>^*
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*false*^<^*/AllowShowSelector *^>^ *
                //*^<^ *AllowShowSelectorSearch *^>^ *false *^<^ */ AllowShowSelectorSearch *^>^ *
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False", restart: true);
                ExecutedSteps++;

                //Step 4 - In the TestEHR tool set:
                //True, True
                //-------------------------------- -
                //In the TestEHR tool set: Address = *^<^ *enter path of iCA server under testing*^>^ *
                //Show Selector = true
                //Show Selector Search = true
                //Enter Accession number to a patient with multiple priors
                //Leave the rest fields as default.
                //Click Cmd line
                //Click Load
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_4);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step4_1 = ehr.ErrorMsg();
                if (Step4_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Replace a Accession number which is unique among these priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_5 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_5);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step5_1 = ehr.ErrorMsg();
                if (Step5_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Leave all patient/study fields empty. Launch URL.   
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                String url_6 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_6);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step6_1 = ehr.ErrorMsg();
                if (Step6_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - 	Enter a Study UID from a patient with multiple priors. Launch URL.	
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_7 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_7);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step7_1 = ehr.ErrorMsg();
                if (Step7_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                String url_8 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_8);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step8_1 = ehr.ErrorMsg();
                if (Step8_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Now add the patient First Name with multiple priors, and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                String url_9 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_9);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step9_1 = ehr.ErrorMsg();
                if (Step9_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                String url_10 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_10);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step10_1 = ehr.ErrorMsg();
                if (Step10_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Change patient last name and first name, where this is the only study in the data source, and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[1], "Last_Name");
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_11);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step11_1 = ehr.ErrorMsg();
                if (Step11_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12 - Test Data: false, false
                //          In the TestEHR tool, change the following settings only:
                //          Show Selector = false, Show Selector Search = false
                //          Enter Accession number to search a patient with multiple priors                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url_12 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_12);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step12_1 = ehr.ErrorMsg();
                if (Step12_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Replace a Accession number which is unique among these priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_13 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_13);
                var viewport = bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step13 = result.steps[++ExecutedSteps];
                step13.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step13, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 14 -	Leave all patient/study fields empty. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                String url_14 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_14);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step14_1 = ehr.ErrorMsg();
                if (Step14_1.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 15 - Enter a Study UID from a patient with multiple priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_15 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_15);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step15 = result.steps[++ExecutedSteps];
                step15.SetPath(testid, ExecutedSteps);
                var Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step15, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 16 -	Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                String url_16 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_16);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step16_1 = ehr.ErrorMsg();
                if (Step16_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 17 -	Now add patient First Name where the patient has multiple priors , and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                String url_17 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_17);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step17_1 = ehr.ErrorMsg();
                if (Step17_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18 -	Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(Acclist[2]);
                String url_18 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_18);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step18 = result.steps[++ExecutedSteps];
                step18.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step18, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 19 -	Change patient last name and first name, where the patient only has no priors
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                ehr.SetSearchKeys_Study(Acclist[2]);
                String url_19 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_19);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step19 = result.steps[++ExecutedSteps];
                step19.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step19, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
            }
        }

        /// <summary>
        /// Integrator User Sharing
        /// </summary>
        public TestCaseResult Test_162357(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer viewer = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            DomainManagement domainmgmt = null;
            RoleManagement rolemgmt = null;
            UserManagement usermgmt = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String datasource1 = login.GetHostName(Config.EA91).ToUpper();
                String datasource2 = login.GetHostName(Config.SanityPACS).ToUpper();
                int randomnumber = new Random().Next(1, 1000);

				//From iCA Server, open Webaccess\Web.config file and set developer logs to verbose. Reset IIS 
				basepage.SetWebConfigValue(Config.webconfig, "DeveloperTraceSwitch", "Verbose");
				servicetool.RestartIISUsingexe();

				//Domain-1 Users and Role
				Dictionary<object, string> domainattr1;
                String Role1 = "Physician1" + randomnumber;
                String User1 = "ph1" + randomnumber;

                //Non existing Users 
                String User_7 = "aa_" + randomnumber;
                String User_8 = "bb_" + randomnumber;
                String User_9 = "frank_" + randomnumber;
                String User_12 = "Tony_" + randomnumber;
                String User_15 = "User_" + randomnumber;
                String User_16 = "cc_" + randomnumber;
                String User_17 = "dd_" + randomnumber;
                String User_18 = "ee_" + randomnumber;
                String User_22 = "NonUser1_" + randomnumber;
                String User_23 = "bbb_" + randomnumber;
                String User_24 = "NonUser2_" + randomnumber;

                //Preconditions
                //1. Test Data: Use studies - \\10.4.16.130\anonymized_data\Bluring\Chest, Chester - QAC - 136076\Chest_Chester___ % 6573382
                //   =>Study attached in the EA(ECM_ARC_96 10.4.38.96) data source(patient "CHEST, CHESTER" Accession: 782101)
                //2. See attached instructions for configuring TestEHR in iCA server
                //3. In Viewer, Select Options-- *^>^ *User Preferences and set the 'Default Viewer Setting' as 'BluRing'.
                //5. iCA 7.0 Server : In IBM iConnect Access Service tool and select Integrator Tab, set Sharing = Always Disabled, Shadow User = Always Disabled
                //6. In the service tool->Viewer->Miscellaneous->select BluRing viewer and apply, Click on "Restart IIS and Windows Services"                                         
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.IntegratorUrlTab().Click();
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                servicetool.WaitWhileBusy();
                if (servicetool.URLEnc_CB().Checked == true)
                {
                    servicetool.URLEnc_CB().Checked = false;
                }
                servicetool.WaitWhileBusy();
                servicetool.ClickApplyButtonFromTab();
                servicetool.WaitWhileBusy();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 : Login as admin and create a domain with the following attributes.
                //         Domain Name = Domain1, Role = Role1, User = User1, Select a datasource that has the Studies (Chest, Chester, Patient ID= 6573382 used).
                //         Accession Number = 782101, Disable all other Data sources, Set the default Settings per modality for CR layout to 1x1
                //         Create another Role = Role2 in the new Domain1.                
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainattr1 = domainmgmt.CreateDomainAttr();
                domainmgmt.CreateDomain(domainattr1, new string[] { datasource1, datasource2 });
                String Domain1 = domainattr1[DomainManagement.DomainAttr.DomainName];
                domainmgmt.SearchDomain(Domain1);
                domainmgmt.SelectDomain(Domain1);
                domainmgmt.ClickEditDomain();
                domainmgmt.SetCheckBoxInEditDomain("universalviewer", 0);
                domainmgmt.ModifyStudySearchFields();
                domainmgmt.ModalityDropDown().SelectByText("CR");
                domainmgmt.LayoutDropDown().SelectByText("1x1");
                domainmgmt.ClickSaveDomain();

                rolemgmt = (RoleManagement)login.Navigate("RoleManagement");
                rolemgmt.CreateRole(Domain1, Role1, "Physician");

                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.CreateUser(User1, Domain1, Role1, 1, Config.emailid, 1, User1);

                login.Logout();
                ExecutedSteps++;

                //Step 2 - In the Service tool and select Integrator Tab, set, User Sharing = Always Disabled, Shadow User = Always Disabled
                //         In the service tool ->Viewer ->Protocols change the layout for the CR modality to 2 x 3 and apply, Reset IIS
                ExistingLayoutValue = GetAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CR']", "layout");

                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always disabled", shadowuser: "Always disabled");
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                servicetool.MoadalitySetting(modalitytype: "CR", layout: "2x3");
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                ////Step 3 - Open the C:\WebAccess\IntegratorAuthenticationSTS\Web.Config file and enable the Bypass protocol by removing the comment lines. 
                //login.EnableBypass();
                //ExecutedSteps++;

                //Step 3 - In the service tool -*^>^* Integrator Tab Confirm the User Sharing and Shadow User are in the Always disabled state.
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyButton();
                if (servicetool.UserSharingCombobox().SelectedItemText.Equals("Always disabled")
                    && servicetool.ShadowUserCombobox().SelectedItemText.Equals(String.Empty))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                servicetool.CloseServiceTool();

                //Step 4 - Verify there is no Integrator users sharing setting in the Domain under test by logon to iCA --*^>^* Domain tab --*^>^* Look for Default Role drop down box.                
                login.DriverGoTo(login.url);
                login.LoginIConnect(adminUserName, adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(Domain1);
                domainmgmt.SelectDomain(Domain1);
                domainmgmt.ClickEditDomain();
                PageLoadWait.WaitForPageLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame");
                bool flag = true;
                try
                {
                    if (domainmgmt.DefaultRoleDropDown().Displayed)
                        flag = true;
                    else
                        flag = false;
                }
                catch { flag = false; }
                if (flag == false)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                domainmgmt.EditDomainCloseBtn().Click();
                login.Logout();

                //Step 5 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Disabled, Shadow User = Always Disabled (service tool)
                //         AutoEndSession = true, Selector Centricity = Study, Domain = Domain1, Role = Role1, User = ICA known user (User1)
                //         Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(autoendsession: "True", domain: Domain1, role: Role1, user: User1);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

				var transferStartTime = System.DateTime.Now;
				login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_6);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

				//Step 6 - From iCA server, check the webaccess developer log for the information "SessionType=Integrator"
				var transferEndtTime = System.DateTime.Now;
				try
				{
					var loggedMessage = string.Empty;
					String Date = System.DateTime.Now.Date.ToString("yyyyMMdd");
					for (var i = 1; i >= 1; i++)
					{
						String LogFilePath = @"C:\Windows\Temp\WebAccessDeveloper-" + Date + "(" + i + ")" + ".log";
						System.DateTime DateTime = System.DateTime.Now.Date;

						if (File.Exists(LogFilePath))
						{
							//StreamReader reader = new StreamReader(stream);
							var LogValues = basepage.ReadDevTraceLog(LogFilePath, transferStartTime, transferEndtTime, isInformation: true);

							foreach (var entry in LogValues)
							{
								if (entry.Value["Message"].Contains("SessionType=Integrator")) //Actual message : License type embeded SessionType=Integrator
								{
									loggedMessage = entry.Value["Message"];
									break;
								}
							}
						}
						else
						{
							Logger.Instance.ErrorLog("Unable to Read Log file");
							break;
						}
					}

					//Validation of message in log file
					if (loggedMessage == "License type embeded SessionType=Integrator")
					{
						result.steps[++ExecutedSteps].status = "Pass";
						Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
					}
					else
					{
						result.steps[++ExecutedSteps].status = "Fail";
						Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
						result.steps[ExecutedSteps].SetLogs();
					}
				}
				catch (Exception e)
				{
					result.steps[++ExecutedSteps].status = "Fail";					
				}

				//Step 7 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Disabled
				//         Shadow User = Always Disabled (service tool), default browser = true, AutoEndSession = true, Selector Centricity = Study
				//         Domain = Domain1, Role = Role1, User =ICA non existing user (aa)
				//         Accession Number = 782101, click on the Cmd line and select load.
				ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User_7);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_7);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Disabled, Shadow User = Always Disabled (service tool)
                //         default browser = true, AutoEndSession = true, Domain = Domain1, Role = Blank, User = ICA non existing user (bb)
                //         Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User_8);
                ehr.SetSearchKeys_Study(Accession);
                String url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_8);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Disabled, default browser = true
                //         AutoEndSession = true, Domain = Domain1, Role = Role1, User = ICA non existing user (Frank)
                //         Accession Number = 782101, click on the Cmd line and select load.
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User_9);
                ehr.SetSearchKeys_Study(Accession);
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_9);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Disabled
                //          default browser = true, AutoEndSession = true, Domain = Domain1, Role = Blank, User =User1 (registered user)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_10);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Enabled, Shadow User = Always Disabled (service tool)
                //          default browser = true, AutoEndSession = true, Domain = Domain1, Role = Blank, User =User1 (registered user)
                //          Accession Number = 782101, click on the Cmd line and select load.
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always disabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_11);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Enabled, Shadow User = Always Disabled (service tool)
                //          default browser = true, AutoEndSession = true, Domain = Domain1, Role = Blank, User =Non registered user (Tony)
                //          Accession Number = 782101, click on the Cmd line and select load.
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always enabled", restart: true);

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User_12);
                ehr.SetSearchKeys_Study(Accession);
                String url_12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                try
                {
                    login.CreateNewSesion();
                    bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_12);
                    if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                    {
                        result.steps[++ExecutedSteps].status = "Pass";
                        Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                    }
                    else
                    {
                        result.steps[++ExecutedSteps].status = "Fail";
                        Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                        result.steps[ExecutedSteps].SetLogs();
                    }
                }
                catch (Exception)
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always Disabled, Shadow User = Always Disabled (service tool)
                //          default browser = true, AutoEndSession = true, Domain = ,Role = , User = User1
                //          Accession Number = 782101, click on the Cmd line and select load.
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_13);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 14 - In the Service tool set the following
                //          User Sharing = Always enabled, Shadow User = Always enabled
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Enabled", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 15 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always enabled, Shadow User = Always enabled
                //          default browser = true, AutoEndSession = true, Domain = Domain1, Role = Add a role that does not exist or a role in another domain (Existing Role not in Domain1)
                //          User = Use a non existing user. Confirm user does not exist by logging into the SQL DB and looking at table dbo.IRUser.
                //          Accession Number = 782101, click on the Cmd line and select load. 
                RestartIISUsingexe();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: "RandomRole_" + randomnumber, user: User_15);
                ehr.SetSearchKeys_Study(Accession);
                String url_15 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToIntegratorURL(url_15);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                //bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_15);
                if (bluringviewer.AuthenticationErrorMsg().Text.Contains("Client authentication failed"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 16 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always enabled, Shadow User = Always enabled
                //          default browser = true, AutoEndSession = true, Domain = Domain1, Role = Role1, User = non existing user (cc)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User_16);
                ehr.SetSearchKeys_Study(Accession);
                String url_16 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_16);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 17 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always enabled, Shadow User = Always enabled
                //          default browser = true, AutoEndSession = true, Domain = Domain1, Role = Blank, User = non existing user (dd)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User_17);
                ehr.SetSearchKeys_Study(Accession);
                String url_17 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                //bluringviewer.NavigateToBluringIntegratorURL(url_17);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_17);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always enabled, Shadow User = Always enabled
                //          default browser = true, AutoEndSession = true, Domain = Non ICA existing Domain, Role = Role1, User = non ICA existing user (ee)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: "RandomDomain_" + randomnumber, role: Role1, user: User_18);
                ehr.SetSearchKeys_Study(Accession);
                String url_18 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                //bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_18);
                //bluringviewer.NavigateToIntegratorFrame(url_18); //NavigateToIntegratorFrame
                bluringviewer.NavigateToIntegratorURL(url_18);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                if (bluringviewer.AuthenticationErrorMsg().Text.Contains("Client authentication failed"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 19 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = Always enabled, Shadow User = Always enabled
                //          default browser = true, AutoEndSession = true, Domain = Blank, Role = Blank, User = User1 (registered user)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_19 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
				transferStartTime = System.DateTime.Now;
				//bluringviewer.NavigateToBluringIntegratorURL(url_19);
				bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_19);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


				//Step 20 - From ICA server, check the webaccess developer log for the information "SessionType=IntegratorUserSharing"
				transferEndtTime = System.DateTime.Now;
				try
				{
					var loggedMessage = string.Empty;
					String Date = System.DateTime.Now.Date.ToString("yyyyMMdd");
					for (var i = 1; i >= 1; i++)
					{
						String LogFilePath = @"C:\Windows\Temp\WebAccessDeveloper-" + Date + "(" + i + ")" + ".log";
						System.DateTime DateTime = System.DateTime.Now.Date;

						if (File.Exists(LogFilePath))
						{
							//StreamReader reader = new StreamReader(stream);
							var LogValues = basepage.ReadDevTraceLog(LogFilePath, transferStartTime, transferEndtTime, isInformation: true);

							foreach (var entry in LogValues)
							{
								if (entry.Value["Message"].Contains("SessionType=IntegratorUserSharing")) //Actual message: License type embeded SessionType=IntegratorUserSharing
								{
									loggedMessage = entry.Value["Message"];
									break;
								}
							}
						}
						else
						{
							Logger.Instance.ErrorLog("Unable to Read Log file");
							break;
						}
					}

					//Validation of message in log file
					if (loggedMessage == "License type embeded SessionType=IntegratorUserSharing")
					{
						result.steps[++ExecutedSteps].status = "Pass";
						Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
					}
					else
					{
						result.steps[++ExecutedSteps].status = "Fail";
						Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
						result.steps[ExecutedSteps].SetLogs();
					}
				}
				catch (Exception e)
				{
					result.steps[++ExecutedSteps].status = "Fail";
				}


				//Step 21 - In the Service tool set the following
				//          User Sharing = URL determined, Shadow User = Always enabled
				servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "URL determined", shadowuser: "Always Enabled");
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 22 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = URL enabled, Shadow User = Always enabled (service tool)
                //          default browser = true, AutoEndSession = true, Enable UserSharing in URL = True ( in Test EHR), Domain = Domain1, Role = Role1, User = User1 (registered user)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(usersharing: "True", domain: Domain1, role: Role1, user: User1);
                ehr.SetSelectorOptions("Study");
                ehr.SetSearchKeys_Study(Accession);
                String url_21 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_21);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 23 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = URL enabled, Shadow User = Always enabled (service Tool)
                //          default browser = true, AutoEndSession = true, Enable UserSharing = False ( URL setting , Test EHR)), Domain = Domain1, Role = Role1, User = non registered user
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(usersharing: "False", domain: Domain1, role: Role1, user: User_22);
                ehr.SetSearchKeys_Study(Accession);
                String url_22 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_22);
                Boolean isStudyPresent_22 = GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                                            Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6;

                login.CreateNewSesion();
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser("*", Domain1);
                Boolean isuserpresent_22 = usermgmt.IsUserPresent(User_22);
                if (isStudyPresent_22 && !isuserpresent_22)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 24 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = URL enabled, Shadow User = Always enabled
                //          default browser = true, AutoEndSession = true, Enable UserSharing = False ( URL setting , Test, Domain = Domain1, Role = , User = non existing user (bbb)
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(usersharing: "False", domain: Domain1, role: User_23, user: User_23);
                ehr.SetSearchKeys_Study(Accession);
                String url_23 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_23);
                Boolean isStudyPresent_23 = GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                                            Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6;

                login.CreateNewSesion();
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser("*", Domain1);
                Boolean isuserpresent_23 = usermgmt.IsUserPresent(User_23);
                if (isStudyPresent_23 && !isuserpresent_23)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 25 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = URL enabled, Shadow User = Always enabled (service Tool)
                //          default browser = true, AutoEndSession = true, Enable UserSharing = False ( URL setting , Test, Domain = ,Role = Role1, User = non registered user
                //          Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(usersharing: "False", domain: Role1, role: Role1, user: User_24);
                ehr.SetSearchKeys_Study(Accession);
                String url_24 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_24);
                Boolean isStudyPresent_24 = GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                                            Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6;

                login.CreateNewSesion();
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser("*", Domain1);
                Boolean isuserpresent_24 = usermgmt.IsUserPresent(User_24);
                if (isStudyPresent_24 && !isuserpresent_24)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 26 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = URL enabled, Shadow User = Always enabled (service Tool)
                //          default browser = true, AutoEndSession = true, enableUserSharing = True, Enable UserSharing = True ( URL setting , Test Domain = Blank, Role = Blank
                //          User = User1, Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "True", domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_25 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_25);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 27 - Start the TestEHR program and enter, Address = http://localhost/WebAccess, User Sharing = URL enabled, Shadow User = Always enabled (service Tool)
                //          default browser = true, AutoEndSession = true, enableUserSharing = True, Enable UserSharing = False ( URL setting , Test
                //          Domain = Blank, Role = Blank, User = User1, Accession Number = 782101, click on the Cmd line and select load.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "False", domain: "", role: "", user: User1);
                ehr.SetSearchKeys_Study(Accession);
                String url_26 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_26);
                Boolean isStudyPresent_26 = GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                                            GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                                            Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6;

                login.CreateNewSesion();
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                usermgmt = (UserManagement)login.Navigate("UserManagement");
                usermgmt.SearchUser(User1, Domain1);
                int UsersCount_26 = usermgmt.ListedUsers().Count();
                if (isStudyPresent_26 && UsersCount_26 == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-28:Start the TestEHR program and enter Address =http://<BR IP>/WebAccess/User Sharing = URL DeterminedShadow User = Always enabled (service Tool)AutoEndSession = trueEnable UserSharing = TrueDomain = Existing DomainRole = Existing RoleUser Id = Non existing userAccession Number = 782101click on the Cmd line and select load.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(usersharing: "True", domain: "SuperAdminGroup", role: "SuperRole", user: User_12);
                ehr.SetSearchKeys_Study(Accession);
                String url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);
                if (GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Equals(FirstName.ToLower()) &&
                    GetElement("cssselector", BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
            finally
            {
                ChangeAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CR']", "layout", ExistingLayoutValue);
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        /// Study Data Source
        /// </summary>
        public TestCaseResult Test_162358(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");

                String URL = @"http://" + Config.IConnectIP + "/webaccess";
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;

                //Preconditions                
                //1. Configure TestEHR based on the file attached
                //2. Set default viewer as " BluRing " in miscellaneous under viewer tab
                //3. Set User Sharing as Always Disabled
                //4. Select Allow Show Selector Search and Allow Show Selector in the integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 - Launch TestEHR, Select Image Load tab of the TestEHR application and enter
                //         Address = http://<BR IP>/WebAccess/ Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ * Example, in Security ID field type: Administrator - Administrator                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ExecutedSteps++;

                //Step 2 - Set Show selector to true, show selector search to true and enter the data source name which is configured in the "Merge iConnect Service Tool" in the Study Data Source Field 
                //         (e.g.: EA96) then Enter "*" in the patient last name. click on the Cmd line.                
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("*", "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3 - Copy and Paste the generated URL in a browser on a client system then search.                
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("#ctl00_m_listResultsControl_m_messageLabel")));
                String Step1_1 = ehr.StudyListErrorMsg();
                String Step1_2 = ehr.StudyListGrid()[1].FindElement(By.TagName("td")).Text;
                if (Step1_1.Trim().Equals("* Error occurred while retrieving study list. Your search result may be incomplete.") &&
                    Step1_2.Equals("No studies that match the search criteria could be found."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Return to the Image Load tab of the TestEHR application. Change the Study Datasource to the MPACS Datasource name which is 
                //         configured in the "Merge iConnect Service Tool." (E.g. vm225)then Enter "A"in the Patient Full Name field click on the Cmd line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study("A", "Patient_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.PACS2), "Datasource");
                ExecutedSteps++;

                //Step 5 - Click on Load and copy/Paste the generated URL in a browser on a client system then search         
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_5);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].StartsWith("A") && studyinfo["Patient ID"][0].Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Select one patient and click on View Exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step6, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Enabling / Disabling fullscreen mode from TestEHR
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162359(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");

                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition - Show Selector = False      
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set default viewer as " BluRing " in user preference of Administrator
                //3. Check in " Load study in full screen "  in user preference of Administrator
                //4. Set User Sharing as Always Enabled
                //5. Select Allow Show Selector in the integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetCheckbox(userpref.LoadStudyInFullScreenChkBox());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - Launch TestEHR, in Image Load tab, Enter valid search criteria for a study.
                //         Set Show Selector to True and set Full Screen to True,
                //         Click on CMD line and copy the generated the URL and launch it in a browser.              
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", fullScreen: "True");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_1 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_1);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2 - Select a patient and click on view exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                var bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (!IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Select Image Load tab, Enter valid search criteria for a study.
                //         Set Show Selector to True and set Full Screen to False,
                //         Click on CMD line and copy the generated the URL and launch it in a browser.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", fullScreen: "False");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_3);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Select a patient and click on view exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Navigate to BluRing application and Select Options --*^>^*User Preferences and set the 'Default Viewer Setting' as 'HTML4'.
                login.CreateNewSesion();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.HTML4RadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();
                ExecutedSteps++;

                //Step 6 - In the Merge iConnect Access Service tool,select 'Integrator' Tab,then set User Sharing = Always Disabled
                //         In the service tool->Viewer->Miscellaneous->select BluRing viewer and apply
                //         Check the "Load Study In Full Screen Mode" checkbox. Reset IIS
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always disabled");
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab(ServiceTool.Viewer.Name.Miscellaneous_tab);
                wpfobject.GetButton(ServiceTool.ModifyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.SetBluringViewer();
                wpfobject.SelectCheckBox(ServiceTool.Viewer.Name.FullScreenChkBox, 1);
                wpfobject.GetButton(ServiceTool.ApplyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 7 - In TestEHR,Select Image Load tab, Enter valid search criteria for a study.
                //         Set Show Selector to True and set Full Screen to True,
                //         Click on CMD line and copy the generated the URL and launch it in a browser.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", fullScreen: "True");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_7 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_7);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Select a patient and click on view exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - In TestEHR,Select Image Load tab, Enter valid search criteria for a study.
                //         Set Show Selector to True and set Full Screen to False,
                //         Click on CMD line and copy the generated the URL and launch it in a browser.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", fullScreen: "False");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_9);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Select a patient and click on view exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - In the Merge iConnect Access Service tool,select 'Integrator' Tab,then set
                //          User Sharing = Always Disabled. In the service tool->Viewer->Miscellaneous->select BluRing viewer and apply
                //          UnCheck the "Load Study In Full Screen Mode" checkbox. Reset IIS
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always disabled");
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab(ServiceTool.Viewer.Name.Miscellaneous_tab);
                wpfobject.GetButton(ServiceTool.ModifyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.SetBluringViewer();
                wpfobject.UnSelectCheckBox(ServiceTool.Viewer.Name.FullScreenChkBox, 1);
                wpfobject.GetButton(ServiceTool.ApplyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 12 - In TestEHR, Select Image Load tab, Enter valid search criteria for a study.
                //          Set Show Selector to True and set Full Screen to True,
                //          Click on CMD line and copy the generated the URL and launch it in a browser.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", fullScreen: "True");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_12 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_12);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Select a patient and click on view exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (!IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 14 - In TestEHR,Select Image Load tab, Enter valid search criteria for a study.
                //          Set Show Selector to True and set Full Screen to False,
                //          Click on CMD line and copy the generated the URL and launch it in a browser.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "True", fullScreen: "False");
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_14);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 15 - Select a patient and click on view exam button
                patientstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.UnCheckCheckbox(userpref.LoadStudyInFullScreenChkBox());
                userpref.CloseUserPreferences();
                login.Logout();

                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Viewer_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab(ServiceTool.Viewer.Name.Miscellaneous_tab);
                wpfobject.GetButton(ServiceTool.ModifyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.SetBluringViewer();
                wpfobject.UnSelectCheckBox(ServiceTool.Viewer.Name.FullScreenChkBox, 1);
                wpfobject.GetButton(ServiceTool.ApplyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
            }
        }

        /// <summary>
        /// System default viewer
        /// </summary>
        public TestCaseResult Test_162310(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String DatasourceList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources");
                String PatientFullName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String[] Datasource = DatasourceList.Split(':');

                String URL = "http://localhost/webaccess";
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;

                //Precondition
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set User Sharing as Always Disabled
                //3. Set default viewer as " BluRing " in miscellanious under Viewer tab
                //4. Set the default viewport for CR modality as 2x3
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                ExistingLayoutValue = GetAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CR']", "layout");
                ChangeAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CR']", "layout", "2x3");
                servicetool.RestartIISUsingexe();

                //Step 1 - Open the TestEHR application and enter Address = http://<BR IP>/WebAccess/, Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^*username*^>^*-*^<^*password*^>^*, Example, in Security ID field type:, Administrator-Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ExecutedSteps++;

                //Step 2 - Enter the noted Patient ID and Accession number and click on the Cmd line                
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3 - Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var viewport = bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step4, viewport) &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ChangeAttributeValue(Config.FileLocationPath, "/ViewingProtocols/Protocol[@modality='CR']", "layout", ExistingLayoutValue);
                servicetool.RestartIISUsingexe();
            }
        }

        /// <summary>
        /// Inbounds or Outbounds in standalone mode
        /// </summary>
        public TestCaseResult Test_162311(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies studies = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String DatasourceList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources");
                String PatientFullName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String viewerName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Viewer");
                String[] Datasource = DatasourceList.Split(':');

                String URL = "http://localhost/webaccess";
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;

                //Precondition Grant Access
                servicetool = new ServiceTool();
                servicetool.LaunchServiceTool();
                servicetool.NavigateToEnableFeatures();
                wpfobject.WaitTillLoad();
                servicetool.ModifyEnableFeatures();
                wpfobject.WaitTillLoad();
                servicetool.EnableStudySharing();
                servicetool.EnableDataTransfer();
                servicetool.ApplyEnableFeatures();
                wpfobject.WaitTillLoad();
                wpfobject.ClickOkPopUp();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                domainmanagement.SearchDomain(Config.adminGroupName);
                domainmanagement.SelectDomain(Config.adminGroupName);
                domainmanagement.ClickEditDomain();
                domainmanagement.SetCheckBoxInEditDomain("grant", 0);
                domainmanagement.ClickSaveDomain();

                rolemanagement = (RoleManagement)login.Navigate("RoleManagement");
                rolemanagement.SearchRole(Config.adminRoleName, Config.adminGroupName);
                rolemanagement.SelectRole(Config.adminRoleName);
                rolemanagement.ClickEditRole();
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    Click("cssselector", "[id$='_RoleAccessFilter_GrantAccessRadioButtonList_2']", true);
                else
                    rolemanagement.GrantAccessRadioBtn_Anyone().Click();
                rolemanagement.ClickSaveEditRole();

                rolemanagement = (RoleManagement)login.Navigate("RoleManagement");
                if (!rolemanagement.RoleExists("Staff")) rolemanagement.CreateRole(Config.adminGroupName, "Staff", "");
                if (!rolemanagement.RoleExists("Physician")) rolemanagement.CreateRole(Config.adminGroupName, "Physician", "physician");

                //Precondtion to create ph1, st users
                usermanagement = (UserManagement)login.Navigate("UserManagement");
                if (!usermanagement.IsUserExist(Config.stUserName, Config.adminGroupName)) usermanagement.CreateUser(Config.stUserName, Config.adminGroupName, "Staff", 1, Config.emailid, 1, Config.stPassword);
                if (!usermanagement.IsUserExist(Config.ph1UserName, Config.adminGroupName)) usermanagement.CreateUser(Config.ph1UserName, Config.adminGroupName, "Physician", 1, Config.emailid, 1, Config.ph1Password);
                login.Logout();

                //Step 1 - Login to WebAccess as ph user and navigate to studies tab                
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.ph1UserName, Config.ph1Password);
                studies = login.Navigate<Studies>();
                ExecutedSteps++;

                //Step 2 - Select a study from the Study list and click on "Grant Access" button.  
                studies.SearchStudy(AccessionNo: Accession, Datasource: login.GetHostName(Config.EA1));
                studies.SelectStudy("Accession", Accession);
                ExecutedSteps++;

                //Step 3 - Verify the dialog prompt
                // Covered in Step 4
                ExecutedSteps++;

                //Step 4 - The physician /User(ph) selects User(e.g. st) as the user with which the study should be shared
                studies.ShareStudy(false, new String[] { Config.stUserName });
                ExecutedSteps++;

                //Step 5 - The physician /User(e.g. ph) commits by click "Grant Access" button
                // Covered in Step 4
                ExecutedSteps++;

                //Step 6 - For User(e.g. ph), click"Outbounds tab and search the study which is share in previous step.
                outbounds = (Outbounds)login.Navigate("Outbounds");
                outbounds.SearchStudy("Accession", Accession);
                outbounds.SearchStudy("studyPerformed", "All Dates");
                String[] values_6 = BasePage.GetColumnValues(BasePage.GetSearchResults(), "Accession", BasePage.GetColumnNames());
                if (Array.IndexOf(values_6, Accession) > -1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Double click on any study in the study list and verify the study is launched on the iCA Enterprise Viewer
                outbounds.SelectStudy("Accession", Accession);
                DoubleClick(Driver.FindElement(By.CssSelector("#gridTableOutboundsStudyList tbody tr:nth-child(2)")));
                PageLoadWait.WaitForFrameLoad(20);
                BluRingViewer.WaitforViewports();
                BluRingViewer.WaitforThumbnails();
                bluringviewer.CloseBluRingViewer();
                ExecutedSteps++;

                //Step 8 - Logout as user(e.g. ph) and login as st user                
                login.Logout();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.stUserName, Config.stPassword);
                ExecutedSteps++;

                //Step 9 - Navigate to Inbound tab and search for the study which was shared in previous step.
                inbounds = (Inbounds)login.Navigate("Inbounds");
                inbounds.SearchStudy("Accession", Accession);
                inbounds.SearchStudy("studyPerformed", "All Dates");
                String[] values_9 = GetColumnValues(GetSearchResults(), "Accession", GetColumnNames());
                if (Array.IndexOf(values_9, Accession) > -1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Double click on any study in the study list and verify the study is launched on the iCA Enterprise Viewer
                inbounds.SelectStudy("Accession", Accession);
                DoubleClick(Driver.FindElement(By.CssSelector("#gridTableInboundsStudyList tbody tr:nth-child(2)")));
                PageLoadWait.WaitForFrameLoad(20);
                BluRingViewer.WaitforViewports();
                BluRingViewer.WaitforThumbnails();
                ExecutedSteps++;

                bluringviewer.CloseBluRingViewer();
                login.Logout();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Default Viewer Setting as 'HTML4'
        /// </summary>
        public TestCaseResult Test_162312(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies studies = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");

                //Step 1 - Login to WebAccess as Administrator and navigate to studies tab                
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                ExecutedSteps++;

                //Step 2 - Select Options --*^>^*User Preferences and set the 'Default Viewer Setting' as 'HTML4 Viewer',then click on 'Save' button.
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.HTML4RadioBtn().Click();
                userpref.CloseUserPreferences();
                ExecutedSteps++;

                //Step 3 - Double click on any study from studies tab after searching
                studies.SearchStudy(AccessionNo: Accession, Datasource: login.GetHostName(Config.EA1));
                studies.SelectStudy("Accession", Accession);
                studies.DoubleClick(Driver.FindElement(By.CssSelector("#gridTableStudyList tbody tr:nth-child(2)")));
                PageLoadWait.WaitForPageLoad(30);
                PageLoadWait.WaitForFrameLoad(20);
                Thread.Sleep(10000);
                PageLoadWait.WaitForThumbnailsToLoad(360);
                PageLoadWait.WaitForAllViewportsToLoad(60);
                ExecutedSteps++;

                //Close study and Logout
                studies.CloseStudy();
                login.Logout();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();
            }
        }

        /// <summary>
        /// Patient search criteria in Integrator Mode
        /// </summary>
        public TestCaseResult Test_162313(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String URL = @"http://" + Config.IConnectIP + "/webaccess";

                //Precondition
                //1. See attached instructions for configuring TestEHR in iCA server.
                //2. Set default viewer as " BluRing " in user preference of Administrator
                //3. Set User Sharing as Always Enabled in integrator tab
                //4. Select Allow show selector in integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();

                //Step 1 - Launch TestEHR application and enter Address = http://BR IP/WebAccess/ in Address tab under Image Load; Common Parameters
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ExecutedSteps++;

                //Step 2 - Enter the last name and first name of patient in Search Keys(patient) tab and click on Cmd line button.
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(FirstName.Split(':')[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName.Split(':')[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource"); //EA96              
                ExecutedSteps++;

                //Step 3 - Click on Load button                
                String url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 4 -Verify the study should be loaded in the iCA viewer [HTML5/Universal] which is set in user Preferences
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_3);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID.Split(':')[0]))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Clear the last name and first name in Search Key parameters in TestEHR application and enter New Patient's last name and first name.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(FirstName.Split(':')[1], "First_Name");
                ehr.SetSearchKeys_Study(LastName.Split(':')[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                ExecutedSteps++;

                //Step 6 - Click on the Cmd line.
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 7 - Copy and Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_5);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID.Split(':')[1]))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Select any patient and Click on "View Exam" button and then Verify the study is loaded in the iCA viewer[HTML5/Universal] which is set in the user Preferences
                patientstudy.SelectPatinet("Patient ID", PatientID.Split(':')[1]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport1 = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step8 = result.steps[++ExecutedSteps];
                step8.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step8, viewport1))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Load multiple studies from same patient in Integrated mode
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162314(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String studyuid = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String patientname = string.Concat((String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName"), ", ", (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName"));

                String[] arrstudyuid = studyuid.Split(':');
                String[] arraccession = Accession.Split(':');
                String[] FirstNames = FirstName.Split(':');

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions 
                //1. See attached instructions for configuring TestEHR in iCA server.
                //2. Set default viewer as " BluRing " in miscellaneous under viewer tab
                //3. Set User Sharing as Always Disabled
                //4. Ensure Allow Show Selector Search and Allow Show Selector options are not selected in the integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 - Launch TestEHR, In the Image load enter a study instance UID which has multiple studies of a patient and click on Cmd line then click on load button           
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetShowSelector(false);
                ehr.SetSearchKeys_Study(arrstudyuid[0], "Study_UID");
                var url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_1);
                var viewport = bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var step1_1 = bluringviewer.CompareImage(step4, viewport);
                if (step1_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2 - In Study Instance UID field add another study instance UID of the patient separated by backslash, e.g.:
                //         Study Instance UID: 1.2.840...studyA\1.2.840...studyB Click Load Study.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetShowSelector(false);
                ehr.SetSearchKeys_Study(arrstudyuid[0] + "\\" + arrstudyuid[1], "Study_UID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91) + "\\" + login.GetHostName(Config.EA91), "Datasource"); //TODO - Remove this line
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                var step2_1 = ehr.CompareImage(step2, Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel)));
                if (step2_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Verify the study should be loaded into the user preferences viewer(BluRing viewer).
                if (bluringviewer != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Compare the patient and study info with the data source.
                if (GetElement(SelectorType.CssSelector, BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement(SelectorType.CssSelector, BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Replace(".", "").Equals(FirstNames[0].ToLower()) &&
                    GetElement(SelectorType.CssSelector, BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Apply any tool(e.g. Line Measurement) on the loaded study.                
                try
                {
                    bluringviewer.SelectViewerTool(BluRingTools.Line_Measurement);
                }
                catch (Exception)
                {
                    new SimulateAction(BasePage.Driver).ContextClick(bluringviewer.Activeviewport);
                    bluringviewer.SelectViewerTool(BluRingTools.Line_Measurement);
                }
                bluringviewer.ApplyTool_LineMeasurement();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step_5 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport));
                if (step_5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Select another study from the Exam List Panel
                bluringviewer.OpenPriors(1);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bluringviewer.NavigateToIntegratorFrame("bluring");
                bool step6 = bluringviewer.CompareImage(result.steps[ExecutedSteps], GetElement(SelectorType.CssSelector, BluRingViewer.div_studypanel + ":nth-of-type(2)"));
                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Verify the newly selected study from Exam List panel should be loaded into the user preferences viewer(Universal viewer).
                if (bluringviewer != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Load one of series.
                IList<IWebElement> list = Driver.FindElements(By.CssSelector(BluRingViewer.div_Draggable));
                new Actions(BasePage.Driver).DoubleClick(list[1]).Build().Perform();
                BluRingViewer.WaitforViewports();
                PageLoadWait.WaitForFrameLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step_8 = bluringviewer.CompareImage(result.steps[ExecutedSteps], Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel + ":nth-of-type(2)")));
                if (step_8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Load multiple studies from another patient.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetShowSelector(false);
                ehr.SetSearchKeys_Study(arrstudyuid[0] + "\\" + arrstudyuid[2] + "\\" + arrstudyuid[3], "Study_UID");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_9);
                var step9 = result.steps[++ExecutedSteps];
                step9.SetPath(testid, ExecutedSteps);
                var step9_1 = ehr.CompareImage(step9, Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel)));
                if (step9_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Compare the patient, study and image info with the data source.
                if (GetElement(SelectorType.CssSelector, BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[0].ToLower().Equals(LastName.ToLower()) &&
                    GetElement(SelectorType.CssSelector, BluRingViewer.p_PatientName).GetAttribute("innerText").Split(',')[1].ToLower().Trim().Replace(".", "").Contains(FirstNames[1].ToLower()) &&
                    GetElement(SelectorType.CssSelector, BluRingViewer.div_PatientID).GetAttribute("innerText").Equals(PatientID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Leave Study Instance UID field empty in TestEHR Tool, load multiple studies from a patient using Accession Number field.
                //          Note: Enable Show selector(Studies will not be loaded without selecting this option)

                //Enable Show selector
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Study_UID");
                var combinedaccession = arraccession[0] + "\\" + arraccession[1];
                ehr.SetSearchKeys_Study(combinedaccession, "");
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_11);
                ExecutedSteps++;

                //Step 12 -Load any listed study and compare the patient, study and image info with the data source.
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID) &&
                    studyinfo["First Name"][0].Equals(FirstNames[1].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(LastName.ToUpper()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Enable Show Report
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162315(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies studies = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition - Show Selector = False    
                //1. Configure TestEHR based on the file attached
                //2. Set default viewer as BluRing / iCA Enterprise viewer in user preference of Administrator
                //3. Select " Enable PDF Report " options from Enable features
                //4. Select " Enable Encapsulated PDF " option from Enable Features - > Report
                //5. Enable User sharing = Always Enabled in integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always Enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                TestFixtures.UpdateFeatureFixture("pdfreport", value: "true");

                servicetool.LaunchServiceTool();
                servicetool.NavigateToEnableFeatures();
                servicetool.SetEnableFeaturesGeneral();
                wpfobject.WaitTillLoad();
                servicetool.ModifyEnableFeatures();
                wpfobject.WaitTillLoad();
                servicetool.EnablePDFReport();
                servicetool.ApplyEnableFeatures();
                wpfobject.WaitTillLoad();
                wpfobject.ClickOkPopUp();
                wpfobject.WaitTillLoad();

                servicetool.NavigateSubTab(ServiceTool.EnableFeatures.Name.Report);
                wpfobject.WaitTillLoad();
                wpfobject.GetButton(ServiceTool.ModifyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                if (!wpfobject.IsCheckBoxSelected(ServiceTool.EnableFeatures.Name.StructuredReports, 1))
                    wpfobject.SelectCheckBox(ServiceTool.EnableFeatures.Name.StructuredReports, 1);
                wpfobject.GetButton(ServiceTool.ApplyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 - Login to WebAccess as Administrator then navigate to domain management page and check in " Enable Report " option
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();

                domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                domainmanagement.SearchDomain(Config.adminGroupName);
                domainmanagement.SelectDomain(Config.adminGroupName);
                domainmanagement.ClickEditDomain();
                domainmanagement.SetCheckBoxInEditDomain("reportview", 0);
                domainmanagement.SetCheckBoxInEditDomain("pdfreport", 0);
                domainmanagement.ClickSaveEditDomain();
                ExecutedSteps++;

                //Step 2 - Navigate to Role management and check in " Enable Report " option
                rolemanagement = (RoleManagement)login.Navigate("RoleManagement");
                rolemanagement.SelectDomainfromDropDown(Config.adminGroupName);
                rolemanagement.SearchRole(Config.adminRoleName);
                rolemanagement.SelectRole(Config.adminRoleName);
                rolemanagement.ClickEditRole();
                rolemanagement.SetCheckboxInEditRole("pdfreport", 0);
                rolemanagement.ClickSaveEditRole();
                ExecutedSteps++;

                //Step 3 - Navigate to Studies,Search any DICOM study which has Report (e.g. PDF Reports) and note down the patient ID and Accession number
                studies = login.Navigate<Studies>();
                studies.SearchStudy(AccessionNo: Accession, Datasource: login.GetHostName(Config.EA1));
                if (GetSearchResults().Count > 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                login.Logout();

                //Step 4 - Open the TestEHR application and enter, Address = http://<BR IP>/WebAccess/
                //         Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //         Example, in Security ID field type: Administrator - Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                //Step 5 - Enter the noted Patient ID and Accession number that is present in the data source configured in "Merge iConnect Service Tool", Select Show Report as 'True' and click on the Cmd line
                ehr.SetSelectorOptions(showReport: "True");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 6 - Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_5);
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                var step11_1 = ehr.CompareImage(step11, Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel)));
                if (step11_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Verify the Report button should be enabled.
                NavigateToIntegratorHomeFrame();
                basepage.ClickElement(GetElement("cssselector", "div.reportDocIcon"));
                Thread.Sleep(5000);
                if (IsElementVisible(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(1)")) &&
                    IsElementVisible(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(2)")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Click the Report icon to preview the study's report.
                //Driver.FindElement(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(2)")).Click();
                basepage.ClickElement(GetElement("cssselector", BluRingViewer.ReportTabList_div + ":nth-of-type(2)"));
                Thread.Sleep(5000);
                var step14 = result.steps[++ExecutedSteps];
                step14.SetPath(testid, ExecutedSteps);
                var step14_1 = ehr.CompareImage(step14, Driver.FindElement(By.CssSelector(BluRingViewer.div_StudyPanel)));
                if (step14_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9:In service tool, Set user sharing - Always disabled and repeat the above steps to launch TestEHR URL with user sharing disabled 
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled", restart: true);

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showReport: "True");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_9);
                NavigateToIntegratorHomeFrame();
                basepage.ClickElement(GetElement("cssselector", "div.reportDocIcon"));
                Thread.Sleep(5000);
                var step9 = result.steps[++ExecutedSteps];
                step9.SetPath(testid, ExecutedSteps);
                var step9_1 = ehr.CompareImage(step9, Driver.FindElement(By.CssSelector(BluRingViewer.div_StudyPanel)));
                if (step9_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Disable Show Report
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162316(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");

                //Preconditions - In the Merge iConnect Access Service tool,
                //1. Configure TestEHR based on the file attached
                //2. Ensure that "Enable Encapsulated PDF" option is not selected from Enable Features - > Report
                //3. Enable User sharing = Always Enabled in integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always Enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                TestFixtures.UpdateFeatureFixture("pdfreport", value: "false");
                servicetool.LaunchServiceTool();
                servicetool.NavigateToEnableFeatures();
                servicetool.NavigateSubTab(ServiceTool.EnableFeatures.Name.Report);
                wpfobject.WaitTillLoad();
                wpfobject.GetButton(ServiceTool.ModifyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                if (wpfobject.IsCheckBoxSelected(ServiceTool.EnableFeatures.Name.StructuredReports, 1))
                    wpfobject.UnSelectCheckBox(ServiceTool.EnableFeatures.Name.StructuredReports, 1);
                wpfobject.GetButton(ServiceTool.ApplyBtn_Name, 1).Click();
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 - Open the TestEHR application and enter, Address = http://<BR IP>/WebAccess/
                //         Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //         Example, in Security ID field type: Administrator - Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                //Step 2 - Enter the noted Patient ID and Accession number that is present in the data source configured in "Merge iConnect Service Tool" , Select Show Report as 'False' and click on the Cmd line
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3 - Copy/Paste the generated URL in a browser on a client system then search.  
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                var step3_1 = ehr.CompareImage(step3, Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel)));
                if (step3_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - verify the report icon displayed for the study under the Exam List.
                NavigateToIntegratorHomeFrame();
                if (IsElementPresent(By.CssSelector("div.reportDocIcon")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Click and verify the Report should not be displayed.
                NavigateToIntegratorHomeFrame();
                basepage.ClickElement(GetElement("cssselector", "div.reportDocIcon"));
                Thread.Sleep(5000);
                if (!IsElementPresent(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(1)")) &&
                    !IsElementPresent(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(2)")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6:In service tool, Set user sharing = Always disabled and repeat the above steps to launch TestEHR URL with user sharing disabled 
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled", restart: true);

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_6);

                NavigateToIntegratorHomeFrame();
                basepage.ClickElement(GetElement("cssselector", "div.reportDocIcon"));
                Thread.Sleep(5000);
                if (!IsElementPresent(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(1)")) &&
                    !IsElementPresent(By.CssSelector(BluRingViewer.ReportTabList_div + ":nth-of-type(2)")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Hide\Show Search Criteria in Search Panel
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162317(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            IntegratorStudies integratorstudies = new IntegratorStudies();
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] PatientId = PatientID.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');

                //Preconditions
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set default viewer as "BluRing" in user preference of Administrator
                //3. Set User Sharing as Always Enabled
                //4. Select Allow Show Selector Search and Allow Show Selector in the integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();

                //Step 1 - Launch the TestEHR application and enter, Address = http://<BR IP>/WebAccess/
                //         Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //         Example, in Security ID field type: Administrator - Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                //Step 2 - Enter the noted Patient ID that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.SetSearchKeys_Study(PatientId[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3 - Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientId[0]) && IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Click the arrow beside 'Hide Search Criteria'.
                NavigateToIntegratorHomeFrame();
                integratorstudies.ExpandBtn().Click();
                if (integratorstudies.expandTextlbl().Text.Equals(ExpandText) &&
                    login.GetElement(SelectorType.Id, "SearchPanelDiv").GetAttribute("style").Contains("display: none;"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Click the arrow beside 'Show Search Criteria'.
                integratorstudies.ExpandBtn().Click();
                if (integratorstudies.expandTextlbl().Text.Equals(HideText) &&
                    !(login.GetElement("id", "SearchPanelDiv").GetAttribute("style").Contains("display: none;")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Perform a few searches.
                ClearText("cssselector", "#ctl00_m_studySearchControl_m_searchInputPatientID");
                patientstudy.StudySearch(FirstName: FirstNames[0]);
                patientstudy.StudySearch(LastName: LastNames[0]);
                Thread.Sleep(5000);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Equals(LastNames[0]) && studyinfo["First Name"][0].Equals(FirstNames[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Select one of the patients and click View.
                patientstudy.SelectPatinet("Last Name", LastNames[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(SelectorType.CssSelector, viewer.Activeviewport);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step7, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Return to the Image Load tab of the TestEHR application. Set 'Show selector Search' to Disabled, enter a valid search, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(PatientId[1], "Patient_ID");
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                var url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_8);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(FirstNames[1]) &&
                    studyinfo["Last Name"][0].Equals(LastNames[1]) &&
                    !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Return to the Image Load tab of the TestEHR application. Set 'Show selector Search' to unspecified, enter a valid search, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters();
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(PatientId[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                ehr.SetSelectorOptions(selectorsearch: "");
                var url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_9);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(FirstNames[0]) &&
                    studyinfo["Last Name"][0].Equals(LastNames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Close icon shall be displayed in Integrated mode
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162318(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            IntegratorStudies integratorstudies = null;
            int ExecutedSteps = -1;
            Studies studies = null;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions                
                //1.See attached instructions for configuring TestEHR in iCA server
                //2.Set default viewer as " BluRing " in user preference of Administrator Configuration in iCA service tool :
                //3.Set User Sharing as Always Enabled
                //4.Select Allow Show search and Allow Show Selector in the integrator tab               
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 - Open the TestEHR.exe and set the
                //                Address to http -//ServerIP/webaccess
                //                User ID - Administrator
                //Security ID-Administrator - Administrator
                //Autoend Session-True
                //Show selector &show selector search -True
                //CloseURL - leave blank
                // Enter 'a*' in the Patient full name field
                // Click on the Cmd line to creat the URL
                //Copy the completed URL and paste it into a browser.

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(closeurl: "", usersharing: "True");
                ehr.SetSearchKeys_Study(PatientID.Split(':')[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 2 -Select one of the patients from the selector page and click on Universal viewer button.
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                patientstudy.SelectPatinet("Accession", AccessionID[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step4, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Verify the "Exit" button should not be displayed in top of the Study viewer.                
                if (IsElementVisible(By.CssSelector(BluRingViewer.div_closeStudyIconControl)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 Close Browser                
                ExecutedSteps++;

                //Step-5 Open the TestEHR.exe and set the
                //                Address to http -//ServerIP/webaccess
                //                User ID - Administrator
                //Security ID-Administrator - Administrator
                //Autoend Session-True
                //Show selector &show selector search -True
                //CloseURL - http -//ICAIPaddress/webaccess
                //Enter 'a*' in the Patient full name field
                //Click on the Cmd line to creat the URL
                //Copy the completed URL and paste it into a browser.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(closeurl: URL, usersharing: "True");
                ehr.SetSearchKeys_Study(PatientID.Split(':')[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                var url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_5);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID.Split(':')[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6 Select one of the patients from the selector page and click on Universal viewer button.
                patientstudy.SelectPatinet("Accession", AccessionID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step6, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7  Verify the "Exit" button should be displayed in top of the Study viewer.                
                if (IsElementVisible(By.CssSelector(BluRingViewer.div_closeStudy)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8 Click the Exit button in the tool bar
                viewer.CloseBluRingViewer();
                if (IsElementVisible(login.By_UserIdTxtBox()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Set Search Priors as "True"
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162319(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions
                //  1. See attached instructions for configuring TestEHR in iCA server Configuration in iCA service tool :
                //  2. Set default viewer as " Universal " in the miscellanious under Viewer tab
                //  3. Set User Sharing as Always Disabled               
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                ////Step 1 - Run Merge iConnect Access Service Tool
                //servicetool.LaunchServiceTool();
                //ExecutedSteps++;

                ////Step 2 - Select Integrator Tab Select Modify button and uncheck the following boxes: Patient ID and Patient Name
                //servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                //servicetool.ClickModifyFromTab();
                //wpfobject.WaitTillLoad();
                //ITabPage currenttab = WpfObjects._mainWindow.Get<Tab>(SearchCriteria.All).SelectedTab;
                //servicetool.PatientIDChkBox().Checked = false;
                //servicetool.PatientFullName().Checked = false;
                //servicetool.PatientLastName().Checked = false;
                //ExecutedSteps++;

                ////Step 3 - Select Apply button.                
                //servicetool.ClickApplyButtonFromTab();
                //if (servicetool.WarningDialogWindow("ERROR").Equals("At least Patient ID or Patient Name should be selected as Related Study Parameters."))
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                ////Step 4 - Re-select Patient ID and Patient Name(Patient Full Name or Patient Last Name).
                //servicetool.PatientIDChkBox().Checked = true;
                //servicetool.PatientFullName().Checked = true;
                ////servicetool.PatientLastName().Checked = true;                
                //ExecutedSteps++;

                ////Step 5 - Select Apply button and IIS reset.
                //if (wpfobject.GetAnyUIItem<ITabPage, Button>(currenttab, ServiceTool.ApplyBtn_Name, 1).Enabled)
                //{
                //    try
                //    {
                //        servicetool.ClickApplyButtonFromTab();
                //        wpfobject.WaitForPopUp();
                //        wpfobject.GetMainWindowByIndex(1);
                //        wpfobject.GetButton(ServiceTool.YesBtn_Name, 1).Click();
                //    }
                //    catch { }
                //    wpfobject.GetMainWindowByIndex(0);
                //    servicetool.RestartService();
                //    servicetool.WaitWhileBusy();
                //}
                //servicetool.CloseConfigTool();
                //ExecutedSteps++;

                //Step 1 -Launch TestEHR application and enter Address - http-//<BR IP>/WebAccess/ Username and Password of a WebAccess user into the Security ID field. Format- *^<^*username*^>^*-*^<^*password*^>^* Example, in Security ID field type- Administrator-Administrator
                //1. In Study UID box, type- (study UID number) 
                //2. Select True from the drop box Search Priors (top left corner). 
                //3. Select True from the drop box Auto End Session 4. Select Load button.               
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                ehr.SetSelectorOptions(SearchPriors: "True");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, autoendsession: "True");
                String url_6 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_6);
                if (bluringviewer.CheckPriorsCount() > 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2 - Close the browser (covered in 9th step)
                ExecutedSteps++;

                //Step 3 - From the TestEHR, select False from the drop box Search Priors.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSelectorOptions(SearchPriors: "False");
                if (wpfobject.GetComboBox("m_searchPriorsComboBox").SelectedItemText.Equals("False"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Select Load button.
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_9);
                if (bluringviewer.CheckPriorsCount() == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Close the browser.
                ExecutedSteps++;

                //Step 6 - From the TestEHR, enter abdomen in the Full Name field and click on Load
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(LastName, "Full_Name");
                String url_11 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_11);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Equals(LastName))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Select one of the patients and click on "Universal viewer" button then verify priors are not listed in Exam List
                patientstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport1 = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step8 = result.steps[++ExecutedSteps];
                step8.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step8, viewport1))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Close Viewer
                ehr.CloseEHR();
                ExecutedSteps++;

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Integrator Desktop - Indirect Study Display:Listing the patients in selector page that match the search criteria
        /// </summary>
        public TestCaseResult Test_162320(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String MiddleName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MiddleName");
                String StudyIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String PatientDOB = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String Gender = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
                String RefPhysician = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "RefPhysician");
                String IPID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "IPID");
                String AccessionID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] Lastname = LastName.Split(':');
                String[] Fname = FirstName.Split(':');
                String[] StudyID = StudyIDList.Split(':');
                String[] dob = PatientDOB.Split(':');
                String[] pid = PatientID.Split(':');

                String URL = "http://" + Config.IConnectIP + "/webaccess";

                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);

                //Step 1 - Launch TestEHR application and enter Address = http://<BR IP>/WebAccess/; Username and Password of a WebAccess user into the Security ID field; Format: *^<^ *username *^>^ *-*^<^ *password *^>^ * ; Example, in Security ID field type: Administrator - Administrator
                ehr.LaunchEHR();
                //Security  ID field populated by default
                ExecutedSteps++;

                //Step-2: Return to the Image Load tab of the TestEHR application. Enable Show selector, enter a first name search, and click on the Cmd Line.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                //ehr.SetSearchKeys_Study(FirstName.Split(':')[0], "First_Name");
                ehr.SetSearchKeys_Study(Fname[0], "First_Name");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-2: " + url_2);
                ExecutedSteps++;

                //Step-3: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                PatientsStudy pstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                var PatientList = pstudy.GetPateintList();
                IList<string> step3 = PatientList["First Name"];

                if (step3.All(p => p.ToLower().Contains(Fname[0].ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Expand one of the patients.
                ehr.expandPatient(Lastname[0]);
                IList<IWebElement> expandedpatient = Driver.FindElements(By.CssSelector(PatientsStudy.css_trChildtableRows));
                if (expandedpatient.Count != 0 && expandedpatient.Any(p => p.Text.Contains(StudyID[0])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[0]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step5 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6: Return to the Image Load tab of the TestEHR application. Clear the first name field, enter a middle name search, and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(MiddleName, "Middle_Name");
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-6: " + url_6);
                ExecutedSteps++;

                //Step-7: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_6);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step7 = PatientList["Last Name"];

                if (step7.All(p => p.ToLower().Contains(Lastname[3].ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8: Expand one of the patients.
                ehr.expandPatient(Lastname[3]);
                expandedpatient = Driver.FindElements(By.CssSelector(PatientsStudy.css_trChildtableRows));
                if (expandedpatient.Count != 0 && expandedpatient[0].Text.Contains(AccessionID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[4]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step9 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10: Return to the Image Load tab of the TestEHR application. Clear the middle name field, enter a last name search, and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Middle_Name");
                ehr.SetSearchKeys_Study(Lastname[0], "Last_Name");
                String url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-10: " + url_10);
                ExecutedSteps++;

                //Step-11: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_10);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step11 = PatientList["Last Name"];

                if (step11.All(p => p.ToLower().Contains(Lastname[0].ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[0]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step12 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-13: Return to the Image Load tab of the TestEHR application. Clear the last name field, enter a patient ID search, and and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(pid[0], "Patient_ID");
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-13: " + url_13);
                ExecutedSteps++;

                //Step-14: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_13);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step14 = PatientList["Patient ID"];

                if (step14.All(p => p.Contains(pid[0])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-15: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[0]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step15 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step15)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-16: Return to the Image Load tab of the TestEHR application. Clear all fields, enter a Patient Name and a patient DOB search,and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Patient_ID");
                ehr.SetSearchKeys_Study(Lastname[1], "Last_Name");
                ehr.SetSearchKeys_Study(dob[0], "Patient_DOB");
                String url_16 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-16: " + url_16);
                ExecutedSteps++;

                //Step-17: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_16);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step17_1 = PatientList["Last Name"];
                IList<string> step17_2 = PatientList["Patient DOB"];

                if (step17_1.All(p => p.ToLower().Contains(Lastname[1].ToLower())) && step17_2.All(p => p.Equals(dob[1])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-18: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[1]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step18 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step18)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-19: Return to the Image Load tab of the TestEHR application. Clear all fields, enter a Patient Name and a patient gender search, and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(Lastname[4], "Last_Name");
                ehr.SetSearchKeys_Study("", "Patient_DOB");
                ehr.SetSearchKeys_Study("", "First_Name");
                //ehr.SetSearchKeys_Study(Fname[1], "First_Name");
                ehr.SetSearchKeys_Study(Gender, "Gender");
                String url_19 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-19: " + url_19);
                ExecutedSteps++;

                //Step-20: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_19);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step20_1 = PatientList["Last Name"];
                IList<string> step20_2 = PatientList["Patient Gender"];

                if (step20_1.All(p => p.ToLower().Contains(Lastname[4].ToLower())) && step20_2.All(p => p.Equals(Gender)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-21: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[3]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step21 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step21)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-22: Return to the Image Load tab of the TestEHR application. Clear the patient gender field, enter a referring physician search, and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Gender");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(Lastname[4], "Last_Name");
                ehr.SetSearchKeys_Study(RefPhysician, "Ref_Physician");
                String url_22 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-22: " + url_22);
                ExecutedSteps++;

                //Step-23: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_22);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step23_1 = PatientList["Last Name"];

                if (step23_1.All(p => p.ToLower().Contains(Lastname[4].ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-24: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[3]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step24 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step24)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-25: Return to the Image Load tab of the TestEHR application. Clear all fields, enter a referring physician search, and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Ref_Physician");
                ehr.SetSearchKeys_Study(RefPhysician, "Ref_Physician");
                String url_25 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-25: " + url_25);
                ExecutedSteps++;

                //Step-26: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_25);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step26_1 = PatientList["Last Name"];

                if (step26_1.All(p => p.ToLower().Contains(Lastname[4].ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-27: Select one of the patients and click View.
                pstudy.SelectPatinet("Patient ID", pid[3]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step27 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step27)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-28: Return to the Image Load tab of the TestEHR application. Clear all fields, enter an Issuer of Patient ID search, and click on the Cmd Line.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Ref_Physician");
                ehr.SetSearchKeys_Study(IPID, "IPID");
                String url_28 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("Generated URL- Step-28: " + url_28);
                ExecutedSteps++;

                //Step-29: Copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_28);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                PatientList = pstudy.GetPateintList();
                IList<string> step29_1 = PatientList["Patient ID"];

                if (PatientList.Count > 2)//step29_1.All(p => p.ToLower().Contains(pid[5].ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-30: Select one of the patients and click Universal viewer.
                pstudy.SelectPatinet("Patient ID", pid[6]);
                pstudy.SelectPatinet("Patient ID", pid[7]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step30 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step30)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-31:Select each study listed in the Exam List Panel
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step31 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ExamPanel());
                if (step31 && GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Contains(MultiplePatientErrorMsg))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                //result.steps[ExecutedSteps++].SetLogs();
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test 137919 - Study Centric
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        /// 
        public TestCaseResult Test_162321(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            IntegratorStudies intgtrStudies = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientDOBList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String[] PatientDOB = PatientDOBList.Split(':');
                String FirstNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNameList.Split(':');
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNameList.Split(':');
                String FullNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientName");
                String[] FullName = FullNameList.Split(':');

                PatientsStudy ps = new PatientsStudy();
                String URL = String.Empty;

                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);

                //Step 1
                //Launch TestEHR, in Image Load tab, select correct url in Address field, 
                //change Selector centricity to Study, enter first name  //Select Load.
                //ALM, Anna 

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name", datasources: login.GetHostName(Config.EA1));
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //Location, Patient Name, Patient ID, Patient DOB, Study ID, Study Date/Time, Accession, Description, Modality, Data Source
                string[] Actualheaders = BasePage.Driver.FindElements(intgtrStudies.Intgr_Header()).Select(head => head.Text).ToArray();
                string[] ExpectedHeaders = new string[] { "Location", "Last Name", "First Name", "Patient ID", "Patient DOB", "Study ID", "Study Date/Time", "Accession", "Description", "Modality", "Data Source" };
                bool status = ExpectedHeaders.All(exh => Actualheaders.Contains(exh));
                DataTable intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] columnvalue = basepage.GetColumnValues(intgrtable, "First Name");
                bool NameExists = columnvalue.All(a => a.Equals(FirstName[0]));
                Logger.Instance.InfoLog("First name column value is: " + columnvalue[0] + "bool value is: " + NameExists);
                Logger.Instance.InfoLog("Column header value is: " + Actualheaders[0] + "bool value is: " + status);
                if (NameExists && status)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-2
                //Observe the order the studies are listed in.
                string[] dateString = basepage.GetColumnValues(intgrtable, "Study Date/Time");

                //Studies sorted first by Assigning Authority (Ascending) and second by Study Date/Time (Descending)

                IList<DateTime> resresult = new List<DateTime>();
                IList<DateTime> dummy = new List<DateTime>();
                for (int i = 0; i < dateString.Length; i++)
                {
                    DateTime res = DateTime.Parse(dateString[i]);
                    resresult.Add(res);
                    dummy.Add(res);
                }
                dummy.OrderByDescending(c => c).ToList();

                if (resresult.SequenceEqual(dummy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-3
                //Select each column header to sort based on the respective column. 
                //Select a second time to sort descending.
                string[] columnval = BasePage.Driver.FindElements(intgtrStudies.Intgr_Header()).Select(head => head.Text).ToArray();
                IList<IWebElement> Actualheaders12 = BasePage.Driver.FindElements(intgtrStudies.Intgr_Header());
                //String[] studycolumns = BasePage.GetColumnNames();
                bool isSortedAsc = false;
                bool isSortedDsc = false;
                for (int i = 2; i < Actualheaders12.Count; i++)
                {
                    isSortedAsc = false;
                    isSortedDsc = false;
                    //Sort Ascending
                    IList<IWebElement> Actualheaders1 = BasePage.Driver.FindElements(intgtrStudies.Intgr_Header());
                    Actualheaders1[i].Click();
                    DataTable intgrtable1 = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                    Thread.Sleep(2000);
                    String column = columnval[i];
                    //Check Sort field - Ascending
                    if (column.Contains("Date"))
                    {

                        DateTime[] values = basepage.GetColumnValues(intgrtable1, column)
                        .Select((date) => DateTime.ParseExact(date, "dd-MMM-yyyy h:mm:ss tt", CultureInfo.InvariantCulture)).ToArray();
                        DateTime[] sortedvalues = values.ToList().OrderBy<DateTime, DateTime>(value => value).ToArray();
                        isSortedAsc = values.SequenceEqual(sortedvalues);
                    }
                    else if (column.Contains("DOB"))
                    {
                        DateTime[] values = basepage.GetColumnValues(intgrtable1, column)
                        .Select((date) => DateTime.ParseExact(date, "dd-MMM-yyyy", CultureInfo.InvariantCulture)).ToArray();
                        DateTime[] sortedvalues = values.ToList().OrderBy<DateTime, DateTime>(value => value).ToArray();
                        isSortedAsc = values.SequenceEqual(sortedvalues);
                    }
                    else
                    {
                        String[] values = basepage.GetColumnValues(intgrtable1, column);
                        String[] sortedvalues = values.ToList().OrderBy<String, String>(value => value).ToArray();
                        isSortedAsc = values.SequenceEqual(sortedvalues);
                    }


                    //Sort Descending   
                    IList<IWebElement> Actualheaders2 = BasePage.Driver.FindElements(intgtrStudies.Intgr_Header());
                    Actualheaders2[i].Click();
                    DataTable intgrtable2 = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                    Thread.Sleep(2000);

                    //Check Sort - Descending
                    if (column.Contains("Date"))
                    {
                        DateTime[] values = basepage.GetColumnValues(intgrtable2, column)
                        .Select((date) => DateTime.ParseExact(date, "dd-MMM-yyyy h:mm:ss tt", CultureInfo.InvariantCulture)).ToArray();
                        DateTime[] sortedvalues = values.ToList().OrderByDescending<DateTime, DateTime>(value => value).ToArray();
                        isSortedDsc = values.SequenceEqual(sortedvalues);
                    }
                    else if (column.Contains("DOB"))
                    {
                        DateTime[] values = basepage.GetColumnValues(intgrtable2, column)
                        .Select((date) => DateTime.ParseExact(date, "dd-MMM-yyyy", CultureInfo.InvariantCulture)).ToArray();
                        DateTime[] sortedvalues = values.ToList().OrderByDescending<DateTime, DateTime>(value => value).ToArray();
                        isSortedDsc = values.SequenceEqual(sortedvalues);
                    }
                    else
                    {
                        String[] values = basepage.GetColumnValues(intgrtable2, column);
                        String[] sortedvalues = values.ToList().OrderByDescending<String, String>(value => value).ToArray();
                        isSortedDsc = values.SequenceEqual(sortedvalues);
                    }
                    if (isSortedAsc && isSortedDsc)
                    {
                        Logger.Instance.InfoLog("Column==" + column + "==Sorted correctly");
                    }
                    else
                    {
                        Logger.Instance.InfoLog("Column==" + column + "==Sorted Incorrectly" + "--isSortedAsc--" + isSortedAsc + "--isSortedDsc--" + isSortedDsc);
                        break;
                    }
                }

                if (isSortedAsc && isSortedDsc)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
               // result.steps[++ExecutedSteps].status = "Not Automated";

                //step-4
                //Select one study, and click on View Exam button
                ps.SelectPatinet("First Name", FirstName[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                //The selected study is loaded in the iCA Enterprise viewer
                IWebElement panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status4 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);

                if (status4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-5
                //Return to the Image Load tab, enter DOB in short date format specified on client system 
                //that matches at least 1 patient in a data source domain and click on Load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                ehr.SetSearchKeys_Study(PatientDOB[0], "Patient_DOB");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //All of the studies matching the query are listed.
                intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] Patient_DOB_5 = basepage.GetColumnValues(intgrtable, "Patient DOB");
                if (Patient_DOB_5.All(new String[] { PatientDOB[1] }.Contains))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-6
                //Select one of the patients and click on View Exam button
                ps.SelectPatinet("Patient DOB", PatientDOB[1]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);

                //The selected study is loaded in the iCA Enterprise viewer
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status6 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);

                if (status6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-7
                //Return to the Image Load tab, enter DOB long date format on client system 
                //that matches at least 1 patient in a data source domain and click on Load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                //PatientDOB[1] 
                ehr.SetSearchKeys_Study(PatientDOB[2], "Patient_DOB");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                //All of the studies matching the query are listed.
                intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] Patient_DOB_7 = basepage.GetColumnValues(intgrtable, "Patient DOB");
                if (Patient_DOB_7.All(new String[] { PatientDOB[3] }.Contains))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-8
                //Select one of the patients and click on View Exam button
                ps.SelectPatinet("Patient DOB", PatientDOB[3]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);

                //The selected study is loaded in the iCA Enterprise viewer
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status8 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);

                if (status8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //step-9
                //Return to the Image Load tab, enter DOB in format specified in (InputDateTimeFormats value e.g. short date format -> e.g. May 10,1988 & long date format e.g. Tuesday, May 10,1988)
                //that matches at least 1 patient in a data source domain and click on Load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                //PatientDOB[2] 
                ehr.SetSearchKeys_Study(PatientDOB[4], "Patient_DOB");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                //All of the studies matching the query are listed.

                intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] Patient_DOB_9 = basepage.GetColumnValues(intgrtable, "Patient DOB");
                if (Patient_DOB_9.All(new String[] { PatientDOB[4] }.Contains))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-10
                //Select one of the patients and click on View Exam button
                ps.SelectPatinet("Patient DOB", PatientDOB[4]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);

                //The selected study is loaded in the iCA Enterprise viewer
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status10 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);

                if (status10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-11
                //Return to the Image Load tab, enter Patient First Name and Last Name 
                //that matches at least one study in existing data source domains and click on Load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                //FullName[0] => CAESAR JULIUS
                ehr.SetSearchKeys_Study(FullName[0].Split(' ')[0], "Last_Name");
                ehr.SetSearchKeys_Study(FullName[0].Split(' ')[1], "First_Name");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //All of the studies matching the query are listed.
                intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] LastName_11 = basepage.GetColumnValues(intgrtable, "Last Name");
                string[] FirstName_11 = basepage.GetColumnValues(intgrtable, "First Name");
                if (LastName_11.All(new String[] { FullName[0].Split(' ')[0] }.Contains) &&
                    FirstName_11.All(new String[] { FullName[0].Split(' ')[1] }.Contains))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-12
                //Select one of the patients and click on View Exam button
                ps.SelectPatinet("Last Name", FullName[0].Split(' ')[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);

                //The selected study is loaded in the iCA Enterprise viewer
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status12 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);

                if (status12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-13
                //Return to the Image Load tab, enter Patient First Name, Middle Name and Last Name 
                //that matches at least one study in existing data source domains and click on Load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                //FullName[1] ==> CASHMORE DUDLEY JAMES
                ehr.SetSearchKeys_Study(FullName[1].Split(' ')[0], "Last_Name");
                ehr.SetSearchKeys_Study(FullName[1].Split(' ')[2], "Middle_Name");
                ehr.SetSearchKeys_Study(FullName[1].Split(' ')[1], "First_Name");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //All of the studies matching the query are listed.
                //FullName[0] ==>
                intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] LastName_13 = basepage.GetColumnValues(intgrtable, "Last Name");
                string[] FirstName_13 = basepage.GetColumnValues(intgrtable, "First Name");
                if (LastName_13.All(new String[] { FullName[1].Split(' ')[0] }.Contains) &&
                    FirstName_13.All(new String[] { FullName[1].Split(' ')[1] }.Contains))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-14
                //Select one of the patients and click on View Exam button
                //FullName[1] ==>CASHMORE DUDLEY JAMES
                ps.SelectPatinet("Last Name", FullName[1].Split(' ')[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);

                //The selected study is loaded in the iCA Enterprise viewer
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status14 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);

                if (status14)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-15
                //Return to the Image Load tab, enter PatientName value 
                //that matches at least one study in existing data source domains & click on Load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(selectoroption: "Study");
                //FullName[2] ==>FINNERAN
                ehr.SetSearchKeys_Study(FullName[2], "Full_Name");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(URL);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                //All of the studies matching the query are listed.
                //FullName[1] ==>
                intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] LastName_15 = basepage.GetColumnValues(intgrtable, "Last Name");
                string[] FirstName_15 = basepage.GetColumnValues(intgrtable, "First Name");
                if (LastName_15.All(new String[] { FullName[2] }.Contains))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-16
                //Select one of the patients and click on View Exam button
                //FullName[2] ==>

                //FullName[1] ==>CASHMORE DUDLEY JAMES
                ps.SelectPatinet("Last Name", FullName[2]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);

                //The selected study is loaded in the iCA Enterprise viewer
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status16 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);
                if (status16)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test With User ID
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162322(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Patient_DOBs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String MiddleNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MiddleName");
                String AccessionIDList1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                String[] arrstudyuid = StudyUID.Split(':');
                String[] AccessionID = Accession.Split(':');
                String[] LastName = LastNames.Split(':');
                String[] FirstName = FirstNames.Split(':');
                String[] Patient_DOB = Patient_DOBs.Split(':');
                String[] MiddleName = MiddleNames.Split(':');
                String[] AccessionList_1 = AccessionIDList1.Split(':');

                //Precondition - Show Selector = False      
                //1.See attached instructions for configuring TestEHR in iCA server
                //2.Set default viewer as " BluRing " in the miscellanious under Viewer tab
                //3.Set User Sharing as Always Disabled
                //4.Configure the InputDateTimeFormats set it to MM / dd / yyyy or yyyy / MM / dd.
                //5.Select Allow show selector & Allow show selector search in integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                servicetool.WaitWhileBusy();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                ITabPage currenttab = WpfObjects._mainWindow.Get<Tab>(SearchCriteria.All).SelectedTab;
                Button applybutton = wpfobject.GetAnyUIItem<ITabPage, Button>(currenttab, ServiceTool.ApplyBtn_Name, 1);
                currenttab.Click();
                wpfobject.setTextInTextBoxUsingIndex(1, "MM/dd/yyyy");
                if (wpfobject.GetAnyUIItem<ITabPage, Button>(currenttab, ServiceTool.ApplyBtn_Name, 1).Enabled)
                {
                    servicetool.ClickApplyButtonFromTab();
                    try
                    {
                        wpfobject.WaitForPopUp();
                        wpfobject.GetMainWindowByIndex(1);
                        wpfobject.GetButton(ServiceTool.YesBtn_Name, 1).Click();
                    }
                    catch { }
                    wpfobject.GetMainWindowByIndex(0);
                    servicetool.RestartService();
                    servicetool.WaitWhileBusy();
                }
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1 - Launch TestEHR               
                ehr.LaunchEHR();
                ExecutedSteps++;

                //Step 2 - Return to the Image Load tab, enter the Study Instance UID that matches no studies in any data source domains. 
                //         Ensure that Show Report is enabled, Show selector is not enabled, and click Load.                             
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "", showReport: "True");
                ehr.SetSearchKeys_Study(arrstudyuid[0], "Study_UID");
                String url_2 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step2_1 = ehr.ErrorMsg();
                //if (Step2_1.Trim().Equals("Error Occurred in operation: The study cannot be located, or it does not contain any images or reports that are supported by iCA. Please contact PACS team."))
                if (Step2_1.Trim().Equals("Error Occurred in operation: No studies that match the search criteria could be found."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Return to the Image Load tab of the TestEHR application. Clear the Study UID field, 
                //         enter the Accession Number that matches one study that is in one of the data source domains and click Load.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "", showReport: "");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Accession.Split(':')[0]);
                String url_3 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                var viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Return to the Image Load tab of the TestEHR application. Clear the Search keys fields, 
                //         enter Study UIDs or Accession Numbers that matches multiple studies for one patient that is in one data source Domain and click Load.
                //         Note: "\" should be given when multiple values are given in Accession or Study UID field (Eg: Acc#1\Acc#2)
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionList_1[0]);
                String url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                IList<IWebElement> AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                //if (bluringviewer.CompareImage(step4, viewport)
                //    && bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionList_1[0].Split('\\')[0])
                //    && AccessionExamList[1].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionList_1[0].Split('\\')[0])
                //    && AccessionExamList[2].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionList_1[0].Split('\\')[1]))
                if (bluringviewer.CompareImage(step4, viewport)
                    && bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionList_1[0].Split('\\')[0]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5:In Exam list,verify the requested study instance IDs or Accession numbers should be listed based on date newest or most recent date.
                if (AccessionExamList[0].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionList_1[0].Split('\\')[0])
                    && AccessionExamList[1].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionList_1[0].Split('\\')[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Return to the Image Load tab of the TestEHR application. Clear the Search keys fields, 
                //         enter Study UIDs or Accession Numbers that matches multiple studies for multiple patients 
                //         that are from the same Assigning Authority and click Load.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "", showReport: "");
                ehr.SetSearchKeys_Study(AccessionList_1[1], datasources: login.GetHostName(Config.EA1));
                String url_5 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_5);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step5, viewport)
                    && bluringviewer.CheckAccession_ExamList(new string[] { AccessionID[4], AccessionID[5] })
                    && Driver.FindElement(By.TagName("body")).Text.Contains("Studies listed below may not belong to the same patient"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Return to the Image Load tab of the TestEHR application. 
                //         Clear the study UID field, enter an accession number that does not match any studies and click Load.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionID[6], datasources: login.GetHostName(Config.EA1));
                String url_6 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_6);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step6_1 = ehr.ErrorMsg();
                if (Step6_1.Trim().Equals("Error Occurred in operation: No studies that match the search criteria could be found."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - set show selector False in TestEHR. Return to the Image Load tab of the TestEHR application. 
                //         Clear the study UID field, enter an accession number that matches multiple studies and click Load.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionID[7]);
                String url_7 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_7);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step7_1 = ehr.ErrorMsg();
                //if (Step7_1.Trim().Equals("Error Occurred in operation: No studies that match the search criteria could be found."))
                if (Step7_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Return to the Image Load tab, enter Patient query parameters that matches 1 patient with 1 study in a data source domain. 
                //         Ensure to enter the Study UID or Accession number. Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study("");
                ehr.SetSearchKeys_Study(arrstudyuid[2], "Study_UID");
                String url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_8);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step8 = result.steps[++ExecutedSteps];
                step8.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step8, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Return to the Image Load tab, enter Patient Name that matches 1 patient with multiple studies in one data source domain.
                //         Ensure to enter the Study UID. Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(arrstudyuid[3], "Study_UID");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_9);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step10_1 = ehr.ErrorMsg();
                //if (Step7_1.Trim().Equals("Error Occurred in operation: No studies that match the search criteria could be found."))
                if (Step10_1.Trim().Equals("Error Occurred in operation: Other search criteria must not be specified when Study Instance UID is provided."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Return to the Image Load tab, enter Patient query parameters that matches 1 patient with multiple studies from multiple Assigning Authorities. 
                //          Ensure to enter the Study UID or Accession number. Ensure that Show Report is True, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", SearchPriors: "True");
                ehr.SetSearchKeys_Study(arrstudyuid[4], "Study_UID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_10);
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step10 = result.steps[++ExecutedSteps];
                step10.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step10, viewport)
                    && bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionID[10])
                    && AccessionExamList[0].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[9])
                    && AccessionExamList[1].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[10]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12 - Return to the Image Load tab, enter DOB in format yyyy.MM.dd that matches at least 1 patient in a data source domain. 
                //          Ensure that Show Report is True, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True", SearchPriors: "True");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                String url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_11);
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step11, viewport)
                    && AccessionExamList[0].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[8]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Return to the Image Load tab, enter DOB in format yyyyMMdd that matches at least 1 patient in a data source domain. 
                //          Ensure to enter the Study UID or Accession number. Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(Patient_DOB[1], "Patient_DOB");
                String url_12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_12);
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step12 = result.steps[++ExecutedSteps];
                step12.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step12, viewport)
                    && AccessionExamList[0].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[8]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 14 - Return to the Image Load tab, enter DOB in format specified in precondition 6 (InputDateTimeFormats value) that matches at least 1 patient in a data source domain. 
                //          Ensure to enter the Study UID or Accession number. Ensure that Show Report is enabled, Show selector is not enabled, and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(Patient_DOB[2], "Patient_DOB");
                String url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_13);
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step13 = result.steps[++ExecutedSteps];
                step13.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step13, viewport)
                    && AccessionExamList[0].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[8]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 15 - Return to the Image Load tab, enter Patient First Name, Middle Name and Last Name that matches at least one study in existing data source domains. 
                //          Ensure to enter the Study UID or Accession number. Ensure that Show Report is enabled, Show selector is not enabled, and click Load.            
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(MiddleName[0], "Middle_Name");
                ehr.SetSearchKeys_Study(arrstudyuid[1], "Study_UID");
                String url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_14);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step14_1 = ehr.ErrorMsg();
                bool ErrorMessage1 = Step14_1.Contains("Error Occurred in operation: Other search criteria must not be specified when Study Instance UID is provided.");

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(AccessionID[7]);
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name");
                url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_14);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step14_2 = ehr.ErrorMsg();
                bool ErrorMessage2 = Step14_2.Contains("Error Occurred in operation: Other search criteria must not be specified when Study Instance UID is provided.");

                if (ErrorMessage1 || ErrorMessage2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 16 - Return to the Image Load tab of the TestEHR application. Clear the Search keys fields, enter two Study UIDs separated by"\"and enter two Datasources that match the studies.
                //          Study UIDs and datasources are paired one to one so that UID1\UID2 is paired to DS1\DS2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(arrstudyuid[6] + "\\" + arrstudyuid[7], "Study_UID");
                String url_15 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_15);
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step15 = result.steps[++ExecutedSteps];
                step15.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step15, viewport)
                    && AccessionExamList[0].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[15])
                    && AccessionExamList[1].GetAttribute("innerText").Split(':')[1].Trim().Equals(AccessionID[16]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test 137924 - Set 'Show close' to unspecified or Leave as Blank
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162323(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();
                login.CreateNewSesion();

                //Step 1                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                //Step 2
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetCommonParameters(showclose: "");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3     
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                var isExitButtonDisabled = false;
                try
                {
                    var button = viewer.GetElement(BasePage.SelectorType.CssSelector, "div.toolIconControl.exitIcon-disabled");
                    if (button != null)
                        isExitButtonDisabled = true;
                }
                catch (Exception) { isExitButtonDisabled = false; }
                if (isExitButtonDisabled)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                login.CreateNewSesion();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test 137925 - Disable Show close and ensure Show selector is enabled
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162324(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                //Step 2
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 4
                patientstudy.SelectPatinet("Patient ID", PatientID[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step4, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                var isExitButtonFound = false;
                try
                {
                    var button = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_closeStudy);
                    if (button.Displayed)
                        isExitButtonFound = true;
                }
                catch (Exception) { }
                if (!isExitButtonFound)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test 137933 - Enable Use Post Method in TestEHR Tool
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162325(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usepostmethod: "check");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetCommonParameters(showclose: "");
                ehr.SetSearchKeys_Study(Accession, "");
                var url_1 = ehr.clickCmdLine("ImageLoad");
                var postfilepath1 = ehr.GetPostFilePath();
                ehr.CloseEHR();

                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: postfilepath1);
                var viewport1 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step1 = result.steps[++ExecutedSteps];
                step1.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step1, viewport1))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-2
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usepostmethod: "");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                var pstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = pstudy.GetPateintList();
                if (studyinfo["Patient ID"].Contains(PatientID[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                pstudy.SelectPatinet("Patient ID", PatientID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport3 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, viewport3))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usepostmethod: "check");
                var postfilepath4 = ehr.GetPostFilePath();
                ehr.CloseEHR();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(postfilepath4);
                studyinfo = pstudy.GetPateintList();
                if (studyinfo["Patient ID"].Contains(PatientID[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                pstudy.SelectPatinet("Patient ID", PatientID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport5 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                ehr.CloseEHR();
                if (viewer.CompareImage(step5, viewport5))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usepostmethod: "");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                var url_6 = ehr.clickCmdLine("ImageLoad");
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_6);
                var viewport6 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step6, viewport6))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7
                login.CreateNewSesion();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usepostmethod: "check");
                var postfilepath7 = ehr.GetPostFilePath();
                ehr.CloseEHR();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: postfilepath7);
                var viewport7 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step7, viewport7))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result                                
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Integrator Desktop - Patient Centric
        /// </summary>
        public TestCaseResult Test_162326(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastname = LastName.Split(':');
                String[] pid = PatientID.Split(':');

                String URL = "http://" + Config.IConnectIP + "/webaccess";

                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);

                //Step 1 - Launch TestEHR, in the Image Load tab change Selector centricity to Patient, and enter some value for Patient First Name which will return multiple studies from multiple data source domains
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(selectoroption: "Patient");
                ehr.SetSearchKeys_Study(FirstName.Split(':')[0], "Last_Name");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                PatientsStudy pstudy = PatientsStudy.LaunchPatientsStudyPage(url_1);
                string[] colNames = new string[] { "Location", "Last Name", "First Name", "Patient ID", "Patient DOB", "Patient Gender", "Most Recent Study" };
                string[] subcolNames = new string[] { "Study ID", "Study Date/Time", "Accession", "Description", "Modality", "Data Source" };
                WebDriverWait wait = new WebDriverWait(Driver, TimeSpan.FromSeconds(5));
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                IList<String> col = ehr.GetColumnNames();
                bool step1 = col.SequenceEqual(colNames);
                if (step1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2 - Expand some of the patients.
                ehr.expandPatient(Lastname[1]);
                ehr.expandPatient(Lastname[0]);
                //Validate the columns are in expected order
                IList<String> col2 = ehr.GetColumnNames(1);
                bool step2 = col2.SequenceEqual(subcolNames);
                if (step2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Observe the order the patients are listed in.
                bool[] step3 = pstudy.IsListSorted("Most Recent Study", "descending", isColumnDateField: true);
                if (ValidateBoolArray(step3))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Select each column header to sort based on the respective column. Select a second time to sort descending.
                var js = (IJavaScriptExecutor)Driver;
                IWebElement header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_LastName);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();

                bool[] step4_1 = pstudy.IsListSorted("Last Name");  //Ascending order
                bool arrow_1 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Asc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_LastName);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_2 = pstudy.IsListSorted("Last Name", "descending");  //descending order
                bool arrow_2 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Desc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_FirstName);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_3 = pstudy.IsListSorted("First Name");  //Ascending order
                bool arrow_3 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Asc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_FirstName);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_4 = pstudy.IsListSorted("First Name", "descending");  //descending order
                bool arrow_4 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Desc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_PatientID);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_5 = pstudy.IsListSorted("Patient ID");  //Ascending order
                bool arrow_5 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Asc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_PatientID);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_6 = pstudy.IsListSorted("Patient ID", "descending");  //descending order
                bool arrow_6 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Desc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_DOB);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_7 = pstudy.IsListSorted("Patient DOB", isColumnDateField: true);  //Ascending order
                bool arrow_7 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Asc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_DOB);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_8 = pstudy.IsListSorted("Patient DOB", "descending", isColumnDateField: true);  //descending order
                bool arrow_8 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Desc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_MostRecentStudy);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_9 = pstudy.IsListSorted("Most Recent Study", isColumnDateField: true);  //Ascending order
                bool arrow_9 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Asc");

                header = GetElement(SelectorType.Id, PatientsStudy.SelectorTitle_MostRecentStudy);
                if (SBrowserName.ToLower().Equals("internet explorer"))
                    js.ExecuteScript("arguments[0].click()", header);
                else
                    header.Click();
                bool[] step4_10 = pstudy.IsListSorted("Most Recent Study", "descending", isColumnDateField: true);  //descending order
                bool arrow_10 = header.FindElement(By.TagName("img")).GetAttribute("src").Contains("Desc");

                if (ValidateBoolArray(step4_1) && ValidateBoolArray(step4_2) && ValidateBoolArray(step4_3) && ValidateBoolArray(step4_4) && ValidateBoolArray(step4_5) && ValidateBoolArray(step4_6) && ValidateBoolArray(step4_7) && ValidateBoolArray(step4_8) && ValidateBoolArray(step4_9) && ValidateBoolArray(step4_10)
                    && arrow_1 && arrow_2 && arrow_3 && arrow_4 && arrow_5 && arrow_6 && arrow_7 && arrow_8 && arrow_9 && arrow_10)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5: Select one patient which has only 1 study, and select View.
                pstudy.SelectPatinet("Patient ID", pid[0]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step5 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6: Close the Viewer and Reload the URL from TestEHR
                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_1);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                col = ehr.GetColumnNames();
                bool step6 = col.SequenceEqual(colNames);
                if (step6)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7: Select multiple patients from multiple Assigning Authorities, and select View.
                pstudy.SelectPatinet("Patient ID", pid[0]);
                pstudy.SelectPatinet("Patient ID", pid[1]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);

                if (GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Contains(MultiplePatientErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                ////Step-8: Click on "Exam" panel and select each study from the Viewer Study Selector. Observe the, patient information menu (Verify Patient ID updates).
                //if (GetElement(SelectorType.CssSelector, BluRingViewer.HistoryPanel_div).GetCssValue("left").Contains("-"))
                //{
                //    bluringviewer.OpenExamList();
                //}

                ////Exam list is appeared instantly without any animation effect 
                //IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                //Exam_list[0].Click();
                //BluRingViewer.WaitforViewports();
                //Exam_list[1].Click();
                //BluRingViewer.WaitforViewports();
                //if (Exam_list[0].Displayed == true &&
                //    Exam_list[1].Displayed == true)
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                ////Step-9: Select a different layout. Verify the Patient Information is unchanged.
                ////Get patient information before layout change
                //string step9_1 = GetElement(SelectorType.CssSelector, BluRingViewer.div_PatientInfoContainer).Text;
                //bluringviewer.ChangeViewerLayout("3x2");
                //string step9_2 = GetElement(SelectorType.CssSelector, BluRingViewer.div_PatientInfoContainer).Text;
                //if (step9_1 == step9_2)
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test 137935 - Set 'Show Selector' to unspecified or Leave as Blank
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162327(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String DataSource = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";
                String logoutUrl = @"http://localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True
                                   &Culture=en-us&UserID=Administrator&SecurityID=Administrator-Administrator&operation=EndSession";


                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1  - Patient ID               
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetCommonParameters(showclose: "");
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(DataSource, "Datasource");
                var url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_1);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 2
                patientstudy.SelectPatinet("Patient ID", PatientID[0]);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (IsElementPresent(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3 Accession                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetCommonParameters(showclose: "");
                ehr.SetSearchKeys_Study(AccessionID[0], "");
                ehr.SetSearchKeys_Study(DataSource, "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step3, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 Study UID                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetCommonParameters(showclose: "");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                ehr.SetSearchKeys_Study(DataSource, "Datasource");
                var url_3 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step4, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5 Apply tools
                bluringviewer.SelectViewerTool(BluRingTools.Line_Measurement);
                bluringviewer.ApplyTool_LineMeasurement();
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step5, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6  
                IJavaScriptExecutor js = (IJavaScriptExecutor)BasePage.Driver;
                js.ExecuteScript("window.open();");
                IList<string> tabs = new List<string>(Driver.WindowHandles);
                BasePage.Driver.SwitchTo().Window(tabs[1]);
                BasePage.Driver.Navigate().GoToUrl(logoutUrl);
                PageLoadWait.WaitForPageLoad(15);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);
                var logoutimage = BasePage.FindElementByCss("div#greyBox");
                if (bluringviewer.CompareImage(step6, logoutimage, isCaptureScreen: true))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7  
                Thread.Sleep(5000);             
                BasePage.Driver.SwitchTo().Window(tabs[0]);
                bluringviewer.SetDriver(BasePage.Driver);
                PageLoadWait.WaitForFrameLoad(10);
                Thread.Sleep(2000);
                var viewport = BasePage.FindElementByCss(bluringviewer.Activeviewport);
                bluringviewer.OpenViewerToolsPOPUp(viewport.Size.Height / 4, viewport.Size.Width / 4);
                var toolcount = bluringviewer.GetToolsInToolBoxByGrid().Count;
                if (toolcount == 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result               
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Integrator Desktop - Multiple studies from different patients
        /// </summary>
        public TestCaseResult Test_162328(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientName");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastname = LastName.Split(':');
                String[] pdetails = PatientName.Split(':');

                String URL = "http://" + Config.IConnectIP + "/webaccess";

                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False", restart: true);

                //Step 1 - Launch TestEHR, in Image Load tab enter multiple study instance UIDs such that there are 2 from the same patient and 1 is from a different patient and click on load button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", url: url_1);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step1 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step1 && GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Contains(MultiplePatientErrorMsg))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-2: Select each study listed, observe the Patient Information displayed.
                bluringviewer.OpenPriors(0);
                bluringviewer.OpenPriors(2);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bluringviewer.NavigateToIntegratorFrame("bluring");
                int step2 = bluringviewer.AllstudyPanel().Count;
                if (step2 == 3 && Driver.FindElements(By.CssSelector(BluRingViewer.div_PatientInfoContainer))[1].Text.Contains(PatientName))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3: Load a series from thumbnails.
                TestCompleteAction action = new TestCompleteAction();
                IList<IWebElement> ThumbnailList = bluringviewer.ThumbnailIndicator(2);
                int ThumbnailCount = ThumbnailList.Count;

                // Drag the 2nd last thumbnail to the first viewport
                bluringviewer.SetViewPort(0, 3);
                IWebElement TargetElement = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                action = new TestCompleteAction();
                action.DragAndDrop(ThumbnailList[ThumbnailCount - 1], TargetElement).Perform();
                Thread.Sleep(5000);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step3 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4: Close the viewer and Navigate to TestEHR Tool,Load multiple studies by entering noted Accession Numbers such that there are 2 from the same patient and 1 is from a different patient.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSearchKeys_Study(Accession, "");
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Launch URL
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", url: url_4);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step4 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step4 && GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Contains(MultiplePatientErrorMsg))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5: Select each study listed, observe the Patient Information displayed.
                bluringviewer.OpenPriors(0);
                bluringviewer.OpenPriors(2);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bluringviewer.NavigateToIntegratorFrame("bluring");
                int step5 = bluringviewer.AllstudyPanel().Count;
                if (step5 == 3 && Driver.FindElements(By.CssSelector(BluRingViewer.div_PatientInfoContainer))[1].Text.Contains(PatientName))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6: Load a series from each study.
                ThumbnailList = bluringviewer.ThumbnailIndicator(0);
                ThumbnailCount = ThumbnailList.Count;

                // Drag the 2nd last thumbnail to the first viewport
                bluringviewer.ScrollIntoView(ThumbnailList.ElementAt(ThumbnailCount - 2));
                bluringviewer.SetViewPort(0, 1);
                TargetElement = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                action = new TestCompleteAction();
                action.DragAndDrop(ThumbnailList[ThumbnailCount - 2], TargetElement).Perform();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step6 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Integrator Desktop - multiple studies from DICOM data source
        /// </summary>
        public TestCaseResult Test_162329(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String StudyDescription = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyDescription");
                String StudyUIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDList.Split(':');
                String[] description = StudyDescription.Split(':');

                String URL = "http://" + Config.IConnectIP + "/webaccess";

                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False", restart: true);

                //Step 1 - Open the test EHR application, disable Show selector.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "False");
                ExecutedSteps++;

                //Step-2: Load multiple studies by entering the study instance UIDs of the patient that are stored in DICOM data source.
                //ehr.SetSearchKeys_Study(FirstName.Split(':')[0], "First_Name");
                ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
                String url_1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL1: " + url_1);

                //Click Load Study.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_1);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step2 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step2 && bluringviewer.AllStudyInfoAtStudyPanel()[0].GetAttribute("innerHTML").Contains(description[0]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3: Use two data sources one Merge PACS and one EA, make sure the study exist in both the Merge PACS archive and the EA archive.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(StudyUID[1], "Study_UID");
                String url_3 = ehr.clickCmdLine("ImageLoad");
                Logger.Instance.InfoLog("URL : " + url_3);
                ehr.CloseEHR();

                //Click Load Study.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                if (bluringviewer.AllStudyInfoAtStudyPanel()[0].GetAttribute("innerHTML").Contains(description[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4: Verify the study should be loaded into the user Preferences viewer(BluRing viewer).
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step4 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                //result.steps[ExecutedSteps++].SetLogs();
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Test 137938 - Compression mode preference Lossy
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162330(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ExecutedSteps++;

                //Step 2
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetCommonParameters(showclose: "");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3     
                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Lossless: Turn off compression mode in the User Preference window
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162331(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = @"http://" + Config.IConnectIP + @"/webaccess";

                //Preconditions
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set default viewer as " BluRing " in user preference of Administrator
                //3. Set PNG(Lossless) option for Image format in the user preference of Administrator
                //4. Set User Sharing as Always Enabled
                //5. Select Allow Show search and Allow Show Selector in the integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.PNGRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - Launch TestEHR application and enter Address = http://<BR IP>/WebAccess/
                //         Username and Password of a WebAccess user into the Security ID field.
                //         Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //         Example, in Security ID field type: Administrator - Administrator                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ExecutedSteps++;

                //Step 2 - Enter the noted Patient ID and Accession number that is present in the data source configured in "Merge iConnect Service Tool" and click on the Cmd line
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                String url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step 3 - Click on Load and copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);
                if (!Driver.FindElement(By.TagName("body")).Text.Contains("Lossy Compressed") &&
                    Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() > 0)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.JPEGRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();
            }
        }

        /// <summary>
        /// Test 137940 - ShowSelector=True|ShowSelectorSearch=False and showSelector/ShowSelectorSearch=False
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162332(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String AccessionList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] Accession = AccessionList.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String FirstNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNameList.Split(':');
                String LastNameList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNameList.Split(':');

                String URL = String.Empty;
                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Step 1
                //Test data
                ExecutedSteps++;

                //step-2
                //Show Selector = false
                //Show Selector Search = false
                //Enter Accession number to search a patient with multiple priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(Accession[0]); //A120986
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step_2 = ehr.ErrorMsg();
                if (Step_2.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-3
                //Replace a Accession number which is unique among these priors. Launch URL and Click on 'View Exam' button.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(Accession[1]); //ACC10666401
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //The only matching study is loaded into the iCA Enterprise viewer.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                IWebElement panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status3 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);
                if (status3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-4
                //Leave all patient/study fields empty. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //Only Error message shows that indicates Error Occurred in operation: Study search fields are all empty. Open query is not permitted.
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step_4 = ehr.ErrorMsg();
                if (Step_4.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-5
                //Enter a Study UID from a patient with multiple priors. Launch URL and Click on 'View Exam' button..
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID"); //ACC10666401
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //The only matching study is loaded into the iCA Enterprise viewer.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status5 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);
                if (status5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-6
                //Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.              
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name"); //ALM
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step_6 = ehr.ErrorMsg();
                //Only Error message shows that indicates Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study.
                if (Step_6.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-7
                //Now add the patient First Name with multiple priors, and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name"); //Anna
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step_7 = ehr.ErrorMsg();
                //Only Error message shows that indicates Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study.
                if (Step_7.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-8
                //Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), ,Launch URL and click on 'View Exam' button.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name"); //uique - 
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //The only matching study is loaded into the iCA Enterprise viewer.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                panel = GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status8 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);
                if (status8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-9
                //Change patient last name and first name, where the patient only has no priors ,Launch URL and click on 'View Exam' button.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(LastName[1], "Last_Name"); //uique - 
                ehr.SetSearchKeys_Study(FirstName[1], "First_Name"); //uique - 
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //The only matching study is loaded into the iCA Enterprise viewer.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                panel = GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status9 = bluringviewer.CompareImage(result.steps[ExecutedSteps], panel);
                if (status9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        ///  ShowSelector=True|ShowSelectorSearch=False and showSelector/ShowSelectorSearch=Empty
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162336(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String PID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String[] Lastnames = LastName.Split(':');
                String[] Firstnames = FirstName.Split(':');
                String[] Acclist = Accession.Split(':');
                String[] PIDlist = PID.Split(':');

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition         
                //1. See attached instructions for configuring TestEHR in iCA server Configuration in iCA service tool
                //2. Set default viewer as " BluRing " in the miscellaneous under Viewer tab
                //3. Set User Sharing as Always Disabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - 	iCA 7.0 server under testing is configured and is able to load images from the connected data sources          
                ExecutedSteps++;

                //Step 2 - Required test date in data sources-
                //1) A Patient with at least 3 studies
                //2) A patient with at least 3 studies in which there is a study that has a unique Accession number
                //2)  At least there are 3 patient with same last name but different first names, these patients only has 1 study.
                //3) A patient's name is unique from all accessed data sources               
                ExecutedSteps++;

                //Step 3 -Test Data: 
                //Launch TestEHR application, Test Data: Show Error, False, False
                //Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\*^<^ *add key = "Integrator.OnMultipleStudy"value = "Show Error"/*^>^*
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\*^<^*AllowShowSelector*^>^*false*^<^*/AllowShowSelector *^>^ *
                //*^<^ *AllowShowSelectorSearch *^>^ *false *^<^ */ AllowShowSelectorSearch *^>^ *
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();
                ehr.LaunchEHR();
                ExecutedSteps++;

                //Step 4 - In the TestEHR tool, change the following settings only:
                //         Show Selector = blank
                //         Show Selector Search = blank
                //         Enter Accession number to search a patient with multiple priors                
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_4);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step4_1 = ehr.ErrorMsg();
                if (Step4_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - 	Replace a Accession number which is unique among these priors. Launch URL.  
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_5 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_5);
                var viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step5, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - 	Leave all patient/study fields empty. Launch URL.   
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                String url_6 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_6);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step6_1 = ehr.ErrorMsg();

                if (Step6_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - 	Enter a Study UID from a patient with multiple priors. Launch URL.	 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                ehr.SetSelectorOptions(SearchPriors: "True");
                String url_7 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_7);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step7, viewport) && bluringviewer.CheckPriorsCount() > 1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - 	Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                String url_8 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_8);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step8_1 = ehr.ErrorMsg();

                if (Step8_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Now add patient First Name where the patient has multiple priors , and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                String url_9 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_9);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step9_1 = ehr.ErrorMsg();

                if (Step9_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                String url_10 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_10);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step10_1 = ehr.ErrorMsg();

                if (Step10_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Change patient last name and first name, where the patient only has no priors
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[1], "Last_Name");
                String url_11 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_11);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step11_1 = ehr.ErrorMsg();

                if (Step11_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
            }
        }

        /// <summary>
        /// Test 137945 - Display Series Thumbnail Image in Integrator Mode
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        /// 
        public TestCaseResult Test_162337(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            login = new Login();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String StudyUIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDList.Split(':');
                String SeriesUIDList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SeriesUID");
                String[] SeriesUID = SeriesUIDList.Split(':');
                String Height = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Height");
                String Width = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Width");
                servicetool.CloseServiceTool();

                //Close browser
                //Step 1
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ITabPage currenttab = ehr.GetCurrentTabItem();
                if (wpfobject.GetAnyUIItem<ITabPage, TextBox>(currenttab, "m_addressTextBox").Text.Equals("http://localhost/WebAccess"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                String url_2 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_2);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                var viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step2 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[1]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[1]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                String url_3 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_3);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step3 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[1]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                String url_4 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_4);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step4 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[3]);
                String url_5 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_5);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step5 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();

                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[7]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[10]);
                String url_6 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_6);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForPageLoad(10);

                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step6 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[5]);
                String url_7 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_7);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step7 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step7)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[6]);
                String url_8 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_8);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step8 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[3]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[3]);
                String url_9 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_9);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step9 = login.CompareImage(result.steps[ExecutedSteps], viewport);

                if (step9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[2]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[6]);
                String url_10 = ehr.clickCmdLine("ThumbnailView");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_10);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step10 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11
                ehr.LaunchEHR();
                wpfobject.SelectTabFromTabItems("Thumbnail View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[6]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[9]);
                String url_11 = ehr.clickCmdLine("ThumbnailView");

                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_11);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                PageLoadWait.WaitForFrameLoad(10);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step11 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step11)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.FocusWindow();
                currenttab = ehr.GetCurrentTabItem();
                String url_12 = ehr.ClickLogout("ThumbnailView");
                ehr.CloseEHR();

                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                login.CreateNewSesion();
                login.NavigateToIntegratorURL(url_12);
                viewport = BasePage.Driver.FindElement(By.XPath("/html/body/img"));
                bool step12 = login.CompareImage(result.steps[ExecutedSteps], viewport);
                if (step12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Thumbnail Image Width and Height
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162338(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String SeriesUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SeriesUID");
                String Height = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Height");
                String Width = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Width");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                String[] StudyUID = StudyUIDs.Split(':');
                String[] SeriesUID = SeriesUIDs.Split(':');

                //Precondition
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set default viewer as " BluRing " in the miscellaneous under Viewer tab
                //3. Set User Sharing as Always Disabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.RestartIISandWindowsServices();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - Open the TestEHR application to the Thumbnail View tab, enter the address for the iConnect Access server.             
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Thumbnail view");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ExecutedSteps++;

                //Step 2 - Enter the address for the iConnect Access server, Fill in valid study and series instance UIDs.
                login.CreateNewSesion();
                ehr.SetCommonParameters(user: Config.adminUserName, domain: Config.adminGroupName, usersharing: "",
                                        SecurityID: Config.adminUserName + "-" + Config.adminUserName, autoendsession: "True");
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                String url_2 = ehr.clickCmdLine("ThumbnailView");

                login.CreateNewSesion();
                var bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var viewport = GetElement(SelectorType.Xpath, "/html/body/img");
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step2, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Display series thumbnail with invalided Thumbnail Width and Height value (e.g., negative value, zero, character...
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Thumbnail view");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetCommonParameters(user: Config.adminUserName, domain: Config.adminGroupName, usersharing: "",
                                        SecurityID: Config.adminUserName + "-" + Config.adminUserName, autoendsession: "True");
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Height", "-" + Height);
                ehr.SetSearchKeys_ThumbnailView("Width", "c" + Width);
                String url_3 = ehr.clickCmdLine("ThumbnailView");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, BluRingViewer.div_studypanel);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Display series thumbnail with valid width and height values.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Thumbnail view");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL);
                ehr.SetCommonParameters(user: Config.adminUserName, domain: Config.adminGroupName, usersharing: "",
                                        SecurityID: Config.adminUserName + "-" + Config.adminUserName, autoendsession: "True");
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                String url_4 = ehr.clickCmdLine("ThumbnailView");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, BluRingViewer.div_studypanel);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step4, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// GUID:GUID shall get generated in SecurityID field
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162339(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;


            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition - Show Selector = False      
                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Set default viewer as " BluRing " in the miscellaneous under Viewer tab
                //3. Set User Sharing as Always Disabled
                //4. Select Allow Show Selector in the integrator tab
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always Disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();

                //Step 1 - Open the TestEHR application and press the GUID button.               
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.GUID().Click();
                if ((wpfobject.GetTextbox("m_securityIdTextBox").Text != null) && (wpfobject.GetTextbox("m_securityIdTextBox").Text != "Administrator-Administrator"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2 - Enter noted patient details and click on the Cmd line                
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;

                //Step 3 - Copy and Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID) &&
                    studyinfo["Accession"][0].Equals(Accession.Split(':')[1]) &&
                    studyinfo["Accession"][1].Equals(Accession.Split(':')[0]))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Select and load one of the patient.
                patientstudy.SelectPatinet("Patient ID", PatientID);
                var bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step4, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Return to the Image Load tab of the TestEHR application. 
                //         Disable Show selector, clear the search parameters, enter the accession number of a study that is in 
                //         one of the data sources and click Load and click on 'View Exam' button.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
                ehr.SetSearchKeys_Study(Accession.Split(':')[0]);
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_5);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                if (bluringviewer.CompareImage(step5, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();

                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Integrator Desktop - Error message shall be displayed when user entered invalid username and password in the Security ID field
        /// </summary>
        public TestCaseResult Test_162340(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Maintenance maintenance;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            String xmlFilePath = @"C:\WebAccess\IntegratorAuthenticationSTS\Web.config";
            String NodePath = "/configuration/microsoft.web.services3/security/securityTokenManager/add/authProvider[1]";
            string id, classname, assembly, spName, spipParam, spIdParam, connectionstring, patternType;
            id = classname = assembly = spName = spipParam = spIdParam = connectionstring = patternType = string.Empty;
            try
            {
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                String StudyDescription = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyDescription");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String AccessionID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] description = StudyDescription.Split(':');
                String connString = "Data Source=" + GetHostName(Config.IConnectIP) + "\\WEBACCESS;Initial Catalog=IRWSDB;User Id=sa;Password=welcome@123";
                String URL = "http://" + Config.IConnectIP + "/webaccess";
                string validSecurityID = "Administrator#Administrator";
                string invalidSecurityID1 = "Random#Random";
                string invalidSecurityID2 = "Administrator-Administrator";
                string invalidSecurityID3 = "Administrator-PassWord";
                string invalidSecurityID4 = "12345Administrator@Administrator";
                string invalidSecurityID5 = "12345Administrator@PassWord";
                string ErrorMessage = "Error Occurred in operation: Client authentication failed.";
                string newID = "icadb";

                //Precondition - Web configuration
                //Store existing values to reset at end of case
                try
                {
                    id = GetAttributeValue(xmlFilePath, NodePath, "id");
                    classname = GetAttributeValue(xmlFilePath, NodePath, "class");
                    assembly = GetAttributeValue(xmlFilePath, NodePath, "assembly");
                    spName = GetAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "name");
                    spipParam = GetAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "ipParam");
                    spIdParam = GetAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "securityIdParam");
                    connectionstring = GetAttributeValue(xmlFilePath, NodePath + "/connectionString", "value");
                    patternType = GetAttributeValue(xmlFilePath, NodePath + "/credentialsPattern", "pattern");
                }
                catch (Exception ex) { Logger.Instance.ErrorLog("Exception due to: " + ex); }

                //Updating values
                basepage.ChangeAttributeValue(xmlFilePath, NodePath, "id", newID);
                basepage.ChangeAttributeValue(xmlFilePath, NodePath, "class", "Sample.HostIntegration.Authentication.ICADbAuthenticator");
                basepage.ChangeAttributeValue(xmlFilePath, NodePath, "assembly", "Sample.HostIntegration");
                basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "name", "AuthenticateUser");
                basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "ipParam", "");
                basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "securityIdParam", "");
                basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/connectionString", "value", connString);
                basepage.AddAttribute(xmlFilePath, NodePath + "/storedProcedure", "idParam", "@userID");
                basepage.AddAttribute(xmlFilePath, NodePath + "/storedProcedure", "passwordParam", "@password");
                basepage.InsertNode(xmlFilePath, NodePath, "<credentialsPattern pattern=\"#\" />", false);

                //Precondition 
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False", restart: true);

                //Getting Event count before hand - precondition for last step
                login.LoginIConnect(username, password);
                maintenance = login.Navigate<Maintenance>();
                maintenance.Navigate("Audit");
                maintenance.SetCheckBoxInAudit("serious", true);
                maintenance.SetCheckBoxInAudit("minor", true);
                maintenance.SetCheckBoxInAudit("major", true);
                maintenance.SelectEventID("User Authentication", 0);
                int eventcount_before = maintenance.GetEventCount("User Authentication/Login", byvalue: 1);
                login.Logout();

                //Step 1 - Launch TestEHR application.
                //Enter the username and password of a WebAccess user into the Security ID field.
                //Format: *^<^ *username *^>^ *#*^<^*password*^>^*
                //Example, in Security ID field type: Administrator#Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: validSecurityID, AuthProvider: newID);
                wpfobject.WaitTillLoad();
                string step1_postcheck = wpfobject.GetAnyUIItem<ITabPage, TextBox>(ehr.GetCurrentTabItem(), EHR.EHR_SecurityIDTextBox).BulkText;
                Logger.Instance.InfoLog("GUID value: " + step1_postcheck);
                if (step1_postcheck.Equals(validSecurityID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-2: Enable Show selector, enter the noted patient details and click Load.
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL : " + url_2);

                login.CreateNewSesion();
                PatientsStudy pstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                PageLoadWait.WaitForIntegratorPatientListToLoad();
                var PatientList = pstudy.GetPateintList();
                IList<string> step2 = PatientList["Last Name"];

                if (step2.All(p => p.ToLower().Contains(LastName.ToLower())))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3: Select and load one of the patient.
                pstudy.SelectPatinet("Patient ID", PatientID);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step3 = pstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step3 && bluringviewer.AllStudyInfoAtStudyPanel()[0].GetAttribute("innerHTML").Contains(description[0]))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4: Return to the Image Load tab of the TestEHR application. Enter an invalid username and password in the Security ID field, enter some search criteria and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: invalidSecurityID1, AuthProvider: newID);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(AccessionID, "Accession");
                string step4_check = wpfobject.GetAnyUIItem<ITabPage, TextBox>(ehr.GetCurrentTabItem(), EHR.EHR_SecurityIDTextBox).BulkText;
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL : " + url_4);
                Logger.Instance.InfoLog("Security ID value: " + step4_check);

                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_4);
                if (GetElement(SelectorType.CssSelector, EHR.css_ErrorSpan).Text == ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5: Open the TestEHR application.
                //Enter the username and password of a WebAccess user into the Security ID field.
                //Format: *^<^ *username *^>^ *-*^<^ *password *^>^ *
                //Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: invalidSecurityID2, AuthProvider: newID);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                string step5_check = wpfobject.GetAnyUIItem<ITabPage, TextBox>(ehr.GetCurrentTabItem(), EHR.EHR_SecurityIDTextBox).BulkText;
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL : " + url_5);
                Logger.Instance.InfoLog("Security ID value: " + step5_check);

                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_5);
                if (GetElement(SelectorType.CssSelector, EHR.css_ErrorSpan).Text == ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6: Open the TestEHR application.
                //Enter the username of a WebAccess user and an incorrect password into the Security ID field.
                //Format: Username - Password
                //Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: invalidSecurityID3, AuthProvider: newID);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                string step6_check = wpfobject.GetAnyUIItem<ITabPage, TextBox>(ehr.GetCurrentTabItem(), EHR.EHR_SecurityIDTextBox).BulkText;
                String url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL : " + url_6);
                Logger.Instance.InfoLog("Security ID value: " + step6_check);

                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_6);
                if (GetElement(SelectorType.CssSelector, EHR.css_ErrorSpan).Text == ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7: Open the TestEHR application.
                //Enter the username and password of a iConnect Access user into the Security ID field.
                //Format: 12345 *^<^ *username *^>^ *@#$*^<^*password*^>^*
                //Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: invalidSecurityID4, AuthProvider: newID);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                string step7_check = wpfobject.GetAnyUIItem<ITabPage, TextBox>(ehr.GetCurrentTabItem(), EHR.EHR_SecurityIDTextBox).BulkText;
                String url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                Logger.Instance.InfoLog("URL : " + url_7);
                Logger.Instance.InfoLog("Security ID value: " + step7_check);

                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_7);
                if (GetElement(SelectorType.CssSelector, EHR.css_ErrorSpan).Text == ErrorMessage)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8: Open the TestEHR application.
                //Enter the username of a WebAccess user and an incorrect password into the Security ID field.
                //Format: 12345 *^<^ *username *^>^ *@#$*^<^*password*^>^*
                //Enter some search criteria, and select Load.
                //ehr.LaunchEHR();
                //wpfobject.GetMainWindow("Test WebAccess EHR");
                //wpfobject.SelectTabFromTabItems("Image Load");
                //wpfobject.WaitTillLoad();
                //ehr.SetCommonParameters(address: URL, SecurityID: invalidSecurityID5, AuthProvider: newID);
                //wpfobject.WaitTillLoad();
                //ehr.SetSelectorOptions(showSelector: "True");
                //ehr.SetSearchKeys_Study(LastName, "Last_Name");
                //string step8_check = wpfobject.GetAnyUIItem<ITabPage, TextBox>(ehr.GetCurrentTabItem(), EHR.EHR_SecurityIDTextBox).BulkText;
                //String url_8 = ehr.clickCmdLine("ImageLoad");
                //ehr.CloseEHR();
                //Logger.Instance.InfoLog("URL : " + url_8);
                //Logger.Instance.InfoLog("Security ID value: " + step8_check);

                //login.CreateNewSesion();
                //pstudy = PatientsStudy.LaunchPatientsStudyPage(url_8);
                //if (GetElement(SelectorType.CssSelector, EHR.css_ErrorSpan).Text == ErrorMessage)
                //{
                //    result.steps[++ExecutedSteps].status = "Pass";
                //    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                //}
                //else
                //{
                //    result.steps[++ExecutedSteps].status = "Fail";
                //    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                //    result.steps[ExecutedSteps].SetLogs();
                //}

                //Step-8: Go to another machine and log in to BluRing application, open the audit log.
                CreateNewSesion();
                login.DriverGoTo(URL);
                login.LoginIConnect(username, password);
                maintenance = login.Navigate<Maintenance>();
                maintenance.Navigate("Audit");
                maintenance.SetCheckBoxInAudit("serious", true);
                maintenance.SetCheckBoxInAudit("minor", true);
                maintenance.SetCheckBoxInAudit("major", true);
                maintenance.SelectEventID("User Authentication", 0);
                int eventcount_after = maintenance.GetEventCount("User Authentication/Login", byvalue: 1);
                var eventdata = maintenance.GetEventsData();
                //DataTable TableValue = CollectRecordsInAllPages(maintenance.Tbl_EvemtsTable(), maintenance.TableHeader(), maintenance.TableRow(), maintenance.TableColumn());
                if (eventdata["User ID"].Select(s => s.Contains("Unknown")).Count(s => s.Equals(true)) >= 6 && //Unknown corresponds to integrator login details
                    eventdata["Outcome"].Select(s => s.Contains("Success")).Count(s => s.Equals(true)) >= 1 && // 1 success login
                    eventdata["Outcome"].Select(s => s.Contains("Minor failure")).Count(s => s.Equals(true)) >= 4) // 4 failed attempts
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Logger.Instance.InfoLog("eventcount_after - eventcount_before: " + (eventcount_after - eventcount_before));
                Logger.Instance.InfoLog("eventdata['User ID'].Select(s => s.Contains('Unknown')).Count(s => s.Equals(true)): " + eventdata["User ID"].Select(s => s.Contains("Unknown")).Count(s => s.Equals(true)));
                Logger.Instance.InfoLog("eventdata['Outcome'].Select(s => s.Contains('Success')).Count(s => s.Equals(true)): " + eventdata["Outcome"].Select(s => s.Contains("Success")).Count(s => s.Equals(true)));
                Logger.Instance.InfoLog("eventdata['Outcome'].Select(s => s.Contains('Minor failure')).Count(s => s.Equals(true)): " + eventdata["Outcome"].Select(s => s.Contains("Minor failure")).Count(s => s.Equals(true)));

                login.Logout();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                //result.steps[ExecutedSteps++].SetLogs();
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
            finally
            {
                try
                {
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath, "id", "");
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath, "class", classname);
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath, "assembly", assembly);
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "name", spName);
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "ipParam", spipParam);
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/storedProcedure", "securityIdParam", spIdParam);
                    basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/connectionString", "value", connectionstring);
                    basepage.RemoveAttribute(xmlFilePath, NodePath + "/storedProcedure", "idParam");
                    basepage.RemoveAttribute(xmlFilePath, NodePath + "/storedProcedure", "passwordParam");
                    if (String.IsNullOrEmpty(patternType))
                    {
                        basepage.RemoveNode(xmlFilePath, NodePath + "/credentialsPattern");
                    }
                    else
                    {
                        basepage.ChangeAttributeValue(xmlFilePath, NodePath + "/credentialsPattern", "pattern", patternType);
                    }
                    RestartIISUsingexe();
                }
                catch (Exception ex)
                {
                    Logger.Instance.ErrorLog("Error while re-changing values in finally block due to: " + ex);
                    RestartIISUsingexe();
                }

            }
        }

        /// <summary>
        /// Test 137950  - Browser Multisession Modesmultiple session/multiple browser tab handling
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162341(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled               
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1            
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True");
                wpfobject.WaitTillLoad();
                ehr.GUID().Click();
                ExecutedSteps++;

                //Step 2 
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step-3
                login.CreateNewSesion();
                var pstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = pstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                pstudy.SelectPatinet("Accession", AccessionID[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                ExecutedSteps++;

                //Step-5
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step5, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6
                BasePage.CreateBrowserTab();
                bool isDuplicatesession5 = PatientsStudy.IsDuplicateSessionMessage(url_2);
                if (isDuplicatesession5)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0);
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                var viewport7 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step7, viewport7))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8                
                BasePage.Driver.Close();
                ExecutedSteps++;

                //Step-9
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, SessionID: "1");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetShowSelector(true);
                var url_8 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_8);
                studyinfo = pstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10:Select one patient and click on Universal viewer button
                pstudy.SelectPatinet("Accession", AccessionID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport10 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step10 = result.steps[++ExecutedSteps];
                step10.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step10, viewport10))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-11
                BasePage.CreateBrowserTab();
                if (PatientsStudy.IsDuplicateSessionMessage(url_8))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0);
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                var viewport11 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step11, viewport11))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-13
                BasePage.MultiDriver.Add(BasePage.Driver);
                var browser = (BasePage.SBrowserName.Contains("chrome")) ? "firefox" :
                    ((BasePage.SBrowserName.Contains("firefox")) ? "chrome" :
                    ((BasePage.SBrowserName.Contains("ie")) ? "chrome" : ""));
                BasePage.MultiDriver.Add(InvokeBrowser(browser));
                login.SetDriver(MultiDriver[1]);
                BasePage.Driver.Navigate().GoToUrl(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                ExecutedSteps++;

                //Step-14
                var maintainTab = login.Navigate<Maintenance>();
                var datatable = CollectRecordsInTable(maintainTab.StatisticsTable(), maintainTab.TableHeader(), maintainTab.TableRow(), maintainTab.TableColumn());
                var actual = GetColumnValues(datatable, "Feature Name");
                int WebAdmincount = actual.Where(val => string.Equals(val, "ica.free.standing 1.0", StringComparison.OrdinalIgnoreCase)).Count();
                if (actual.Length == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-15
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, SessionID: "2");
                ehr.SetShowSelector(true);
                var url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                viewer.SetDriver(MultiDriver[0]);
                BasePage.CreateBrowserTab();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_14);
                studyinfo = pstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-16:
                pstudy.SelectPatinet("Accession", AccessionID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport16 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step16 = result.steps[++ExecutedSteps];
                step16.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step16, viewport16))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-17
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                var viewport15 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step15 = result.steps[++ExecutedSteps];
                step15.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step15, viewport15))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-18
                login.SetDriver(MultiDriver[1]);
                login.Navigate<Studies>();
                login.Navigate<Maintenance>();
                datatable = CollectRecordsInTable(maintainTab.StatisticsTable(), maintainTab.TableHeader(), maintainTab.TableRow(), maintainTab.TableColumn());
                actual = GetColumnValues(datatable, "Feature Name");
                WebAdmincount = actual.Where(val => string.Equals(val, "ica.free.standing 1.0", StringComparison.OrdinalIgnoreCase)).Count();
                if (actual.Length == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-19
                login.SetDriver(MultiDriver[0]);
                BasePage.SwitchBrowserTab(0);
                var viewport17_1 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step17 = result.steps[++ExecutedSteps];
                step17.SetPath(testid, ExecutedSteps, 1);
                var isImagePresent_1 = viewer.CompareImage(step17, viewport17_1);
                BasePage.SwitchBrowserTab(1);
                var viewport17_2 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                step17.SetPath(testid, ExecutedSteps, 2);
                var isImagePresent_2 = viewer.CompareImage(step17, viewport17_2, 1);
                if (isImagePresent_1 && isImagePresent_2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-20                
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                var viewport18_1 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step18 = result.steps[++ExecutedSteps];
                step18.SetPath(testid, ExecutedSteps, 1);
                var isImagePresent_18_1 = viewer.CompareImage(step18, viewport18_1);
                BasePage.SwitchBrowserTab(0);
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                var viewport18_2 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                step18.SetPath(testid, ExecutedSteps, 2);
                var isImagePresent_18_2 = viewer.CompareImage(step18, viewport18_2, 1);
                if (isImagePresent_18_1 && isImagePresent_18_2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-21                
                BasePage.SwitchBrowserTab(0);
                var viewport21 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                viewport21.SendKeys(Keys.ArrowDown);
                viewport21.SendKeys(Keys.ArrowDown);
                var step21 = result.steps[++ExecutedSteps];
                step21.SetPath(testid, ExecutedSteps);
                var isimageCompare21 = viewer.CompareImage(step21, viewport21);
                if (isimageCompare21)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-22
                BasePage.SwitchBrowserTab(1);
                var actions = new TestCompleteAction();
                var viewport22 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                actions.MouseScroll(viewport22, "down", "10").Perform();
                var step22 = result.steps[++ExecutedSteps];
                step22.SetPath(testid, ExecutedSteps);
                var isimageCompare22 = viewer.CompareImage(step22, viewport22);
                if (isimageCompare22)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-23 - 
                //Validation Logic -- In 1st Tab it should scrolls up to 1st Image and in 2nd Tab it should remain in Last Image
                BasePage.SwitchBrowserTab(0);
                var viewport23 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                viewport23.SendKeys(Keys.ArrowUp);
                viewport23.SendKeys(Keys.ArrowUp);
                var step23 = result.steps[++ExecutedSteps];
                step23.SetPath(testid, ExecutedSteps);
                var isimageCompare23 = viewer.CompareImage(step23, viewport23);

                BasePage.SwitchBrowserTab(1);
                var viewport23_2 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                step23.SetPath(testid, ExecutedSteps, 1);
                var isimageCompare23_2 = viewer.CompareImage(step23, viewport23_2);
                if (isimageCompare23 && isimageCompare23_2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-24
                if (result.steps[ExecutedSteps].status.ToLower().Equals("pass"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-25
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0);
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                var viewport25 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step25 = result.steps[++ExecutedSteps];
                step25.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step25, viewport25))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-26
                login.SetDriver(MultiDriver[1]);
                login.Navigate<Studies>();
                login.Navigate<Maintenance>();
                datatable = CollectRecordsInTable(maintainTab.StatisticsTable(), maintainTab.TableHeader(), maintainTab.TableRow(), maintainTab.TableColumn());
                actual = GetColumnValues(datatable, "Feature Name");
                WebAdmincount = actual.Where(val => string.Equals(val, "ica.free.standing 1.0", StringComparison.OrdinalIgnoreCase)).Count();
                if (actual.Length == 2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-27
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, SessionID: "2");
                ehr.SetShowSelector(true);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                var url_27 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.SetDriver(MultiDriver[0]);
                BasePage.CreateBrowserTab();
                pstudy = PatientsStudy.LaunchPatientsStudyPage(url_27);
                pstudy.SelectPatinet("Accession", AccessionID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport27 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step27 = result.steps[++ExecutedSteps];
                step27.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step27, viewport27))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-28
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                ExecutedSteps++;

                //Setp-29
                login.SetDriver(MultiDriver[1]);
                login.Navigate<Studies>();
                login.Navigate<Maintenance>();
                datatable = CollectRecordsInTable(maintainTab.StatisticsTable(), maintainTab.TableHeader(), maintainTab.TableRow(), maintainTab.TableColumn());
                actual = GetColumnValues(datatable, "Feature Name");
                WebAdmincount = actual.Where(val => string.Equals(val, "ica.free.standing 1.0", StringComparison.OrdinalIgnoreCase)).Count();
                if (actual.Length == 1)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                login.ResetDriver();
                login.CreateNewSesion();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
        /// Using Encrypted URL
        /// </summary>
        public TestCaseResult Test_162342(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            IntegratorStudies intgtrStudies = null;
            int ExecutedSteps = -1;
            Stopwatch stopwatch = new Stopwatch();
            TimeSpan timeout = new TimeSpan(0, 3, 0);

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String PatientNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientName");
                String[] PatientName = PatientNames.Split(':');

                String PatientIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PatientID = PatientIDs.Split(':');

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String SeriesUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "SeriesUID");
                String[] SeriesUID = SeriesUIDs.Split(':');

                String Height = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Height");
                String Width = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Width");

                String DocumentIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DocumentID");
                String[] DocumentID = DocumentIDs.Split(':');
                String RepositoryIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "RepositoryID");
                String[] RepositoryID = RepositoryIDs.Split(':');
                String MimeTypes = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "MimeType");
                String[] MimeType = MimeTypes.Split('/');

                string adminUserName = Config.adminUserName;
                string adminpassword = Config.adminPassword;
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition
                UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");

                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                try
                {
                    wpfobject.WaitTillLoad();
                    servicetool.NavigateToTab("Integrator");
                    servicetool.WaitWhileBusy();
                    servicetool.ClickModifyButton();
                    TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                    SetTimeout.Enter("2");
                    servicetool.ClickApplyButtonFromTab();
                    wpfobject.WaitTillLoad();
                    try
                    {
                        wpfobject.WaitForPopUp();
                        wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    }
                    catch (Exception) { }
                    servicetool.RestartIISandWindowsServices();
                    wpfobject.WaitTillLoad();
                }
                catch (Exception) { }
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.SelectTabFromTabItems(ServiceTool.Encryption.Name.Encryption_tab);
                servicetool.EnterServiceEntry();
                servicetool.EnterServiceParameters("key", "string", "");
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                string[] Keys = servicetool.GenerateEncryptionKeys("mergehealthcare");
                servicetool.EditServiceParameters("Key", "TripleDES", "Name", "key", Value: Keys[0]);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.SelectTabFromTabItems(ServiceTool.Encryption.Name.Encryption_tab);
                servicetool.EnterServiceEntry("TripleDES-A");
                servicetool.EnterServiceParameters("key", "string", "");
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                Keys = servicetool.GenerateEncryptionKeys("cedaracare");
                servicetool.EditServiceParameters("Key", "TripleDES-A", "Name", "key", Value: Keys[0]);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.EnterEncryptionProviders("ID-456", "args", "Cryptographic.TripleDES-A");
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();
                servicetool.EnterEncryptionProviders("ID-123", "args", "Cryptographic.TripleDES");
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();

                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.RestartService();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                PageLoadWait.WaitForLoadingMessage(60);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 -Launch TestEHR application and change the 
                //Address to HTTP://localhost/webaccess
                //click on the default browser box, select auto end session = true, enter an A in the patients Full Name field.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("A", "Full_Name");
                ExecutedSteps++;

                //Step 2 - Click on the Use Encryption box and click on Cmd Line button.
                ehr.EncryptionCB().Checked = true;
                String url_2 = ehr.clickCmdLine("ImageLoad");
                if (url_2.Contains("encryptionProvider=ID-123"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3:Click on Load to launch Viewer.
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                string[] columnvalues = ehr.GetColumnValues("Last Name");
                bool ValueSearch = columnvalues.All(lastname => lastname.StartsWith("A"));

                if (ValueSearch && IsElementVisible(intgtrStudies.SearchPanel()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 4 - Select one patient and click on 'View Exam' button
                ehr.selectPatient(PatientName[1]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step4, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Close the viewer and in the TestEHR and select the None box, click on Cmd Line                
                wpfobject.SelectCheckBox("useNoEncryption");
                url_2 = ehr.clickCmdLine("ImageLoad");
                if (!url_2.Contains("encryptionProvider=ID-123"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 -Click on Load to launch viewer.      
                login.CreateNewSesion();
                viewer.NavigateToBluringIntegratorURL(url_2);
                string ExpectedError = "Error Occurred in operation: Requested study doesn't match security claims provided.";
                if (viewer.AuthenticationErrorMsg().Text.Contains(ExpectedError))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Close viewer and in the TestEHR select the Default box and click on CmdLine                
                wpfobject.SelectCheckBox("useDefaultEncryptionChk");
                url_2 = ehr.clickCmdLine("ImageLoad");
                if (!url_2.Contains("encryptionProvider"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Click on Load to launch viewer. 
                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                columnvalues = ehr.GetColumnValues("Last Name");
                ValueSearch = columnvalues.All(lastname => lastname.StartsWith("A", StringComparison.OrdinalIgnoreCase));
                if (ValueSearch)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9:Copy the URL and wait for 2 min copy URL into new browser window.                
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                int actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                string expectederrormsg = "Error Occurred in operation: The Url has been over due.";
                if (bluringviewer.AuthenticationErrorMsg().Text.Contains(expectederrormsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 -go to TestEHR"PMJ Load"tab. Address = http://localhost/WebAccess
                //Security ID = Administrator-Administrator
                //Select Auto End Session as"True"
                //Patient ID = 4455^^^TOH ( test data: John, Doe)
                //Check Use Encryption (TimeStamp)
                //Click"cmd line"button.              
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("PMJ Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True", SecurityID: securityID_Local, autoendsession: "True");
                ehr.SetSearchKeysPMJ_Study("Patient_ID", PatientID[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("PmjLoad");
                bool PatientidNotExists = !url_2.Contains("Patient_id");
                if (PatientidNotExists)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                ////Step 11 -	Click on Load to launch viewer.
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForPageLoad(40);
                if (BasePage.Driver.FindElement(By.CssSelector("#PatientMasterJacket_PatientDemographic_m_patientName")).Text.Contains("John,Doe"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                ////Step-12:Copy the URL and wait for 2 min copy URL into new browser window.                
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                expectederrormsg = "Error Occurred in operation: The Url has been over due.";
                if (studyviewer.AuthenticationErrorMsg().Text.Contains(expectederrormsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //result.steps[++ExecutedSteps].status = "On Hold";
                //result.steps[++ExecutedSteps].status = "On Hold";
                //result.steps[++ExecutedSteps].status = "On Hold";

                //Step-13:Close all browsers. Go to TestEHR"Thumbnail View"tab. 
                //Address = http://localhost/WebAccess
                //Security ID = Administrator-Administrator
                //StudyUID = 2.16.840.1.113662.4.4162725393.939735033.1759523607584223909
                //Series UID = 2.16.840.1.113662.4.4162725393.939736864.621350209442302413
                //(this is test study"Abdomen, MR; make sure this study existed in datasource)
                //Thumbnail Height = 512; Thumbnail width = 512
                //Check Use Encryption (TimeStamp)
                //Click 'Cmd line' button.                
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Thumbnail view");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True", SecurityID: "administrator-administrator", autoendsession: "True");
                ehr.SetSearchKeys_ThumbnailView("Study_UID", StudyUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Series_UID", SeriesUID[0]);
                ehr.SetSearchKeys_ThumbnailView("Height", Height);
                ehr.SetSearchKeys_ThumbnailView("Width", Width);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("ThumbnailView");
                bool StudyUidNotExists = !url_2.Contains("Study_UID");
                bool SeriesUidNotExists = !url_2.Contains("Series_UID");
                if (StudyUidNotExists && SeriesUidNotExists)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-14:Click on View to launch the thumbnail.
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                string[] width = BasePage.Driver.FindElements(By.TagName("img")).Select(img => img.GetAttribute("width")).ToArray();
                string[] height = BasePage.Driver.FindElements(By.TagName("img")).Select(img => img.GetAttribute("height")).ToArray();

                if (width[0].Equals(Width) && height[0].Equals(Height))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-15:Copy the URL and wait for 2 min copy URL into new browser window.                
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                PageLoadWait.WaitForPageLoad(40);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool StudyPanelExists = login.CompareImage(result.steps[ExecutedSteps], BasePage.Driver.FindElement(By.CssSelector("body>img")));
                if (StudyPanelExists)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-16:Close all browsers. Go to TestEHR"Document View"tab. 
                //Address = http://localhost/WebAccess
                //Security ID = Administrator-Administrator
                //Document ID = Document200
                //keep the Repository UID as default.
                //MIME type selects"image/jpeg"
                //Check Use Encryption (TimeStamp)
                //Click"cmd line"button.                
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Document View");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True", SecurityID: "administrator-administrator", autoendsession: "True");
                ehr.SetSearchKeysDocument_Study("Document_id", DocumentID[0]);
                ehr.SetSearchKeysDocument_Study("Repository_uid", RepositoryID[0]);
                ComboBox MimeTypetextbox = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "m_MIMETypeCB", 0);
                MimeTypetextbox.Enter(MimeType[0] + "/" + MimeType[1]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                url_2 = ehr.clickCmdLine("Documentview");
                bool DocumentidNotExists = !url_2.Contains("Document_id");
                if (DocumentidNotExists)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-17:Click on Load to launch document viewer.
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                string ThumbnailDocumentUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "mimetype");
                if (ThumbnailDocumentUID.ToLowerInvariant().Contains(MimeType[0]) && ThumbnailDocumentUID.ToLowerInvariant().Contains(MimeType[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step-18:Copy the URL and wait for 2 min copy URL into new browser window.                
                stopwatch.Start();
                while (!(stopwatch.Elapsed >= timeout)) { /*Stay Idle for 2 Miniutes*/ }
                actualtimeout = stopwatch.Elapsed.Minutes;
                stopwatch.Stop();
                stopwatch.Reset();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                expectederrormsg = "Error Occurred in operation: The Url has been over due.";
                string Actualerrormsg = studyviewer.AuthenticationErrorMsg().Text;
                if (Actualerrormsg.Contains(expectederrormsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
                try
                {
                    servicetool.InvokeServiceTool();
                    wpfobject.WaitTillLoad();
                    servicetool.NavigateToTab("Integrator");
                    servicetool.WaitWhileBusy();
                    servicetool.ClickModifyButton();
                    TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                    SetTimeout.Enter("0");
                    servicetool.ClickApplyButtonFromTab();
                    wpfobject.WaitTillLoad();
                    try
                    {
                        wpfobject.WaitForPopUp();
                        wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    }
                    catch (Exception) { }
                    servicetool.RestartIISandWindowsServices();
                    wpfobject.WaitTillLoad();
                    servicetool.CloseServiceTool();
                }
                catch (Exception) { }
            }
        }

        /// <summary>
        /// Hide URL In Browser
        /// </summary>
        public TestCaseResult Test_162343(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            IntegratorStudies intgtrStudies = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String PID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition
                UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");


                //Disable enrcyption
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                //TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled", restart: true);
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseConfigTool();


                //Step 1 - 	Launch the TestEHR application
                ehr.LaunchEHR();
                ExecutedSteps++;

                //Step 2 - Load the following URL into a browser Address bar and launch it.(Enter the server name that you are using or the IP)
                //http -//icaserver/WebAccess/Default.ashx?RequestClass-Integrator&AuthProvider-Bypass&AutoEndSession-True&Culture-en-ca&UserID-Administrator&SecurityID-Administrator-Administrator&ShowClose-True&operation-ImagePresentation&ShowReport-True&SelectorCentricity-Patient&studyUID-1.2.124.110.31828270.238315.25327.232.31              
                String Givenurl = "http://localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowReport=True&SelectorCentricity=Patient&studyUID=2.16.124.113531.4.6.930658307.41.2752539161.1";
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: Givenurl);
                string runtimeUrl = Driver.Url;
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (Givenurl.Equals(runtimeUrl) && bluringviewer != null && Exam_list[0].Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - 	Close browser  
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                ExecutedSteps++;

                //Step 4 - Open the service tool and in the Integrator Tab click Modify and select the Hide True URL from Browser Address bar. 
                //IISRESET
                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                servicetool.NavigateToTab(ServiceTool.Integrator_Tab);
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.SelectCheckBox(ServiceTool.Integrator.Name.HideTrueURLfromBrowserAddressBar, 1);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();
                //servicetool.RestartService();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                ExecutedSteps++;


                //Step 5 - Cut and paste the same URL into a new browser window and launch the browser. (Enter the servername that you are using or the IP)                
                login.CreateNewSesion();
                //bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: Givenurl);
                try
                {
                    BasePage.Driver.Navigate().GoToUrl(Givenurl);
                    BluRingViewer.WaitforViewports();
                    BluRingViewer.WaitforThumbnails(400);
                    BluRingViewer.WaitForPriorsToLoad();
                }
                catch (Exception e) { }
                runtimeUrl = Driver.Url;
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (!Givenurl.Equals(Driver.Url) && bluringviewer != null && Exam_list[0].Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Cut and paste the resultant URL from the Address bar in the BluRing window into a new Browser window and try to launch the browser.                
                login.CreateNewSesion();
                try
                {
                    BasePage.Driver.Navigate().GoToUrl(runtimeUrl);
                    if (new BluRingViewer().AuthenticationErrorMsg().Text.ToLower().Contains("there is another session open"))
                    {
                        ((IJavaScriptExecutor)BasePage.Driver).ExecuteScript("location.reload()");
                    }
                    PageLoadWait.WaitForFrameLoad(60);
                }
                catch (Exception e) { }
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                string ExpectedError = "Error Occurred in operation";
                if (bluringviewer.AuthenticationErrorMsg().Text.Contains(ExpectedError))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - If Encrypted URL has not been setup refer the attached file to set it up and enable in it in the service tool.        
                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                try
                {
                    wpfobject.WaitTillLoad();
                    servicetool.NavigateToTab("Integrator");
                    servicetool.WaitWhileBusy();
                    servicetool.ClickModifyButton();
                    TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                    SetTimeout.Enter("2");
                    servicetool.ClickApplyButtonFromTab();
                    wpfobject.WaitTillLoad();
                    try
                    {
                        wpfobject.WaitForPopUp();
                        wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    }
                    catch (Exception) { }
                    servicetool.RestartIISandWindowsServices();
                    wpfobject.WaitTillLoad();
                }
                catch (Exception) { }
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.SelectTabFromTabItems(ServiceTool.Encryption.Name.Encryption_tab);
                servicetool.EnterServiceEntry();
                servicetool.EnterServiceParameters("key", "string", "");
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                string[] Keys = servicetool.GenerateEncryptionKeys("mergehealthcare");
                servicetool.EditServiceParameters("Key", "TripleDES", "Name", "key", Value: Keys[0]);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.SelectTabFromTabItems(ServiceTool.Encryption.Name.Encryption_tab);
                servicetool.EnterServiceEntry("TripleDES-A");
                servicetool.EnterServiceParameters("key", "string", "");
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                Keys = servicetool.GenerateEncryptionKeys("cedaracare");
                servicetool.EditServiceParameters("Key", "TripleDES-A", "Name", "key", Value: Keys[0]);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.EnterEncryptionProviders("ID-456", "args", "Cryptographic.TripleDES-A");
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();
                servicetool.EnterEncryptionProviders("ID-123", "args", "Cryptographic.TripleDES");
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();

                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");

                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 8 - Open the TestEHR program and change the 
                //Address to HTTP://localhost/webaccess, select auto end session = true, enter an A in the patients Full Name field.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSearchKeys_Study("A", "Full_Name");
                ExecutedSteps++;

                //Step-9:	Click on the Use Encryption box and click on Cmd Line button.
                //ehr.EncryptionCB().Checked = true;
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                String url_9 = ehr.clickCmdLine("ImageLoad");
                if (!url_9.Equals(runtimeUrl))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 10 -Click on Load to launch Viewer.               
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_9);
                runtimeUrl = Driver.Url;
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                string[] columnvalues = ehr.GetColumnValues("Last Name");
                bool ValueSearch = columnvalues.All(lastname => lastname.StartsWith("A"));

                if (ValueSearch && !url_9.Equals(runtimeUrl) && IsElementVisible(intgtrStudies.SearchPanel()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 11 - Select one patient study from studies list and click on "View Exam" button and then verify the study should be launched in the user viewer.
                var studyinfo = patientstudy.GetPateintList();
                patientstudy.SelectPatinet("Last Name", LastName);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (viewer != null && Exam_list[0].Displayed && viewer.CompareImage(step4, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                basepage.CloseBrowser();

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripleDES-A']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeNodeValue(Config.FileLocationPath, "/IntegratedMode/HideUrl", "False");
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
                try
                {
                    servicetool.InvokeServiceTool();
                    wpfobject.WaitTillLoad();
                    servicetool.NavigateToTab("Integrator");
                    servicetool.WaitWhileBusy();
                    servicetool.ClickModifyButton();
                    TextBox SetTimeout = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), "AutoSelectTextBox", 0);
                    SetTimeout.Enter("0");
                    servicetool.ClickApplyButtonFromTab();
                    wpfobject.WaitTillLoad();
                    try
                    {
                        wpfobject.WaitForPopUp();
                        wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
                    }
                    catch (Exception) { }
                    servicetool.RestartIISandWindowsServices();
                    wpfobject.WaitTillLoad();
                    servicetool.CloseServiceTool();
                }
                catch (Exception) { }

            }
        }

        /// <summary>
        /// ShowSelector=False|ShowSelectorSearch=False and showSelector/ShowSelectorSearch=Empty
        /// </summary>
        public TestCaseResult Test_162344(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastnames = LastName.Split(':');
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] Firstnames = FirstName.Split(':');
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String[] Acclist = Accession.Split(':');
                String PID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PIDlist = PID.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                PageLoadWait.WaitForLoadingMessage(60);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - BluRing server under testing is configured and is able to load images from the connected data sources            
                ExecutedSteps++;

                //Step 2 - Required test date in data sources-
                //1) A Patient with at least 3 studies
                //2) A patient with at least 3 studies in which there is a study that has a unique Accession number
                //2)  At least there are 3 patient with same last name but different first names, these patients only has 1 study.
                //3) A patient's name is unique from all accessed data sources               
                ExecutedSteps++;

                //Step 3 - In TestEHR Tool,
                //Test Data: 
                //Show Error
                //False
                //False
                //---------------------------------
                //Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^*add key="Integrator.OnMultipleStudy"value="Show Error"/*^>^*
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*false*^<^*/AllowShowSelector*^>^*
                //*^<^*AllowShowSelectorSearch*^>^*false*^<^*/AllowShowSelectorSearch*^>^*
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                //Step 4 - Test Data: 
                //Note: This output depends on Integrator.OnMultipleStudy setting in web.config; in this case, it is set to Show Error
                //---------------------------------
                //In the TestEHR tool, change the following settings only:
                //Show Selector = blank
                //Show Selector Search = blank
                //Enter Accession number to search a patient with multiple priors
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_4);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step4_1 = ehr.ErrorMsg();
                if (Step4_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Replace a Accession number which is unique among these priors. Launch URL.              
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_5 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_5);
                IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Leave all patient/study fields empty. Launch URL.               
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                String url_6 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_6);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step6_1 = ehr.ErrorMsg();
                if (Step6_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Enter a Study UID from a patient with multiple priors. Launch URL.           
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                String url_7 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_7);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                String url_8 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_8);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step8_1 = ehr.ErrorMsg();
                if (Step8_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Now add patient First Name where the patient has multiple priors , and launch URL
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                String url_9 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_9);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step9_1 = ehr.ErrorMsg();
                if (Step9_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                String url_10 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_10);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step10_1 = ehr.ErrorMsg();
                if (Step10_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Change patient last name and first name, where the patient only has no priors
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[1], "Last_Name");
                String url_11 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_11);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step11_1 = ehr.ErrorMsg();
                if (Step11_1.Trim().Equals("Error Occurred in operation: System override settings don't allow showing the selector. Please change your search criteria or contact the system administrator."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
            }

        }

        /// <summary>
        ///  ShowSelector=True|ShowSelectorSearch=False and showSelector/ShowSelectorSearch=True
        /// </summary>
        public TestCaseResult Test_162345(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastnames = LastName.Split(':');
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] Firstnames = FirstName.Split(':');
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String[] Acclist = Accession.Split(':');
                String PID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PIDlist = PID.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition - Included in Setp #3               
                //TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled", restart: true);

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                PageLoadWait.WaitForLoadingMessage(60);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - BluRing server under testing is configured and is able to load images from the connected data sources            
                ExecutedSteps++;

                //Step 2 - Required test date in data sources-
                //1) A Patient with at least 3 studies
                //2) A patient with at least 3 studies in which there is a study that has a unique Accession number
                //2)  At least there are 3 patient with same last name but different first names, these patients only has 1 study.
                //3) A patient's name is unique from all accessed data sources               
                ExecutedSteps++;

                //Step 3 -Show Error
                //true
                //false
                //---------------------------------
                //Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^*add key="Integrator.OnMultipleStudy"value="Show Error"/*^>^*
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*true*^<^*/AllowShowSelector*^>^*
                //*^<^*AllowShowSelectorSearch*^>^*false*^<^*/AllowShowSelectorSearch*^>^*
                //Restart IIS and Windows Service                
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled", restart: true);
                ExecutedSteps++;

                //Step 4 - In the TestEHR tool set:
                //Address = *^<^*enter path of BluRing server under testing*^>^*
                //Show Selector = true
                //Show Selector Search = true
                //Enter Accession number to search a patient with multiple priors
                //Leave the rest fields as default.
                //Click Cmd line
                //Click Load
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Accession"][0].Equals(Acclist[0]) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - 	Replace a Accession number which is unique among these priors. Launch URL.            
                ehr.SetSearchKeys_Study(Acclist[1]);
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Accession"][0].Equals(Acclist[1]) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Leave all patient/study fields empty. Launch URL.            
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step6_1 = ehr.ErrorMsg();
                if (Step6_1.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Enter a Study UID from a patient with multiple priors. Launch URL.	         
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Accession"][0].Equals(Acclist[1]) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Equals(Lastnames[0]) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Now add the patient First Name with multiple priors, and launch URL
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Equals(Lastnames[0]) && studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Equals(Lastnames[1]) && studyinfo["First Name"][0].Equals(Firstnames[1]) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Change patient last name and first name, where this is the only study in the data source, and launch URL
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[1], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Equals(Lastnames[1]) && studyinfo["First Name"][0].Equals(Firstnames[1]) && !IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
            }
        }

        /// <summary>
        ///  ShowSelector=True|ShowSelectorSearch=False and showSelector/ShowSelectorSearch=True/False/Empty
        /// </summary>
        public TestCaseResult Test_162346(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastnames = LastName.Split(':');
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] Firstnames = FirstName.Split(':');
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String[] Acclist = Accession.Split(':');
                String PID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String[] PIDlist = PID.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition - Covered in Step#3              
                //TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled", restart: true);

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                PageLoadWait.WaitForLoadingMessage(60);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - 	iCA 7.0 server under testing is configured and is able to load images from the connected data sources          
                ExecutedSteps++;

                //Step 2 - Required test date in data sources-
                //1) A Patient with at least 3 studies
                //2) A patient with at least 3 studies in which there is a study that has a unique Accession number
                //2)  At least there are 3 patient with same last name but different first names, these patients only has 1 study.
                //3) A patient's name is unique from all accessed data sources               
                ExecutedSteps++;

                //Step 3 -Test Data: 
                //Show Error
                //true
                //true
                //---------------------------------
                //Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^*add key="Integrator.OnMultipleStudy"value="Show Error"/*^>^*
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*true*^<^*/AllowShowSelector*^>^*
                //*^<^*AllowShowSelectorSearch*^>^*true*^<^*/AllowShowSelectorSearch*^>^*
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step 4 - In the TestEHR tool set:
                //Address = *^<^*enter path of BluRing server under testing*^>^*
                //Show Selector = true
                //Show Selector Search = true
                //Enter Accession number to search a patient with multiple priors
                //Leave the rest fields as default.
                //Click Cmd line
                //Click Load
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[2]) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[2]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - 	Replace a Accession number which is unique among these priors. Launch URL.            
                ehr.SetSearchKeys_Study(Acclist[1]);
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - 	Leave all patient/study fields empty. Launch URL.            
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step6_1 = ehr.ErrorMsg();
                if (Step6_1.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - 	Enter a Study UID from a patient with multiple priors. Launch URL.	         
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - 	Clear Study UID field and enter a Patient Last Name with multiple priors. Launch URL.
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 -Now add the patient First Name with multiple priors, and launch URL
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[1]) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[1]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Change patient last name and first name, where this is the only study in the data source, and launch URL
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[1], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[1]) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[1]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12:In the TestEHR tool, change the following settings only:
                //Show Selector = blank
                //Show Selector Search = blank
                //Enter Accession number to search a patient with multiple priors                
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(Acclist[0]);
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step12_1 = ehr.ErrorMsg();
                if (Step12_1.Trim().Equals("Error Occurred in operation: More than one patient and/or study was found that match the search criteria. Each request to view a study must result in a unique study."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Replace a Accession number which is unique among these priors. Launch URL.
                ehr.SetSearchKeys_Study(Acclist[1]);
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);
                var viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step13 = result.steps[++ExecutedSteps];
                step13.SetPath(testid, ExecutedSteps);
                IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step13, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-14:	Leave all patient/study fields empty. Launch URL.
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study("");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                wait.Until(ExpectedConditions.ElementToBeClickable(By.CssSelector("div#ErrorDiv span")));
                String Step14_1 = ehr.ErrorMsg();
                if (Step14_1.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-15:	Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step15 = result.steps[++ExecutedSteps];
                step15.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step15, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-16:	Clear Study UID field and enter a Patient Last Name, where the patient has multiple priors. Launch URL.
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSearchKeys_Study(Lastnames[0], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-17:	Now add patient First Name where the patient has multiple priors , and launch URL
                ehr.SetSearchKeys_Study(Firstnames[0], "First_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[0].ToUpper()) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[0]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-18:	Clear search fields, Change patient First Name to a unique one (e.g., only has 1 study matching patient last name in data source), and launch URL
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[1]) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[1]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-19:	Change patient last name and first name, where the patient only has no priors
                ehr.SetSearchKeys_Study(Firstnames[1], "First_Name");
                ehr.SetSearchKeys_Study(Lastnames[1], "Last_Name");
                url = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["First Name"][0].Equals(Firstnames[1]) &&
                    studyinfo["Last Name"][0].Equals(Lastnames[1]) &&
                    IsElementVisible(By.CssSelector("div#SearchPanelDiv")))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
            }
        }

        /// <summary>
        /// ShowSelector-True|ShowSelectorSearch-True and showSelector/ShowSelectorSearch-True/False/Empty
        /// </summary>
        public TestCaseResult Test_162347(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            IntegratorStudies intgtrStudies = null;
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] Lastnames = LastName.Split(':');
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String[] Acclist = Accession.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUIDs = StudyUID.Split(':');

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition                
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled", restart: true);

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                PageLoadWait.WaitForLoadingMessage(60);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - iCA 7.0 server under testing is configured and is able to load images from the connected data sources
                ExecutedSteps++;

                //Step 2 - Required test date in data sources-
                //1) A Patient with at least 3 studies
                //2) A patient with at least 3 studies in which there is a study that has a unique Accession number
                //2)  At least there are 3 patient with same last name but different first names, these patients only has 1 study.
                //3) A patient's name is unique from all accessed data sources               
                ExecutedSteps++;

                //Step 3 -Show Selector
                //true
                //true                
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Selector");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step 4 - In the TestEHR tool set:
                //Address = *^<^*enter path of BluRing server under testing*^>^*
                //Show Selector = blank
                //Show Selector Search = true
                //Enter Accession number to search a patient with multiple priors
                //Leave the rest fields as default.
                //Click Cmd line
                //Click Load
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.GetMainWindow("Test WebAccess EHR");
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "True");
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_4);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");

                if (ehr.VerifyPatientDetails("Accession", Acclist[0], 1) && IsElementVisible(intgtrStudies.SearchPanel()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - 	Replace a Accession number which is unique among these priors. Launch URL.            
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_5 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_5);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                var viewport = bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step5, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 - Enter a few Accession numbers from different patients, where they have priors. Launch URL                  
                ehr.SetSearchKeys_Study(Acclist[0] + @"\" + Acclist[1]);
                String url_6 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_6);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                DataTable intgrtable = basepage.CollectRecordsInTable(intgtrStudies.ListTable(), intgtrStudies.Intgr_Header(), intgtrStudies.Intgr_Row(), intgtrStudies.Intgr_Column());
                string[] columnvalue = basepage.GetColumnValues(intgrtable, "Accession");
                if (columnvalue.Any(cv => string.Equals(cv, Acclist[1], StringComparison.OrdinalIgnoreCase)) && columnvalue.Any(cv => string.Equals(cv, Acclist[0], StringComparison.OrdinalIgnoreCase)) &&
                    IsElementVisible(intgtrStudies.SearchPanel()))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Select 1 study from each patient found in the Study Selector, View	 
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                ehr.selectPatient(Lastnames[0], 1);
                ehr.selectPatient(Lastnames[1], 1);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step7, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8 - 	Verify all selected studies are listed in the Exam List Panel
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (Exam_list[0].Displayed && Exam_list.Count == 2) //ToDo Accession validation
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 -	Leave all patient/study fields empty. Launch URL.
                ehr.SetSearchKeys_Study("");
                String url_9 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_9);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step9 = ehr.ErrorMsg();
                if (Step9.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.SetSearchKeys_Study(StudyUIDs[0], "Study_UID");
                String url_10 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_10);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step10 = result.steps[++ExecutedSteps];
                step10.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step10, viewport))  //**ToDO Accession Validation
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 - Load Oldest
                //true
                //true
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Load Oldest");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step 12 - In the TestEHR tool, change the following settings only:
                //Show Selector = blank
                //Show Selector Search = false
                //Enter Accession number to search a patient with multiple priors
                ehr.SetSearchKeys_Study(Acclist[0]);
                ehr.SetSearchKeys_Study("", "Study_UID");
                ehr.SetSelectorOptions(showSelector: "", selectorsearch: "False");
                String url_12 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_12);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step12 = result.steps[++ExecutedSteps];
                step12.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step12, viewport)) //**ToDO Accession Validation
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-13:Replace a Accession number which is unique among these priors. Launch URL.
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_13 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_13);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step13 = result.steps[++ExecutedSteps];
                step13.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step13, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-14:Enter a few Accession numbers from different patient, where they have priors. Launch URL
                ehr.SetSearchKeys_Study(Acclist[0] + @"\" + Acclist[1]);
                String url_14 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_14);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step14 = result.steps[++ExecutedSteps];
                step14.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step14, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-15:Verify all selected studies are listed in the Exam List Panel
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (Exam_list[0].Displayed && Exam_list.Count == 2) //**ToDO Accession Validation
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-16:Leave all patient/study fields empty. Launch URL.
                ehr.SetSearchKeys_Study("");
                String url_16 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_16);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step16 = ehr.ErrorMsg();

                if (Step16.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-17:Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.SetSearchKeys_Study(StudyUIDs[0], "Study_UID");
                String url_17 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_17);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step17 = result.steps[++ExecutedSteps];
                step17.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step17, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-18:Load Newest
                //true
                //true
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Load Newest");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step-19:In the TestEHR tool, change the following settings only:
                //Show Selector = blank
                //Show Selector Search = blank
                //Enter Accession number to search a patient with multiple priors                
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(Acclist[0]);
                String url_19 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_19);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step19 = result.steps[++ExecutedSteps];
                step19.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step19, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-20:Replace a Accession number which is unique among these priors. Launch URL.
                ehr.SetSearchKeys_Study(Acclist[1]);
                String url_20 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_20);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step20 = result.steps[++ExecutedSteps];
                step20.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step20, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-21:Leave all patient/study fields empty. Launch URL.
                ehr.SetSearchKeys_Study("");
                String url_21 = ehr.clickCmdLine("ImageLoad");
                bluringviewer.NavigateToBluringIntegratorURL(url_21);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step21 = ehr.ErrorMsg();
                if (Step21.Trim().Equals("Error Occurred in operation: Study search fields are all empty. Open query is not permitted."))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-22:Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.SetSearchKeys_Study(StudyUIDs[0], "Study_UID");
                String url_22 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_22);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step22 = result.steps[++ExecutedSteps];
                step22.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && viewer.CompareImage(step22, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-23:Enter a few Study UIDs from different patient, where they have priors.
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(StudyUIDs[0] + @"\" + StudyUIDs[1]);
                String url_23 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_23);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step23 = result.steps[++ExecutedSteps];
                step23.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step23, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-24:In Exam List Panel and all studies matching the searched Study UID should listed.
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (Exam_list[0].Displayed && Exam_list.Count == 2) //ToDO Accession validation
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                //Close browser
                basepage.CloseBrowser();
                BasePage.Driver.Quit();
                BasePage.Driver = null;

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
            }
        }

        /// <summary>
        /// Uncheck the Encryption URL
        /// </summary>
        public TestCaseResult Test_162348(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");


                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Precondition      
                servicetool.LaunchServiceTool();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                wpfobject.SelectTabFromTabItems(ServiceTool.Encryption.Name.Encryption_tab);
                servicetool.EnterServiceEntry("TripDES.AvLite");
                servicetool.EnterServiceParameters("key", "string", "");
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                string[] Keys = servicetool.GenerateEncryptionKeys("TripDES.Halo");
                servicetool.EditServiceParameters("Key", "TripDES.AvLite", "Name", "key", Value: Keys[0]);
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();
                servicetool.EnterEncryptionProviders("ID-456", "args", "Cryptographic.TripDES.AvLite");
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();
                servicetool.EnterEncryptionProviders("ID-123", "args", "Cryptographic.TripDES.AvLite");
                servicetool.ClickApplyButtonFromTab();
                servicetool.AcceptDialogWindow();
                servicetool.RestartService();
                servicetool.CloseServiceTool();

                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);

                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                PageLoadWait.WaitForLoadingMessage();
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 -  Launch the TestEHR application, In Image Load tab, enter the either Patient ID or Accession number of a study that matches one study that is in one of the data source domains.           
                ehr.LaunchEHR();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(Accession);
                ExecutedSteps++;


                //Step-2:Set Show Report as "True" and Show Selector as "False" and click on the Use Encryption box and click on Cmd Line button.               
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.EncryptionCB().Checked = true;
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ExecutedSteps++;

                //Step-3:Click on Load and copy/Paste the generated URL in a browser on a client system then search.
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                var viewport = bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4:Close the browser.
                //At the Image Load tab, enter the either Patient ID or Accession number of a study that matches one study that is in one of the data source domains. 
                ehr.SetSearchKeys_Study(Accession);
                ExecutedSteps++;

                //Step-5:Uncheck the Use Encryption box and click on Cmd Line button.
                ehr.EncryptionCB().Checked = false;
                String url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                //Step-6:Click on Load and copy/Paste the generated URL in a browser on a client system then search. 
                login.CreateNewSesion();
                bluringviewer.NavigateToIntegratorURL(url_5);
                //bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Errormsg = ehr.ErrorMsg();

                if (Errormsg.Trim().Equals("Error Occurred in operation: URL is not properly encrypted"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                servicetool.CloseServiceTool();
                ehr.CloseEHR();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripDES.AvLite']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic.TripDES.AvLite']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();

                Driver.Manage().Cookies.DeleteAllCookies();
                this.CloseBrowser();
            }
        }

        /// <summary>
        /// Test 138738 - Test EHR with LDAP user credentials, Study shall be displayed in user preferences viewer as
        /// "BluRing" in iCAMixed authentication mode.
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162349(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String URL = "http://localhost/webaccess";
                String authtype_ldap = "iCAMixed";
                String ldap_username = Config.LdapAdminUserName;
                String ldap_password = Config.LdapAdminPassword;
                String securityID_ldap = ldap_username + "-" + ldap_password;
                String local_username = Config.adminUserName;
                String local_password = Config.adminPassword;
                String securityID_local = local_username + "-" + local_password;

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.LdapAdminUserName, Config.LdapAdminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();
                new Login();

                //Uncomment iCALDAP Tag
                login.CommentXMLnode("id", "Bypass");
                login.CommentXMLnode("id", "iCADatabase");
                login.CommentXMLnode("id", "iCALdap");
                login.UncommentXMLnode("id", "iCAMixed");

                //Step 1                
                ehr.LaunchEHR();
                ExecutedSteps++;

                //Step 2
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: authtype_ldap, user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]) && url_2.Contains(securityID_ldap) && url_2.Contains(ldap_username))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-3
                patientstudy.SelectPatinet("Patient ID", PatientID[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 - Launch study directly
                login.CreateNewSesion();
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study("", "Patient_ID");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                var url_4 = ehr.clickCmdLine("ImageLoad");
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var viewport4 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                ehr.CloseEHR();
                if (viewer.CompareImage(step4, viewport4))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_local, AuthProvider: authtype_ldap, user: local_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_5 = ehr.clickCmdLine("ImageLoad");
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_5);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(PatientID[0]) && url_5.Contains(securityID_local) && url_5.Contains(local_username))
                {

                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-6
                patientstudy.SelectPatinet("Patient ID", PatientID[0]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport6 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step6, viewport6))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7
                login.CreateNewSesion();
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study("", "Patient_ID");
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                var url_7 = ehr.clickCmdLine("ImageLoad");
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_7);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                var viewport7 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                ehr.CloseEHR();
                if (viewer.CompareImage(step7, viewport7))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8 - Invalid LDAP user Crdentials - Mixed Mode
                login.CreateNewSesion();
                ehr.LaunchEHR();
                var token8 = "1234" + "-" + ldap_password;
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: token8, AuthProvider: authtype_ldap, user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_8))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9 - Invalid credentials in Local DB - Mixed mode               
                login.CreateNewSesion();
                ehr.LaunchEHR();
                var token9 = local_username + "-" + "1234";
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: token9, AuthProvider: authtype_ldap, user: local_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_9))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10 - Valid ldap credentials - Bypass mode
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: "Bypass", user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_10 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_10))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-11 - Valid Local DB credentials - Bypass mode
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_local, AuthProvider: "Bypass", user: local_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_11 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_11))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12 - Valid LDAP credentials - iCALdap mode
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: "iCALdap", user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_12))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-13
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_local, AuthProvider: "iCALdap", user: local_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_13 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_13))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-14 - Valid Ldap credentials - iCADatabase mode
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: "iCADatabase", user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_14 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_14))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-15 - Valid Local DB - iCADatabase mode
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: "iCALdap", user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_15 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_15))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {

                //Uncomment iCALDAP Tag
                login.UncommentXMLnode("id", "Bypass");
                login.CommentXMLnode("id", "iCADatabase");
                login.CommentXMLnode("id", "iCALdap");
                login.CommentXMLnode("id", "iCAMixed");

            }

        }

        /// <summary>
        /// Test 138738 - Authentication - iCALdap authenticaton
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162350(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Accession4 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");

                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String URL = "http://localhost/webaccess";
                String authtype_ldap = "iCALdap";
                String ldap_username = Config.LdapAdminUserName;
                String ldap_password = Config.LdapAdminPassword;
                String securityID_ldap = ldap_username + "-" + ldap_password;

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.LdapAdminUserName, Config.LdapAdminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();
                new Login();

                //Uncomment iCALDAP Tag
                login.CommentXMLnode("id", "Bypass");
                login.CommentXMLnode("id", "iCADatabase");
                login.UncommentXMLnode("id", "iCALdap");

                //Step 1                
                ehr.LaunchEHR();
                ExecutedSteps++;

                //Step 2
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: authtype_ldap, user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(PatientID[0], "Patient_ID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                ExecutedSteps++;

                //Step 3
                patientstudy.SelectPatinet("Patient ID", PatientID[0]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: authtype_ldap, user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "False", selectorsearch: "False");
                ehr.SetSearchKeys_Study(Accession4);
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var viewport4 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step4, viewport4))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step-5 - Invalid ldap username or password
                login.CreateNewSesion();
                ehr.LaunchEHR();
                var token = ldap_username + "-" + "1234";
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: token, AuthProvider: authtype_ldap, user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_5 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_5))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6 - Valid Local username and password
                login.CreateNewSesion();
                ehr.LaunchEHR();
                var token6 = "Administrator" + "-" + "Administrator";
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: token6, AuthProvider: authtype_ldap, user: "Administrator");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_6 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_6))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7 - Valid ldap user id, Auth type - Bypass
                ehr.LaunchEHR();
                login.CreateNewSesion();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: "Bypass", user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_7))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8 -  Valid ldap user id and Auth Type - iCADatabase
                ehr.LaunchEHR();
                login.CreateNewSesion();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_ldap, AuthProvider: "iCADatabase", user: ldap_username);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True", selectorsearch: "True");
                ehr.SetCommonParameters(showclose: "False");
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_8 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (PatientsStudy.IsAuthFailedMessage(url_8))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                //Uncomment iCALDAP Tag
                login.UncommentXMLnode("id", "Bypass");
                login.CommentXMLnode("id", "iCADatabase");
                login.CommentXMLnode("id", "iCALdap");
            }
        }

        /// <summary>
        /// Test 138740 - User sharing Enabled- Local and LDAP Database
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test1_162351(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            String Domain1 = null;
            String Role1 = null;
            String User1 = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String username = Config.adminUserName;
                String password = Config.adminPassword;

                //29822041
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                //LDAPCredential =Domain1:Role1:tuser1
                String LDAPCredential = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LDAPCredential");
                String[] LDAP_List = LDAPCredential.Split(':');

                //Domain1:Role1:User1:password =>Domain1:TestRole1:ben.kenobi:.ben.13579

                Domain1 = LDAP_List[0];
                Role1 = LDAP_List[1];

                User1 = LDAP_List[2];
                String Passwd = LDAP_List[3];

                String DomainRole1 = "Role_" + new Random().Next(1000);
                String[] datasource = null;

                DomainManagement domain = new DomainManagement();
                RoleManagement role = new RoleManagement();
                UserManagement usermgt = new UserManagement();
                Studies study = new Studies();
                UserPreferences userpref = new UserPreferences();
                BluRingViewer viewer = new BluRingViewer();
                String URL = null;

                //Preconditions
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");

                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                //Enable both Local and LDAP Database 
                servicetool.SetMode(2, "ldap");
                servicetool.LDAPSetup(LDApServerHost: "10.4.38.27");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Create a new domain/role /non-admin user
                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == false)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.CreateDomain(Domain1, DomainRole1, datasources: datasource);
                    domain.SetViewerTypeInNewDomain("universal");
                    PageLoadWait.WaitForPageLoad(30);
                    PageLoadWait.WaitForFrameLoad(10);
                    domain.ClickSaveDomain();
                }
                PageLoadWait.WaitForPageLoad(30);
                role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == false)
                    role.CreateRole(Domain1, Role1, "physician");
                login.Logout();

                //Precondition
                login.LoginIConnect(User1, Passwd);
                //domain = (DomainManagement)login.Navigate("DomainManagement");
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1 - Launch TestEHR application
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ExecutedSteps++;

                //step-2
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess,
                //AutoEndSession - true , /Domain - Domain1
                //Role - Role1 ,  //User - Mapped LDAP User say as User1
                //Security-User1-User1    //Show Selector - False
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession);//29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 - Copy the generated URL and launch it in a browser.
                login.CreateNewSesion();
                try
                {
                    bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                }
                catch { Thread.Sleep(30000); }
                IWebElement panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                bool status3 = viewer.CompareImage(step3, panel);
                if (status3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-4
                // Test Data-Load the study by providing only Domain information not Role.
                //Address - http -//localhost/WebAccess       //AutoEndSession - true
                //Domain - Domain1 Role - (Left it as blank) //User - Mapped LDAP User say as User1
                // Security - User1 - User1[Password for User1]   //Accession Number - Access
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 - Copy the generated URL and launch it in a browser.
                login.CreateNewSesion();
                try
                {
                    bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                }
                catch { Thread.Sleep(60000); }
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bool status5 = viewer.CompareImage(step5, panel);
                if (status5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-6
                //Load the study only Role information not Domain  
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)   //Role - Role
                //User - Mapped LDAP User say as User1  Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - acc 
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 - Copy the generated URL and launch it in a browser
                login.CreateNewSesion();
                try
                {
                    bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                }
                catch { Thread.Sleep(60000); }
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                bool status7 = viewer.CompareImage(step7, panel);
                if (status7)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-8
                //Loading study by without domain and role 
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank) //Role - (Left it as blank)
                //Accession Number - acc
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 - Copy the generated URL and launch it in a browser.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                var step9 = result.steps[++ExecutedSteps];
                step9.SetPath(testid, ExecutedSteps);
                bool status9 = viewer.CompareImage(step9, panel);
                if (status9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 - Login to iCA as an administrator.
                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                ExecutedSteps++;

                //step-11
                //"Navigate to Role management tab and delete the role which was mapped in the LDAP domain.
                //Note- Make sure that the deleted role is not present in ‘IRUSER’ table in database."	"Role should be deleted
                role = (RoleManagement)login.Navigate("RoleManagement");
                role.SearchRole(Role1, Domain1);
                role.SelectRole(Role1);
                role.ClickButtonInRole("delete");
                login.Logout();
                //result.steps[++ExecutedSteps].status = "Hold";
                //DB-- validation
                DataBaseUtil db = new DataBaseUtil("sqlserver");
                db.ConnectSQLServerDB();
                IList<String> rolelist = db.ExecuteQuery("select RoleID from dbo.IRRole");
                bool isRoleavailable = rolelist.Contains(Role1);
                IList<String> UserList1 = db.ExecuteQuery("select UserID from dbo.IRUser");
                db.ReadTable("delete from dbo.IRUser where UserID=" + "'" + User1 + "'");
                IList<String> UserList2 = db.ExecuteQuery("select UserID from dbo.IRUser");
                if (isRoleavailable == false && UserList1.Count - 1 == UserList2.Count)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-12
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess //AutoEndSession - true
                //Domain - Domain //Role - Role
                //User - Mapped LDAP User say as User1 //Security-User1-User1[Password for User1]
                //Accession Number - acc
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 - Copy the generated URL and launch it in a browser.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-14
                //Load the study by providing only Domain, not Role
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - Domain1   //Role - (Left it as blank)
                //Show Selector - False //Accession Number - Acc               
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-15
                //Copy the generated URL and launch it in a browser.
                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status15 = study.CompareImage(result.steps[ExecutedSteps], panel);
                if (status15)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-16
                //Load the study by providing only Role, not Domain
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - (Left it as blank)    //Role - Role
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]                             
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-17
                //Copy the generated URL and launch it in a browser.
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-18
                //Load the study by without providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)  //Role - (Left it as blank)
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - Acc
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                if (URL != null)// && UserList1.Count - 1 == UserList2.Count)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step 19 - Copy the generated URL and launch it in a browser.
                login.CreateNewSesion();
                //bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: URL);
                //panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                //result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                //bool status19 = study.CompareImage(result.steps[ExecutedSteps], panel);
                //if (status19)
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);


                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                             

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }
            finally
            {
                //Enable local  Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(0);
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                try
                {
                    login = new Login();
                    login.DriverGoTo(login.url);
                    login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                    RoleManagement role = (RoleManagement)login.Navigate("RoleManagement");
                    if (role.RoleExists(Role1, Domain1) == true)
                    {
                        role.SearchRole(Role1, Domain1);
                        role.SelectRole(Role1);
                        role.ClickButtonInRole("delete");
                    }
                    DomainManagement domain = (DomainManagement)login.Navigate("DomainManagement");
                    Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                    bool DomainFlag = domain.DomainExists(Domain1);
                    if (DomainFlag == true)
                    {
                        domain = (DomainManagement)login.Navigate("DomainManagement");
                        domain.SearchDomain(Domain1);
                        domain.SelectDomain(Domain1);
                        domain.ClickDeleteDomainBtn();
                        domain.ConfirmDeleteDomain();
                    }
                    login.Logout();
                }
                catch(Exception)
                {
                    login = new Login();
                    login.DriverGoTo(login.url);
                    login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                    UserManagement User = (UserManagement)login.Navigate("UserManagement");
                    bool UserFlag = User.SearchUser(User1,Domain1);
                    if (UserFlag == true)
                    {
                        User.DeleteUser(Domain1, User1);
                    }
                    DomainManagement domain = (DomainManagement)login.Navigate("DomainManagement");
                    Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                    bool DomainFlag = domain.DomainExists(Domain1);
                    if (DomainFlag == true)
                    {
                        domain = (DomainManagement)login.Navigate("DomainManagement");
                        domain.SearchDomain(Domain1);
                        domain.SelectDomain(Domain1);
                        domain.ClickDeleteDomainBtn();
                        domain.ConfirmDeleteDomain();
                    }
                    login.Logout();
                }
            }
        }

        /// <summary>
        /// Test 138740 - User sharing Enabled- LDAP Database
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test2_162351(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            IntegratorStudies intgtrStudies = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            String Domain1 = null;
            String Role1 = null;

            try
            {
                String username = Config.adminUserName;
                String password = Config.adminPassword;

                //29822041
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                //LDAPCredential =Domain1:Role1:tuser1
                String LDAPCredential = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LDAPCredential");
                String[] LDAP_List = LDAPCredential.Split(':');

                //Domain1:Role1:User1:password =>Domain1:TestRole1:ben.kenobi:.ben.13579

                Domain1 = LDAP_List[0];
                Role1 = LDAP_List[1];

                String User1 = LDAP_List[2];
                String Passwd = LDAP_List[3];

                String DomainRole1 = "Role_" + new Random().Next(1000);

                String[] datasource = null;

                DomainManagement domain = new DomainManagement();
                RoleManagement role = new RoleManagement();
                UserManagement usermgt = new UserManagement();
                Studies study = new Studies();
                UserPreferences userpref = new UserPreferences();
                BluRingViewer viewer = new BluRingViewer();
                String URL = null;

                //Precondition
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);

                //1. See attached instructions for configuring TestEHR in iCA server
                //2. Create a new domain/role /non-admin user
                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == false)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.CreateDomain(Domain1, DomainRole1, datasources: datasource);
                    domain.SetViewerTypeInNewDomain("universal");
                    PageLoadWait.WaitForPageLoad(30);
                    PageLoadWait.WaitForFrameLoad(10);
                    domain.ClickSaveDomain();
                }
                PageLoadWait.WaitForPageLoad(30);
                role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == false)
                    role.CreateRole(Domain1, Role1, "physician");
                login.Logout();

                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                //Enable only LDAP Database 
                servicetool.SetMode(1, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                login.LoginIConnect(User1, Passwd);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1
                //Launch TestEHR application
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ExecutedSteps++;

                //step-2
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess,
                //AutoEndSession - true , /Domain - Domain1
                //Role - Role1 ,  //User - Mapped LDAP User say as User1
                //Security-User1-User1    //Show Selector - False

                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession);//29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-3
                //Copy the generated URL and launch it in a browser.
                login.InvokeBrowser(Config.BrowserType);
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();

                IWebElement panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status3 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-4
                //Test Data- Load the study by providing only Domain information not Role.
                //Address - http-//localhost/WebAccess       //AutoEndSession - true
                //Domain - Domain1 Role - (Left it as blank) //User - Mapped LDAP User say as User1
                //Security-User1-User1[Password for User1]   //Accession Number - Access
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-5
                //Copy the generated URL and launch it in a browser.
                CreateNewSesion();

                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status5 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //step-6
                //Load the study only Role information not Domain  
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)   //Role - Role
                //User - Mapped LDAP User say as User1  Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - acc 

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-7
                //Copy the generated URL and launch it in a browser
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();

                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status7 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status7)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-8
                //Loading study by without domain and role 
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank) //Role - (Left it as blank)
                //Accession Number - acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-9
                //Copy the generated URL and launch it in a browser.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();

                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status9 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-10
                //Login to iCA as an administrator.
                //Enable local  Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(2, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                ExecutedSteps++;

                //step-11
                //"Navigate to Role management tab and delete the role which was mapped in the LDAP domain.
                //Note- Make sure that the deleted role is not present in ‘IRUSER’ table in database."	"Role should be deleted

                role = (RoleManagement)login.Navigate("RoleManagement");
                role.SearchRole(Role1, Domain1);
                role.SelectRole(Role1);
                role.ClickButtonInRole("delete");
                login.Logout();


                //Disable local Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(1, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();


                // result.steps[++ExecutedSteps].status = "Hold";

                //DB-- validation
                DataBaseUtil db = new DataBaseUtil("sqlserver");
                db.ConnectSQLServerDB();
                IList<String> rolelist = db.ExecuteQuery("select RoleID from dbo.IRRole");
                bool isRoleavailable = rolelist.Contains(Role1);
                IList<String> UserList1 = db.ExecuteQuery("select UserID from dbo.IRUser");
                db.ReadTable("delete from dbo.IRUser where UserID=" + "'" + User1 + "'");
                IList<String> UserList2 = db.ExecuteQuery("select UserID from dbo.IRUser");
                if (isRoleavailable == false && UserList1.Count - 1 == UserList2.Count)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-12
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess //AutoEndSession - true
                //Domain - Domain //Role - Role
                //User - Mapped LDAP User say as User1 //Security-User1-User1[Password for User1]
                //Accession Number - acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-13
                //Copy the generated URL and launch it in a browser.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");

                //Authentication should fail & error msg display,(Error Occurred in operation- Client authentication failed)
                if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-14
                //Load the study by providing only Domain, not Role
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - Domain1   //Role - (Left it as blank)
                //Show Selector - False //Accession Number - Acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-15
                //Copy the generated URL and launch it in a browser.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status15 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status15)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-16
                //Load the study by providing only Role, not Domain
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - (Left it as blank)    //Role - Role
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]                  
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-17
                //Copy the generated URL and launch it in a browser.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");

                //Authentication should fail & error msg display,(Error Occurred in operation- Client authentication failed)
                if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-18
                //Load the study by without providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)  //Role - (Left it as blank)
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - Acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)//&& UserList1.Count - 1 == UserList2.Count)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-19
                //Copy the generated URL and launch it in a browser.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                //bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");                
                //BluRingViewer.WaitforThumbnails();
                //BluRingViewer.WaitforViewports();
                //panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                //result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                //bool status19 = study.CompareImage(result.steps[ExecutedSteps], panel);

                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                //Enable local  Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(0);
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                RoleManagement role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == true)
                {
                    role.SearchRole(Role1, Domain1);
                    role.SelectRole(Role1);
                    role.ClickButtonInRole("delete");
                }
                DomainManagement domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == true)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.SearchDomain(Domain1);
                    domain.SelectDomain(Domain1);
                    domain.ClickDeleteDomainBtn();
                    domain.ConfirmDeleteDomain();
                }
                login.Logout();

            }
        }

        /// <summary>
        /// Test 138813 - User sharing Disabled- Local and LDAP Database
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test1_162352(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            String Domain1 = null;
            String Role1 = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                //29822041
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                //LDAPCredential =Domain1:Role1:tuser1
                String LDAPCredential = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LDAPCredential");
                String[] LDAP_List = LDAPCredential.Split(':');

                //Domain1:Role1:User1 =>Domain1:Role1:tuser1
                Domain1 = LDAP_List[0];
                Role1 = LDAP_List[1];
                String User1 = LDAP_List[2];
                String Passwd = LDAP_List[3];

                String DomainRole1 = "Role_" + new Random().Next(1000);
                String[] datasource = null;

                DomainManagement domain = new DomainManagement();
                RoleManagement role = new RoleManagement();
                UserManagement usermgt = new UserManagement();
                Studies study = new Studies();
                UserPreferences userpref = new UserPreferences();
                BluRingViewer viewer = new BluRingViewer();
                String URL = null;

                //Precondition
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                //Enable both Local and LDAP Database 
                servicetool.SetMode(2, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                //Preconditions:
                //Set default viewer as " BluRing " in the miscellaneous under Viewer tab
                //Set User Sharing as Always Disabled
                //Disable the Encrypted URL in the Service tool Tab Located in --*^>^*Integrator URL 

                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);


                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == false)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.CreateDomain(Domain1, DomainRole1, datasources: datasource);
                    PageLoadWait.WaitForPageLoad(30);
                    PageLoadWait.WaitForFrameLoad(10);
                    domain.ClickSaveDomain();
                }
                PageLoadWait.WaitForPageLoad(30);
                role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == false)
                    role.CreateRole(Domain1, Role1, "physician");
                login.Logout();

                login.LoginIConnect(User1, Passwd);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess //AutoEndSession - true
                //Domain - Domain1   //Role - Role1
                //User - Mapped LDAP User say as User1   //Security-User1-User1[Password for User1]
                //Show Selector - False   //Accession Number - Acc

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-2
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                IWebElement panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status2 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-3
                //Test Data- Load the study by providing only Domain information not Role.
                //Address - http-//localhost/WebAccess       //AutoEndSession - true
                //Domain - Domain1 Role - (Left it as blank) //User - Mapped LDAP User say as User1
                //Security-User1-User1[Password for User1]   //Accession Number - Access
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-4
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status4 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-5
                //Load the study only Role information not Domain  
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)   //Role - Role
                //User - Mapped LDAP User say as User1  Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - acc 

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-6
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status6 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-7
                //Loading study by without domain and role 
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank) //Role - (Left it as blank)
                //Accession Number - acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-8
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status8 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-9
                //Login to iCA as an administrator.
                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                ExecutedSteps++;

                //step-10
                //"Navigate to Role management tab and delete the role which was mapped in the LDAP domain.
                //Note- Make sure that the deleted role is not present in ‘IRUSER’ table in database."	"Role should be deleted

                role = (RoleManagement)login.Navigate("RoleManagement");
                role.SearchRole(Role1, Domain1);
                role.SelectRole(Role1);
                role.ClickButtonInRole("delete");
                login.Logout();

                //DB-- validation
                DataBaseUtil db = new DataBaseUtil("sqlserver");
                db = new DataBaseUtil("sqlserver");
                db.ConnectSQLServerDB();
                IList<String> UserList1 = db.ExecuteQuery("select UserID from dbo.IRUser");
                Logger.Instance.InfoLog("The userlist count before deleting the user " + User1 + ":" + UserList1.Count);
                db.ReadTable("delete from dbo.IRUser where UserID=" + "'" + User1 + "'");
                IList<String> UserList2 = db.ExecuteQuery("select UserID from dbo.IRUser");
                Logger.Instance.InfoLog("The userlist count after deleting the user " + User1 + ":" + UserList2.Count);
                IList<String> rolelist = db.ExecuteQuery("select RoleID from dbo.IRUser");
                bool isRoleavailable = rolelist.Contains(Role1);
                if (isRoleavailable == false)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-11
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess //AutoEndSession - true
                //Domain - Domain //Role - Role
                //User - Mapped LDAP User say as User1 //Security-User1-User1[Password for User1]
                //Accession Number - acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-12
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                //Authentication should fail & error msg display,(Error Occurred in operation- Client authentication failed)
                //if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status12 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-13
                //Load the study by providing only Domain, not Role
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - Domain1   //Role - (Left it as blank)
                //Show Selector - False //Accession Number - Acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-14
                //Copy the generated URL and launch it in a browser.

                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status14 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status14)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-15
                //Load the study by providing only Role, not Domain
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - (Left it as blank)    //Role - Role
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]
                //Accession Number - Acc 

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-16
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");

                //Authentication should fail & error msg display,(Error Occurred in operation- Client authentication failed)
                //if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status16 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status16)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-17
                //Load the study by without providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)  //Role - (Left it as blank)
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - Acc
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-18
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status18 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status18)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                //Enable local  Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(0);
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                RoleManagement role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == true)
                {
                    role.SearchRole(Role1, Domain1);
                    role.SelectRole(Role1);
                    role.ClickButtonInRole("delete");
                }
                DomainManagement domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == true)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.SearchDomain(Domain1);
                    domain.SelectDomain(Domain1);
                    domain.ClickDeleteDomainBtn();
                    domain.ConfirmDeleteDomain();
                }
                login.Logout();

            }
        }

        /// <summary>
        /// Test 138813 - User sharing Disabled- LDAP Database
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test2_162352(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            IntegratorStudies intgtrStudies = null;
            String Domain1 = null;
            String Role1 = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String username = Config.adminUserName;
                String password = Config.adminPassword;
                //29822041
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                //LDAPCredential =Domain1:Role1:tuser1
                String LDAPCredential = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LDAPCredential");
                String[] LDAP_List = LDAPCredential.Split(':');

                //Domain1:Role1:User1 =>Domain1:Role1:tuser1
                Domain1 = LDAP_List[0];
                Role1 = LDAP_List[1];
                String User1 = LDAP_List[2];
                String Passwd = LDAP_List[3];

                String DomainRole1 = "Role_" + new Random().Next(1000);
                String[] datasource = null;

                DomainManagement domain = new DomainManagement();
                RoleManagement role = new RoleManagement();
                UserManagement usermgt = new UserManagement();
                Studies study = new Studies();
                UserPreferences userpref = new UserPreferences();
                BluRingViewer viewer = new BluRingViewer();
                String URL = null;

                //Precondition

                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == false)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.CreateDomain(Domain1, DomainRole1, datasources: datasource);
                    PageLoadWait.WaitForPageLoad(30);
                    PageLoadWait.WaitForFrameLoad(10);
                    domain.ClickSaveDomain();
                }
                PageLoadWait.WaitForPageLoad(30);
                role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == false)
                    role.CreateRole(Domain1, Role1, "physician");
                login.Logout();


                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                //Enable LDAP Database 
                servicetool.SetMode(1, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                //Preconditions:
                //Set default viewer as " BluRing " in the miscellaneous under Viewer tab
                //Set User Sharing as Always Disabled
                //Disable the Encrypted URL in the Service tool Tab Located in --*^>^*Integrator URL 

                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);

                login.LoginIConnect(User1, Passwd);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess //AutoEndSession - true
                //Domain - Domain1   //Role - Role1
                //User - Mapped LDAP User say as User1   //Security-User1-User1[Password for User1]
                //Show Selector - False   //Accession Number - Acc

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-2
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                IWebElement panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status2 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-3
                //Test Data- Load the study by providing only Domain information not Role.
                //Address - http-//localhost/WebAccess       //AutoEndSession - true
                //Domain - Domain1 Role - (Left it as blank) //User - Mapped LDAP User say as User1
                //Security-User1-User1[Password for User1]   //Accession Number - Access
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-4
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status4 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();
                //step-5
                //Load the study only Role information not Domain  
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)   //Role - Role
                //User - Mapped LDAP User say as User1  Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - acc 

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-6
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status6 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-7
                //Loading study by without domain and role 
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank) //Role - (Left it as blank)
                //Accession Number - acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-8
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status8 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-9
                //Login to iCA as an administrator.
                //Enable local  Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(2, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                login.DriverGoTo(login.url);
                login.LoginIConnect(username, password);
                ExecutedSteps++;

                //step-10
                //"Navigate to Role management tab and delete the role which was mapped in the LDAP domain.
                //Note- Make sure that the deleted role is not present in ‘IRUSER’ table in database."	"Role should be deleted

                role = (RoleManagement)login.Navigate("RoleManagement");
                role.SearchRole(Role1, Domain1);
                role.SelectRole(Role1);
                role.ClickButtonInRole("delete");
                login.Logout();

                //Disable local Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(1, "ldap");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                //DB-- validation
                DataBaseUtil db = new DataBaseUtil("sqlserver");
                db = new DataBaseUtil("sqlserver");
                db.ConnectSQLServerDB();
                IList<String> UserList1 = db.ExecuteQuery("select UserID from dbo.IRUser");
                Logger.Instance.InfoLog("The userlist count before deleting the user " + User1 + ":" + UserList1.Count);
                db.ReadTable("delete from dbo.IRUser where UserID=" + "'" + User1 + "'");
                IList<String> UserList2 = db.ExecuteQuery("select UserID from dbo.IRUser");
                Logger.Instance.InfoLog("The userlist count after deleting the user " + User1 + ":" + UserList2.Count);
                IList<String> rolelist = db.ExecuteQuery("select RoleID from dbo.IRUser");
                bool isRoleavailable = rolelist.Contains(Role1);
                if (isRoleavailable == false)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-11
                //Load the study by providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess //AutoEndSession - true
                //Domain - Domain //Role - Role
                //User - Mapped LDAP User say as User1 //Security-User1-User1[Password for User1]
                //Accession Number - acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-12
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                //Authentication should fail & error msg display,(Error Occurred in operation- Client authentication failed)
                //if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status12 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status12)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-13
                //Load the study by providing only Domain, not Role
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - Domain1   //Role - (Left it as blank)
                //Show Selector - False //Accession Number - Acc

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: Domain1, role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041

                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-14
                //Copy the generated URL and launch it in a browser.

                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status14 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status14)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-15
                //Load the study by providing only Role, not Domain
                //Address - http-//localhost/WebAccess  //AutoEndSession - true
                //Domain - (Left it as blank)    //Role - Role
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]
                //Accession Number - Acc 

                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: Role1, user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-16
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");

                //Authentication should fail & error msg display,(Error Occurred in operation- Client authentication failed)
                //if (bluringviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status16 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status16)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                CreateNewSesion();

                //step-17
                //Load the study by without providing domain and role information in TestEHR.
                //Address - http-//localhost/WebAccess   //AutoEndSession - true
                //Domain - (Left it as blank)  //Role - (Left it as blank)
                //User - Mapped LDAP User say as User1  //Security-User1-User1[Password for User1]
                //Show Selector - False //Accession Number - Acc
                URL = null;
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "", role: "", user: User1, SecurityID: User1 + "-" + Passwd);
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study(Accession); //29822041
                URL = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //URL should be generated
                if (URL != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //step-18
                //Copy the generated URL and launch it in a browser.
                bluringviewer.NavigateToBluringIntegratorURL(URL);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforThumbnails();
                BluRingViewer.WaitforViewports();
                panel = Driver.FindElement(By.CssSelector(BluRingViewer.div_studypanel));
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps + 1);
                bool status18 = study.CompareImage(result.steps[ExecutedSteps], panel);

                //The study loaded into the Viewer.
                if (status18)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                //Enable local  Database 
                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(0);
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                RoleManagement role = (RoleManagement)login.Navigate("RoleManagement");
                if (role.RoleExists(Role1, Domain1) == true)
                {
                    role.SearchRole(Role1, Domain1);
                    role.SelectRole(Role1);
                    role.ClickButtonInRole("delete");
                }
                DomainManagement domain = (DomainManagement)login.Navigate("DomainManagement");
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("TabContent").SwitchTo().Frame("TabContent");
                bool DomainFlag = domain.DomainExists(Domain1);
                if (DomainFlag == true)
                {
                    domain = (DomainManagement)login.Navigate("DomainManagement");
                    domain.SearchDomain(Domain1);
                    domain.SelectDomain(Domain1);
                    domain.ClickDeleteDomainBtn();
                    domain.ConfirmDeleteDomain();
                }
                login.Logout();

            }
        }

        /// <summary>
        /// 'Default Viewer Setting' as 'BluRing' : Verify the Update preference to allow launching the study in the BlueRing viewer via study list double click in Standalone Mode
        /// </summary>
        public TestCaseResult Test_162360(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies studies = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                //Step 1 - Launch the BlueRing application with a client browser 
                login = new Login();
                login.DriverGoTo(login.url);
                ExecutedSteps++;

                //Step 2 - Login to WebAccess site with any privileged user.
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                ExecutedSteps++;

                //Step 3 - Select Studies tab.
                studies = login.Navigate<Studies>();
                ExecutedSteps++;

                //Step 4 - Select Options --*^>^*User Preferences and set the 'Default Viewer Setting' as 'BluRing',then click on 'Save' button.                
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.ModalityDropDown().SelectByText("CR");

                ExistingLayoutValue = userpref.LayoutDropDown().SelectedOption.Text;
                userpref.LayoutDropDown().SelectByText("2x3");
                userpref.CloseUserPreferences();
                ExecutedSteps++;

                //Step 5 - Double click on any study in the study list and verify the study should be launched on the BlueRing Viewer 
                studies.SearchStudy("Accession", Accession);
                studies.SelectStudy("Accession", Accession);
                studies.Doubleclick("cssselector", "#gridTableStudyList tbody tr:nth-child(2)");
                PageLoadWait.WaitForPageLoad(30);
                PageLoadWait.WaitForFrameLoad(10);
                BluRingViewer.WaitforViewports();
                BluRingViewer.WaitforThumbnails();
                ExecutedSteps++;

                //Close study and Logout
                bluringviewer.CloseBluRingViewer();
                login.Logout();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.ModalityDropDown().SelectByText("CR");
                userpref.LayoutDropDown().SelectByText(ExistingLayoutValue);
                userpref.CloseUserPreferences();
                login.Logout();
            }
        }

        /// <summary>
		/// TestEHR with supported Modality
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162395(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);


                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                UserPreferences userpref = new UserPreferences();
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.ModalityDropdown().SelectByText("CT");
                if (userpref.LayoutDropdown().SelectedOption.Equals("1x2"))
                {
                    Logger.Instance.InfoLog("Layout is 1X2 for CT already");
                    userpref.CancelPreferenceBtn();
                    PageLoadWait.WaitForFrameLoad(30);
                }
                else
                {
                    userpref.LayoutDropdown().SelectByText("1x2");
                    userpref.CloseUserPreferences();
                }
                login.Logout();


                //Step 1  Launch TestEHR and enter below details		
                //URL: http://iCA server ip/webaccess
                //User Id : Administrator
                //Security id: Administrator - Administrator
                //User sharing : True
                //Accession number: (enter the accession number of the CT modality study that is to be loaded ) 
                //Click on CMD button
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                if (url_2 != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 2 Copy and Paste the URL in any browser
                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step2, panel) && (Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 2))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Close browser
                login.CreateNewSesion();

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                UserPreferences userpref = new UserPreferences();
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.ModalityDropdown().SelectByText("CT");
                if (userpref.LayoutDropdown().SelectedOption.Equals("2x2"))
                {
                    Logger.Instance.InfoLog("Layout is 2X2 for CT already");
                    userpref.CancelPreferenceBtn();
                    PageLoadWait.WaitForFrameLoad(30);
                }
                else
                {
                    userpref.LayoutDropdown().SelectByText("2x2");
                    userpref.CloseUserPreferences();
                }
                login.Logout();
            }
        }
        
        /// <summery>
        /// AutoEndSession
        /// </summery>
        public TestCaseResult Test_162407(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;           
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            string WebaccessConfigurationpath = Config.FileLocationPath;
            string AccessionNo = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

            try
            {
                //Step-1 From WebAccessConfiguration.xml set AutoEndSession value to "False"
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AutoEndSession", "False");
                servicetool.RestartIISUsingexe();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-2 Launch TestEHR application.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-3 Set AutoEndSession = True in TestEHR tool
                ehr.SetCommonParameters();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-4 Enter Accession number which is available in datasource and Click on CMD Line.
                ehr.SetSearchKeys_Study(AccessionNo);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-5 Select Load
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);                             
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6: Close the browser or tab in which study is loaded
                BasePage.CreateBrowserTab();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0, isWaitforFrameload:false);
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 7: Hit the Load button again with same settings
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url); 
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 8: Select AutoEndSession value to blank and hit cmd button from TestEHR tool 
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(autoendsession: "");                
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 9: Enter Accession number which is available in datasource and Click on CMD Line
                //Step 10: Copy the complete URL
                ehr.SetSearchKeys_Study(AccessionNo);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                result.steps[++ExecutedSteps].status = "Pass";
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 11: Open the browser and paste the URL in browser address bar      
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator:false);
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12: Close the browser or tab in which study is loaded
                BasePage.CreateBrowserTab();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0, isWaitforFrameload: false);
                bool isDuplicatesession12 = PatientsStudy.IsDuplicateSessionMessage(url);
                if (isDuplicatesession12)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13: Select AutoEndSession value to False and hit cmd button from TestEHR tool
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();               
                ehr.SetCommonParameters(autoendsession: "False");
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 14: Enter Accession number which is available in datasource and Click on CMD Line
                ehr.SetSearchKeys_Study(AccessionNo);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 15: Select Load.               
                BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator:false);                
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 16
                BasePage.CreateBrowserTab();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0, isWaitforFrameload: false);
                bool isDuplicatesession16 = PatientsStudy.IsDuplicateSessionMessage(url);
                if (isDuplicatesession16)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 17: From WebAccessConfiguration.xml set AutoEndSession value to "True" in IntegratorMode session
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AutoEndSession", "True");
                servicetool.RestartIISUsingexe();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 18,19: Launch TestEHR application.
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(autoendsession: "True");
                result.steps[++ExecutedSteps].status = "Pass";
                result.steps[++ExecutedSteps].status = "Pass";                

                //Step 20: Enter Accession number which is available in datasource and Click on CMD Line.
                ehr.SetSearchKeys_Study(AccessionNo);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 21: Select Load               
                bluringviewer=BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);        
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 22: Close the browser or tab in which study is loaded
                BasePage.CreateBrowserTab();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0, isWaitforFrameload: false);
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 23
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator: false);
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-24, 25
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(autoendsession: "");
                ehr.SetSearchKeys_Study(AccessionNo);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();               
                result.steps[++ExecutedSteps].status = "Pass";
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 26
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator: false);
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-27                
                BasePage.CreateBrowserTab();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0, isWaitforFrameload: false);
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 28
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator: false);
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-29, 30
                login.CreateNewSesion();
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(autoendsession: "False");
                ehr.SetSearchKeys_Study(AccessionNo);
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                result.steps[++ExecutedSteps].status = "Pass";
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 31
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator: false);
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-32              
                BasePage.CreateBrowserTab();
                BasePage.SwitchBrowserTab(0);
                BasePage.Driver.Close();
                BasePage.SwitchBrowserTab(0, isWaitforFrameload: false);
                result.steps[++ExecutedSteps].status = "Pass";

                //Step 33
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url, isRefreshForIntegrator: false);
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: AccessionNo))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;                
            }
            catch(Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Logout
                login.Logout();
                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                basepage.ChangeNodeValue(WebaccessConfigurationpath, "/IntegratedMode/AutoEndSession", "True");
                servicetool.RestartIISUsingexe();
            }
        }
        
        /// <summary>
        /// 162408 - Study search criteria
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162408(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] AccessionID = Accession.Split(':');
                String[] PatientID = Patient.Split(':');
                String[] FirstNames = FirstName.Split(':');
                String[] LastNames = LastName.Split(':');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";


                //Step-1 In WebaccessConfiguration.xml set:
                //< AllowShowSelector > false </ AllowShowSelector >
                //< AllowShowSelectorSearch > false </ AllowShowSelectorSearch > Note: Use studies with same last name and Use studies with multiple priors..
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "False");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False", restart: true);
                ExecutedSteps++;

                //Step-2 In web.config under webaccess\webaccess\ <add key="Integrator.OnMultipleStudy" value="Show Error" />
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error", restart: true);
                ExecutedSteps++;

                //Step 3  Open the TestEHR application.	         
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "True");
                ExecutedSteps++;

                //Step 4 Set patientLastName=<patient's last name>, and launch URL. 
                //Note: Patient should have multiple studies in the domain
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_4 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_4);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step4_1 = ehr.ErrorMsg();
                if (Step4_1.Trim().Equals(SystemOverrideErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 5 Now add patientFirstName=<patient's First name>, and launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[0], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_5 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_5);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step5_1 = ehr.ErrorMsg();
                if (Step5_1.Trim().Equals(SystemOverrideErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 Set patientLastName=<patient's Last name>, and launch URL. Note: Patient should have single study in the domain
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastNames[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_6 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_6);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step6_1 = ehr.ErrorMsg();
                if (Step6_1.Trim().Equals(SystemOverrideErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 Now add patienFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[1], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_7 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_7);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step7_1 = ehr.ErrorMsg();
                if (Step7_1.Trim().Equals(SystemOverrideErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 8 In TestEHR set ShowSelector = false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "False");
                ExecutedSteps++;

                //Step 9 Set patientLastName=<patient's last name>, and launch URL. 
                //Note: Patient should have multiple studies in the domain
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_9 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_9);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step9_1 = ehr.ErrorMsg();
                if (Step9_1.Trim().Equals(MorePatientsErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 10 Now add patientFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[0], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_10 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_10);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step10_1 = ehr.ErrorMsg();
                if (Step10_1.Trim().Equals(MorePatientsErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 	Set patientLastName=<patient's Last name>, and launch URL. 
                //Note: Patient should have single study in the domain
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "False");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastNames[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                var url_11 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_11);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step11, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12 	Now add patienFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[1], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA91), "Datasource");
                var url_12 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_12);
                var viewport12 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step12 = result.steps[++ExecutedSteps];
                step12.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step12, viewport12))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 Leave all patient/study fields empty
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Datasource");
                var url_13 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_13);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step13_1 = ehr.ErrorMsg();
                if (Step13_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 14 In WebaccessConfiguration.xml set
                //< AllowShowSelector > true </ AllowShowSelector >
                //< AllowShowSelectorSearch > false </ AllowShowSelectorSearch >
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "False", restart: true);
                ExecutedSteps++;

                //Step 15 In TestEHR set ShowSelectorSearch= False
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "False");
                ExecutedSteps++;

                //Step 16 Set patientLastName=<patient's last name>, and launch URL. 
                //Note: Patient should have multiple studies in the domain
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_16 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_16);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"].All(a => a.StartsWith(LastNames[0])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 17 Now add patientFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[0], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_17 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy17 = PatientsStudy.LaunchPatientsStudyPage(url_17);
                var studyinfo17 = patientstudy17.GetPateintList();
                if (studyinfo17["Last Name"].Count == 1 && studyinfo17["Last Name"][0].Equals(LastNames[0]) && studyinfo17["First Name"][0].Equals(FirstNames[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.ErrorLog("No' of studies listing: " + studyinfo17["Last Name"].Count);
                    Logger.Instance.ErrorLog("Lastname in the list: " + studyinfo17["Last Name"][0]);
                    Logger.Instance.ErrorLog("Firstname in the list: " + studyinfo17["First Name"][0]);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18 	Set patientLastName=<patient's Last name>, and launch URL. 
                //Note: Patient should have single study in the domain
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastNames[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_18 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy18 = PatientsStudy.LaunchPatientsStudyPage(url_18);
                var studyinfo18 = patientstudy18.GetPateintList();
                if (studyinfo18["Last Name"][0].Equals(LastNames[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 19 Now add patienFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[1], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_19 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy19 = PatientsStudy.LaunchPatientsStudyPage(url_19);
                var studyinfo19 = patientstudy19.GetPateintList();
                if (studyinfo19["Last Name"].Count == 1 && studyinfo19["Last Name"][0].Equals(LastNames[1]) && studyinfo19["First Name"][0].Equals(FirstNames[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.ErrorLog("No' of studies listing: " + studyinfo19["Last Name"].Count);
                    Logger.Instance.ErrorLog("Lastname in the list: " + studyinfo19["Last Name"][0]);
                    Logger.Instance.ErrorLog("Firstname in the list: " + studyinfo19["First Name"][0]);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 20 Leave all patient/study fields empty
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Datasource");
                var url_20 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_20);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step20_1 = ehr.ErrorMsg();
                if (Step20_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 21 In TestEHR set ShowSelector = false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "False");
                ExecutedSteps++;

                //Step 22 	Set patientLastName=<patient's last name>, and launch URL. 
                //Note: Patient should have multiple studies in the domain
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_22 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_22);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step22_1 = ehr.ErrorMsg();
                if (Step22_1.Trim().Equals(MorePatientsErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 23 Now add patientFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[0], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_23 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_23);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step23_1 = ehr.ErrorMsg();
                if (Step23_1.Trim().Equals(MorePatientsErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 24 	Set patientLastName=<patient's Last name>, and launch URL. 
                //Note: Patient should have single study in the domain
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastNames[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_24 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_24);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                var step24 = result.steps[++ExecutedSteps];
                step24.SetPath(testid, ExecutedSteps);
                if (bluringviewer != null && bluringviewer.CompareImage(step24, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport)))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 25 Now add patienFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[1], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_25 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_25);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                var step25 = result.steps[++ExecutedSteps];
                step25.SetPath(testid, ExecutedSteps);
                if (bluringviewer != null && bluringviewer.CompareImage(step25, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport)))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 26 Leave all patient/study fields empty
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Datasource");
                var url_26 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_26);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step26_1 = ehr.ErrorMsg();
                if (Step26_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 27 In WebaccessConfiguration.xml set
                //< AllowShowSelector > true </ AllowShowSelector >
                //< AllowShowSelectorSearch > true </ AllowShowSelectorSearch >
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step 28 Set patientLastName=<patient's last name>, and launch URL. Note: Patient should have multiple studies in the domain
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_28 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy28 = PatientsStudy.LaunchPatientsStudyPage(url_28);
                var studyinfo28 = patientstudy28.GetPateintList();
                if (studyinfo28["Last Name"].All(a => a.StartsWith(LastNames[0])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 29 Now add patientFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[0], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_29 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy29 = PatientsStudy.LaunchPatientsStudyPage(url_29);
                var studyinfo29 = patientstudy29.GetPateintList();
                if (studyinfo29["Last Name"].Count == 1 && studyinfo29["Last Name"][0].Equals(LastNames[0]) && studyinfo29["First Name"][0].Equals(FirstNames[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.ErrorLog("No' of studies listing: " + studyinfo29["Last Name"].Count);
                    Logger.Instance.ErrorLog("Lastname in the list: " + studyinfo29["Last Name"][0]);
                    Logger.Instance.ErrorLog("Firstname in the list: " + studyinfo29["First Name"][0]);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 30 Set patientLastName=<patient's Last name>, and launch URL. Note: Patient should have single study in the domain
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastNames[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_30 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy30 = PatientsStudy.LaunchPatientsStudyPage(url_30);
                var studyinfo30 = patientstudy30.GetPateintList();
                if (studyinfo30["Last Name"][0].Equals(LastNames[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 31 Now add patienFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[1], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_31 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy31 = PatientsStudy.LaunchPatientsStudyPage(url_31);
                var studyinfo31 = patientstudy31.GetPateintList();
                if (studyinfo31["Last Name"].Count == 1 && studyinfo31["Last Name"][0].Equals(LastNames[1]) && studyinfo31["First Name"][0].Equals(FirstNames[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.ErrorLog("No' of studies listing: " + studyinfo31["Last Name"].Count);
                    Logger.Instance.ErrorLog("Lastname in the list: " + studyinfo31["Last Name"][0]);
                    Logger.Instance.ErrorLog("Firstname in the list: " + studyinfo31["First Name"][0]);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 32 Leave all patient/study fields empty
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Datasource");
                var url_32 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_32);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step32_1 = ehr.ErrorMsg();
                if (Step32_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 33 In TestEHR set ShowSelectorSearch= false
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "False");
                ExecutedSteps++;

                //Step 34 Set patientLastName=<patient's last name>, and launch URL.
                //Note: Patient should have multiple studies in the domain
                ehr.SetSearchKeys_Study(LastNames[0], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_34 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy34 = PatientsStudy.LaunchPatientsStudyPage(url_34);
                var studyinfo34 = patientstudy34.GetPateintList();
                if (studyinfo34["Last Name"].All(a => a.StartsWith(LastNames[0])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Step 35 Now add patientFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[0], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_35 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy35 = PatientsStudy.LaunchPatientsStudyPage(url_35);
                var studyinfo35 = patientstudy35.GetPateintList();
                if (studyinfo35["Last Name"].Count == 1 && studyinfo35["Last Name"][0].Equals(LastNames[0]) && studyinfo35["First Name"][0].Equals(FirstNames[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.ErrorLog("No' of studies listing: " + studyinfo35["Last Name"].Count);
                    Logger.Instance.ErrorLog("Lastname in the list: " + studyinfo35["Last Name"][0]);
                    Logger.Instance.ErrorLog("Firstname in the list: " + studyinfo35["First Name"][0]);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 36 Set patientLastName=<patient's Last name>, and launch URL. Note: Patient should have single study in the domain
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study(LastNames[1], "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_36 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy36 = PatientsStudy.LaunchPatientsStudyPage(url_36);
                var studyinfo36 = patientstudy36.GetPateintList();
                if (studyinfo36["Last Name"][0].Equals(LastNames[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 37 	Now add patienFirstName=<patient's First name>, and launch URL. 
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study(FirstNames[1], "First_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_37 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy37 = PatientsStudy.LaunchPatientsStudyPage(url_37);
                var studyinfo37 = patientstudy37.GetPateintList();
                if (studyinfo37["Last Name"].Count == 1 && studyinfo37["Last Name"][0].Equals(LastNames[1]) && studyinfo37["First Name"][0].Equals(FirstNames[1]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    Logger.Instance.ErrorLog("No' of studies listing: " + studyinfo37["Last Name"].Count);
                    Logger.Instance.ErrorLog("Lastname in the list: " + studyinfo37["Last Name"][0]);
                    Logger.Instance.ErrorLog("Firstname in the list: " + studyinfo37["First Name"][0]);
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 38 Leave all patient/study fields empty	
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("", "First_Name");
                ehr.SetSearchKeys_Study("", "Last_Name");
                ehr.SetSearchKeys_Study("", "Datasource");
                var url_38 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_38);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step38_1 = ehr.ErrorMsg();
                if (Step38_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 39 Pre-Condition: In Web.config under WebAccess\WebAccess set <add key="Integrator.OnMultipleStudy" value="Show Error" />
                //In WebaccessConfiguration.xml set
                //< AllowShowSelector > true </ AllowShowSelector >
                //< AllowShowSelectorSearch > true </ AllowShowSelectorSearch >
                //In TestEHR set ShowSelector = blank, and ShowSeletorSearch = blank
                //Note: Use studies with multiple priors.
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "", showSelector: "");
                ExecutedSteps++;

                //Step 40 Enter Accession number and launch URL
                ehr.SetSearchKeys_Study(AccessionID[1]);
                var url_40 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_40);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step40_1 = ehr.ErrorMsg();
                if (Step40_1.Trim().Equals(MorePatientsErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 41 Add Study UID of study with Accession number and launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("");
                ehr.SetSearchKeys_Study(LastNames[2], "Last_Name");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                var url_41 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_41);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step41_1 = ehr.ErrorMsg();
                if (Step41_1.Trim().Equals(OtherSearchCriteriaErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 42 Change in Web.config under WebAccess\WebAccess, set <add key="Integrator.OnMultipleStudy" value="Show Selector" />
                //Leave the rest of conditions the same
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Selector", restart: true);
                ExecutedSteps++;

                //Step 43 Enter Accession number and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(AccessionID[1]);
                var url_43 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy43 = PatientsStudy.LaunchPatientsStudyPage(url_43);
                var studyinfo43 = patientstudy43.GetPateintList();
                if (studyinfo43["Accession"].All(a => a.Equals(AccessionID[1])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 44 Change in Web.config under WebAccess\WebAccess, set <add key="Integrator.OnMultipleStudy" value="Load Newest" />
                //Leave the rest of conditions the same
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Load Newest", restart: true);
                ExecutedSteps++;

                //Step 45 Enter Accession number and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(AccessionID[1]);
                var url_45 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_45);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                var step45 = result.steps[++ExecutedSteps];
                step45.SetPath(testid, ExecutedSteps);
                IList<IWebElement> Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step45, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport)))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 46 Leave all patient/study fields empty	
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("");
                var url_46 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_46);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step46_1 = ehr.ErrorMsg();
                if (Step46_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 47 	Change in Web.config under WebAccess\WebAccess, set <add key="Integrator.OnMultipleStudy" value="Load Oldest" />
                //Leave the rest of conditions the same
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Load Oldest", restart: true);
                ExecutedSteps++;

                //Step 48 Enter Accession number and launch URLs
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(AccessionID[0]);
                var url_48 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_48);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforViewports();
                BluRingViewer.WaitforThumbnails(120);
                BluRingViewer.WaitForPriorsToLoad();
                var step48 = result.steps[++ExecutedSteps];
                step45.SetPath(testid, ExecutedSteps);
                Exam_list = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step45, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport)))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 49 Leave all patient/study fields empty	
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("");
                var url_49 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_49);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step49_1 = ehr.ErrorMsg();
                if (Step49_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();


                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Error", restart: true);
            }
        }

        /// <summary>
		/// Series Scope is Image
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162386(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            String PatientID = null;

            try
            {
                String adminUserName = Config.adminUserName;
                PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";
                int changebrowser = 0;
                //Delete PR if present
                try
                {                    
                    String browserName = ((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower();
                    if ((((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower().Contains("explorer")))
                    {
                        BasePage.Driver.Quit();
                        Config.BrowserType = "chrome";
                        Logger.Instance.InfoLog("Swicthing Browser Type to chrome");
                        BasePage.Driver = null;
                        if (PatientID != null)
                        {
                            HPLogin hplogin = new HPLogin();
                            BasePage.Driver.Navigate().GoToUrl("https://" + Config.EA96 + "/webadmin");
                            HPHomePage hphome = (HPHomePage)hplogin.LoginHPen(Config.hpUserName, Config.hpPassword, EA_URL: "https://" + Config.EA96 + "/webadmin");
                            WorkFlow workflow = (WorkFlow)hphome.Navigate("Workflow");
                            workflow.NavigateToLink("Workflow", "Archive Search");
                            workflow.HPSearchStudy("PatientID", PatientID);
                            if (BasePage.Driver.FindElements(By.CssSelector("#tabrow>tbody tr")).Count > 0)
                                workflow.DeletePaticularModality("PR");
                            hplogin.LogoutHPen();
                            changebrowser++;
                        }
                    }
                }
                catch (Exception e)
                {
                    Logger.Instance.ErrorLog("PR delete exception -- " + e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                }

                //Revert back to the same driver type or logout
                if (changebrowser == 1)
                {
                    this.CloseBrowser();
                    Config.BrowserType = browserName;
                    Logger.Instance.InfoLog("Swicthing Back Browser to --" + browserName);
                    new HPLogin();
                }

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);


                //Precondition - setup BluRing as default viewer
                login = new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                UserPreferences userpref = new UserPreferences();
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.CloseUserPreferences();

                DomainManagement domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
                domainmanagement.SearchDomain("SuperAdminGroup");
                domainmanagement.SelectDomain("SuperAdminGroup");
                domainmanagement.ClickEditDomain();
                BasePage.Driver.SwitchTo().DefaultContent();
                BasePage.Driver.SwitchTo().Frame("UserHomeFrame");
                var ConfiguredTools = login.GetConfiguredToolsInToolBoxConfig();
                if (ConfiguredTools.Contains("Series Scope") && ConfiguredTools.Contains("Image Scope") && ConfiguredTools.Contains("Save Series") && ConfiguredTools.Contains("Save Annotated Images"))
                {
                    Logger.Instance.InfoLog("Series Scope, Image Scope, Save Series and Save Annotated Image are already configured in the ToolBox");
                    domainmanagement.ClickElement(domainmanagement.SaveButton());
                }
                else
                {
                    IWebElement group1 = BasePage.Driver.FindElement(By.CssSelector(BasePage.div_toolBoxConfiguration_Groups + ":nth-of-type(3)"));
                    var dictionary = new Dictionary<String, IWebElement>();
                    dictionary.Add("Series Scope", group1);
                    dictionary.Add("Image Scope", group1);
                    dictionary.Add("Save Series", group1);
                    dictionary.Add("Save Annotated Images", group1);
                    domainmanagement.AddToolsToToolbox(dictionary);
                    domainmanagement.ClickElement(domainmanagement.SaveButton());
                    Logger.Instance.InfoLog("Series Scope, Image Scope, Save Series and Save Annotated Image are configured in the ToolBox");
                }
                login.Logout();


                login.CreateNewSesion();

                //Step 1  Open the TestEHR application.	         
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ExecutedSteps++;

                //Step 2 Enter the Study Instance UID that matches one study that is in one of the data source domains. Ensure that Show Report is enabled, Show selector is not enabled, 
                // UserID = (Administrator)or existing ICA user in the domain used for testing
                // Enable User Sharing = True
                // Click on"Cmd Line"and then click on"Load"
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local, usersharing: "True");
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(showSelector: "", showReport: "True");
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID");
                ehr.SetSearchKeys_Study(login.GetHostName(Config.EA96), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var viewport = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step2, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 3 Change the layout so multiple images are visible and apply each of the review tools from the tool bar at top 
                //(e.g. Scope, Series viewer, layout, W/L, Zoom, Pan, orientation, image text and Measurement etc...)
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                var viewport3 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                if (viewer.CompareImage(step3, viewport3))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 Change Series Scope to Series. Select one of the images. 
                IWebElement element1 = (BasePage.Driver).FindElement(By.CssSelector(viewer.Activeviewport));                
                viewer.SelectInnerViewerTool(BluRingTools.Series_Scope, BluRingTools.Pan);
                Thread.Sleep(3000);
                TestCompleteAction action = new TestCompleteAction();
                action.MouseScroll(element1, "down", "1").Perform();
                Thread.Sleep(3000);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step4 = studies.CompareImage(result.steps[ExecutedSteps], viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport));
                if (step4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5 Click on Reset button.
                viewer.SelectViewerTool(BluRingTools.Reset);
                action = new TestCompleteAction();
                action.MouseScroll(element1, "up", "1").Perform();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step5 = studies.CompareImage(result.steps[ExecutedSteps], viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport));
                if (step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6 Apply review tools including measurements to multiple images.
                viewer.SelectViewerTool(BluRingTools.Line_Measurement);
                element1 = (BasePage.Driver).FindElement(By.CssSelector(viewer.Activeviewport));
                int width = element1.Size.Width;
                int height = element1.Size.Height;
                viewer.ApplyTool_LineMeasurement(width / 10 - 5, height / 4 - 5, width / 3, height / 3);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step6 = studies.CompareImage(result.steps[ExecutedSteps], viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_viewport));
                if (step6)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7 Change Series scope to image level. Select one of the images and click on Reset button.              
                viewer.SelectInnerViewerTool(BluRingTools.Image_Scope, BluRingTools.Pan);
                Thread.Sleep(4000);
                action = new TestCompleteAction();
                action.MouseScroll(element1, "down", "1").Perform();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step7 = studies.CompareImage(result.steps[ExecutedSteps], viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport));
                if (step7)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8 Change Series scope to series. With the same image is still selected, click on Reset button.
                viewer.SelectViewerTool(BluRingTools.Line_Measurement);//To select Imagescope from Pan as outer tool
                Thread.Sleep(3000);
                viewer.SelectInnerViewerTool(BluRingTools.Series_Scope, BluRingTools.Pan);
                Thread.Sleep(3000);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step8 = studies.CompareImage(result.steps[ExecutedSteps], viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport));
                if (step8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9 Click on Save Annotated Images.
                Thread.Sleep(3000);
                viewer.SelectViewerTool(BluRingTools.Reset);
                int thumbnailsCountBeforeSaveAnnotation = viewer.ThumbnailIndicator(0).Count;
                viewer.SavePresentationState(BluRingTools.Save_Annotated_Image, BluRingTools.Pan);
                Thread.Sleep(1000);
                IList<IWebElement> thumbnailsAfterSaveAnnotation = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studyPanelThumbnailImages));
                bool step9_1 = thumbnailsAfterSaveAnnotation.Count == thumbnailsCountBeforeSaveAnnotation + 1;
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step9_2 = studies.CompareImage(result.steps[ExecutedSteps], viewer.ThumbnailandViewPortContainer());
                if (step9_1 && step9_2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10 Click on Save Series.
                Thread.Sleep(3000);
                viewer.SelectViewerTool(BluRingTools.Reset);
                int thumbnailsCountBeforeSaveSeries = viewer.ThumbnailIndicator(0).Count;
                viewer.SavePresentationState(BluRingTools.Save_Series, BluRingTools.Pan);
                Thread.Sleep(1000);
                thumbnailsAfterSaveAnnotation = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studyPanelThumbnailImages));
                bool step10_1 = thumbnailsAfterSaveAnnotation.Count == thumbnailsCountBeforeSaveSeries + 1;
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                bool step10_2 = viewer.CompareImage(result.steps[ExecutedSteps], viewer.ThumbnailandViewPortContainer());
                if (step10_1 && step10_2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                int changebrowser = 0;
                try
                {
                    String browserName = ((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower();
                    if ((((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower().Contains("explorer")))
                    {
                        BasePage.Driver.Quit();
                        Config.BrowserType = "chrome";
                        Logger.Instance.InfoLog("Swicthing Browser Type to chrome");
                        BasePage.Driver = null;
                        hplogin = new HPLogin();
                        if (PatientID != null)
                        {
                            HPLogin hplogin = new HPLogin();
                            BasePage.Driver.Navigate().GoToUrl("https://" + Config.EA96 + "/webadmin");
                            HPHomePage hphome = (HPHomePage)hplogin.LoginHPen(Config.hpUserName, Config.hpPassword, EA_URL: "https://" + Config.EA96 + "/webadmin");
                            WorkFlow workflow = (WorkFlow)hphome.Navigate("Workflow");
                            workflow.NavigateToLink("Workflow", "Archive Search");
                            workflow.HPSearchStudy("PatientID", PatientID);
                            if (BasePage.Driver.FindElements(By.CssSelector("#tabrow>tbody tr")).Count > 0)
                                workflow.DeletePaticularModality("PR");
                            hplogin.LogoutHPen();
                            changebrowser++;
                        }
                    }
                }
                catch (Exception e)
                {
                    Logger.Instance.ErrorLog("PR delete exception -- " + e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                }

                //Revert back to the same driver type or logout
                if (changebrowser == 1)
                {
                    this.CloseBrowser();
                    Config.BrowserType = browserName;
                    Logger.Instance.InfoLog("Swicthing Back Browser to --" + browserName);
                    new HPLogin();
                }
            }
        }

        /// <summary>
		/// Ldap - Integration Sharing
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_163419(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            DomainManagement domainmgmt = null;
            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");

                String securityID_Local = Config.LdapAdminUserName + "-" + Config.LdapAdminPassword;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always enabled",restart: true);

                servicetool.LaunchServiceTool();
                servicetool.NavigateToConfigToolUserMgmtDatabaseTab();
                servicetool.SetMode(2, "ldap");
                servicetool.LDAPSetup(LDApServerHost: "10.4.38.27");
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                //Step-1 Login to iCA as Administrator in the standalone mode,
                //Go to the dmain management tab and set the default Settings per modality for CR layout to 2x2.
                login =new Login();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(Config.adminGroupName);
                domainmgmt.SelectDomain(Config.adminGroupName);
                domainmgmt.ClickEditDomain();
                //domainmgmt.ModifyStudySearchFields();
                domainmgmt.ModalityDropDown().SelectByText("CR");
                domainmgmt.LayoutDropDown().SelectByText("2x2");                    
                domainmgmt.ClickSaveDomain();
                ExecutedSteps++;

                //Step-2 : Logout from ica.
                login.Logout();
                ExecutedSteps++;


                //Step 3 User is already in the DB with the SuperAdminGroup Domain.
                //Start the TestEHR program and enter
                //Address = http://localhost/WebAccess 
                //AutoEndSession = true
                //Selector Centricity = Study
                //Domain = blank
                //Role = blank
                //User = Administrator
                //Accession Number = 782101
                //click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: Config.LdapAdminUserName,SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption:"Study");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accession);
                //ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_3 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                var panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, panel) && (Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 4))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4:In the TestEHR program and enter 
                //Address = http://localhost/WebAccess 
                //AutoEndSession = true
                //Selector Centricity = Study
                //Domain = Domain1
                //Role = blank
                //User = Administrator
                //Accession Number = 782101
                //click on the Cmd line and select load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: Config.LdapAdminUserName, domain: Config.adminGroupName);
                ehr.SetSelectorOptions(selectoroption: "Study");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accession);
                //ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step4, panel) && (Driver.FindElements(By.CssSelector(BluRingViewer.div_allViewportes)).Count() == 4))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);
                
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            finally
            {
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                domainmgmt = (DomainManagement)login.Navigate("DomainManagement");
                domainmgmt.SearchDomain(Config.adminGroupName);
                domainmgmt.SelectDomain(Config.adminGroupName);
                domainmgmt.ClickEditDomain();
                //domainmgmt.ModifyStudySearchFields();
                domainmgmt.ModalityDropDown().SelectByText("CR");
                domainmgmt.LayoutDropDown().SelectByText("auto");
                domainmgmt.ClickSaveDomain();
                login.Logout();
            }
        }

        /// <summary>
        /// Test 162397 - 7.0 Authentication7.1.0 ByPass
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162397(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled               
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1            
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True");
                wpfobject.WaitTillLoad();
                ehr.GUID().Click();
                var guid = wpfobject.GetAnyUIItem<ITabPage, TextBox>
                    (servicetool.GetCurrentTabItem(), "m_securityIdTextBox").Text;
                if (!String.IsNullOrWhiteSpace(guid) && !String.IsNullOrEmpty(guid))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 2 
                ehr.SetShowSelector(true);
                ehr.SetSearchKeys_Study(Patient, "Patient_ID");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                var pstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = pstudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Equals(Patient))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                pstudy.SelectPatinet("Accession", Accession);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                var isImageCompare = viewer.CompareImage(step3, BasePage.FindElementByCss(viewer.Activeviewport));
                if (isImageCompare)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 Accession                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True");
                ehr.SetShowSelector(false);
                wpfobject.WaitTillLoad();
                ehr.GUID().Click();
                ehr.SetSearchKeys_Study(Accession, datasources: login.GetHostName(Config.EA1));
                var url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var viewport4 = viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport);
                if (viewer.CompareImage(step4, viewport4))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Report Result               
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }

        }

        /// <summary>
        /// Test 162399 - Priors Box = True in TESTEHR
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162399(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                var arraccession = Accession.Split(':');
                String Patient = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled               
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1            
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSelectorOptions(SearchPriors: "True");
                ExecutedSteps++;

                //Step 2
                ehr.SetSearchKeys_Study(StudyUID, "Study_UID", datasources: login.GetHostName(Config.EA1));
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                var isImageComapre2 = viewer.CompareImage(step2, BasePage.FindElementByCss(viewer.Activeviewport));
                var isPriorsPresent = viewer.CheckAccession_ExamList(arraccession);
                if (isImageComapre2 && isPriorsPresent)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                login.CreateNewSesion();
                ExecutedSteps++;

                //Report Result               
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();


                //Return Result
                return result;
            }

        }       

        /// <summary>
        /// ShowSelector: On Multiple studies setting value as Show Selector/Load Newest/Load oldest 
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_163427(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] Accessions = Accession.Split(':');
                String StudyUID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUIDs = StudyUID.Split(':');

                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                Studies studies = login.Navigate<Studies>();
                studies.SelectAllDateAndData();
                studies.ClickSearchBtn();
                login.Logout();
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("shadowuser", value: "Always enabled");


                //Step-1 Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^ *add key = "Integrator.OnMultipleStudy"value = "Show Selector"/*^>^*
                //or modify it from Service Tool/Integrator tab/On Multiple Study: Show Selector
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*true*^<^*/AllowShowSelector *^>^ *
                //*^<^ *AllowShowSelectorSearch *^>^ *true *^<^ */ AllowShowSelectorSearch *^>^ *
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Selector");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step-2 In the TestEHR tool set:
                //Address = *^<^ *enter path of iCA server under testing*^>^ *
                //Show Selector = blank
                //Show Selector Search = true
                //Enter Accession number to search a patient with multiple priors
                //Leave the rest fields as default.
                //Click Cmd line
                //Click Load
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(Accessions[0]);
                //ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Accession"].All(a => a.Equals(Accessions[0])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 3 Replace a Accession number which is unique among these priors. Launch URL.				
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accessions[1]);
                //ehr.SetSearchKeys_Study(login.GetHostName(Config.EA1), "Datasource");
                var url_3 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_3);
                var panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4:Enter a few Accession numbers from different patients, where they have priors. Launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                var combinedaccession = Accessions[0] + "\\" + Accessions[1];
                ehr.SetSearchKeys_Study(combinedaccession);
                var url_4 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_4);
                studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Accession"].Any(a => a.Equals(Accessions[0])) && studyinfo["Accession"].Any(a => a.Equals(Accessions[1])))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5:Select 1 study from each patient found in the Study Selector, View
                patientstudy.SelectPatinet("Accession", Accessions[0]);
                patientstudy.SelectPatinet("Accession", Accessions[1]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);

                bool Errormsg = GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Trim().Contains(MultiplePatientErrorMsg);
                if (Errormsg)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 6 Verify that all the studies selected are listed in the exam list
                IList<IWebElement> AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                var viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);

                if (bluringviewer.CompareImage(step6, viewport) && bluringviewer.CheckAccession_ExamList(Accessions))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 7 Leave all patient/study fields empty. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("");
                var url_7 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_7);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step7_1 = ehr.ErrorMsg();
                if (Step7_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 8 Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUIDs[0], "Study_UID");
                String url_8 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_8);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step8 = result.steps[++ExecutedSteps];
                step8.SetPath(testid, ExecutedSteps);
                var Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step8, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 9 Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^ *add key = "Integrator.OnMultipleStudy"value = "Load Oldest"/*^>^*
                //or modify it from Service Tool/Integrator tab/On Multiple Study: Load Oldest
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*true*^<^*/AllowShowSelector *^>^ *
                //*^<^ *AllowShowSelectorSearch *^>^ *true *^<^ */ AllowShowSelectorSearch *^>^ *
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Load Oldest");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step 10 In the TestEHR tool, change the following settings only:
                //Show Selector = blank
                //Show Selector Search = false
                //Enter Accession number to search a patient with multiple priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "False");
                ehr.SetSearchKeys_Study(Accessions[0]);
                String url_10 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_10);
                var step10 = result.steps[++ExecutedSteps];
                step10.SetPath(testid, ExecutedSteps);
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step10, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 11 Replace a Accession number which is unique among these priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accessions[1]);
                String url_11 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_10);
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step11, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 12 Enter a few Accession numbers from different patient, where they have priors. Launch URL
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                combinedaccession = Accessions[0] + "\\" + Accessions[1];
                ehr.SetSearchKeys_Study(combinedaccession);
                var url_12 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_12);

                bool Errormsg12 = GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Trim().Contains(MultiplePatientErrorMsg);
                if (Errormsg12)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 13 Verify that all studies matching the searched Accession Numbers are listed in exam list.
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step12 = result.steps[++ExecutedSteps];
                step12.SetPath(testid, ExecutedSteps);

                if (bluringviewer.CompareImage(step12, viewport) && bluringviewer.CheckAccession_ExamList(Accessions))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 14 Leave all patient/study fields empty. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("");
                var url_14 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_14);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step14_1 = ehr.ErrorMsg();
                if (Step14_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 15 Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSelectorOptions(selectorsearch: "True");
                ehr.SetSearchKeys_Study(StudyUIDs[0], "Study_UID");
                String url_15 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_15);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step15 = result.steps[++ExecutedSteps];
                step15.SetPath(testid, ExecutedSteps);
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step15, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 16 Set as following values in configuration files:
                //1) In web.config under webaccess\webaccess\
                //*^<^ *add key = "Integrator.OnMultipleStudy"value = "Load Newest"/*^>^*
                //or modify it from Service Tool/Integrator tab/On Multiple Study: Load Newest
                //2) In WebaccessConfiguration.xml under webaccess\webaccess\Config\
                //*^<^*AllowShowSelector*^>^*true*^<^*/AllowShowSelector *^>^ *
                //*^<^ *AllowShowSelectorSearch *^>^ *true *^<^ */ AllowShowSelectorSearch *^>^ *
                //Restart IIS and Windows Services
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Load Newest");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True", restart: true);
                ExecutedSteps++;

                //Step 17 In the TestEHR tool, change the following settings only:
                //Show Selector = blank
                //Show Selector Search = blank
                //Enter Accession number to search a patient with multiple priors
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accessions[0]);
                String url_17 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_17);
                var step17 = result.steps[++ExecutedSteps];
                step17.SetPath(testid, ExecutedSteps);
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step17, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 18 Replace a Accession number which is unique among these priors. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(Accessions[1]);
                String url_18 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_18);
                var step18 = result.steps[++ExecutedSteps];
                step18.SetPath(testid, ExecutedSteps);
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step18, bluringviewer.ViewPortContainer()))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 19 Leave all patient/study fields empty. Launch URL.
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSearchKeys_Study("");
                var url_19 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_19);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                String Step19_1 = ehr.ErrorMsg();
                if (Step19_1.Trim().Equals(SearchFieldsEmptyErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();

                //Step 20 	Enter a Study UID from a patient with multiple priors. Launch URL.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, SecurityID: securityID_Local);
                wpfobject.WaitTillLoad();
                ehr.SetSearchKeys_Study(StudyUIDs[0], "Study_UID");
                String url_20 = ehr.clickCmdLine("ImageLoad");

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_20);
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step20 = result.steps[++ExecutedSteps];
                step20.SetPath(testid, ExecutedSteps);
                Exam_list = Driver.FindElements(By.CssSelector(BluRingViewer.div_ExamList));
                if (bluringviewer != null && Exam_list[0].Displayed && bluringviewer.CompareImage(step20, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step 21 Enter a few Study UIDs from different patient, where they have priors. Launch URL, e.g., 1.2.840.113745.101000.2032000.37774.4616.1920910\2.16.124.113531.1.1.10100370031309.20140909.145328.97220
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                var combinedStudyUID = StudyUIDs[0] + "\\" + StudyUIDs[1];
                ehr.SetSearchKeys_Study(combinedStudyUID, "Study_UID");
                var url_21 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_21);

                bool Errormsg21 = GetElement(SelectorType.CssSelector, BluRingViewer.MultiplePatientErrorContent).Text.Trim().Contains(MultiplePatientErrorMsg);
                if (Errormsg21)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 22  Verify that all studies matching the searched Study UID are listed in exam list.
                AccessionExamList = Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
                viewport = bluringviewer.GetElement(SelectorType.CssSelector, bluringviewer.Activeviewport);
                var step22 = result.steps[++ExecutedSteps];
                step22.SetPath(testid, ExecutedSteps);

                if (bluringviewer.CompareImage(step22, viewport) && bluringviewer.CheckAccession_ExamList(Accessions))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
        }

        /// <summary>
		///  90029 Generating URL using two encryption services 
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162405(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables  
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool servicetool = new ServiceTool();
            IntegratorStudies studies = new IntegratorStudies();
            TestCaseResult result = null;
            int ExecutedSteps = -1;
            string Encryption_AES_Key = "AES_" + new Random().Next(1000);
            string Encryption_TripleDes_Key = "TripleDES_" + new Random().Next(1000);
            string Encryption_HALO_Key = "HALO_" + new Random().Next(1000);
            try
            {
                //Setup Test Step Description
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);

                string Encryption_Provider_AES_id = "ID_AES_" + new Random().Next(1000);
                string Encryption_Provider_TripleDES_id = "ID_TripleDES_" + new Random().Next(1000);
                string Encryption_Provider_HALO_id = "ID_HALO_" + new Random().Next(1000);

                string ArgmentName = "encrpyt";

                TextBox ID;
                TextBox ArugumentName;
                ComboBox EhrEncryptionProvider;


                string adminUserName = Config.adminUserName;
                string adminPassword = Config.adminPassword;
                string DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                string DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                string DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                string DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                string DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                string DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);
                string URL = "http://localhost/webaccess";

                String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
                String[] StudyUID = StudyUIDs.Split(':');

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');

                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNames.Split(':');

                String FirstNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String[] FirstName = FirstNames.Split(':');

                String Patient_DOBs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
                String[] Patient_DOB = Patient_DOBs.Split(':');

                String Genders = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
                String[] Gender = Genders.Split(':');

                // Precondition:
                // Create three keys 
                servicetool.InvokeServiceTool();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Key Generator");

                String[] AESGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_AES_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] TripleDESGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_TripleDes_Key, keysize: "192 bit (Key for TripleDES, AES)");
                String[] HALOGeneratedKey = servicetool.GenerateEncryptionKeys(Encryption_HALO_Key, keysize: "192 bit (Key for TripleDES, AES)");

                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_TripleDes_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.TripleDES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", TripleDESGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_AES_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("key", "string", AESGeneratedKey[0]);
                servicetool.EnterServiceParameters("iv", "string", "");
                servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
                servicetool.EnterServiceParameters("operationMode", "string", "CBC");
                servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                servicetool.SetEncryptionEncryptionService();
                servicetool.WaitWhileBusy();
                servicetool.EnterServiceEntry(Key: Encryption_HALO_Key, Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.HaloCryptographyWrapper");
                wpfobject.GetButton("Apply", 1).Click();
                servicetool.EnterServiceParameters("password", "string", "amicas");
                wpfobject.GetMainWindowByTitle("Service Entry Form");
                wpfobject.GetButton("OK", 1).Click();

                wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();


                // Create a Provide list for 
                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_AES_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = ArgmentName;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_AES_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_TripleDES_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = ArgmentName;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_TripleDes_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
                ID.BulkText = Encryption_Provider_HALO_id;
                wpfobject.WaitTillLoad();
                ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
                ArugumentName.BulkText = ArgmentName;
                wpfobject.WaitTillLoad();
                wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_HALO_Key);
                wpfobject.ClickButton("Add", 1);
                wpfobject.WaitTillLoad();

                ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_TripleDES_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try { wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1); } catch (Exception e) { }

                //wpfobject.SelectTabFromTabItems("External Application");
                //wpfobject.ClickButton("Add", 1);
                //servicetool.EnterExternalApplicationSettingsParameters("HALO", "Halo Application", "amicaspacs HALOPACS", "80", false, "servlet/com.amicas.servlet.integration.EmbeddedGateway", "Browser", "unixTicks,milliseconds,0", false);
                //servicetool.EnterExternalApplicationEncryptionParameters("auth", "Cryptographic.HALO.RC4");
                //servicetool.EnterExternalApplicationUrlParameterEntryForm("TS", "Dynamic", "Application.TimeStamp", true);
                //servicetool.EnterExternalApplicationUrlParameterEntryForm("ID", "Dynamic", "Patient.PatientID", true);
                //servicetool.EnterExternalApplicationUrlParameterEntryForm("SID", "Dynamic", "Study.UID", true);

                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();

                // Step 1:
                // Launch TestEHR application->Image Load tab-> Enter all the required information->Select "Use Encryption" checkbox.
                // Select Triple DES encryption from the list
                // Note: Triple DES encryption is made as default in Integrator tab from iCA Service tool

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_TripleDES_id);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                ExecutedSteps++;

                // Step 2:
                // Generate an URL and launch it in browser	
                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                var panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step2, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 3:
                // Select HALO encryption service from the list and generate URL -> Launch it in browser	

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_HALO_id);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step3 = result.steps[++ExecutedSteps];
                step3.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step3, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 4
                // Select Default encryption checkbox from TestEHR -> Generate and launch URL
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                wpfobject.SelectCheckBox("Default");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step4, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5
                // Make HALO encryption service as default from Integrator tab under iCA Service tool -> Restart services
                servicetool.InvokeServiceTool();
                wpfobject.WaitTillLoad();
                servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
                wpfobject.WaitTillLoad();
                servicetool.NavigateSubTab("Integrator Url");
                wpfobject.WaitTillLoad();
                servicetool.ClickModifyFromTab();
                wpfobject.WaitTillLoad();
                wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
                wpfobject.WaitTillLoad();
                DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
                DefaultEncryptionProvider.Enter(Encryption_Provider_HALO_id);
                wpfobject.WaitTillLoad();
                servicetool.ClickApplyButtonFromTab();
                wpfobject.WaitTillLoad();
                try { wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1); } catch (Exception e) { }
                wpfobject.WaitTillLoad();
                servicetool.RestartIISandWindowsServices();
                wpfobject.WaitTillLoad();
                servicetool.CloseServiceTool();
                ExecutedSteps++;

                // Step 6
                // Select HALO encryption from encryption provider list in TestEHR -> Generate and launch URL	

                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_HALO_id);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();


                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step6 = result.steps[++ExecutedSteps];
                step6.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step6, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 7
                // Select Triple DES encryption from the list -> Generate and launch URL	
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                EhrEncryptionProvider = wpfobject.GetAnyUIItem<ITabPage, ComboBox>(ehr.GetCurrentTabItem(), "encryptionProviderCmb", 0);
                EhrEncryptionProvider.Enter(Encryption_Provider_TripleDES_id);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step7, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 8:
                // Select Default encryption checkbox from TestEHR -> Generate and launch URL	
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
                ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
                ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
                ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
                ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
                ehr.SetSearchKeys_Study(Gender[0], "Gender");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                wpfobject.SelectCheckBox("encryptEnabledCheckBox");
                wpfobject.SelectCheckBox("Default");
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
                panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step8 = result.steps[++ExecutedSteps];
                step8.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step8, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Report Result
                result.FinalResult(ExecutedSteps);

                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Logout
                login.Logout();

                //Return Result
                return result;
            }
            finally
            {
                ehr.CloseEHR();
                servicetool.CloseServiceTool();
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_TripleDes_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_TripleDes_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_HALO_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_HALO_Key + "']");
                }
                if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AES_Key + "']"))
                {
                    basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_AES_Key + "']");
                }
                if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
                {
                    basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
                }
                basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
                servicetool.RestartIISUsingexe();
            }
        }

        ///<summary>
        /// Changing 1up mode on secondary viewer
        ///</summary>
        public TestCaseResult Test_162410(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            string Lastname = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
            string Firstname = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);


            try
            {
                //Step-1 Configure TestEHR.
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-2 Launch TestEHR application. 
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.WaitTillLoad();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-3 Select Image Load tab, Show Report=True,Auto End Session=True,Show selector= True, Enable user Sharing = True
                //Enter Patient Name that matches multiple patients with multiple studies in one data source domain. Click on the Cmd line and select load.	
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "True", autoendsession: "True");
                ehr.SetSelectorOptions(showReport: "True", showSelector: "True");
                ehr.SetSearchKeys_Study(Lastname, "Last_Name");
                ehr.SetSearchKeys_Study(Firstname, "First_Name");
                var url_1 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                PatientsStudy patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_1);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Last Name"][0].Contains(Lastname))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 In the patient result list put a check mark beside all the patients and click on View button.
                IList<IWebElement> checkbox = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.id_List));
                foreach (IWebElement element in checkbox)
                {
                    element.Click();
                }
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step4 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step4)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5 From the Exam list load the other studies in secondary and third panel.
                bluringviewer.OpenPriors(3);
                var studyPanelCount = bluringviewer.GetStudyPanelCount();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step5 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (studyPanelCount == 2 && step5)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6 From the secondary viewer, select one viewport and double click on it.
                Actions act = new Actions(BasePage.Driver);
                if ((((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower().Contains("internet explorer")))
                { 
                    IWebElement doublec1 = bluringviewer.ClickOnViewPort(2, 2);
                    Thread.Sleep(2000);
                    act.DoubleClick(doublec1).Build().Perform();
                }
                else
                {
                    act.DoubleClick(bluringviewer.ClickOnViewPort(2, 2)).Build().Perform();
                }
                int viewportCount = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_Panel(2) + BluRingViewer.div_allViewportes)).Count;
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step6 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step6 && viewportCount == 1)
                {
                    
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7 Again double click on loaded viewport.
                Actions act1 = new Actions(BasePage.Driver);
                if ((((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower().Contains("internet explorer")))
                {
                    IWebElement double1 = bluringviewer.ClickOnViewPort(2, 2);
                    Thread.Sleep(2000);
                    act1.DoubleClick(double1).Build().Perform();
                }
                else
                {
                    act1.DoubleClick(bluringviewer.ClickOnViewPort(2, 2)).Build().Perform();
                }
                int viewportCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_Panel(2) + BluRingViewer.div_allViewportes)).Count;
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step7 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step7 && viewportCount1 != 1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8 Select Image Load tab, Show Report=True,Auto End Session=True,Show selector= True, Enable user Sharing = False
                //Enter Patient Name that matches multiple patients with multiple studies in one data source domain. Click on the Cmd line and select load.
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(usersharing: "False", autoendsession: "True");
                ehr.SetSelectorOptions(showReport: "True", showSelector: "True");
                ehr.SetSearchKeys_Study(Lastname, "Last_Name");
                ehr.SetSearchKeys_Study(Firstname, "First_Name");
                var url_2 = ehr.clickCmdLine("ImageLoad");
                login.CreateNewSesion();
                PatientsStudy patientstudy1 = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo1 = patientstudy.GetPateintList();
                if (studyinfo1["Last Name"][0].Contains(Lastname))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9 In the patient result list put a check mark beside all the patients and click on View button.
                IList<IWebElement> checkbox1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.id_List));
                foreach (IWebElement element in checkbox1)
                {
                    element.Click();
                }
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "integrator", showselector: true);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step9 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step9)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10 From the Exam list load the other studies in secondary and third panel.
                bluringviewer.OpenPriors(3);
                var studyPanelCount1 = bluringviewer.GetStudyPanelCount();
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step10 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (studyPanelCount1 == 2 && step10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-11 From the secondary viewer, select one viewport and double click on it.
                Actions act2 = new Actions(BasePage.Driver);
                if ((((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower().Contains("internet explorer")))
                {
                    IWebElement double2 = bluringviewer.ClickOnViewPort(2, 2);
                    Thread.Sleep(2000);
                    act2.DoubleClick(double2).Build().Perform();
                }
                else
                {
                    act2.DoubleClick(bluringviewer.ClickOnViewPort(2, 2)).Build().Perform();
                }
                int viewportCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_Panel(2) + BluRingViewer.div_allViewportes)).Count;
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step11 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step11 && viewportCount2 == 1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12 Again double click on loaded viewport.
                Actions act3 = new Actions(BasePage.Driver);
                if ((((RemoteWebDriver)BasePage.Driver).Capabilities.BrowserName.ToLower().Contains("internet explorer")))
                {
                    IWebElement double3 = bluringviewer.ClickOnViewPort(2, 2);
                    Thread.Sleep(2000);
                    act3.DoubleClick(double3).Build().Perform();
                }
                else
                {
                    act3.DoubleClick(bluringviewer.ClickOnViewPort(2, 2)).Build().Perform();
                }
                int viewportCount3 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_Panel(2) + BluRingViewer.div_allViewportes)).Count;
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step12 = patientstudy.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());
                if (step12 && viewportCount3 != 1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                ehr.CloseEHR();
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch(Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Logout
                login.Logout();
                //Return Result
                return result;
            }
        }

        ///<summary>
        /// First requested study failed warning
        /// </summary>
        public TestCaseResult Test_162413(String testid, String teststeps, int stepcount)
        {                   
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            String AccessionList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
            String[] accession = AccessionList.Split('\\');
            String studyuidList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
            String Check_Msg = "the first requested study failed to load";
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);           
            try
            {
                //Step-1 Launch the Test EHR application.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.WaitTillLoad();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-2 Enter the Accession numbers in the Study search keys field in the below combination:
                //Invalid Accession number \ Valid Accession number \Valid Accession number.
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters();
                ehr.SetSearchKeys_Study(AccessionList);
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-3 Click on the CMD button.
                url = ehr.clickCmdLine("ImageLoad");
                if(url != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4 Copy the URL, Launch in the browser and verify.
                bluringviewer.NavigateToBluringIntegratorURL(url);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforViewports();
                BluRingViewer.WaitforThumbnails(360);
                BluRingViewer.WaitForPriorsToLoad();
                String step4 = BasePage.Driver.FindElement(By.CssSelector(BluRingViewer.warning_msg)).Text.ToLower();
                if (bluringviewer.VerifyPriorsHighlightedInExamList(AccessionNumber: accession[1]) && step4 != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5 Verify the warning message in the iCA viewer.
                bool step5 = BasePage.Driver.FindElement(By.CssSelector(BluRingViewer.warning_msg)).Text.ToLower().Contains(Check_Msg);
                if (step5)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6 Close the viewer.
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-7 Navigate back to Test EHR application and clear the Accession number field.
                ehr.SetSearchKeys_Study("");
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-8 Enter the Study UID in the Study search keys field in the below combination: 
                //Invalid Study UID \ Valid Study UID \Valid Study UID
                ehr.SetSearchKeys_Study(studyuidList, "Study_UID");
                result.steps[++ExecutedSteps].status = "Pass";

                //Step-9 Click on the CMD button.
                url = ehr.clickCmdLine("ImageLoad");
                if (url != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10 Copy the URL, Launch in the browser and verify the warning message at the bottom of the iCA viewer.
                CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url);
                bluringviewer = (BluRingViewer)login.NavigateToIntegratorFrame(viewer: "bluring");
                BluRingViewer.WaitforViewports();
                BluRingViewer.WaitforThumbnails(360);
                BluRingViewer.WaitForPriorsToLoad();
                bool step10_1 = BasePage.Driver.FindElement(By.CssSelector(BluRingViewer.warning_msg)).Text.ToLower().Contains(Check_Msg);
                result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
                var step10 = bluringviewer.CompareImage(result.steps[ExecutedSteps], bluringviewer.ViewPortContainer());               
                if(step10 && step10_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
               
                ehr.CloseEHR();
                CloseBrowser();
                //Report Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                //Return Result
                return result;
            }
            catch(Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);
                //Logout
                login.Logout();
                //Return Result
                return result;
            }
        }


		/// <summary>
		/// Loading prior studies from another datasource
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162411(String testid, String teststeps, int stepcount)
		{
			//Declare and initialize variables
			TestCaseResult result;
			result = new TestCaseResult(stepcount);
			int ExecutedSteps = -1;
			Studies studies = null;
			DomainManagement domainmanagement;
			StudyViewer viewer = null;
			IntegratorStudies intgtrStudies = null;
			//Set up Validation Steps
			result.SetTestStepDescription(teststeps);

			try
			{
				//Fetch required Test data            
				String Username = Config.adminUserName;
				String Password = Config.adminPassword;
				String PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
				String DataSourceList = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources");
				String AccessionNo = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
				String[] Acc = AccessionNo.Split(':');
				String[] DataSource = DataSourceList.Split('|');
				String[] Accessions = ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList").ToString().Split(':');

				//Pre-Condition to set all datasource in study search
				login.LoginIConnect(Username, Password);
				studies = (Studies)login.Navigate("Studies");
				studies.SearchStudy(Datasource: "All");
				PageLoadWait.WaitForPageLoad(20);
				login.Logout();

				//Step-1:Configure TestEHR then set few properties in domain Management and service tool
				servicetool.LaunchServiceTool();
				wpfobject.WaitTillLoad();
				servicetool.NavigateToTab("Integrator");
				wpfobject.WaitTillLoad();
				servicetool.EanbleUserSharing_ShadowUser(usersharing: "URL Determined");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				wpfobject.WaitTillLoad();
				servicetool.AllowShowSelector().Checked = true;
				wpfobject.SelectCheckBox("Patient ID", 1);
				wpfobject.SelectCheckBox("Patient Full Name", 0);
				servicetool.ApplyEnableFeatures();
				servicetool.WaitWhileBusy();
				servicetool.RestartIISandWindowsServices();
				servicetool.CloseServiceTool();
				login.UncommentXMLnode("id", "Bypass");

				//To check the Query Patien ID in domain management Page
				login.LoginIConnect(Username, Password);
				domainmanagement = (DomainManagement)login.Navigate("DomainManagement");
				domainmanagement.SearchDomain(Config.adminGroupName);
				domainmanagement.SelectDomain(Config.adminGroupName);
				domainmanagement.EditDomainButton().Click();
				BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame");
				domainmanagement.SetCheckBoxInEditDomain("patientid", 0);
				domainmanagement.SetCheckBoxInEditDomain("patientfullname", 1);
				domainmanagement.SetCheckBoxInEditDomain("patientdob", 1);
				domainmanagement.SetCheckBoxInEditDomain("patientlastname", 1);
				domainmanagement.SetCheckBoxInEditDomain("patientipid", 1);
				domainmanagement.ClickSaveEditDomain();
				login.Logout();
				result.steps[++ExecutedSteps].StepPass();

				//Step-2: Login as Administrator
				login.LoginIConnect(Username, Password);
				result.steps[++ExecutedSteps].StepPass();

				//Step-3: Navigate to the studies tab and load the prior study from the datasource1
				studies = (Studies)login.Navigate("Studies");
				studies.SearchStudy(patientID: PatientID, Datasource: DataSource[0]);
				var IntDS1Count = studies.CheckStudyListCount();
				studies.SelectStudy("Accession", Acc[0]);
				var bluviewer = BluRingViewer.LaunchBluRingViewer();
				if (IntDS1Count > 1 && bluviewer != null)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}


				//Step-4 :Verify that the all priors from datasource 1 and 2 are listed in the exam list  
				var IntDS2Count = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList)).Count;
				if (IntDS2Count > IntDS1Count)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}
				bluviewer.CloseBluRingViewer();
				login.Logout();

				//To load data from all datasources
				login.LoginIConnect(Username, Password);
				studies = (Studies)login.Navigate("Studies");
				studies.SearchStudy(Datasource: "All");
				PageLoadWait.WaitForPageLoad(20);
				login.Logout();

				//Step-5: Launch TestEHR
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				result.steps[++ExecutedSteps].StepPass();

				//Step-6: Select Image Load tab, Enter valid search criteria for the above mentioned study.
				//Click on CMD line and copy the generated the URL and launch it in a browser.
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(user: Username, domain: Config.adminGroupName, usersharing: "True", autoendsession: "True");
				ehr.SetSelectorOptions(showSelector: "True", SearchPriors: "True");
				ehr.SetSearchKeys_Study(PatientID, "Patient_ID");
				String url_6 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_6);
				var studyinfo = patientstudy.GetPateintList();
				if (studyinfo["Patient ID"].All(a => a.Equals(PatientID)))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				//Step-7: Load the study from datasource2 which has related studies in datasource1
				patientstudy.SelectPatinet("Accession", Acc[1]);
				bluviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
				var viewport = bluviewer.GetElement(BasePage.SelectorType.CssSelector, bluviewer.Activeviewport);
				var step7 = result.steps[++ExecutedSteps];
				step7.SetPath(testid, ExecutedSteps);
				if (bluviewer.CompareImage(step7, viewport))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				//Step-8: Verify that the all priors from datasource 1 and 2 are listed in the exam list				
				var accExamlist = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.AccessionNumberInExamList));
				var acclist = accExamlist.Select<IWebElement, String>(element =>
				{
					return bluviewer.GetAccession(element);
				}).ToArray<String>();
				int cnt = 0;
				if (Array.Exists(acclist, ac => ac.Equals(Accessions[cnt++])))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				//Step-9: Load the study from datasource1 which has related studies in datasource2
				bluviewer.OpenPriors(1);
				result.steps[++ExecutedSteps].SetPath(testid, ExecutedSteps);
				var step9 = bluviewer.CompareImage(result.steps[ExecutedSteps], BasePage.Driver.FindElement(By.CssSelector(BluRingViewer.div_compositeViewer)));
				if (step9)
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				//Report Result
				result.FinalResult(ExecutedSteps);
				Logger.Instance.InfoLog("Overall Test status--" + result.status);

				//Return Result
				return result;
			}
			catch (Exception e)
			{
				//Log exception
				Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

				//Report Result
				result.FinalResult(e, ExecutedSteps);
				Logger.Instance.InfoLog("Overall Test status--" + result.status);

				//Return Result
				return result;
			}
			finally
			{
				servicetool.CloseServiceTool();
				ehr.CloseEHR();
			}
		}

		/// <summary>
		/// Using Encrypted URL - AES URL Encryption
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162402(String testid, String teststeps, int stepcount)
		{
			//Declare and initialize variables
			StudyViewer studyviewer = new StudyViewer();
			ServiceTool servicetool = new ServiceTool();
			IntegratorStudies studies = new IntegratorStudies();
			TestCaseResult result = new TestCaseResult(stepcount);
			int ExecutedSteps = -1;

			//Set up Validation Steps
			result.SetTestStepDescription(teststeps);
			string Encryption_Service_List_AE256_Key = "AES256";
			string Encryption_Service_List_AES192_Key = "AES192";
			string Encryption_Service_List_AES128_Key = "AES128";
			string Encryption_Service_List_AES128_Key2 = "AES128_2";
			string Encryption_Service_List_AESCustom_Key = "AES_Custom";
			try
			{
				string adminUserName = Config.adminUserName;
				string adminPassword = Config.adminPassword;
				string DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
				string DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
				string DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
				string DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
				string DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
				string DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);

				string Encryption_Key1 = "Testkey1_" + new Random().Next(1000);
				string Encryption_Key2 = "Testkey2_" + new Random().Next(1000);
				string Encryption_Key3 = "Testkey3_" + new Random().Next(1000);
				string Encryption_Key4 = "Testkey4_" + new Random().Next(1000);
				string Encryption_Key5 = "Testkey5_" + new Random().Next(1000);
				string Encryption_Key6 = "Testkey6_" + new Random().Next(1000);
				string Encryption_Key7 = "Testkey7_" + new Random().Next(1000);
				string Encryption_Key8 = "Testkey8_" + new Random().Next(1000);

				string URL = "http://localhost/webaccess";

				string Encryption_Provider_256_id = "ID_" + new Random().Next(1000);
				string Encryption_Provider_192_id = "ID_192_" + new Random().Next(1000);
				string Encryption_Provider_128_2_id = "ID_128_2_" + new Random().Next(1000);
				string Encryption_Provider_128_id = "ID_128_" + new Random().Next(1000);
				string Encryption_Provider_Custom_id = "ID_Custom_" + new Random().Next(1000);
				string Encryption_Provider_Arg = "arg";

				String StudyUIDs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyUID");
				String[] StudyUID = StudyUIDs.Split(':');

				String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
				String[] AccessionId = AccessionIds.Split(':');

				String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
				String[] LastName = LastNames.Split(':');

				String FirstNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
				String[] FirstName = FirstNames.Split(':');

				String Patient_DOBs = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientDOB");
				String[] Patient_DOB = Patient_DOBs.Split(':');

				String Genders = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Gender");
				String[] Gender = Genders.Split(':');

				//  Pre - conditions:  
				// Step 1:
				// From Service Tool create an encryption service using AES:
				// 1.Click the Encryption tab Encryption Service sub-tab
				// 2.Click Add
				// 3.In the Key field, type a name for this encryption service, e.g.AES256
				// 4.In the Assembly field, type OpenContent.Generic.Core.dll
				// 5.In the Class field, type OpenContent.Core.Security.Services.AES
				// 6.To create the service parameters, click Add.
				basepage.UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");
				servicetool.InvokeServiceTool();
				servicetool.WaitWhileBusy();
				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				servicetool.WaitWhileBusy();
				servicetool.SetEncryptionEncryptionService();
				servicetool.WaitWhileBusy();
				servicetool.EnterServiceEntry(Key: "AES256", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
				wpfobject.GetButton("Apply", 1).Click();
				ExecutedSteps++;

				// Step 2
				// Continue from above step
				//    1.Update the fields as described below:
				// Name: key, Class: string, Value: leave it blank for now, Click Apply
				// Name: iv, Class: string, Value: blank, Click Apply.
				// Name: characterSet, Class: string, Value: Windows - 1252, Click Apply
				// Name: operationMode, Class: string, Value: CBC, Click Apply
				// Name: paddingMode, Class: string, Value: Zeros, Click Apply
				// 2.When your updates are complete, click OK in Service Parameter Entry form.
				// 3.Click Apply then Ok.
				// 4.Click Restart IIS and Windows Services to apply the changes you have made.
				servicetool.EnterServiceParameters("key", "string", "");
				servicetool.EnterServiceParameters("iv", "string", "");
				servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
				servicetool.EnterServiceParameters("operationMode", "string", "CBC");
				servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
				wpfobject.GetMainWindowByTitle("Service Entry Form");
				wpfobject.GetButton("OK", 1).Click();
				wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
				wpfobject.WaitTillLoad();
				servicetool.RestartIISandWindowsServices();
				ExecutedSteps++;

				// Step 3
				// Pre-condition3:
				// 1.Click the Key Generator sub-tab.
				// 2.In the Plain Text Key field, type a text string.This string is used to generate the Base64 encryption key.
				// 3.Select key size '256 bit (Key for AES)'
				// 4.Click Generate Key.
				// 5.Copy the data in the Base64 field and enter it in the 'Key' service parameter 'Value' field that was left blank in Pre - condition2
				servicetool.NavigateSubTab("Key Generator");
				String[] testkey1 = servicetool.GenerateEncryptionKeys(Encryption_Key1, keysize: "256 bit (Key for AES");
				servicetool.EditServiceParameters("Key", "AES256", "Name", "key", Value: testkey1[0]);
				wpfobject.GetMainWindowByTitle("Service Entry Form");
				wpfobject.GetButton("OK", 1).Click();
				wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
				wpfobject.WaitTillLoad();
				ExecutedSteps++;

				// Step 4
				// 	In the Key Generator sub-tab enter a different passphrase for key, e.g. testkey2
				// Select a key size '256 bit (key for AES)' dropdown list Click Generate key
				// Verify keys are generated with different values
				String[] testkey2 = servicetool.GenerateEncryptionKeys(Encryption_Key2, keysize: "256 bit (Key for AES");
				if (!testkey1[0].Equals(testkey2[0]))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}


				// Step 5
				//	In the Key Generator sub-tab select a key size '192 bit (Key for TripleDES, AES)' from the list
				// Click Generate key. Verify keys are generated with different values
				String[] testkey3 = servicetool.GenerateEncryptionKeys(Encryption_Key3, keysize: "192 bit (Key for TripleDES, AES)");
				if (!testkey1[0].Equals(testkey3[0]))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step6
				// In Select Key size list select 'Choose custom size it bit'
				//Enter some valid key size(multiple of 8); Note that ICA current only support keysize values 128, 192 and 256 bit for AES.
				//Verify that keys are generated successfully.
				String[] testkey4 = servicetool.GenerateEncryptionKeys(Encryption_Key4, keysize: "Choose custom size in bit", keytext: "192");
				ExecutedSteps++;

				// Step 7
				// Repeat above step for the rest key sizes available in the list
				// Verify keys are generated with different values
				String[] testkey5 = servicetool.GenerateEncryptionKeys(Encryption_Key5, keysize: "128 bit (key for TripleDES, AES | IV for AES)");
				String[] testkey6 = servicetool.GenerateEncryptionKeys(Encryption_Key6, keysize: "64 bit (IV for TripleDES)");
				String[] testkey7 = servicetool.GenerateEncryptionKeys(Encryption_Key7, keysize: "192 bit (Key for TripleDES, SHA1) - Legacy");
				String[] testkey8 = servicetool.GenerateEncryptionKeys(Encryption_Key8, keysize: "128 bit (key for TripleDES, AES | IV for AES)");
				ExecutedSteps++;

				// Step 8
				// Pre - condition4:
				// Configuring the Application to Use an Encryption Service
				// 1.Click the Encryption tab, then click the Integrator URL sub-tab.
				// 2.Click Modify
				// 3.In the ID field, type a unique identifier for the encryption provider
				// 4.Enter Argument Name = arg
				// 5.In the Encryption Service drop - down list, select the encryption service you created
				servicetool.NavigateToTab("Encryption");
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				//wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
				TextBox ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
				ID.BulkText = Encryption_Provider_256_id;
				wpfobject.WaitTillLoad();
				TextBox ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
				ArugumentName.BulkText = Encryption_Provider_Arg;
				wpfobject.WaitTillLoad();
				wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AE256_Key);
				wpfobject.ClickButton("Add", 1);
				wpfobject.ClickButton("Apply", 1);
				wpfobject.WaitForPopUp();
				try
				{
					wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
					wpfobject.WaitForPopUp();
				}
				catch (Exception e)
				{ }
				ExecutedSteps++;

				// Step 9
				// 	Pre-condition:
				// On the iCA sever modify web.config file under C:\WebAccess\WebAccess\IntegratorAuthenticationSTS\ by uncommenting section:
				// *^<^ *!--authProvider id = "Bypass"class="Sample.HostIntegration.Authentication.BypassAuthenticator"assembly="Sample.HostIntegration"*^>^*
				// *^<^*/authProvider--*^>^* IISRESET At least one datasources must be available for testing.

				basepage.UncommentXMLnode("authProvider id", "Bypass", @"C:\WebAccess\IntegratorAuthenticationSTS\web.config");
				servicetool.RestartService();
				wpfobject.WaitTillLoad();
				servicetool.CloseServiceTool();
				ExecutedSteps++;

				// Step 10
				// URL Encryption is disabled in Service Tool]
				// 1.Ensure option ' URL Encryption Enabled' is not selected in Service Tool\Encryption tab\Integration Url sub - tab.
				// 2.From test server, start TestEHR tool (TestEHR.exe)Image Load tab, set Show Selector to False
				// 3.Enter Patient Last Name, First Name, DOB and Gender of a patient study existing in the configured data source.
				// 4.uncheck Use Encryption(Time Stamp)
				// 5.Cmd line, Load
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
				ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
				ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
				ehr.SetSearchKeys_Study(Gender[0], "Gender");
				ehr.SetSearchKeys_Study(AccessionId[1]);
				String url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				var panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step10 = result.steps[++ExecutedSteps];
				step10.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step10, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 11
				// 	Exam the generated Url
				// expected result :  When encryption is not enabled, query parameters are visible in the generated URL query string,
				// e.g., entered patient name, DOB, gender and logins etc. are visible in the URL query string. For example: 
				// http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&
				// SecurityID =Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&patientID=11111
				// &patientFirstName=MRI&patientLastName=ANKLE&patientGender=M&patientDOB=20-Nov-1958 12

				bool IsPatientLastNameExist = url_2.Any(msg => url_2.Contains("patientLastName"));
				bool IsPatientFirstNameExist = url_2.Any(msg => url_2.Contains("patientFirstName"));
				bool IsPatientDOBExist = url_2.Any(msg => url_2.Contains("patientDOB"));
				bool IsPatientGenderExist = url_2.Any(msg => url_2.Contains("patientGender"));
				// if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist)
				if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist && IsPatientGenderExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 12
				// Close the browser, From TestEHR tool Image Load tab, clear patient search keys. 
				// Enter Accession number of a study that matches one study in configured data source. Click Cmd line and click Load
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(AccessionId[0], datasources: DatasourceVMSSA131);
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step12 = result.steps[++ExecutedSteps];
				step12.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step12, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 13
				// IsAccessionNumberExist
				// When encryption is not enabled, query parameters are visible in the generated URL query string, 
				// e.g., entered accession number and logins etc. are visible in the URL query string.
				// For example: http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&accessionNumber=123df45
				bool IsAccessionNumberExist = url_2.Any(msg => url_2.Contains("accessionNumber=" + AccessionId[0]));
				if (IsAccessionNumberExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 14
				// Repeat above step by entering a StudyUID that matches one study in configured data source.Click Cmd line and click Load.
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step14 = result.steps[++ExecutedSteps];
				step14.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step14, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 15
				// Exam the generated Url	
				// When encryption is not enabled, query parameters are visible in the generated URL query string, 
				// e.g., entered StudyUID and logins etc. are visible in the URL query string. 
				// For example: http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=iCADatabase&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&studyUID=1.2.124.113532.1.1.3.0.8.92.20020423164900.390.137

				bool IsStudyUIDExist = url_2.Any(msg => url_2.Contains("studyUID=" + StudyUID[0]));
				if (IsStudyUIDExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 16
				// 	Close the browser. From TestEHR tool Image Load tab, check on 'Use Encryption(TimeStamp) box, click Cmd line and click Load.
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				ehr.clickCmdLine("ImageLoad");
				wpfobject.WaitForPopUp();
				String data = servicetool.WarningDialogWindow();
				if (data.Equals("An encryption provider must be selected if encryption is enabled"))
				{

					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}


				// Step 17
				// [URL Encryption is enabled with Keysize=256 bit (Key for AES)]
				// 1.Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize '256 bit (key for AES)'
				// 2.Ensure option 'URL Encryption Enabled' is SELECTED in Service Tool\Encryption tab\Integration Url sub - tab.
				// 2.From test server, start TestEHR tool (TestEHR.exe)Image Load tab, set Show Selector to False
				// 3.Enter Patient Last Name, First Name, DOB and Gender of a patient study existing in the configured data source.
				// 4.Select the Encryption Provider generated from keysize '256 bit (Key for AES)'
				// 5.Select Use Encryption(Time Stamp) option 6.Cmd line, Load
				servicetool.InvokeServiceTool();
				servicetool.WaitWhileBusy();
				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				wpfobject.WaitTillLoad();
				wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
				wpfobject.WaitTillLoad();
				ComboBox DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
				DefaultEncryptionProvider.Enter(Encryption_Provider_256_id);
				wpfobject.WaitTillLoad();
				servicetool.ClickApplyButtonFromTab();
				wpfobject.WaitTillLoad();
				try
				{
					wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
					wpfobject.WaitTillLoad();

				}
				catch (Exception e)
				{

				}
				servicetool.RestartService();
				wpfobject.WaitTillLoad();
				servicetool.CloseServiceTool();

				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
				ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
				ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
				ehr.SetSearchKeys_Study(Gender[0], "Gender");
				ehr.SetSearchKeys_Study(AccessionId[1]);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step17 = result.steps[++ExecutedSteps];
				step17.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step17, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				//Step 18
				// Exam the generated Url	
				// When encryption is enabled, query parameters are NOT visible in the generated URL query string, e.g., entered patient name, DOB, gender and logins etc. 
				// are NOT visible in the URL query string.For example:
				// http:/localhost/WebAccess/Default.ashx?encryptionProvider=AES1&arg1=E9FHC9b0yKMuFhpNK3lvROwMXjSStFUZfMrxzJwB9DYEElWg%2fmqqWLPVOVzN96gmXlHp19RzE5FBaXoUm3GnPcaSvoChZ2eH%2fj8DHLorXxNInjLEbE%2fbXOF4uQW5gcDvMwQnH1Fhun0xIIsnnEcDzYN%2frJFrgCOizj39q4LOLPYhp43lU%2bXWJ56WwXTCwbxCHq8%2bfxTOfJ3BABWz7lx%2femtFaPePcog2ubJ%2bBlpABwqh8phK3Bx1T6lJLV20b9oT7Eau5xB8cSBj3O1v%2fgDyCV7xABx%2bk1vOfnUuFqPsErx6VuuGnEm55U3mfqRvtwobhiBaeLdvefriQmXOg16vYa4bUcXpfTYZBCrhhhB3zhfSTV2iq%2fnhiPRQ5akj6BNutqr7SyHwSLbI0SnUF8sTanFOzrB6j5ete1uViJDO%2br4%3d
				IsPatientLastNameExist = url_2.Any(msg => url_2.Contains("patientLastName"));
				IsPatientFirstNameExist = url_2.Any(msg => url_2.Contains("patientFirstName"));
				IsPatientDOBExist = url_2.Any(msg => url_2.Contains("patientDOB"));
				IsPatientGenderExist = url_2.Any(msg => url_2.Contains("patientGender"));
				// if (!IsPatientLastNameExist && !IsPatientFirstNameExist && !IsPatientDOBExist)
				if (!IsPatientLastNameExist && !IsPatientFirstNameExist && !IsPatientDOBExist && !IsPatientGenderExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 19
				// Close the browser. From TestEHR tool Image Load tab, uncheck 'Use Encryption(TimeStamp) box, click Cmd line and click Load.
				// The matching study can't be loaded into 2D view. Error Occurred in operation message displays indicating URL is not properly encrypted.
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(FirstName[0], "First_Name");
				ehr.SetSearchKeys_Study(LastName[0], "Last_Name");
				ehr.SetSearchKeys_Study(Patient_DOB[0], "Patient_DOB");
				ehr.SetSearchKeys_Study(Gender[0], "Gender");
				ehr.SetSearchKeys_Study(AccessionId[1]);
				wpfobject.UnSelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				// ehr.CloseEHR();
				// login.DriverGoTo(url_2);
				// servicetool.RestartIISUsingexe();
				login.CreateNewSesion();
				BasePage.Driver.Navigate().GoToUrl(url_2);
				String Errormsg = ehr.ErrorMsg();
				if (Errormsg.Contains("URL is not properly encrypted"))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}


				// Step 20
				// Exam the generated Url
				// The query string is not encrypted, e.g., query parameters are visible in the URL query string, From example:
				// http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&patientID=11111&patientFirstName=MRI&patientLastName=ANKLE&patientGender=M&patientDOB=20-Nov-1958
				IsPatientLastNameExist = url_2.Any(msg => url_2.Contains("patientLastName"));
				IsPatientFirstNameExist = url_2.Any(msg => url_2.Contains("patientFirstName"));
				IsPatientDOBExist = url_2.Any(msg => url_2.Contains("patientDOB"));
				IsPatientGenderExist = url_2.Any(msg => url_2.Contains("patientGender"));
				// if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist)
				if (IsPatientLastNameExist && IsPatientFirstNameExist && IsPatientDOBExist && IsPatientGenderExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 21
				// Close the browser, From TestEHR tool Image Load tab, clear search keys. Enter Accession number of a study that matches one study in 
				// configured data source. Select Use Encryption (Time Stamp) option. Click Cmd line and click Load.	 
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(AccessionId[0]);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step21 = result.steps[++ExecutedSteps];
				step21.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step21, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 22
				// Exam the generated Url	
				// When encryption is enabled, query parameters are NOT visible in the generated URL query string, e.g., entered accession number and logins etc. are NOT visible in the URL query string. For example: 
				// http:/localhost/WebAccess/Default.ashx?encryptionProvider=AES1&arg1=E9FHC9b0yKMuFhpNK3lvROwMXjSStFUZfMrxzJwB9DYEElWg%2fmqqWLPVOVzN96gmXlHp19RzE5FBaXoUm3GnPcaSvoChZ2eH%2fj8DHLorXxNInjLEbE%2fbXOF4uQW5gcDvMwQnH1Fhun0xIIsnnEcDzYN%2frJFrgCOizj39q4LOLPYhp43lU%2bXWJ56WwXTCwbxCHq8%2bfxTOfJ3BABWz7lx%2femtFaPePcog2ubJ%2bBlpABwpnzgVC3sHdwM1SML22yD0AAIQQqkwaTPzLo05TFWA%2bz9Hh2jMBuw5qwkUsQLx8keHooGr1T%2fA0DRVslyOGItAU
				IsAccessionNumberExist = url_2.Any(msg => url_2.Contains("accessionNumber=" + AccessionId[0]));
				if (!IsAccessionNumberExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 23
				// Close the browser. From TestEHR tool Image Load tab, uncheck 'Use Encryption(TimeStamp) box, click Cmd line and click Load.
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(AccessionId[0]);
				wpfobject.UnSelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				// login.DriverGoTo(url_2);
				//servicetool.RestartIISUsingexe();
				login.CreateNewSesion();
				BasePage.Driver.Navigate().GoToUrl(url_2);
				Errormsg = ehr.ErrorMsg();
				if (Errormsg.Contains("URL is not properly encrypted"))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 24
				// Exam the generated Url	
				IsAccessionNumberExist = url_2.Any(msg => url_2.Contains("accessionNumber=25061603"));
				if (IsAccessionNumberExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}


				// Step 25
				// Close the browser, From TestEHR tool Image Load tab, clear search keys. Enter 
				// StudyUID of a study that matches one study in configured data source. Select Use Encryption (Time Stamp) option. Click Cmd line and click Load.
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step25 = result.steps[++ExecutedSteps];
				step25.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step25, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 26
				// Exam the generated Url
				// When encryption is enabled, query parameters are NOT visible in the generated URL query string, e.g., enteredStudyUID and logins etc. 
				// are NOT visible in the URL query string.For example:
				// http:/localhost/WebAccess/Default.ashx?encryptionProvider=AES1&arg1=E9FHC9b0yKMuFhpNK3lvROwMXjSStFUZfMrxzJwB9DYEElWg%2fmqqWLPVOVzN96gmXlHp19RzE5FBaXoUm3GnPcaSvoChZ2eH%2fj8DHLorXxNInjLEbE%2fbXOF4uQW5gcDvMwQnH1Fhun0xIIsnnEcDzYN%2frJFrgCOizj39q4LOLPYhp43lU%2bXWJ56WwXTCwbxCHq8%2bfxTOfJ3BABWz7lx%2femtFaPePcog2ubJ%2bBlpABwqHT3jioBInr6djTuboSXF%2f%2fbo35JuHxz9EuJWxcdpCxX43kn2vv%2bTrIFBdnNnxAezJMjTlCODCp0H4O4aXd5XjMpgH9zPEua8qv5knSQXB2k%2bua2gtMNX9D8QsSyehzAw%3d
				IsStudyUIDExist = url_2.Any(msg => url_2.Contains("studyUID=" + StudyUID[0]));
				if (!IsStudyUIDExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 27 
				// Close the browser. From TestEHR tool Image Load tab, uncheck 'Use Encryption(TimeStamp) box, click Cmd line and click Load.	
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
				wpfobject.UnSelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();
				// login.DriverGoTo(url_2);
				//servicetool.RestartIISUsingexe();
				login.CreateNewSesion();
				BasePage.Driver.Navigate().GoToUrl(url_2);
				Errormsg = ehr.ErrorMsg();
				if (Errormsg.Contains("URL is not properly encrypted"))
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 28
				// Exam the generated Url	
				// The query string is not encrypted, e.g., query parameters are visible in the URL query string, From example:
				// http:/localhost/WebAccess/Default.ashx?RequestClass=Integrator&AuthProvider=Bypass&AutoEndSession=True&Culture=en-ca&UserID=Administrator&SecurityID=Administrator-Administrator&operation=ImagePresentation&ShowSelector=False&studyUID=1.2.124.113532.1.1.3.0.8.92.20020423164900.390.137
				IsStudyUIDExist = url_2.Any(msg => url_2.Contains("studyUID=" + StudyUID[0]));
				if (IsStudyUIDExist)
				{
					result.steps[++ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[++ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 29
				// [URL Encryption is enabled with keysize = 192 bit (Key for TripleDES, AES)]
				// 1.Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize '192bit (key for TripleDES, AES)'
				// 2.Start TestEHR tool
				// 3.Enable Use Encryption (Time Stamp) option
				// 4.Click Cmd line and click Load
				// 5.Exam the generated Url

				servicetool.InvokeServiceTool();
				servicetool.WaitWhileBusy();
				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				servicetool.WaitWhileBusy();
				servicetool.SetEncryptionEncryptionService();
				servicetool.WaitWhileBusy();
				servicetool.EnterServiceEntry(Key: "AES192", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
				wpfobject.GetButton("Apply", 1).Click();
				servicetool.EnterServiceParameters("key", "string", testkey3[0]);
				servicetool.EnterServiceParameters("iv", "string", "");
				servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
				servicetool.EnterServiceParameters("operationMode", "string", "CBC");
				servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
				wpfobject.GetMainWindowByTitle("Service Entry Form");
				wpfobject.GetButton("OK", 1).Click();
				wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
				wpfobject.WaitTillLoad();
				servicetool.NavigateToTab("Encryption");
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
				ID.BulkText = Encryption_Provider_192_id;
				wpfobject.WaitTillLoad();
				ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
				ArugumentName.BulkText = Encryption_Provider_Arg;
				wpfobject.WaitTillLoad();
				wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AES192_Key);
				wpfobject.ClickButton("Add", 1);
				wpfobject.WaitTillLoad();
				wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
				wpfobject.WaitTillLoad();

				DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
				DefaultEncryptionProvider.Enter(Encryption_Provider_192_id);

				wpfobject.WaitTillLoad();
				servicetool.ClickApplyButtonFromTab();
				wpfobject.WaitTillLoad();
				try
				{
					wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
				}
				catch (Exception e)
				{ }
				servicetool.RestartIISandWindowsServices();
				wpfobject.WaitTillLoad();
				servicetool.CloseServiceTool();

				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step29 = result.steps[++ExecutedSteps];
				step29.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step29, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}


				// Step 30
				// [URL Encryption is enabled with keysize = 128 bit (key for TripleDES, AES | IV for AES)]
				// 1.Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize '128 bit (key for TripleDES, AES | IV for AES)'
				// 2.Start TestEHR tool
				// 3.Enable Use Encryption (Time Stamp) option
				// 4.Click Cmd line and click Load
				// 5.Exam the generated Url
				servicetool.InvokeServiceTool();
				servicetool.WaitWhileBusy();
				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				servicetool.WaitWhileBusy();
				servicetool.SetEncryptionEncryptionService();
				servicetool.WaitWhileBusy();
				servicetool.EnterServiceEntry(Key: "AES128", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
				wpfobject.GetButton("Apply", 1).Click();
				servicetool.EnterServiceParameters("key", "string", testkey5[0]);
				servicetool.EnterServiceParameters("iv", "string", "");
				servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
				servicetool.EnterServiceParameters("operationMode", "string", "CBC");
				servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
				wpfobject.GetMainWindowByTitle("Service Entry Form");
				wpfobject.GetButton("OK", 1).Click();
				wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
				wpfobject.WaitTillLoad();
				servicetool.NavigateToTab("Encryption");
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
				ID.BulkText = Encryption_Provider_128_id;
				wpfobject.WaitTillLoad();
				ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
				ArugumentName.BulkText = Encryption_Provider_Arg;
				wpfobject.WaitTillLoad();
				wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AES128_Key);
				wpfobject.ClickButton("Add", 1);
				wpfobject.WaitTillLoad();
				wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
				wpfobject.WaitTillLoad();

				DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
				DefaultEncryptionProvider.Enter(Encryption_Provider_128_id);
				wpfobject.WaitTillLoad();
				servicetool.ClickApplyButtonFromTab();
				wpfobject.WaitTillLoad();
				try
				{
					wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
				}
				catch (Exception e)
				{ }
				servicetool.RestartIISandWindowsServices();
				wpfobject.WaitTillLoad();
				servicetool.CloseServiceTool();

				// 
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step30 = result.steps[++ExecutedSteps];
				step30.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step30, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 31
				// [URL Encryption is enabled with keysize = 128 bit (key for TripleDES, AES | IV for AES)]
				// 1. Ensure the AES Encryption Service 'key' and 'iv' values are using Base64 Encoded Key generated by keysize '128 bit (key for TripleDES, AES | IV for AES)'
				// 2. Repeat above steps using this Encryption Provider

				servicetool.InvokeServiceTool();
				servicetool.WaitWhileBusy();
				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				servicetool.WaitWhileBusy();
				servicetool.SetEncryptionEncryptionService();
				servicetool.WaitWhileBusy();
				servicetool.EnterServiceEntry(Key: "AES128_2", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
				wpfobject.GetButton("Apply", 1).Click();
				servicetool.EnterServiceParameters("key", "string", testkey8[0]);
				servicetool.EnterServiceParameters("iv", "string", testkey8[0]);
				servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
				servicetool.EnterServiceParameters("operationMode", "string", "CBC");
				servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
				wpfobject.GetMainWindowByTitle("Service Entry Form");
				wpfobject.GetButton("OK", 1).Click();
				wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
				wpfobject.WaitTillLoad();
				servicetool.NavigateToTab("Encryption");
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
				ID.BulkText = Encryption_Provider_128_2_id;
				wpfobject.WaitTillLoad();
				ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
				ArugumentName.BulkText = Encryption_Provider_Arg;
				wpfobject.WaitTillLoad();
				wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AES128_Key2);
				wpfobject.ClickButton("Add", 1);
				wpfobject.SelectCheckBox("URL Encryption Enabled", 1);
				wpfobject.WaitTillLoad();

				DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
				DefaultEncryptionProvider.Enter(Encryption_Provider_128_2_id);
				wpfobject.WaitTillLoad();
				servicetool.ClickApplyButtonFromTab();
				wpfobject.WaitTillLoad();
				try
				{
					wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
				}
				catch (Exception e)
				{ }
				servicetool.RestartIISandWindowsServices();
				wpfobject.WaitTillLoad();
				servicetool.CloseServiceTool();
				wpfobject.WaitTillLoad();

				// 
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step31 = result.steps[++ExecutedSteps];
				step31.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step31, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Step 32
				// [URL Encryption is enabled with keysize = Choose custom size in bit]
				// Note that ICA current only support keysize values 128, 192 and 256bit for AES.
				// 1. Ensure the AES Encryption Service 'key' value is using Base64 Encoded Key generated by keysize 'Choose custom size in bit'
				// 2. Start TestEHR tool
				// 3. Enable Use Encryption (Time Stamp) option
				// 4. Click Cmd line and click Load
				// 5. Exam the generated Url

				servicetool.InvokeServiceTool();
				servicetool.WaitWhileBusy();
				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				servicetool.WaitWhileBusy();
				servicetool.SetEncryptionEncryptionService();
				servicetool.WaitWhileBusy();
				servicetool.EnterServiceEntry(Key: "AES_Custom", Assembly: "OpenContent.Generic.Core.dll", Class: "OpenContent.Core.Security.Services.AES");
				wpfobject.GetButton("Apply", 1).Click();
				servicetool.EnterServiceParameters("key", "string", testkey4[0]);
				servicetool.EnterServiceParameters("iv", "string", "");
				servicetool.EnterServiceParameters("characterset", "string", "Windows-1252");
				servicetool.EnterServiceParameters("operationMode", "string", "CBC");
				servicetool.EnterServiceParameters("paddingMode", "string", "Zeros");
				wpfobject.GetMainWindowByTitle("Service Entry Form");
				wpfobject.GetButton("OK", 1).Click();
				wpfobject.GetMainWindow(ServiceTool.ConfigTool_Name);
				wpfobject.WaitTillLoad();

				servicetool.NavigateToTab("Encryption");
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();
				servicetool.ClickModifyFromTab();
				ID = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 1);
				ID.BulkText = Encryption_Provider_Custom_id;
				wpfobject.WaitTillLoad();
				ArugumentName = wpfobject.GetUIItem<ITabPage, TextBox>(servicetool.GetCurrentTabItem(), 0);
				ArugumentName.BulkText = Encryption_Provider_Arg;
				wpfobject.WaitTillLoad();
				wpfobject.SetText("PART_EditableTextBox", "Cryptographic." + Encryption_Service_List_AESCustom_Key);
				wpfobject.ClickButton("Add", 1);

				servicetool.NavigateToTab(ServiceTool.Encryption_Tab);
				wpfobject.WaitTillLoad();
				servicetool.NavigateSubTab("Integrator Url");
				wpfobject.WaitTillLoad();

				DefaultEncryptionProvider = wpfobject.GetUIItem<ITabPage, ComboBox>(servicetool.GetCurrentTabItem(), 0);
				DefaultEncryptionProvider.Enter(Encryption_Provider_Custom_id);
				wpfobject.WaitTillLoad();
				servicetool.ClickApplyButtonFromTab();
				wpfobject.WaitTillLoad();
				try
				{
					wpfobject.ClickButton(ServiceTool.YesBtn_Name, 1);
				}
				catch (Exception e)
				{ }
				servicetool.RestartIISandWindowsServices();
				wpfobject.WaitTillLoad();
				servicetool.CloseServiceTool();

				// 
				ehr.LaunchEHR();
				wpfobject.GetMainWindow("Test WebAccess EHR");
				wpfobject.SelectTabFromTabItems("Image Load");
				wpfobject.WaitTillLoad();
				ehr.SetCommonParameters(address: URL, user: adminUserName, domain: "SuperAdminGroup", usersharing: "True");
				ehr.SetSelectorOptions(showSelector: "False", showReport: "True");
				ehr.SetSearchKeys_Study(StudyUID[0], "Study_UID", datasources: DatasourceVMSSA131);
				wpfobject.SelectCheckBox("encryptEnabledCheckBox");
				url_2 = ehr.clickCmdLine("ImageLoad");
				ehr.CloseEHR();

				login.CreateNewSesion();
				viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_2);
				panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
				var step32 = result.steps[++ExecutedSteps];
				step32.SetPath(testid, ExecutedSteps);
				if (viewer.CompareImage(step32, panel))
				{
					result.steps[ExecutedSteps].status = "Pass";
					Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
				}
				else
				{
					result.steps[ExecutedSteps].status = "Fail";
					Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
					result.steps[ExecutedSteps].SetLogs();
				}

				// Final Result
				result.FinalResult(ExecutedSteps);
				Logger.Instance.ErrorLog("Overall Test status--" + result.status);

				//Return Result
				return result;
			}
			catch (Exception e)
			{
				//Log Exception
				Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

				//Report Result
				result.FinalResult(e, ExecutedSteps);
				Logger.Instance.ErrorLog("Overall Test status--" + result.status);

				//Close browser
				BasePage.Driver.Quit();
				BasePage.Driver = null;
				login = new Login();

				//Return Result
				return result;
			}
			finally
			{
				servicetool.CloseServiceTool();
				ehr.CloseEHR();
				if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AE256_Key + "']"))
				{
					basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AE256_Key + "']");
				}
				if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES192_Key + "']"))
				{
					basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES192_Key + "']");
				}
				if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key + "']"))
				{
					basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key + "']");
				}
				if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key2 + "']"))
				{
					basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AES128_Key2 + "']");
				}
				if (basepage.NodeExist(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AESCustom_Key + "']"))
				{
					basepage.RemoveNode(Config.ServiceFactoryConfigPath, "/add[@key='Cryptographic." + Encryption_Service_List_AESCustom_Key + "']");
				}
				if (basepage.NodeExist(Config.FileLocationPath, "/EncryptionProviders"))
				{
					basepage.RemoveChildNode(Config.FileLocationPath, "/EncryptionProviders");
				}
				basepage.ChangeAttributeValue(Config.FileLocationPath, "/EncryptionProviders", "default", "");
				basepage.ChangeNodeValue(Config.FileLocationPath, "/EncryptionEnabled", "False");
				servicetool.RestartIISUsingexe();
			}
		}

        /// <summary>
        /// Test 162390 - 3.5.0 Configuring GSPS False
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162390(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";
                String domain = "SuperAdminGroup";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled 
                login.SetWebConfigValue(@"C:\WebAccess\WebAccess\web.Config", "Application.EnableSavingGSPS", "false");
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                ExecutedSteps++;

                //Step-2
                domaintab.SearchDomain(domain);
                domaintab.SelectDomain(domain);
                domaintab.ClickEditDomain();
                var inusetools = domaintab.GetAllToolsInToolBoxConfig();
                var availabletools = domaintab.GetAvailableToolsInToolBoxConfig();
                var tools = availabletools.Concat(inusetools).ToList<String>();
                var isAnnotatedTool = tools.Any<String>(tool => tool.Contains(BluRingTools.Save_Annotated_Image.ToString()));
                var isSaveSeries = tools.Any<String>(tool => tool.Contains(BluRingTools.Save_Annotated_Image.ToString()));
                if (!isAnnotatedTool && !isSaveSeries)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                domaintab.ClickCloseEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Step-4
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSelectorOptions(SearchPriors: "False");
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local);
                ehr.SetSearchKeys_Study(Accession, datasources: login.GetHostName(Config.EA96));
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                var isImageComapre2 = viewer.CompareImage(step2, BasePage.FindElementByCss(viewer.Activeviewport));
                if (isImageComapre2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                viewer.OpenViewerToolsPOPUp();
                var tools5 = viewer.GetToolsInViewer();
                isAnnotatedTool = tools5.Any<String>(tool => tool.Contains(BluRingTools.Save_Annotated_Image.ToString()));
                isSaveSeries = tools5.Any<String>(tool => tool.Contains(BluRingTools.Save_Annotated_Image.ToString()));
                if (!isAnnotatedTool && !isSaveSeries)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Report Result               
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);


                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();


                //Return Result
                return result;
            }

            finally
            {   
                //Enable GSPS again               
                login.SetWebConfigValue(@"C:\WebAccess\WebAccess\web.Config", "Application.EnableSavingGSPS", "true");                
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

            }

        }

        /// <summary>
        /// Test 162391 - GSPS True
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162391(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();
            String Accession = String.Empty;
            String patientid = String.Empty;
            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                patientid = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";
                String domain = "SuperAdminGroup";
                HPLogin hplogin = new HPLogin();

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled 
                login.SetWebConfigValue(@"C:\WebAccess\WebAccess\web.Config", "Application.EnableSavingGSPS", "true");
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                ExecutedSteps++;

                //Step-2
                domaintab.SearchDomain(domain);
                domaintab.SelectDomain(domain);
                domaintab.ClickEditDomain();
                var inusetools = domaintab.GetAllToolsInToolBoxConfig();
                var availabletoos = domaintab.GetAvailableToolsInToolBoxConfig();
                var tools = inusetools.Concat(availabletoos).ToList<String>();
                var isAnnotatedTool = tools.Any<String>(tool => tool.Contains("Save Annotated Images"));
                var isSaveSeries = tools.Any<String>(tool => tool.Contains("Save Series"));
                if (isAnnotatedTool && isSaveSeries)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                IWebElement group1 = BasePage.Driver.FindElement(By.CssSelector(BasePage.div_toolBoxConfiguration_Groups + ":nth-of-type(11)"));// li:nth-of-type(3)"));				
                IWebElement group2 = BasePage.Driver.FindElement(By.CssSelector(BasePage.div_toolBoxConfiguration_Groups + ":nth-of-type(11)"));
                var dictionary = new Dictionary<String, IWebElement>();
                dictionary.Add("Save Series", group1);
                dictionary.Add("Save Annotated Images", group2);
                domaintab.AddToolsToToolbox(dictionary);
                domaintab.ClickSaveEditDomain();
                login.Logout();
                ExecutedSteps++;

                //Step-4
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetSelectorOptions(SearchPriors: "False");
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local, usersharing: "True");
                ehr.SetSearchKeys_Study(Accession, datasources: login.GetHostName(Config.EA96));
                String url_4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                var isImageComapre2 = viewer.CompareImage(step2, BasePage.FindElementByCss(viewer.Activeviewport));
                if (isImageComapre2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                viewer.OpenViewerToolsPOPUp();                
                var tools5 = viewer.GetToolsInViewer();
                isAnnotatedTool = tools5.Any<String>(tool => tool.Contains("Save Annotated Images"));
                isSaveSeries = tools5.Any<String>(tool => tool.Contains("Save Series"));
                new TestCompleteAction().Click(BasePage.FindElementByCss(viewer.Activeviewport)).Perform();
                if (isAnnotatedTool && isSaveSeries)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                viewer.SelectViewerTool(BluRingTools.Interactive_Zoom);
                viewer.ApplyTool_Zoom();
                var isPRSaved = viewer.SavePresentationState(BluRingTools.Save_Series, outerTool:BluRingTools.Pan);
                if (isPRSaved)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7
                login.CreateNewSesion();
                ExecutedSteps++;

                //Step-8
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url_4);
                var step8 = result.steps[++ExecutedSteps];
                step8.SetPath(testid, ExecutedSteps);
                var isImageComapre8 = viewer.CompareImage(step8, BasePage.FindElementByCss(viewer.Activeviewport));
                if (isImageComapre8)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Report Result               
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }

            finally
            {
                //Disable user sharing
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always disabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Delete PR
                login.DriverGoTo("https://" + Config.EA96 + "/webadmin");
                var hphome = hplogin.LoginHPen(Config.hpUserName, Config.hpPassword, EA_URL: "https://" + Config.EA96 + "/webadmin");
                var workflow = (WorkFlow)hphome.Navigate("Workflow");
                workflow.NavigateToLink("Workflow", "Archive Search");
                workflow.HPSearchStudy("PatientID", patientid);
                if (BasePage.Driver.FindElements(By.CssSelector("#tabrow>tbody tr")).Count > 0)
                {
                    workflow.DeletePaticularModality("PR");
                    Logger.Instance.InfoLog("Pre-conditon: All PRs deleted for Accession - " + Accession + " from datasource - " + Config.LB_Dest1IP);
                }
                hplogin.LogoutHPen();


            }

        }

        /// <summary>
        /// Test #162388 - Same Patient, Multiple Study Tests
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_162388(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            TestCaseResult result;
            result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            patients = new Patients();

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String accessionlist = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                var arraccesion = accessionlist.Split('-');
                String firstname = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
                String lastname = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String name = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientName");
                String exptooltip = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "ToolTip");
                var tooltiplist = exptooltip.Split('=');
                String securityID_Local = Config.adminUserName + "-" + Config.adminUserName;
                String URL = "http://localhost/webaccess";

                //Preconditions - In the Merge iConnect Access Service tool, User Sharing --> Always Enabled
                TestFixtures.UpdateFeatureFixture("bluring", value: "true:BluRing");
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();

                //Precondition - setup BluRing as default viewer
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                userpref.OpenUserPreferences();
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpref.BluringViewerRadioBtn().Click();
                userpref.SetRadioButton(userpref.JPEGRadioBtn());
                userpref.CloseUserPreferences();
                login.Logout();

                //Step 1                
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "Study");
                ehr.SetSearchKeys_Study(firstname, "First_Name");
                ehr.SetSearchKeys_Study(lastname, "Last_Name");
                var url1 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                var patientstudies = PatientsStudy.LaunchPatientsStudyPage(url1);
                var plist = patientstudies.GetPateintList();
                var lastnames = plist["Last Name"];
                var firstnames = plist["First Name"];
                if (lastnames.All(lastname1 => lastname1.Contains(lastname)) && firstnames.All(firstname1 => firstname1.Contains(firstname)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-2
                patientstudies.SelectPatinet("Accession", arraccesion[0].Split(':')[0]);
                patientstudies.SelectPatinet("Accession", arraccesion[0].Split(':')[1]);
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                bool iswarningmessage2 = false;
                try
                {
                    iswarningmessage2 = BasePage.FindElementByCss(BluRingViewer.MultiplePatientErrorContent).
                    Text.Contains(MultiplePatientErrorMsg);
                }
                catch
                {
                    iswarningmessage2 = false;
                }
                if (!iswarningmessage2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3            
                var step3 = result.steps[++ExecutedSteps];
                foreach (String accession in arraccesion[0].Split(':'))
                {
                    var tooltip = viewer.GetExamListToolTip(accession);
                    var expectedtooltip = tooltiplist.Single<String>(ecardtooltip => ecardtooltip.Contains(accession));
                    tooltip = tooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\n", "");
                    expectedtooltip = Regex.Replace(expectedtooltip, @"\s+", "");
                    tooltip = Regex.Replace(tooltip, @"\s+", "");
                    expectedtooltip = expectedtooltip.Replace("\\r\\n", "");
                    if (tooltip.Equals(expectedtooltip))
                    {
                        step3.statuslist.Add("Pass");
                    }
                    else
                    {
                        step3.statuslist.Add("Fail");
                        Logger.Instance.ErrorLog("ExpectedTooTip-" + expectedtooltip);
                        Logger.Instance.ErrorLog("ActualTooTip-" + tooltip);
                    }
                }
                if (!step3.statuslist.Contains("Fail"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Step 4               
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "Study");
                ehr.SetSearchKeys_Study(firstname, "First_Name");
                ehr.SetSearchKeys_Study(lastname, "Last_Name");
                var url4 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientstudies = PatientsStudy.LaunchPatientsStudyPage(url4);
                plist = patientstudies.GetPateintList();
                lastnames = plist["Last Name"];
                firstnames = plist["First Name"];
                if (lastnames.All(lastname1 => lastname1.Contains(lastname)) && firstnames.All(firstname1 => firstname1.Contains(firstname)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                patientstudies.SelectPatinet("Accession", arraccesion[1].Split(':')[0]);
                patientstudies.SelectPatinet("Accession", arraccesion[1].Split(':')[1]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                bool iswarningmessage5 = false;
                try
                {
                    iswarningmessage5 = BasePage.FindElementByCss(BluRingViewer.MultiplePatientErrorContent).
                    Text.Contains(MultiplePatientErrorMsg);
                }
                catch
                {
                    iswarningmessage5 = false;
                }
                if (iswarningmessage5)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-6            
                var step6 = result.steps[++ExecutedSteps];
                foreach (String accession in arraccesion[1].Split(':'))
                {
                    var tooltip = viewer.GetExamListToolTip(accession);
                    var expectedtooltip = tooltiplist.Single<String>(ecardtooltip => ecardtooltip.Contains(accession));
                    tooltip = tooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\n", "");
                    expectedtooltip = Regex.Replace(expectedtooltip, @"\s+", "");
                    expectedtooltip = expectedtooltip.Replace("\\r\\n", "");
                    tooltip = Regex.Replace(tooltip, @"\s+", "");
                    if (tooltip.Equals(expectedtooltip))
                    {
                        step6.statuslist.Add("Pass");
                    }
                    else
                    {
                        step6.statuslist.Add("Fail");
                    }
                }
                if (!step6.statuslist.Contains("Fail"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7                               
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "Study");
                ehr.SetSearchKeys_Study(firstname, "First_Name");
                ehr.SetSearchKeys_Study(lastname, "Last_Name");
                var url7 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientstudies = PatientsStudy.LaunchPatientsStudyPage(url7);
                plist = patientstudies.GetPateintList();
                lastnames = plist["Last Name"];
                firstnames = plist["First Name"];
                if (lastnames.All(lastname1 => lastname1.Equals(lastname)) && firstnames.All(firstname1 => firstname1.Equals(firstname)))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-8
                patientstudies.SelectPatinet("Accession", arraccesion[2].Split(':')[0]);
                patientstudies.SelectPatinet("Accession", arraccesion[2].Split(':')[1]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                bool iswarningmessage8 = false;
                try
                {
                    iswarningmessage8 = BasePage.FindElementByCss(BluRingViewer.MultiplePatientErrorContent).
                    Text.Contains(MultiplePatientErrorMsg);
                }
                catch
                {
                    iswarningmessage8 = false;
                }
                if (iswarningmessage8)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-9            
                var step9 = result.steps[++ExecutedSteps];
                foreach (String accession in arraccesion[2].Split(':'))
                {
                    var tooltip = viewer.GetExamListToolTip(accession);
                    var expectedtooltip = tooltiplist.Single<String>(ecardtooltip => ecardtooltip.Contains(accession));
                    tooltip = tooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\n", "");
                    expectedtooltip = Regex.Replace(expectedtooltip, @"\s+", "");
                    tooltip = Regex.Replace(tooltip, @"\s+", "");
                    expectedtooltip = expectedtooltip.Replace("\\r\\n", "");
                    if (tooltip.Equals(expectedtooltip))
                    {
                        step9.statuslist.Add("Pass");
                    }
                    else
                    {
                        step9.statuslist.Add("Fail");
                    }
                }
                if (!step9.statuslist.Contains("Fail"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-10
                viewer.ChangeViewerLayout(Layout: "1x2");
                var step10 = result.steps[++ExecutedSteps];
                step10.SetPath(testid, ExecutedSteps);
                var isImageCorrect10 = viewer.CompareImage(step10, BasePage.FindElementByCss(viewer.Activeviewport));
                if (isImageCorrect10)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-11
                viewer.SelectViewerTool(BluRingTools.Pan);
                viewer.ApplyTool_Pan();
                viewer.SelectViewerTool(BluRingTools.Window_Level);
                viewer.ApplyTool_WindowWidth();
                viewer.SelectViewerTool(BluRingTools.Reset);
                new TestCompleteAction().DoubleClick(BasePage.FindElementByCss(viewer.Activeviewport)).Perform();
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                var isImageCorrect11 = viewer.CompareImage(step11, BasePage.FindElementByCss(viewer.Activeviewport));
                if (isImageCorrect11)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(address: URL, autoendsession: "True", SecurityID: securityID_Local);
                ehr.SetSelectorOptions(selectoroption: "Study");
                ehr.SetSearchKeys_Study(firstname, "First_Name");                
                var url12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientstudies = PatientsStudy.LaunchPatientsStudyPage(url12);
                patientstudies.SelectPatinet("Accession", arraccesion[3].Split(':')[0]);
                patientstudies.SelectPatinet("Accession", arraccesion[3].Split(':')[1]);
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                bool iswarningmessage12 = false;
                try
                {
                    iswarningmessage12 = BasePage.FindElementByCss(BluRingViewer.MultiplePatientErrorContent).
                    Text.Contains(MultiplePatientErrorMsg);
                }
                catch
                {
                    iswarningmessage12 = false;
                }
                if (iswarningmessage12)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-13                          
                var step13 = result.steps[++ExecutedSteps];
                foreach (String accession in arraccesion[3].Split(':'))
                {
                    var tooltip = viewer.GetExamListToolTip(accession);
                    var expectedtooltip = tooltiplist.Single<String>(ecardtooltip => ecardtooltip.Contains(accession));
                    tooltip = tooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\r\n", "");
                    expectedtooltip = expectedtooltip.Replace("\n", "");
                    expectedtooltip = Regex.Replace(expectedtooltip, @"\s+", "");
                    tooltip = Regex.Replace(tooltip, @"\s+", "");
                    expectedtooltip = expectedtooltip.Replace("\\r\\n", "");
                    if (tooltip.Equals(expectedtooltip))
                    {
                        step9.statuslist.Add("Pass");
                    }
                    else
                    {
                        step9.statuslist.Add("Fail");
                    }
                }
                if (!step13.statuslist.Contains("Fail"))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                //Report Result               
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                GC.Collect();
                return result;
            }
            catch (Exception e)
            {
                //Log exception
                Logger.Instance.ErrorLog(e.StackTrace + e.Message + e.InnerException);             

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Close browser
                Driver.Manage().Cookies.DeleteAllCookies();
                CloseBrowser();

                //Return Result
                return result;
            }

        }

        /// <summary>
        /// Test Precondition - Setting up Domain, User and Sharing studies.
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_Precondition(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            int ExecutedSteps = -1;

            try
            {
                String patientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String datasourcelist = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources");
                var arrDataSources = datasourcelist.Split(':');
                var ds1 = arrDataSources[0];
                var ds2 = arrDataSources[1] + "=" + login.GetHostName(Config.DestinationPACS);
                var arrPriors = priorscount.Split(':');
                var arrAccession = accession.Split('=');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String domainname = String.Empty;
                String role1 = BasePage.GetUniqueRole("R1");
                String role2 = BasePage.GetUniqueRole("R2");
                String user1 = BasePage.GetUniqueUserId("U1");
                String user2 = BasePage.GetUniqueUserId("U2");
                String destination = "Destination" + new Random().Next(1, 100);
                String studypath = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "StudyPath");
                String imagescount_shared = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Images");
                String stuydate_shared = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorDate");
                String modality_shared = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorModality");


                //Step-1, 2 and 3
                var servicetool = new ServiceTool();
                TestFixtures.UpdateFeatureFixture("allowshowselector", value: "True");
                TestFixtures.UpdateFeatureFixture("allowshowselectorsearch", value: "True");
                servicetool.LaunchServiceTool();
                servicetool.RestartIISandWindowsServices();
                servicetool.CloseServiceTool();
                //create domain, role users
                login.LoginIConnect(adminUserName, adminPassword);
                var domain = login.Navigate<DomainManagement>();
                var domainattr = domain.CreateDomainAttr();
                domainname = domainattr[DomainManagement.DomainAttr.DomainName];
                domain.CreateDomain(domainattr, isgrantaccessneeded: true, isimagesharingneeded: true);
                domain.SetupStudyQueryParameters(domainname, new QueryParamters[] { QueryParamters.LastName });
                var rolemgmt = login.Navigate<RoleManagement>();
                rolemgmt.CreateRole(domainname, role1, "", ds1);
                rolemgmt.CreateRole(domainname, role2, "both", ds2);
                var usertab = login.Navigate<UserManagement>();
                usertab.CreateUser(user1, role1);
                usertab.CreateUser(user2, role2);

                //Create Destination for DomainB
                var imagesharing = (Image_Sharing)login.Navigate("Image Sharing");
                var pagedestination = (Image_Sharing.Destination)imagesharing.NavigateToSubTab("Destination");
                //pagedestination.CreateDestination(login.GetHostName(Config.DestinationPACS), user2, user2, destination, domainname);
                pagedestination.AddDestination(domainname, destination, login.GetHostName(Config.DestinationPACS), user2, user2);
                var instTab = (Image_Sharing.Institution)imagesharing.NavigateToSubTab("Institution");

                //Update Test Data Sheet
                ReadExcel.UpdateTestData(filepath, "TestData", testid, "Domainname", domainname);
                ReadExcel.UpdateTestData(filepath, "TestData", testid, "User1", user1);
                ReadExcel.UpdateTestData(filepath, "TestData", testid, "User2", user2);
                ReadExcel.UpdateTestData(filepath, "TestData", testid, "Role2", role2);

                //Generate Installer
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Image Sharing");
                servicetool.GenerateInstallerExamImporter(domainname, "EI" + domainname);
                servicetool.RestartService();
                servicetool.CloseServiceTool();

                //Install EI and upload study
                var ei = new ExamImporter();
                ei.EI_Installation(domainname, "EI" + domainname, Config.Inst1, user2, user2);
                BasePage.Kill_EXEProcess("UploaderTool");
                Logger.Instance.InfoLog("The Window name of EI is" + "EI" + domainname);
                String eipath = "C:\\Users\\Administrator\\AppData\\Local\\Apps" + "\\EI" + domainname + "\\bin" + "\\UploaderTool.exe";
                var cduploader = new ExamImporter();
                cduploader.eiWinName = "EI" + domainattr[DomainManagement.DomainAttr.DomainName];
                Thread.Sleep(3000);
                cduploader.EIDicomUpload(user2, user2, destination, studypath, path: eipath, windowName:"EI"+domainname);
                ExecutedSteps++;
                ExecutedSteps++;
                ExecutedSteps++;

                //Step-4
                login.Logout();
                login.LoginIConnect(user1, user1);
                var userpreferences = new UserPreferences();
                userpreferences.OpenUserPreferences();
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.BluringViewerRadioBtn().Click();
                userpreferences.CloseUserPreferences();
                var studies = login.Navigate<Studies>();
                String accession5 = arrAccession[1].Split(':')[0];
                String datasource5 = arrAccession[1].Split(':')[1];
                studies.SearchStudy(AccessionNo: accession5);
                studies.SelectStudy("Accession", accession5);
                studies.ShareStudy(false, new string[] { user2 }, domainName: domainname);
                var outbounds = login.Navigate<Outbounds>();
                outbounds.SearchStudy(AccessionNo: accession5);
                outbounds.ChooseColumns(new string[] { "Modality", "# Images" });
                var study_outbounds = outbounds.GetMatchingRow(new string[] { "Accession", "Study Date", "# Images", "Status", "Modality" }, new string[] { accession5, stuydate_shared, imagescount_shared, "Shared", modality_shared });
                login.Logout();
                login.LoginIConnect(user2, user2);
                userpreferences.OpenUserPreferences();
                PageLoadWait.WaitForPageLoad(10);
                PageLoadWait.WaitForFrameLoad(10);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("UserHomeFrame").SwitchTo().Frame("m_preferenceFrame");
                userpreferences.BluringViewerRadioBtn().Click();
                userpreferences.CloseUserPreferences();
                var inbounds = login.Navigate<Inbounds>();
                outbounds.SearchStudy(AccessionNo: accession5);
                outbounds.ChooseColumns(new string[] { "Modality", "# Images" });
                var study_inbounds = inbounds.GetMatchingRow(new string[] { "Accession", "Study Date", "# Images", "Status", "Modality" }, new string[] { accession5, stuydate_shared, imagescount_shared, "Shared", modality_shared });
                if (study_outbounds != null && study_inbounds != null)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {

                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;

            }

        }


        /// <summary>
        /// Test 139003 - 1-Viewing priors with Query Related Study Parameters Applied - Patient Last Name
        /// Step-1 to 12
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test1_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            int ExecutedSteps = -1;
            String domainame = String.Empty;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSources")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);


                //Step-1 to 5      
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.LastName });
                ExecutedSteps++;
                ExecutedSteps++;
                ExecutedSteps++;
                ExecutedSteps++;
                ExecutedSteps++;

                //Step-6
                login.Logout();
                login.LoginIConnect(user1, user1);
                var outbounds = login.Navigate<Outbounds>();
                outbounds.SearchStudy("Accession", sharedstudy);
                var viewer = BluRingViewer.LaunchBluRingViewer("OutBounds", "Accession", sharedstudy);
                if (viewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[0]) && viewer.CheckAccession_ExamList(user1Priors))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-7
                TestFixtures.UpdateFeatureFixture("usersharing", value: "Always enabled");
                TestFixtures.UpdateFeatureFixture("multiplestudy", value: "Show Selector", restart: true);
                ExecutedSteps++;

                //Step-8
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.LastName });
                ExecutedSteps++;

                //Step-9
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain:domainame, role:role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("TOM", "Last_Name");
                var url9 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url9);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Last Name"][0].Contains("TOM"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                
                //Step-10
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (viewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && viewer.CheckAccession_ExamList(user2Priors)
                     && viewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-11
                viewer.OpenPriors(accession: sharedstudy);
                viewer.SetViewPort(0, 2);
                var step11 = result.steps[++ExecutedSteps];
                step11.SetPath(testid, ExecutedSteps);
                var isImageCompare11 = viewer.CompareImage(step11, viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare11 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-12 
                viewer.OpenPriors(accession: uploadedstudy);
                var step12 = result.steps[++ExecutedSteps];
                step12.SetPath(testid, ExecutedSteps);
                viewer.SetViewPort(0, 3);
                var isImageCompare12 = viewer.CompareImage(step12, viewer.GetElement(BasePage.SelectorType.CssSelector, viewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare12 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }

        }

        /// <summary>
        /// Test 139004 2-Viewing priors with Query Related Study Parameters Applied - Patient Full Name
        /// Step-13 to 17
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test2_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String priordate = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorDate");
                String priormodality = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorModality");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.FullName });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("KIM", "First_Name");
                var url12 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url12);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["First Name"][0].Contains("KIM"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }

            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }

        }

        /// <summary>
        /// Test 139006 3- Viewing priors with Query Related Study Parameters Applied - Patient ID
        /// Step-18 to 22
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test3_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("150511", "Patient_ID");
                var url2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url2);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Contains("150511"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }

        }

        /// <summary>
        /// Test 139007 - 4-Viewing priors with Query Related Study Parameters Applied - Patient ID and Last Name
        /// Step-23 to 27
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test4_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.LastName });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("150511", "Patient_ID");
                ehr.SetSearchKeys_Study("TOM", "Last_Name");
                var url2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url2);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Contains("150511") && studyinfo["Last Name"][0].Contains("TOM"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }

        }

        /// <summary>
        /// Test 139008 - 5-Viewing priors with Query Related Study Parameters Applied - Patient ID and First Name
        /// Step-28 to 32
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test5_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("150511", "Patient_ID");
                ehr.SetSearchKeys_Study("KIM", "First_Name");
                var url2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url2);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Contains("150511") && studyinfo["First Name"][0].Contains("KIM"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }
        }

        /// <summary>
        /// Test 139009 -6-Viewing priors with Query Related Study Parameters Applied - Patient ID and DOB
        /// Step-33 to 37
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test6_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientDOB, QueryParamters.PatientID });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("150511", "Patient_ID");
                ehr.SetSearchKeys_Study("20-Dec-1990", "Patient_DOB");//20.12.1990
                var url2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url2);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Contains("150511") && studyinfo["Patient DOB"][0].Contains("20-Dec-1990"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }
        }

        /// <summary>
        /// Test 139010 -7-Viewing priors with Query Related Study Parameters Applied - Patient ID and Issuer of Patient ID (IPID) 
        /// Step-38 to 42
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test7_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.IPID, QueryParamters.PatientID });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("150511", "Patient_ID");
                ehr.SetSearchKeys_Study("HOME", "IPID");//IPID  --> HOME
                var url2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url2);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Patient ID"][0].Contains("150511") && studyinfo["Location"][0].Contains("HOME"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 == 2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }
        }

        /// <summary>
        /// Test 139011 8-Viewing priors with Query Related Study Parameters Applied - Patient Last Name and Patient DOB 
        /// Step-43 to Step-47
        /// </summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test8_162400(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables         
            TestCaseResult result = null;
            String domainame = String.Empty;
            int ExecutedSteps = -1;
            PatientsStudy patientsStudy = new PatientsStudy();

            try
            {
                var patientID = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID")).Split(':');
                String priorscount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionIDList");
                String accession2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                var datasourcelist = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "DataSourceList")).Split(':');
                domainame = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Domainname");
                String priorcount = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PriorCount");
                String user1 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User1");
                String user2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "User2");
                String sharedstudy = accession.Split('=')[1].Split(':')[0];
                String uploadedstudy = accession.Split('=')[0].Split(':')[0];
                var arrPriorscount = priorcount.Split(':');
                result = new TestCaseResult(stepcount);
                result.SetTestStepDescription(teststeps);
                var user1Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U1PriorsList")).Split(':');
                var user2Priors = ((String)ReadExcel.GetTestData(filepath, "TestData", testid, "U2PriorsList")).Split(':');
                String role2 = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "Role2");

                //Step-1
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientDOB, QueryParamters.LastName });
                ExecutedSteps++;

                //Step-2
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                ehr.SetCommonParameters(user: user2, autoendsession: "True", SecurityID: user2, usersharing: "True", domain: domainame, role: role2);
                ehr.SetSelectorOptions(showSelector: "True", selectoroption: "Study", SearchPriors: "True", IncludeHoldingPen: "True");
                ehr.SetSearchKeys_Study("TOM", "Last_Name");
                ehr.SetSearchKeys_Study("20-Dec-1990", "Patient_DOB");//20.12.1990
                var url2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                patientsStudy = PatientsStudy.LaunchPatientsStudyPage(url2);
                var studyinfo = patientsStudy.GetPateintList();
                if (studyinfo["Last Name"][0].Contains("TOM") && studyinfo["Patient DOB"][0].Contains("20-Dec-1990"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-3
                patientsStudy.SelectPatinet("Accession", accession2);
                bluringviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (bluringviewer.CheckPriorsCount() == Int32.Parse(arrPriorscount[1]) && bluringviewer.CheckAccession_ExamList(user2Priors)
                     && bluringviewer.IsForeignExamAlert(uploadedstudy))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-4
                bluringviewer.OpenPriors(accession: sharedstudy);
                bluringviewer.SetViewPort(0, 2);
                var step4 = result.steps[++ExecutedSteps];
                step4.SetPath(testid, ExecutedSteps);
                var isImageCompare4 = bluringviewer.CompareImage(step4, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount1 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare4 && PanelCount1 ==2)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Step-5
                bluringviewer.OpenPriors(accession: uploadedstudy);
                var step5 = result.steps[++ExecutedSteps];
                step5.SetPath(testid, ExecutedSteps);
                bluringviewer.SetViewPort(0, 3);
                var isImageCompare5 = bluringviewer.CompareImage(step5, bluringviewer.GetElement(BasePage.SelectorType.CssSelector, bluringviewer.Activeviewport));
                int PanelCount2 = BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count;
                if (isImageCompare5 && PanelCount2 == 3)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                //Logout Application  
                login.Logout();

                //Return Result
                result.FinalResult(ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);
                return result;
            }


            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.InfoLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            finally
            {
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                var domaintab = login.Navigate<DomainManagement>();
                domaintab.SetupStudyQueryParameters(domainame, new QueryParamters[] { QueryParamters.PatientID, QueryParamters.FullName });
                login.Logout();
            }
        }

        /// <summary>
		/// Auto-fill all viewers in the series layout with the first available series.
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162394(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool tool = new ServiceTool();
            Studies studies = new Studies();
            UserPreferences userpreferences = new UserPreferences();
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            String url = string.Empty;
            string DicomPath = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "UploadFilePath");
            string Accession = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
            string PatientID = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "PatientID");
            string Datasource = Config.DestEAsIp;
            string AETitle = Config.DestEAsAETitle;
            int Port = 12000;
            try
            {
                string[] FullPath = Directory.GetFiles(Config.TestDataPath + DicomPath, "*.*", SearchOption.AllDirectories);
                //PreConditions
                //Add Dicom to the DataSource
                var client = new DicomClient();
                foreach (string path in FullPath)
                {
                    client.AddRequest(new DicomCStoreRequest(path));
                    client.Send(Datasource, Port, false, "SCU", AETitle);
                }
                servicetool.LaunchServiceTool();
                servicetool.NavigateToTab("Integrator");
                servicetool.WaitWhileBusy();
                servicetool.EanbleUserSharing_ShadowUser(usersharing: "Always Disabled", shadowuser: "Always Disabled");
                servicetool.ClickModifyButton();
                servicetool.AllowShowSelectorSearch().Checked = false;
                servicetool.AllowShowSelector().Checked = false;
                servicetool.ClickApplyButtonFromTab();
                servicetool.RestartIISandWindowsServices();
                servicetool.WaitWhileBusy();
                servicetool.NavigateToTab("Viewer");
                servicetool.WaitWhileBusy();
                servicetool.NavigateSubTab("Protocols");
                servicetool.WaitWhileBusy();
                servicetool.MoadalitySetting(layout: "auto");
                servicetool.CloseServiceTool();
                //Step 1
                // Load a CR study with 4 series.	
                // Expected result: The study loads with a layout of 2x2.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator");
                ehr.SetSearchKeys_Study(Accession);
                ehr.SetSearchKeys_Study(login.GetHostName(Datasource), "Datasource");
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                var viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", url: url);
                var panel = viewer.GetElement(BasePage.SelectorType.CssSelector, BluRingViewer.div_compositeViewer);
                var step2 = result.steps[++ExecutedSteps];
                step2.SetPath(testid, ExecutedSteps);
                if (viewer.CompareImage(step2, panel))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 2
                // Verify the first available series is loaded into the top left viewer.	

                string ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                string ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                if (ThumbnailSeriesUID.Equals(ViewerSeriesUID))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 3
                // Verify the rest of the series.
                // Expected result : The rest of the series should be loaded followed by the thumbnails.
                String ThumbnailSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[1], "src", '&', "seriesUID");
                String ViewerSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X2(), "src", '&', "seriesUID");
                bool result_1X2 = ThumbnailSeriesUID_2.Equals(ViewerSeriesUID_2);

                String ThumbnailSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[2], "src", '&', "seriesUID");
                String ViewerSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X1(), "src", '&', "seriesUID");
                bool result_2X1 = ThumbnailSeriesUID_3.Equals(ViewerSeriesUID_3);

                String ThumbnailSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[3], "src", '&', "seriesUID");
                String ViewerSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X2(), "src", '&', "seriesUID");
                bool result_2X2 = ThumbnailSeriesUID_4.Equals(ViewerSeriesUID_4);

                if (result_1X2 && result_2X1 && result_2X2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 4
                // 	Select any series and draw some annotations.
                // Save the series.
                IWebElement source = studyviewer.ViewportScrollHandle(1, 2);
                IWebElement destination = studyviewer.ViewportScrollBar(1, 2);

                int w = destination.Size.Width;
                int h = destination.Size.Height;

                Actions action2 = new Actions(BasePage.Driver);
                //Apply W/L
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.WindowLevel);
                IWebElement viewport1 = studyviewer.SeriesViewer_1X1();
                h = viewport1.Size.Height;
                w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, 3 * w / 4, 3 * h / 4);

                result.steps[++ExecutedSteps].SetPath(testid + "_2_1_WL_Applied", ExecutedSteps + 1);
                bool status2_1 = studies.CompareImage(result.steps[ExecutedSteps], studyviewer.SeriesViewer_1X1());

                //Apply Zoom
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.InteractiveZoom);
                viewport1 = studyviewer.SeriesViewer_1X1();
                h = viewport1.Size.Height;
                w = viewport1.Size.Width;
                studyviewer.DragandDropImage(viewport1, w / 4, h / 4, 3 * w / 4, 3 * h / 4);
                int ThumbnailCountBeforeSave_FirstStudy = studyviewer.Thumbnails().Count;
                studyviewer.SelectToolInToolBar(IEnum.ViewerTools.SaveSeries);

                PageLoadWait.WaitForLoadingIconToAppear_Savestudy();
                PageLoadWait.WaitForLoadingIconToDisAppear_Savestudy();
                if (status2_1)
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }



                // Step 5
                // Reload the same study.	
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();
                login.NavigateToIntegratorURL(url);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                PageLoadWait.WaitForAllViewportsToLoad(40);
                PageLoadWait.WaitForThumbnailsToLoad(40);
                BasePage.Driver.SwitchTo().DefaultContent().SwitchTo().Frame("IntegratorHomeFrame");
                if (studyviewer.Thumbnails().Count == (ThumbnailCountBeforeSave_FirstStudy + 1) &&
                    studyviewer.ThumbnailCaptions()[0].Text.Contains("PR"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step  6
                // Verify the first available PR series is loaded into the top left viewer.	

                ThumbnailSeriesUID = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesUID");
                ViewerSeriesUID = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X1(), "src", '&', "seriesUID");
                String ThumbnailModality = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[0], "src", '&', "seriesModality");

                if (ThumbnailSeriesUID.Equals(ViewerSeriesUID) && ThumbnailModality.Equals("PR"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 7
                // Verify the rest of the series.
                // Expected result: The rest of the series should be loaded followed by the thumbnails.
                ThumbnailSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[1], "src", '&', "seriesUID");
                ViewerSeriesUID_2 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X2(), "src", '&', "seriesUID");
                result_1X2 = ThumbnailSeriesUID_2.Equals(ViewerSeriesUID_2);

                bool result_1X3;
                ThumbnailSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[2], "src", '&', "seriesUID");
                ViewerSeriesUID_3 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_1X3(), "src", '&', "seriesUID");
                result_1X3 = ThumbnailSeriesUID_3.Equals(ViewerSeriesUID_3);

                ThumbnailSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[3], "src", '&', "seriesUID");
                ViewerSeriesUID_4 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X1(), "src", '&', "seriesUID");
                result_2X1 = ThumbnailSeriesUID_4.Equals(ViewerSeriesUID_4);

                string ThumbnailSeriesUID_5;
                string ViewerSeriesUID_5;

                ThumbnailSeriesUID_5 = studyviewer.GetInnerAttribute(studyviewer.Thumbnails()[4], "src", '&', "seriesUID");
                ViewerSeriesUID_5 = studyviewer.GetInnerAttribute(studyviewer.SeriesViewer_2X2(), "src", '&', "seriesUID");
                result_2X2 = ThumbnailSeriesUID_5.Equals(ViewerSeriesUID_5);

                if (result_1X2 && result_1X3 && result_2X1 && result_2X2)
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                try
                {
                    login.Logout();
                    var hplogin = new HPLogin();
                    BasePage.Driver.Navigate().GoToUrl("https://" + Config.DestEAsIp + "/webadmin");
                    var hphome = hplogin.LoginHPen(Config.hpUserName, Config.hpPassword, destea: true);
                    var workflow = (WorkFlow)hphome.Navigate("Workflow");
                    workflow.NavigateToLink("Workflow", "Archive Search");
                    workflow.HPSearchStudy("PatientID", PatientID);
                    if (BasePage.Driver.FindElements(By.CssSelector("#tabrow>tbody tr")).Count > 0)
                        workflow.HPDeleteStudy();
                    hplogin.LogoutHPen();
                }
                catch (Exception e)
                {
                    Logger.Instance.InfoLog("Finally block log");
                    Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);
                }
                finally
                {
                    login.DriverGoTo(login.url);
                }
            }
        }

        /// <summary>
		/// 7.2.0 Local
		/// </summary>
		/// <param name="testid"></param>
		/// <param name="teststeps"></param>
		/// <param name="stepcount"></param>
		/// <returns></returns>
		public TestCaseResult Test_162398(String testid, String teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool servicetool = new ServiceTool();
            IntegratorStudies studies = new IntegratorStudies();
            Maintenance maintenance = null;
            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;
            Studies study = null;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);

            try
            {
                String adminUserName = Config.adminUserName;
                String adminPassword = Config.adminPassword;
                String DatasourceAutoSSA = new Login().GetHostName(Config.EA77);
                String DatasourceVMSSA131 = new Login().GetHostName(Config.EA1);
                String DatasourceVMSSA91 = new Login().GetHostName(Config.EA91);
                String DatasourceSanityPACS = new Login().GetHostName(Config.SanityPACS);
                String DatasourcePACS2 = new Login().GetHostName(Config.PACS2);
                String DatasourceDestPACS2 = new Login().GetHostName(Config.DestinationPACS);
                String URL = "http://localhost/webaccess";

                String AccessionIds = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "AccessionID");
                String[] AccessionId = AccessionIds.Split(':');
                String LastNames = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
                String[] LastName = LastNames.Split(':');

                servicetool.CloseServiceTool();
                login.DriverGoTo(login.url);
                login.LoginIConnect(Config.adminUserName, Config.adminPassword);
                study = login.Navigate<Studies>();
                study.SelectAllDateAndData();
                study.ClickSearchBtn();
                login.Logout();


                //  Pre - conditions: 
                // Change the integrator authentication. Open IntegratorAuthenticationSTS\Web.config:  C:\WebAccess\IntegratorAuthenticationSTS
                //Set the integrator authentication to local (In IntegratorAuthenticationSTS\Web.config:
                //1.Change from: "Sample.HostIntegration.Authentication.IntegratorAuthenticator, Sample.HostIntegration" to "Sample.HostIntegration.Authentication.WADBAuthenticator, Sample.HostIntegration"
                //2.Change from: storedProcedure name = "AuthenticateIntegrator" ipParam = "@ip" securityIdParam = "@securityId" to storedProcedure name = "AuthenticateUser" idParam = "@userID" passwordParam = "@password"
                //3.Change from: connectionString value = "Data Source=SOLARA\SQLEXPRESS;Initial Catalog=SAMPLEDB;User Id=sa;Password=XXXXXX" to connectionString value = "Data Source=<TestServerName>\WEBACCESS;Initial Catalog=IRWSDB;User Id=sa;Password=Cedara123".
                //4.Set the credentialsPattern to #  
                //  Note: credentialsPattern does not exist by default.i.e. < credentialsPattern pattern = "#" /> needs to be added after the storedProcedure element but still within the add element.
                // basepage.ChangeAttributeValue(@"C:\WebAccess\WebAccess\Config\DSA\DSAServerManagerConfiguration.xml", "/server[@id='ica.ldap.merge.ad']/options/hosts/host", "name", HostName);
                string hostserver = login.GetHostName(Config.IConnectIP);
                string ap = "<authProvider id=\"local\" class=\"Sample.HostIntegration.Authentication.ICADbAuthenticator\" assembly=\"Sample.HostIntegration\"></authProvider>";
                string Cstring = "<connectionString value=\"Data Source = " + hostserver + "\\WEBACCESS; Initial Catalog = IRWSDB; User Id = sa; Password = welcome@123\" />";
                string sp = "<storedProcedure name=\"AuthenticateUser\" idParam=\"@userID\" passwordParam=\"@password\" />";
                string cpat = "<credentialsPattern pattern=\"#\" />";

                basepage.RemoveNode(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add[@localName='UsernameToken']/authProvider[@id='local']");
                basepage.InsertNode(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add[@localName='UsernameToken']", ap, false);
                basepage.InsertNode(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add[@localName='UsernameToken']/authProvider[@id='local']", Cstring, false);
                basepage.InsertNode(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add[@localName='UsernameToken']/authProvider[@id='local']", sp, false);
                basepage.InsertNode(@"C:\WebAccess\IntegratorAuthenticationSTS\Web.config", "/configuration/microsoft.web.services3/security/securityTokenManager/add[@localName='UsernameToken']/authProvider[@id='local']", cpat, false);

                basepage.ChangeNodeValue(Config.FileLocationPath, "/IntegratedMode/AllowShowSelector", "True");
                basepage.ChangeNodeValue(Config.FileLocationPath, "/IntegratedMode/AllowShowSelectorSearch", "True");
                servicetool.RestartIISUsingexe();


                // Step 1
                // Open the TestEHR application. Enter the username and password of a WebAccess user into the Security ID field. Format: *^<^ *username *^>^ *#*^<^*password*^>^*
                // Example, in Security ID field type: Administrator#Administrator
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, SecurityID: "Administrator#Administrator", domain: "SuperAdminGroup", usersharing: "True", AuthProvider: "local");
                ExecutedSteps++;

                // Step 2
                // Enable Show selector, enter some search criteria and click Load.	
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                String url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url_2);
                var studyinfo = patientstudy.GetPateintList();
                if (studyinfo["Accession"][0].Equals(AccessionId[0]))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }


                // Step 3
                // Select and load one of the patients.
                patientstudy.SelectPatinet("Accession", AccessionId[0]);
                var bluviewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                var viewport = bluviewer.GetElement(BasePage.SelectorType.CssSelector, bluviewer.Activeviewport);
                var step7 = result.steps[++ExecutedSteps];
                step7.SetPath(testid, ExecutedSteps);
                if (bluviewer.CompareImage(step7, viewport))
                {
                    result.steps[ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("-->Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("-->Test Step Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 4
                // 	Return to the Image Load tab of the TestEHR application. Enter an invalid username and password in the Security ID field, enter some search criteria and click Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "invalid", domain: "SuperAdminGroup", usersharing: "True", AuthProvider: "local");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 5
                // Open the TestEHR application. Enter the username and password of a WebAccess user into the Security ID field.
                // Format: *^<^ *username *^>^ *-*^<^ *password *^>^ * Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "Administrator-Administrator", domain: "SuperAdminGroup", usersharing: "True", AuthProvider: "local");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                //login.DriverGoTo(url_2);
                //login.NavigateToIntegratorURL(url_2);
                //studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                login.CreateNewSesion();
                bluringviewer.NavigateToBluringIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 6
                // Open the TestEHR application. Enter the username of a WebAccess user and an incorrect password into the Security ID field.
                // Format: Username - Password. Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "Administrator-Administ$##", domain: "SuperAdminGroup", usersharing: "True", AuthProvider: "local");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 7
                // Open the TestEHR application. Enter the username and password of a iConnect Access user into the Security ID field.
                // Format: 12345 *^<^ *username *^>^ *@#$*^<^*password*^>^* Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "Administrator@#$Administrator", domain: "SuperAdminGroup", usersharing: "True", AuthProvider: "local");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 9
                // Open the TestEHR application. Enter the username of a WebAccess user and an incorrect password into the Security ID field.
                // Format: 12345 *^<^ *username *^>^ *@#$*^<^*password*^>^* Enter some search criteria, and select Load.
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: URL, user: "", SecurityID: "12345Administrator@#$Administrator", domain: "SuperAdminGroup", usersharing: "True", AuthProvider: "local");
                ehr.SetSelectorOptions(showSelector: "True", showReport: "True", selectorsearch: "True");
                ehr.SetSearchKeys_Study(AccessionId[0]);
                url_2 = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();

                login.CreateNewSesion();
                login.DriverGoTo(url_2);
                login.NavigateToIntegratorURL(url_2);
                studyviewer = (StudyViewer)login.NavigateToIntegratorFrame();
                if (studyviewer.AuthenticationErrorMsg().Text.Equals(AuthenticationErrorMsg))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }

                // Step 9
                // Go to another machine and log in to iConnect Access application, open the audit log.	
                login.LoginIConnect(adminUserName, adminPassword);
                maintenance = (Maintenance)login.Navigate("Maintenance");
                maintenance.Navigate("Audit");
                PageLoadWait.WaitForPageLoad(60);
                PageLoadWait.WaitForFrameLoad(60);
                maintenance.SetCheckBoxInAudit("success");
                maintenance.SetCheckBoxInAudit("minor");
                maintenance.ClickElement(maintenance.Btn_Search());
                //maintenance.Btn_Search().Click();
                PageLoadWait.WaitForLoadingMessage();
                PageLoadWait.WaitForSearchLoad();
                DataTable TableValue = maintenance.CollectRecordsInAllPages(maintenance.Tbl_EvemtsTable(), maintenance.TableHeader(), maintenance.TableRow(), maintenance.TableColumn());
                string[] AuditEvent = maintenance.GetColumnValues(TableValue, "Audit Event");
                if (AuditEvent.Contains("User Authentication/Login"))
                {
                    result.steps[++ExecutedSteps].status = "Pass";
                    Logger.Instance.InfoLog("Test Step Passed--" + result.steps[ExecutedSteps].description);
                }
                else
                {
                    result.steps[++ExecutedSteps].status = "Fail";
                    Logger.Instance.ErrorLog("Test case Failed--" + result.steps[ExecutedSteps].description);
                    result.steps[ExecutedSteps].SetLogs();
                }
                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }
            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
        }

        ///<summary> 
        ///169099 - Integrator - Allow for disabling the exam list in UV
        ///</summary>
        /// <param name="testid"></param>
        /// <param name="teststeps"></param>
        /// <param name="stepcount"></param>
        /// <returns></returns>
        public TestCaseResult Test_169099(string testid, string teststeps, int stepcount)
        {
            //Declare and initialize variables
            StudyViewer studyviewer = new StudyViewer();
            ServiceTool tool = new ServiceTool();
            Studies studies = new Studies();

            TestCaseResult result = new TestCaseResult(stepcount);
            int ExecutedSteps = -1;

            //Set up Validation Steps
            result.SetTestStepDescription(teststeps);
            string url = string.Empty;
            String Webaccessurl = "http://" + Config.IConnectIP + "/WebAccess";
            string FirstName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "FirstName");
            string LastName = (String)ReadExcel.GetTestData(filepath, "TestData", testid, "LastName");
            string Datasource = Config.EA96;
            try
            {
                //Step 1
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters( address : Webaccessurl, domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator", AuthProvider: "Bypass", autoendsession : "True", ExamList: "False");
                ehr.SetShowSelector(true);
                ehr.SetSelectorOptions(selectorsearch: "True");
                result.steps[++ExecutedSteps].StepPass();

                //Step 2
                ehr.SetSearchKeys_Study(FirstName, "First_Name");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Datasource), "Datasource");
                result.steps[++ExecutedSteps].StepPass();

                //Step 3
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                BluRingViewer viewer = new BluRingViewer();

                var patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);

                IntegratorStudies intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                var studyinfo = patientstudy.GetPateintList();
                if ((studyinfo["First Name"][0].Equals(FirstName)) && (studyinfo["Last Name"][0].Equals(LastName.ToUpper())))
                {
                    result.steps[++ExecutedSteps].StepPass();
                }
                else
                {
                    result.steps[++ExecutedSteps].StepFail();
                }

                //Step 4
                patientstudy.SelectPatinet("Last Name", LastName.ToUpper());
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count == 1)
                    result.steps[++ExecutedSteps].StepPass();
                else
                    result.steps[++ExecutedSteps].StepFail();

                //Step 5
                string leftofExamList = BasePage.FindElementByCss(BluRingViewer.HistoryPanel_div).GetAttribute("style").Split(';')[0].Split(new string[] { "left: " }, StringSplitOptions.None)[1].Split(new string[] { "px" }, StringSplitOptions.None)[0];
                if (int.Parse(leftofExamList) < 0  )
                {
                    result.steps[++ExecutedSteps].StepPass();
                }
                else
                {
                    result.steps[++ExecutedSteps].StepFail();
                }

                //Step 6
                if (!(IsElementPresent(By.CssSelector(BluRingViewer.div_ExamsIconButton))))
                {
                    result.steps[++ExecutedSteps].StepPass();
                }
                else
                {
                    result.steps[++ExecutedSteps].StepFail();
                }

                //Step 7
                ehr.LaunchEHR();
                wpfobject.GetMainWindow("Test WebAccess EHR");
                wpfobject.SelectTabFromTabItems("Image Load");
                wpfobject.WaitTillLoad();
                ehr.SetCommonParameters(address: Webaccessurl, domain: "SuperAdminGroup", role: "SuperRole", user: "Administrator", AuthProvider: "Bypass", autoendsession: "True", ExamList: "True");
                ehr.SetShowSelector(true);
                ehr.SetSelectorOptions(selectorsearch: "True");
                result.steps[++ExecutedSteps].StepPass();

                //Step 8
                ehr.SetSearchKeys_Study(FirstName, "First_Name");
                ehr.SetSearchKeys_Study(LastName, "Last_Name");
                ehr.SetSearchKeys_Study(login.GetHostName(Datasource), "Datasource");
                result.steps[++ExecutedSteps].StepPass();

                //Step 9
                url = ehr.clickCmdLine("ImageLoad");
                ehr.CloseEHR();
                login.CreateNewSesion();
                viewer = new BluRingViewer();

                patientstudy = PatientsStudy.LaunchPatientsStudyPage(url);
                intgtrStudies = (IntegratorStudies)login.NavigateToIntegratorFrame("Studies");
                studyinfo = patientstudy.GetPateintList();
                if ((studyinfo["First Name"][0].Equals(FirstName)) && (studyinfo["Last Name"][0].Equals(LastName.ToUpper())))
                {

                    result.steps[++ExecutedSteps].StepPass();
                }
                else
                {
                    result.steps[++ExecutedSteps].StepFail();
                }

                //Step 10
                patientstudy.SelectPatinet("Last Name", LastName.ToUpper());
                viewer = BluRingViewer.LaunchBluRingViewer(mode: "Integrator", showselector: true);
                if (BasePage.Driver.FindElements(By.CssSelector(BluRingViewer.div_studypanel)).Count == 1)
                    result.steps[++ExecutedSteps].StepPass();
                else
                    result.steps[++ExecutedSteps].StepFail();

                //Step 11
                leftofExamList = BasePage.FindElementByCss(BluRingViewer.HistoryPanel_div).GetAttribute("style").Split(';')[0].Split(new string[] { "left: " }, StringSplitOptions.None)[1].Split(new string[] { "px" }, StringSplitOptions.None)[0];
                if (int.Parse(leftofExamList) >= 0 && viewer.IsElementVisibleInUI(By.CssSelector(BluRingViewer.div_examListPanel)))
                {
                    result.steps[++ExecutedSteps].StepPass();
                }
                else
                {
                    result.steps[++ExecutedSteps].StepFail();
                }

                //Step 12
                if ((viewer.IsElementVisibleInUI(By.CssSelector(BluRingViewer.div_ExamsIconButton))))
                {
                    result.steps[++ExecutedSteps].StepPass();
                }
                else
                {
                    result.steps[++ExecutedSteps].StepFail();
                }


                result.FinalResult(ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Return Result
                return result;
            }

            catch (Exception e)
            {
                //Log Exception
                Logger.Instance.ErrorLog(e.Message + Environment.NewLine + e.StackTrace + Environment.NewLine + e.InnerException);

                //Report Result
                result.FinalResult(e, ExecutedSteps);
                Logger.Instance.ErrorLog("Overall Test status--" + result.status);

                //Close browser
                BasePage.Driver.Quit();
                BasePage.Driver = null;
                login = new Login();

                //Return Result
                return result;
            }
            finally
            {
                login.CreateNewSesion();
            }
            
        }



    }

}
